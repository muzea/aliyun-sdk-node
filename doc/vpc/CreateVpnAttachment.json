{"summary":"调用CreateVpnAttachment接口创建IPsec连接，用于绑定转发路由器实例。","methods":["post","get"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"readAndWrite","deprecated":false,"systemTags":{"operationType":"create","riskType":"high","chargeType":"paid"},"parameters":[{"name":"RegionId","in":"query","schema":{"description":"IPsec连接所属的地域ID。\n\n您可以通过调用[DescribeRegions](~~36063~~)接口获取地域ID。  ","type":"string","required":true,"example":"cn-hangzhou"}},{"name":"Name","in":"query","schema":{"description":"IPsec连接的名称。\n\n名称长度为1～100个字符，不能以`http://`或`https://`开头。","type":"string","required":false,"example":"nametest"}},{"name":"CustomerGatewayId","in":"query","schema":{"description":"用户网关ID。","type":"string","required":true,"example":"cgw-p0w2jemrcj5u61un8****"}},{"name":"NetworkType","in":"query","schema":{"title":"public/private","description":"IPsec连接的网络类型。取值：\n- **public**（默认值）：公网，表示IPsec连接通过公网建立加密通信通道。\n- **private**：私网，表示IPsec连接通过私网建立加密通信通道。","type":"string","required":false,"example":"public"}},{"name":"LocalSubnet","in":"query","schema":{"title":"路由模式为感兴趣流模式时，设置本端ip和对端ip","description":"需要和本地数据中心互通的VPC侧的网段，用于第二阶段协商。\n\n多个网段之间用半角逗号（,）分隔，例如：192.168.1.0/24,192.168.2.0/24。\n\n关于IPsec连接路由模式的说明：\n\n- 如果**LocalSubnet**和**RemoteSubnet**均输入为0.0.0.0/0，则表示您使用目的路由模式。\n- 如果**LocalSubnet**和**RemoteSubnet**均输入具体的网段，则表示您使用感兴趣流模式。","type":"string","required":true,"example":"10.1.1.0/24,10.1.2.0/24"}},{"name":"RemoteSubnet","in":"query","schema":{"description":"需要和VPC互通的本地数据中心侧的网段，用于第二阶段协商。\n\n多个网段之间用半角逗号（,）分隔，例如：192.168.3.0/24,192.168.4.0/24。\n\n关于IPsec连接路由模式的说明：\n\n- 如果**LocalSubnet**和**RemoteSubnet**均输入为0.0.0.0/0，则表示您使用目的路由模式。\n- 如果**LocalSubnet**和**RemoteSubnet**均输入具体的网段，则表示您使用感兴趣流模式。","type":"string","required":true,"example":"10.1.3.0/24,10.1.4.0/24"}},{"name":"EffectImmediately","in":"query","schema":{"title":"立即生效","description":"选择IPsec连接的配置是否立即生效。 取值：\n\n- **true**：是，配置完成后系统立即进行IPsec协议协商。\n- **false**（默认值）：否，当有流量进入时系统才进行IPsec协议协商。","type":"boolean","required":false,"example":"false"}},{"name":"IkeConfig","in":"query","schema":{"description":"第一阶段协商的配置信息：\n           \n- **IkeConfig.Psk**：预共享密钥，用于VPN网关与本地数据中心之间的身份认证。\n\n    - 密钥长度为1~100个字符，支持数字、大小写英文字母以及以下字符。```~!`@#$%^&*()_-+={}[]|;:',.<>/?```\n    - 若您未指定预共享密钥，系统会随机生成一个16位的字符串作为预共享密钥。您可以调用[DescribeVpnConnection](~~2526951~~)接口查询系统自动生成的预共享密钥。\n\n    > IPsec连接侧的预共享密钥需和本地数据中心侧的认证密钥一致，否则本地数据中心和VPN网关之间无法建立连接。\n\n- **IkeConfig.IkeVersion**：IKE协议的版本。取值：**ikev1**或**ikev2**。默认值：**ikev1**。   \n\n- **IkeConfig.IkeMode**：协商模式。取值：**main**或**aggressive**。默认值：**main**。   \n\n- **IkeConfig.IkeEncAlg**：第一阶段协商的加密算法。取值：**aes**、**aes192**、**aes256**、**des**或**3des**。默认值：**aes**。   \n\n- **IkeConfig.IkeAuthAlg**：第一阶段协商的认证算法。取值：**md5**、**sha1**、**sha256**、**sha384**、**sha512**。默认值：**md5**。   \n\n- **IkeConfig.IkePfs**：第一阶段协商使用的Diffie-Hellman密钥交换算法。取值：**group1**、**group2**、**group5**或**group14**。默认值：**group2**。   \n\n- **IkeConfig.IkeLifetime**：第一阶段协商出的SA的生存周期。单位：秒。取值范围：**0**~**86400**。默认值：**86400**。   \n\n- **IkeConfig.LocalId**：IPsec连接阿里云侧的标识，长度限制为100个字符。默认值为空。\n\n- **IkeConfig.RemoteId**：IPsec连接本地数据中心侧的标识，长度限制为100个字符，默认值为用户网关的IP地址。","type":"string","required":false,"example":"{\"Psk\":\"1234****\",\"IkeVersion\":\"ikev1\",\"IkeMode\":\"main\",\"IkeEncAlg\":\"aes\",\"IkeAuthAlg\":\"sha1\",\"IkePfs\":\"group2\",\"IkeLifetime\":86400,\"LocalId\":\"47.XX.XX.1\",\"RemoteId\":\"47.XX.XX.2\"}"}},{"name":"IpsecConfig","in":"query","schema":{"description":"第二阶段协商的配置信息： \n\n- **IpsecConfig.IpsecEncAlg**：第二阶段协商的加密算法。取值：**aes**、**aes192**、**aes256**、**des**或**3des**。默认值：**aes**。   \n\n- **IpsecConfig. IpsecAuthAlg**：第二阶段协商的认证算法。取值：**md5**、**sha1**、**sha256**、**sha384**、**sha512**。默认值：**md5**。   \n\n- **IpsecConfig. IpsecPfs**：第二阶段协商使用的Diffie-Hellman密钥交换算法。取值：**disabled**、**group1**、**group2**、**group5**或**group14**。默认值：**group2**。   \n\n- **IpsecConfig. IpsecLifetime**：第二阶段协商出的SA的生存周期。单位：秒。取值范围：**0**~**86400**。默认值：**86400**。   ","type":"string","required":false,"example":"{\"IpsecEncAlg\":\"aes\",\"IpsecAuthAlg\":\"sha1\",\"IpsecPfs\":\"group2\",\"IpsecLifetime\":86400}"}},{"name":"BgpConfig","in":"query","schema":{"description":"BGP的配置信息：\n\n- **BgpConfig.EnableBgp**：是否开启BGP功能。取值：**true**或**false**（默认值）。\n\n- **BgpConfig.LocalAsn**：阿里云侧的自治系统号。自治系统号取值范围：**1**~**4294967295**。默认值：**45104**。\n\n    支持按照两段位的格式进行输入，即：前16位比特.后16位比特。每个段位使用十进制输入。\n\n    例如输入123.456，则表示自治系统号：123*65536+456=8061384。\n\n- **BgpConfig.TunnelCidr**：IPsec隧道网段。该网段需是一个在169.254.0.0/16内的掩码长度为30的网段。\n\n- **LocalBgpIp**：阿里云侧的BGP地址。该地址为IPsec隧道网段内的一个IP地址。 \n\n> - 在添加BGP配置前，建议您先了解BGP动态路由功能的工作机制和使用限制。更多信息，请参见[BGP动态路由公告\n](~~170235~~)。\n> - 建议您使用自治系统号的私有号码与阿里云建立BGP连接。自治系统号的私有号码范围请自行查阅文档。","type":"string","required":false,"example":"{\"EnableBgp\":\"true\",\"LocalAsn\":\"45104\",\"TunnelCidr\":\"169.254.11.0/30\",\"LocalBgpIp\":\"169.254.11.1\"}"}},{"name":"HealthCheckConfig","in":"query","schema":{"description":"健康检查配置信息：\n\n- **HealthCheckConfig.enable**：是否开启健康检查，取值：**true**或**false**（默认值）。\n\n- **HealthCheckConfig.dip**：健康检查的目的IP地址。输入VPC侧通过IPsec连接可以访问的本地数据中心的IP地址。\n\n- **HealthCheckConfig.sip**：健康检查的源IP地址。输入本地数据中心通过IPsec连接可以访问的VPC侧的IP地址。\n\n- **HealthCheckConfig.interval**：健康检查的重试间隔时间，单位：秒。默认值：**3**。\n\n- **HealthCheckConfig.retry**：健康检查的重试发包次数。默认值：**3**。\n\n- **HealthCheckConfig.Policy**：健康检查失败时是否撤销已发布的路由。取值：\n\n     - **revoke_route**（默认值）：撤销已发布的路由。\n     - **reserve_route**：不撤销已发布的路由。","type":"string","required":false,"example":"{\"enable\":\"true\",\"dip\":\"192.168.1.1\",\"sip\":\"10.1.1.1\",\"interval\":\"3\",\"retry\":\"3\",\"Policy\": \"revoke_route\"}"}},{"name":"AutoConfigRoute","in":"query","schema":{"description":"是否自动配置路由。取值：\n\n- **true**（默认值）：自动配置路由。\n\n- **false**：不自动配置路由。","type":"boolean","required":false,"example":"true"}},{"name":"EnableDpd","in":"query","schema":{"description":"是否开启DPD（对等体存活检测）功能。取值：\n\n- **true**（默认值）：开启DPD功能。IPsec发起端会发送DPD报文用来检测对端的设备是否存活，如果在设定时间内未收到正确回应则认为对端已经断线，IPsec将删除ISAKMP SA和相应的IPsec SA，安全隧道同样也会被删除。\n\n- **false**：不开启DPD功能，IPsec发起端不会发送DPD探测报文。","type":"boolean","required":false,"example":"true"}},{"name":"EnableNatTraversal","in":"query","schema":{"description":"是否开启NAT穿越功能。取值：\n\n- **true**（默认值）：开启NAT穿越功能。开启后，IKE协商过程会删除对UDP端口号的验证过程，同时实现对VPN隧道中NAT网关设备的发现功能。\n\n- **false**：不开启NAT穿越功能。","type":"boolean","required":false,"example":"true"}},{"name":"RemoteCaCert","in":"query","schema":{"description":"国密型VPN网关创建IPsec连接时，对端的CA证书。","type":"string","required":false,"example":"-----BEGIN CERTIFICATE----- MIIB7zCCAZW**** -----END CERTIFICATE-----"}},{"name":"ClientToken","in":"query","schema":{"description":"客户端Token，用于保证请求的幂等性。\n\n从您的客户端生成一个参数值，确保不同请求间该参数值唯一。ClientToken只支持ASCII字符。\n\n> 若您未指定，则系统自动使用API请求的**RequestId**作为**ClientToken**标识。每次API请求的**RequestId**不一样。","type":"string","required":false,"example":"123e4567-e89b-12d3-a456-4266****"}},{"name":"Tags","in":"query","style":"repeatList","schema":{"description":"IPsec连接待添加的标签列表。\n\n一次最多支持为IPsec连接添加20个标签。","type":"array","items":{"description":"标签信息。","type":"object","properties":{"Key":{"description":"标签键。一旦输入该值，则不允许为空字符串。\n\n最多支持64个字符，不能以`aliyun`和`acs:`开头，不能包含`http://`或者`https://`。\n\n一次最多支持输入20个标签键。","type":"string","required":false,"example":"TagKey"},"Value":{"description":"标签值。\n\n标签值最多支持128个字符，可以为空字符串，不能以`aliyun`和`acs:`开头，不能包含`http://`或者`https://`。\n\n一个标签键对应一个标签值。一次最多支持输入20个标签值。","type":"string","required":false,"example":"TagValue"}},"required":false},"required":false,"maxItems":21}},{"name":"ResourceGroupId","in":"query","schema":{"description":"IPsec连接所属的资源组ID。\n\n- 您可以调用[ListResourceGroups](~~158855~~)接口查询资源组ID。\n- 如果您未指定资源组ID，IPsec连接创建后将归属于默认资源组。","type":"string","required":false,"example":"rg-acfmzs372yg****"}}],"responses":{"200":{"schema":{"description":"返回结果。","type":"object","properties":{"RequestId":{"description":"请求ID。","type":"string","example":"88187252-0E26-3C4D-9D1D-32A04454EBBA"},"VpnConnectionId":{"description":"IPsec连接ID。","type":"string","example":"vco-p0wb09rama8qwwgfn****"},"Name":{"description":"IPsec连接的名称。","type":"string","example":"nametest"},"CreateTime":{"description":"创建IPsec连接的时间戳。单位：毫秒。\n\n时间戳的格式采用Unix时间戳，表示从格林威治时间1970年01月01日00时00分00秒至创建IPsec连接时的总时长。","type":"integer","format":"int64","example":"1658201810000"},"Code":{"description":"当前任务返回的状态码。**200**表示任务成功。","type":"string","example":"200"},"Success":{"description":"当前任务是否成功执行。\n\n- **true**：已成功执行。\n- **false**：未能成功执行。","type":"boolean","example":"true"},"Message":{"description":"当前任务返回的信息。","type":"string","example":"successful"}}}}},"errorCodes":{"400":[{"errorCode":"VpnRouteEntry.AlreadyExists","errorMessage":"The specified route entry is already exist."},{"errorCode":"VpnRouteEntry.Conflict","errorMessage":"The specified route entry has conflict."},{"errorCode":"NotSupportVpnConnectionParameter.IpsecPfs","errorMessage":"The specified vpn connection ipsec Ipsec Pfs is not support."},{"errorCode":"NotSupportVpnConnectionParameter.IpsecAuthAlg","errorMessage":"The specified vpn connection ipsec Auth Alg is not support."},{"errorCode":"VpnRouteEntry.BackupRoute","errorMessage":"Validate backup route entry failed."},{"errorCode":"VpnRouteEntry.InvalidWeight","errorMessage":"Invalid route entry weight value."},{"errorCode":"InvalidParameter.VpnConnectionName","errorMessage":"The specified vpn connection name is invalid."},{"errorCode":"QuotaExceeded.PolicyBasedRoute","errorMessage":"The maximum number of policy-based routes is exceeded. Existing routes: %s. Routes to be created: %s. Maximum routes: %s."},{"errorCode":"MissingParameter.TunnelCidr","errorMessage":"The parameter TunnelCidr is mandatory when BGP is enabled."},{"errorCode":"MissingParam.CustomerGatewayAsn","errorMessage":"Asn of customer gateway is mandatory when BGP is enabled."},{"errorCode":"IllegalParam.LocalAsn","errorMessage":"The specified LocalAsn is invalid."},{"errorCode":"InvalidParameter.BgpConfig","errorMessage":"The specified BgpConfig is invalid."},{"errorCode":"IllegalParam.TunnelCidr","errorMessage":"The specified TunnelCidr is invalid."},{"errorCode":"InvalidLocalBgpIp.Malformed","errorMessage":"The specified LocalBgpIp is malformed."},{"errorCode":"IllegalParam.LocalSubnet","errorMessage":"The specified \"LocalSubnet\" (%s) is invalid."},{"errorCode":"IllegalParam.RemoteSubnet","errorMessage":"The specified \"RemoteSubnet\" (%s) is invalid."},{"errorCode":"IllegalParam.LocalBgpIp","errorMessage":"The specified LocalBgpIp is invalid."},{"errorCode":"OperationFailed.MissCertificate","errorMessage":"The VPN connecton has not associated any certificates."},{"errorCode":"MissingParam.RemoteId","errorMessage":"The remote ID is mandatory when creating national standard VPN connection."},{"errorCode":"IllegalParam.EnableBgp","errorMessage":"VPN connection must enable BGP when VPN gateway has enabled BGP."},{"errorCode":"Forbidden.TagKey.Duplicated","errorMessage":"The specified tag key already exists."},{"errorCode":"SizeLimitExceeded.TagNum","errorMessage":"The maximum number of tags is exceeded."},{"errorCode":"InvalidParameter.TagValue","errorMessage":"The specified parameter TagValue is invalid."},{"errorCode":"InvalidParameter.TagKey","errorMessage":"The specified parameter TagKey is invalid."},{"errorCode":"Duplicated.TagKey","errorMessage":"The specified parameter TagKey is duplicated."},{"errorCode":"InternalError","errorMessage":"The request processing has failed due to some unknown error, exception or failure."},{"errorCode":"InvalidTunnelCidr.Malformed","errorMessage":"The specified TunnelCidr is malformed."},{"errorCode":"OperationFailed.NoAvailableAmount","errorMessage":"The available amount of your account is less than 0, please recharge before attempting to purchase."},{"errorCode":"OperationUnsupported.EnableBgp","errorMessage":"Current region does not support enable BGP."}],"403":[{"errorCode":"Forbbiden.SubUser","errorMessage":"User not authorized to operate on the specified resource as your account is created by another user."},{"errorCode":"Forbidden","errorMessage":"User not authorized to operate on the specified resource."}],"404":[{"errorCode":"InvalidCustomerGatewayInstanceId.NotFound","errorMessage":"The specified customer gateway instance id does not exist."}]},"staticInfo":{"returnType":"asynchronous","callback":"Vpc::2016-04-28::DescribeVpnConnection","callbackInterval":2000,"maxCallbackTimes":10},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"RequestId\\\": \\\"88187252-0E26-3C4D-9D1D-32A04454EBBA\\\",\\n  \\\"VpnConnectionId\\\": \\\"vco-p0wb09rama8qwwgfn****\\\",\\n  \\\"Name\\\": \\\"nametest\\\",\\n  \\\"CreateTime\\\": 1658201810000,\\n  \\\"Code\\\": \\\"200\\\",\\n  \\\"Success\\\": true,\\n  \\\"Message\\\": \\\"successful\\\"\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<CreateVpnAttachmentResponse>\\n    <RequestId>88187252-0E26-3C4D-9D1D-32A04454EBBA</RequestId>\\n    <VpnConnectionId>vco-p0wb09rama8qwwgfn****</VpnConnectionId>\\n    <Name>nametest</Name>\\n    <CreateTime>1658201810000</CreateTime>\\n    <Code>200</Code>\\n    <Success>true</Success>\\n    <Message>successful</Message>\\n</CreateVpnAttachmentResponse>\",\"errorExample\":\"\"}]","title":"创建IPsec连接","description":"调用`CreateVpnAttachment`接口创建的IPsec连接默认未绑定任何资源，后续您可以通过调用[CreateTransitRouterVpnAttachment](~~443993~~)接口将IPsec连接绑定转发路由器实例。\n\n### 前提条件\n\n创建IPsec连接前，请确保您已经在IPsec连接所在的地域创建了用户网关。具体操作，请参见[CreateCustomerGateway](~~120368~~)。\n        \n如果您需要为IPsec连接添加BGP配置，请确保用户网关已添加了自治系统号。"}