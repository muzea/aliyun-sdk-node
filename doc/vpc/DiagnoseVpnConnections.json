{"summary":"调用DiagnoseVpnConnections接口诊断IPsec连接。","methods":["post"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"read","deprecated":false,"systemTags":{"operationType":"get"},"parameters":[{"name":"RegionId","in":"query","allowEmptyValue":false,"schema":{"description":"IPsec连接所属地域ID。\n\n您可以通过调用[DescribeRegions](~~36063~~)接口获取地域ID。  ","type":"string","required":true,"example":"cn-qingdao"}},{"name":"VpnGatewayId","in":"query","schema":{"description":"VPN网关实例ID。","type":"string","required":false,"example":"vpn-bp10hz6b0mbp39flt****"}},{"name":"VpnConnectionIds","in":"query","style":"repeatList","schema":{"description":"IPsec连接ID列表。","type":"array","items":{"description":"IPsec连接ID。\n\n> 如果IPsec连接为单隧道模式，该参数必填。","type":"string","required":false,"example":"vco-bp1spxu8hlcvpd7ry****"},"required":false,"maxItems":51}},{"name":"TunnelIds","in":"query","allowEmptyValue":true,"style":"repeatList","schema":{"description":"隧道ID列表。","type":"array","items":{"description":"隧道ID。\n\n> 如果IPsec连接为双隧道模式，该参数必填。","type":"string","required":false,"example":"tun-64n1sr9dig64k6****"},"required":false,"maxItems":100}},{"name":"PageNumber","in":"query","schema":{"description":"列表的页码。默认值：**1**。","type":"integer","format":"int32","required":false,"example":"1"}},{"name":"PageSize","in":"query","schema":{"description":"分页查询时每页的条目数。默认值：**10**。","type":"integer","format":"int32","required":false,"example":"10"}}],"responses":{"200":{"schema":{"title":"Schema of Response","description":"返回结果。","type":"object","properties":{"RequestId":{"title":"Id of the request","description":"请求ID。","type":"string","example":"B8094E1E-935B-1397-96A8-4F87A5D1BF29"},"PageNumber":{"description":"列表的页码。","type":"integer","format":"int32","example":"1"},"PageSize":{"description":"分页查询时每页的条目数。","type":"integer","format":"int32","example":"10"},"TotalCount":{"description":"列表条目数。","type":"integer","format":"int32","example":"1"},"VpnConnections":{"description":"IPsec-VPN连接的诊断信息列表。","type":"array","items":{"description":"IPsec-VPN连接的诊断信息。","type":"object","properties":{"MismatchRemoteParam":{"description":"在IPsec连接和对端网关设备配置的参数值不匹配的情况下，本参数表示对端网关设备配置的参数值。","type":"string","example":"SHA"},"MismatchLocalParam":{"description":"在IPsec连接和对端网关设备配置的参数值不匹配的情况下，本参数表示IPsec连接配置的参数值。","type":"string","example":"SHA256"},"VpnConnectionId":{"description":"IPsec连接ID。","type":"string","example":"vco-bp1spxu8hlcvpd7ry****"},"SourceLog":{"description":"当前错误相关的日志信息。","type":"string","example":"2023-01-13 11:39:21 vco-bp1spxu8hlcvpd7ry**** [PROTO_ERR]: ikev1.c:1433:isakmp_ph1resend(): phase1 negotiation failed due to time up. [{remote id:4}{ph1: 172.16.0.88[500] <=> 192.168.0.206[500], 172.16.0.88 <=> 192.168.0.206}]"},"FailedReasonCode":{"description":"错误码。","type":"string","example":"Phase1NegotiationTimeout"},"FailedTime":{"description":"IPsec-VPN连接发生当前错误的时间戳。单位：毫秒。\n\n时间戳的格式采用Unix时间戳，表示从格林威治时间1970年01月01日00时00分00秒至IPsec-VPN连接发生当前错误时的总时长。","type":"integer","format":"int64","example":"1673581161000"},"FailedReason":{"description":"错误原因。","type":"string","example":"Phase1 negotiation timeout"},"Severity":{"description":"当前错误等级。\n\n- **Critical**：严重，请尽快排查处理。\n- **Warn**：警告，建议尽快排查处理。\n- **Normal**：正常。","type":"string","example":"Warn"},"TunnelId":{"description":"隧道ID。","type":"string","example":"tun-64n1sr9dig64k6****"}}}}}}}},"errorCodes":{"400":[{"errorCode":"InvalidParameter","errorMessage":"The parameter is invalid."}],"403":[{"errorCode":"Forbidden","errorMessage":"User not authorized to operate on the specified resource."}]},"staticInfo":{"returnType":"synchronous"},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"RequestId\\\": \\\"B8094E1E-935B-1397-96A8-4F87A5D1BF29\\\",\\n  \\\"PageNumber\\\": 1,\\n  \\\"PageSize\\\": 10,\\n  \\\"TotalCount\\\": 1,\\n  \\\"VpnConnections\\\": [\\n    {\\n      \\\"MismatchRemoteParam\\\": \\\"SHA\\\",\\n      \\\"MismatchLocalParam\\\": \\\"SHA256\\\",\\n      \\\"VpnConnectionId\\\": \\\"vco-bp1spxu8hlcvpd7ry****\\\",\\n      \\\"SourceLog\\\": \\\"2023-01-13 11:39:21 vco-bp1spxu8hlcvpd7ry**** [PROTO_ERR]: ikev1.c:1433:isakmp_ph1resend(): phase1 negotiation failed due to time up. [{remote id:4}{ph1: 172.16.0.88[500] <=> 192.168.0.206[500], 172.16.0.88 <=> 192.168.0.206}]\\\",\\n      \\\"FailedReasonCode\\\": \\\"Phase1NegotiationTimeout\\\",\\n      \\\"FailedTime\\\": 1673581161000,\\n      \\\"FailedReason\\\": \\\"Phase1 negotiation timeout\\\",\\n      \\\"Severity\\\": \\\"Warn\\\",\\n      \\\"TunnelId\\\": \\\"tun-64n1sr9dig64k6****\\\"\\n    }\\n  ]\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<DiagnoseVpnConnectionsResponse>\\n    <TotalCount>1</TotalCount>\\n    <RequestId>B8094E1E-935B-1397-96A8-4F87A5D1BF29</RequestId>\\n    <PageSize>50</PageSize>\\n    <PageNumber>1</PageNumber>\\n    <VpnConnections>\\n        <MismatchRemoteParam/>\\n        <FailedReasonCode>Phase1NegotiationTimeout</FailedReasonCode>\\n        <FailedReason>Phase1 negotiation timeout</FailedReason>\\n        <Severity>Warn</Severity>\\n        <VpnConnectionId>vco-bp1spxu8hlcvpd7ry****</VpnConnectionId>\\n        <FailedTime>1673581161000</FailedTime>\\n        <MismatchLocalParam/>\\n        <SourceLog>2023-01-13 11:39:21 vco-bp1spxu8hlcvpd7ry**** [PROTO_ERR]: ikev1.c:1433:isakmp_ph1resend(): phase1 negotiation failed due to time up. [{remote id:4}{ph1: 172.16.0.88[500] &lt;=&gt; 192.168.0.206[500], 172.16.0.88 &lt;=&gt; 192.168.0.206}]</SourceLog>\\n    </VpnConnections>\\n</DiagnoseVpnConnectionsResponse>\",\"errorExample\":\"\"}]","title":"诊断IPsec连接","description":"- 如果IPsec连接为单隧道模式，调用**DiagnoseVpnConnections**接口时，请求参数`VpnConnectionIds`必填。\n- 如果IPsec连接为双隧道模式，调用**DiagnoseVpnConnections**接口时，请求参数`TunnelIds`必填。\n- 调用**DiagnoseVpnConnections**接口后，如果当前IPsec-VPN连接存在问题，接口会返回对应的错误码（即返回参数**FailedReasonCode**）和日志信息（即返回参数**SourceLog**）。您可以根据错误码和日志信息自主排查问题。排查方法，请参见[IPsec-VPN连接常见错误及排查方法汇总](~~477862~~)。"}