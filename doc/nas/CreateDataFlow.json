{"summary":"创建一个CPFS文件系统与源端存储的数据流动。","methods":["post","get"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"read","deprecated":false,"systemTags":{"operationType":"create","abilityTreeCode":"49006","abilityTreeNodes":["FEATUREnasPWYFYN"]},"parameters":[{"name":"FileSystemId","in":"query","schema":{"description":"文件系统ID。\n\n- CPFS：必须以`cpfs-`开头，例如cpfs-125487\\*\\*\\*\\*。\n\n- CPFS智算版：必须以`bmcpfs-`开头，例如bmcpfs-0015\\*\\*\\*\\*。\n\n>仅中国站支持CPFS文件系统。","type":"string","required":true,"docRequired":true,"example":"cpfs-099394bd928c****"}},{"name":"FsetId","in":"query","schema":{"description":"Fileset ID。\n> 当文件系统类型为CPFS时，该参数必填。","type":"string","required":false,"docRequired":false,"example":"fset-1902718ea0ae****"}},{"name":"SourceStorage","in":"query","schema":{"description":"源端存储的访问地址。格式：`<storage type>://<path>`。\n\n其中：\n\n- storage type：目前只支持OSS。\n- path：OSS的Bucket名称。限制如下。\n\n    - 仅支持小写字母、数字和短划线（-）且必须以小写字母或者数字开头和结尾。\n\n    - 最长为128个字符。\n\n    - 使用UTF-8编码。\n\n> OSS Bucket必须为在该地域已存在的Bucket。","type":"string","required":true,"docRequired":true,"example":"oss://bucket-01","maxLength":128}},{"name":"SourceSecurityType","in":"query","allowEmptyValue":false,"schema":{"description":"源端存储的安全保护类型，如果源端存储必须通过安全保护访问，请指定源端存储的安全保护类型。取值：\n\n- 无（默认值）：表示源端存储不需要通过安全保护方式访问。\n- SSL：通过SSL证书保护访问。","type":"string","required":false,"example":"SSL"}},{"name":"Throughput","in":"query","schema":{"description":"数据流动的传输带宽上限，单位：MB/s 。取值： \n\n- 600\n- 1200\n- 1500\n\n> 数据流动的传输带宽必须小于文件系统的IO带宽。\n> 当文件系统类型为CPFS时，该参数必填。","type":"integer","format":"int64","required":false,"docRequired":false,"example":"600","enum":["600","1200","1500","2000"]}},{"name":"Description","in":"query","allowEmptyValue":true,"schema":{"description":"数据流动的描述。 \n\n限制：\n\n- 长度为2~128个英文或中文字符。\n- 必须以大小写字母或中文开头，不能以`http://`和`https://`开头。\n- 可以包含数字、半角冒号（:）、下划线（_）或者短划线（-）。","type":"string","required":false,"example":"Bucket01 DataFlow"}},{"name":"AutoRefreshs","in":"query","allowEmptyValue":false,"style":"repeatList","schema":{"description":"自动更新配置信息集合。\n> 当文件系统类型为CPFS时，本参数生效。","type":"array","items":{"type":"object","properties":{"RefreshPath":{"description":"自动更新目录，CPFS注册源端存储的数据修改事件，检查该目录下的源端数据是否发生更新并自动导入更新的数据。\n\n默认为空，源端存储的任何数据更新不会自动导入 CPFS，需要通过手动任务导入更新。\n\n限制：\n\n- 长度为2~1024个字符。\n- 使用UTF-8编码。\n- 必须以正斜线（/）开头和结尾。\n- 该目录必须是CPFS上的已有目录，且必须位于该数据流动的Fileset目录中。","type":"string","required":false,"example":"/prefix1/prefix2/","maxLength":1024,"minLength":2}},"required":false},"required":false,"maxItems":10}},{"name":"AutoRefreshPolicy","in":"query","schema":{"description":"自动更新策略，源端数据更新以后，数据更新导入到CPFS的策略。\n\n- None（默认值）：源端的数据更新不自动导入CPFS，用户可通过数据流动任务导入源端的数据更新。\n- ImportChanged：源端的数据更新自动导入CPFS。\n> 当文件系统类型为CPFS时，本参数生效。","type":"string","required":false,"example":"None","default":"None","enum":["None","ImportChanged"]}},{"name":"AutoRefreshInterval","in":"query","schema":{"description":"自动更新间隔时间，每隔该时间间隔，CPFS检查目录内是否存在数据更新，如果有数据更新，启动自动更新任务，单位：分钟。\n\n取值范围：10~525600，默认值：10。\n> 当文件系统类型为CPFS时，本参数生效。","type":"integer","format":"int64","required":false,"maximum":"525600","minimum":"5","example":"10","default":"10"}},{"name":"DryRun","in":"query","schema":{"description":"是否对此次创建请求执行预检。\n\n预检操作会帮助您检查参数有效性、校验库存等，并不会实际创建实例，也不会产生费用。\n\n取值：\n\n- true：发送检查请求，不会创建实例。检查项包括是否填写了必需参数、请求格式、业务限制和NAS库存。如果检查不通过，则返回对应错误。如果检查通过，则返回200 HttpCode，但FileSystemId为空。\n- false（默认）：发送正常请求，通过检查后直接创建实例。","type":"boolean","required":false,"example":"false","default":"false"}},{"name":"ClientToken","in":"query","schema":{"description":"保证请求幂等性，从您的客户端生成一个参数值，确保不同请求间该参数值唯一。\n\nClientToken只支持ASCII字符，且不能超过64个字符。更多信息，请参见[如何保证幂等性](~~25693~~)。\n\n> 若用户未指定，则系统自动使用API请求的RequestId作为ClientToken标识。每次API请求的RequestId可能不一样。","type":"string","required":false,"example":"123e4567-e89b-12d3-a456-42665544****","maxLength":64,"minLength":1}},{"name":"SourceStoragePath","in":"query","schema":{"title":"源端存储内的访问路径。","description":"源端存储Bucket内的访问路径。限制如下。\n\n   - 必须以/开头和结尾。\n\n- 区分大小写。\n\n- 长度为1~1023个字符之间。\n\n- 使用UTF-8编码。\n\n> 当文件系统类型为CPFS智算版时，本参数必填。","type":"string","required":false,"docRequired":false,"example":"/prefix/","maxLength":1023,"minLength":1}},{"name":"FileSystemPath","in":"query","schema":{"title":"CPFS文件系统内的目录。","description":"智算CPFS文件系统内的目录。限制如下。\n- 必须以/开头和结尾。\n\n- 该目录必须是智算CPFS 上的已有目录。\n\n- 长度为1~1023个字符之间。\n\n- 使用UTF-8编码。\n\n> 当文件系统类型为CPFS智算版时，本参数必填。","type":"string","required":false,"example":"/path/","maxLength":1023,"minLength":1}}],"responses":{"200":{"schema":{"type":"object","properties":{"RequestId":{"description":"请求ID。","type":"string","example":"473469C7-AA6F-4DC5-B3DB-A3DC0D****3E"},"DataFlowId":{"description":"数据流动ID。","type":"string","example":"dfid-194433a5be31****"}}}}},"errorCodes":{"400":[{"errorCode":"IllegalCharacters","errorMessage":"The parameter contains illegal characters."},{"errorCode":"MissingFsetId","errorMessage":"FsetId is mandatory for this action."},{"errorCode":"MissingSourceStorage","errorMessage":"SourceStorage is mandatory for this action."},{"errorCode":"MissingThroughput","errorMessage":"Throughput is mandatory for this action."},{"errorCode":"MissingFileSystemId","errorMessage":"FileSystemId is mandatory for this action."},{"errorCode":"InvalidFilesystemVersion.NotSupport","errorMessage":"This Api does not support this fileSystem version."}],"403":[{"errorCode":"OperationDenied.DependencyViolation","errorMessage":"The operation is denied due to dependancy violation."},{"errorCode":"OperationDenied.NoStock","errorMessage":"The operation is denied due to no stock."},{"errorCode":"OperationDenied.DependFset","errorMessage":"The operation is denied due to invalid fileset state."},{"errorCode":"OperationDenied.ConflictOperation","errorMessage":"The operation is denied due to a conflict with an ongoing operation."},{"errorCode":"OperationDenied.DependMountpoint","errorMessage":"The operation is denied because no mount point is found."},{"errorCode":"OperationDenied.FsetAlreadyInUse","errorMessage":"The Fset is already bound to another data flow."},{"errorCode":"OperationDenied.AutoRefreshNotSupport","errorMessage":"The operation is denied. Auto refresh is not supported."},{"errorCode":"OperationDenied.DependBucketTag","errorMessage":"The operation is denied. The OSS Bucket tag cpfs-dataflow is missing."},{"errorCode":"OperationDenied.DataFlowNotSupported","errorMessage":"The operation is not supported."},{"errorCode":"InvalidOperation.DeletionProtection","errorMessage":"The operation is not allowed due to resource is protected by deletion protection."}],"404":[{"errorCode":"InvalidFileSystem.NotFound","errorMessage":"The specified file system does not exist."},{"errorCode":"InvalidThroughput.OutOfBounds","errorMessage":"Throughput is out of bounds."},{"errorCode":"InvalidDescription.InvalidFormat","errorMessage":"Description format is invalid."},{"errorCode":"InvalidRefreshPath.InvalidParameter","errorMessage":"Refresh path is invalid."},{"errorCode":"InvalidRefreshPath.Duplicated","errorMessage":"Refresh path is duplicated."},{"errorCode":"InvalidRefreshPath.NotFound","errorMessage":"Refresh path does not exist."},{"errorCode":"InvalidRefreshPolicy.InvalidParameter","errorMessage":"Refresh policy is invalid."},{"errorCode":"InvalidRefreshInterval.OutOfBounds","errorMessage":"Refresh interval is out of bounds."},{"errorCode":"InvalidSourceStorage.Unreachable","errorMessage":"Source storage cannot be accessed."},{"errorCode":"InvalidSourceStorage.NotFound","errorMessage":"Source storage is not found."},{"errorCode":"InvalidSourceStorage.NotSupport","errorMessage":"Source storage type is not supported."},{"errorCode":"InvalidSourceStorage.PermissionDenied","errorMessage":"The source storage access permission is denied."},{"errorCode":"InvalidSourceStorage.InvalidRegion","errorMessage":"Source storage region is invalid."},{"errorCode":"InvalidSourceStorage.InvalidParameter","errorMessage":"Source storage has invalid parameters."},{"errorCode":"InvalidSourceSecurityType.NotSupport","errorMessage":"The source security type is not supported."},{"errorCode":"InvalidAutoRefresh.TooManyAutoRefreshes","errorMessage":"The number of auto refreshes exceeds the limit."},{"errorCode":"InvalidSourceStorage.NeedVersioning","errorMessage":"Source storage must enable versioning."},{"errorCode":"InvalidFsetId.NotFound","errorMessage":"The specified Fileset ID does not exist."}]},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"RequestId\\\": \\\"473469C7-AA6F-4DC5-B3DB-A3DC0D****3E\\\",\\n  \\\"DataFlowId\\\": \\\"dfid-194433a5be31****\\\"\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<CreateDataFlowResponse>\\n    <RequestId>473469C7-AA6F-4DC5-B3DB-A3DC0D****3E</RequestId>\\n    <DataFlowId>dfid-194433a5be31****</DataFlowId>\\n</CreateDataFlowResponse>\",\"errorExample\":\"\"}]","title":"创建数据流动","description":"- 基础操作\n    -  文件存储CPFS 2.2.0及以上版本、智算CPFS 2.4.0及以上版本支持数据流动。\n    -  文件存储CPFS、CPFS智算版状态为运行中，才能创建数据流动。\n    -  一个文件存储CPFS 或者CPFS智算版文件系统最大允许创建10个数据流动。\n    -  创建数据流动一般耗时2～5分钟，您可通过DescribeDataFlows检查数据流动创建是否完成。\n\n- 权限\n\n    创建数据流动时，文件存储CPFS会获取`AliyunServiceRoleForNasOssDataflow`和`AliyunServiceRoleForNasEventNotification`两个服务关联角色。更多信息，请参见[CPFS服务关联角色](~~185138~~)。\n\n- CPFS使用说明\n  - 计费\n\n    - 创建数据流动将按照数据流动带宽计费。更多信息，请参见[CPFS计费说明](~~111858~~)。\n    - 使用自动更新（AutoRefresh）时，需要通过EventBridge收集源端OSS存储的对象修改事件，事件将产生费用。更多信息，请参见[EventBridge计费说明](~~163752~~)。\n\n  - 数据流动规格\n      - 数据流动带宽（Throughput）支持600 MB/s、1200 MB/s和1500 MB/s三种规格。数据流动带宽是指该数据流动进行导入或导出数据时能达到的最大传输带宽。\n    - 创建一个数据流动，会消耗1个文件存储CPFS挂载点使用的vSwitch IP地址，请您确保该vSwitch IP资源充足。\n    - 库存查询：当设置DryRun为true时，可校验创建该规格的数据流动的资源是否满足。\n\n  - Fileset\n    - 数据流动的目的端是CPFS文件系统中的Fileset。Fileset是CPFS文件系统中一种新的目录树结构，是在父文件系统中的一个小型文件系统，拥有独立的inode空间和管理能力。\n    -  当文件系统类型为CPFS时，创建数据流动时该Fileset必须已存在，且不能与其他Fileset嵌套。一个Fileset上只能创建一个数据流动，对应一个源端存储。\n    - Fileset内的文件数量上限是100万，如果从OSS Bucket导入的文件数量超过上限，创建新文件会报错`no space`。\n   > 如果Fileset中已存在数据，创建数据流动后，Fileset内的已有数据会被清空，替换为OSS端同步过来的数据。\n\n  - 自动更新\n    -  配置自动更新（AutoRefresh）后，当源端存储数据发生变化时，变化的元数据会自动同步到CPFS文件系统，变化的数据会在用户访问文件时按需加载，或者启动数据流动任务加载数据。\n    -  自动更新依赖EventBridge收集源端OSS存储的对象修改事件。需要先[开通EventBridge服务](~~182246~~)。\n    -  自动更新的作用范围是prefix，由参数RefreshPath指定。一个数据流动最多可配置5个自动更新目录。\n    -  自动更新间隔（AutoRefreshInterval）指CPFS设置的自动更新时间，检查源端OSS Bucket该prefix内是否存在数据更新，如果有数据更新则启动自动更新任务。当OSS源端的对象修改事件频率超过CPFS数据流动处理能力时，自动更新任务会堆积，元数据更新会延迟，数据流动的状态为`Misconfigured`，您可以提升数据流动规格，或者降低OSS修改频率来解决。\n    -  在文件存储CPFS数据流动对prefix配置自动更新时，会在用户侧创建事件总线，并创建源端OSS Bucket的prefix的事件规则。当源端OSS Bucket的prefix内发生对象修改后，会在EventBridge中产生OSS事件，由CPFS数据流动处理。\n     > 文件存储CPFS在EventBridge创建的事件总线、事件规则带有`Create for cpfs auto refresh`的描述，事件总线、事件规则都不能修改或删除，否则自动更新无法正常工作。\n\n  -  源端存储\n     -  源端存储仅支持OSS。数据流动的源端存储（SourceStorage）必须是OSS Bucket。\n     -  CPFS数据流动支持加密和非加密两种方式访问OSS。选择加密（SSL）方式访问OSS时，需确认OSS Bucket的传输加密支持加密访问方式。\n     -  如果多个CPFS的数据流动、或者同一个文件存储CPFS的多个数据流动的源端存储是同一个OSS Bucket，为了防止多个文件存储CPFS向同一个源导出数据产生数据冲突，需要该OSS Bucket开启版本控制。\n     -  不支持跨地域的OSS数据流动，OSS Bucket必须与CPFS文件系统在同一个地域。\n       > 创建数据流动前，您需要先给源端OSS Bucket设置标签（key: cpfs-dataflow, value: true），以便CPFS数据流动访问该Bucket的数据。在数据流动的使用过程中，不能删除和修改该标签，否则CPFS数据流动无法访问Bucket的数据。\n\n- CPFS智算版使用说明\n\n  -  源端存储\n      -  源端存储仅支持OSS。数据流动的源端存储（SourceStorage）必须是OSS Bucket。\n      -  CPFS智算版数据流动支持加密和非加密两种方式访问OSS。选择加密（SSL）方式访问OSS时，需确认OSS Bucket的传输加密支持加密访问方式。\n      -  如果多个CPFS智算版的数据流动、或者同一个CPFS智算版的多个数据流动的源端存储是同一个OSS Bucket，为了防止多个CPFS智算版向同一个源导出数据产生数据冲突，需要该OSS Bucket开启版本控制。\n      -  不支持跨地域的OSS数据流动，OSS Bucket必须与CPFS文件系统在同一个地域。\n       > 创建数据流动前，您需要先给源端OSS Bucket设置标签（key: cpfs-dataflow, value: true），以便CPFS智算版数据流动访问该Bucket的数据。在数据流动的使用过程中，不能删除和修改该标签，否则CPFS智算版数据流动无法访问Bucket的数据。\n\n  - 数据流动对文件系统的限制\n\n    - 在数据流动关联的文件系统路径中，不可对非空目录执行重命名操作，否则报错Permission Denied或者目录非空。\n     - 目录、文件名中的特殊字符需要谨慎使用，支持大小写字母、数字、感叹号（！）、短划线（-）、下划线（_）、半角句号（.）、星号（*）和半角圆括号（()）。\n    - 不支持超长路径，数据流动支持的路径最大长度是1023字符。\n\n  - 数据流动导入限制\n\n    - Symlink类型的文件导入到CPFS智算版后，会转变为包含数据的普通文件，并丢失Symlink信息。\n    - 如果OSS Bucket存在多个版本，则只复制最新的版本。\n    - 不支持长度大于255字节的文件名或子目录名。\n  - 数据流动导出限制\n\n    - Symlink类型的文件在同步到OSS后，不会同步Symlink所指向的文件，而是会变成一个普通的无数据空白对象。\n    - Hardlink类型的文件仅作为普通文件同步到OSS。\n    - Socket、Device、Pipe类型的文件导出到OSS Bucket时，会变成一个普通的无数据空白对象。\n    - 不支持长度大于1023字符的目录路径。"}