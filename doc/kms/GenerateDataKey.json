{"summary":"调用GenerateDataKey接口生成一个随机的数据密钥，用于本地数据加密。","methods":["post","get"],"schemes":["https"],"security":[{"AK":[]}],"operationType":"read","deprecated":false,"systemTags":{"operationType":"get"},"parameters":[{"name":"KeyId","in":"query","schema":{"description":"密钥的ID，也可以指定为密钥别名或密钥资源名称（ARN）。关于别名的详细介绍，请参见[管理密钥别名](~~480655~~)。\n>访问其他阿里云账号下的密钥时，必须输入密钥ARN。密钥ARN的格式为`acs:kms:${region}:${account}:key/${keyid}`。\n\n                           ","type":"string","required":true,"docRequired":true,"example":"key-hzz630494463ejqjx****"}},{"name":"KeySpec","in":"query","schema":{"description":"指定生成的数据密钥的长度，取值：\n\n- AES_256：256比特的对称密钥。\n\n- AES_128：128比特的对称密钥。\n\n> 建议使用KeySpec或者NumberOfBytes来指定数据密钥长度。如果两者都不指定，KMS生成256比特的数据密钥；如果两者都被指定，KMS会忽略KeySpec参数。","type":"string","required":false,"example":"AES_256","enum":["AES_256"," AES_128"]}},{"name":"NumberOfBytes","in":"query","schema":{"description":"指定生成的数据密钥的长度，单位为字节。\n\n取值：1~1024。\n\n默认值：\n- 当KeySpec取值为AES_256时，NumberOfBytes默认值为32。\n- 当KeySpec取值为AES_128时，NumberOfBytes默认值为16。","type":"integer","format":"int32","required":false,"maximum":"1024","minimum":"0","example":"256"}},{"name":"EncryptionContext","in":"query","style":"json","schema":{"description":"key/value对的JSON字符串。\n\n如果指定了该参数，则在调用[Decrypt](~~28950~~)接口时需要提供同样的参数。更多信息，请参见[EncryptionContext](~~42975~~)。\n                           ","type":"object","required":false,"example":"{\"Example\":\"Example\"}"}}],"responses":{"200":{"schema":{"type":"object","properties":{"KeyVersionId":{"description":"密钥版本ID。主密钥版本的全局唯一标识符。","type":"string","example":"2ab1a983-7072-4bbc-a582-584b5bd8****"},"KeyId":{"description":"密钥ID。如果请求中的KeyId参数使用的是密钥别名、密钥ARN，在响应中也会返回密钥ID。","type":"string","example":"key-hzz630494463ejqjx****"},"CiphertextBlob":{"description":"数据密钥被指定密钥的主版本加密后的密文。","type":"string","example":"ODZhOWVmZDktM2QxNi00ODk0LWJkNGYtMWZjNDNmM2YyYWJmS7FmDBBQ0BkKsQrtRnidtPwirmDcS0ZuJCU41xxAAWk4Z8qsADfbV0b+i6kQmlvj79dJdGOvtX69Uycs901qOjop4bTS****"},"RequestId":{"description":"本次调用请求的ID，是由阿里云为该请求生成的唯一标识符，可用于排查和定位问题。","type":"string","example":"7021b6ec-4be7-4d3c-8a68-1e85d4d515a0"},"Plaintext":{"description":"数据密钥的明文经过Base64编码后的值。","type":"string","example":"QmFzZTY0IGVuY29kZWQgcGxhaW50****"}}}}},"errorCodes":{"400":[{"errorCode":"UnsupportedOperation","errorMessage":"This action is not supported."}],"404":[{"errorCode":"Forbidden.AliasNotFound","errorMessage":"The specified Alias is not found."},{"errorCode":"Forbidden.KeyNotFound","errorMessage":"The specified Key is not found."}],"409":[{"errorCode":"Rejected.Disabled","errorMessage":"The request was rejected because the key state is Disabled."},{"errorCode":"Rejected.PendingDeletion","errorMessage":"The request was rejected because the key state is PendingDeletion."},{"errorCode":"Rejected.Unavailable","errorMessage":"The request was rejected because the key state is Unavailable."}]},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"KeyVersionId\\\": \\\"2ab1a983-7072-4bbc-a582-584b5bd8****\\\",\\n  \\\"KeyId\\\": \\\"key-hzz630494463ejqjx****\\\",\\n  \\\"CiphertextBlob\\\": \\\"ODZhOWVmZDktM2QxNi00ODk0LWJkNGYtMWZjNDNmM2YyYWJmS7FmDBBQ0BkKsQrtRnidtPwirmDcS0ZuJCU41xxAAWk4Z8qsADfbV0b+i6kQmlvj79dJdGOvtX69Uycs901qOjop4bTS****\\\",\\n  \\\"RequestId\\\": \\\"7021b6ec-4be7-4d3c-8a68-1e85d4d515a0\\\",\\n  \\\"Plaintext\\\": \\\"QmFzZTY0IGVuY29kZWQgcGxhaW50****\\\"\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<GenerateDataKeyResponse>\\n    <KeyVersionId>2ab1a983-7072-4bbc-a582-584b5bd8****</KeyVersionId>\\n    <KeyId>key-hzz630494463ejqjx****</KeyId>\\n    <CiphertextBlob>ODZhOWVmZDktM2QxNi00ODk0LWJkNGYtMWZjNDNmM2YyYWJmS7FmDBBQ0BkKsQrtRnidtPwirmDcS0ZuJCU41xxAAWk4Z8qsADfbV0b+i6kQmlvj79dJdGOvtX69Uycs901qOjop4bTS****</CiphertextBlob>\\n    <RequestId>7021b6ec-4be7-4d3c-8a68-1e85d4d515a0</RequestId>\\n    <Plaintext>QmFzZTY0IGVuY29kZWQgcGxhaW50****</Plaintext>\\n</GenerateDataKeyResponse>\",\"errorExample\":\"\"}]","title":"生成一个数据密钥","description":"### 注意事项\n\n- 非KMS实例中的密钥：进行密码运算时，仅支持通过阿里云SDK调用OpenAPI。\n\n- KMS实例中的密钥：进行密码运算时，支持如下两种方式。\n\n  - 方式一（推荐）：通过KMS实例SDK调用KMS实例API。详细介绍，请参见[KMS实例SDK](~~601593~~)、[KMS实例API](~~601485~~)。\n  - 方式二：通过阿里云SDK调用OpenAPI，但认证方式仅支持可信实体为阿里云服务的RAM角色。详细信息，请参见[创建可信实体为阿里云服务的RAM角色](~~116800~~)。\n\n### QPS限制\n本接口的单用户QPS限制为750次/秒。超过限制，API调用将会被限流，这可能影响您的业务，请合理调用。\n\n\n### 详细说明\nAPI随机生成的数据密钥通过您指定的主密钥（CMK）加密后，返回数据密钥的密文和明文。您可以使用返回的数据密钥明文，在KMS之外对数据进行本地离线加密。在存储加密后的数据时，也需要存储数据密钥的密文。您可以通过响应中的Plaintext字段获取到数据密钥的明文，通过CiphertextBlob字段获取到数据密钥的密文。\n\n在请求中指定的CMK，仅会被用作数据密钥的加密，和数据密钥的生成无关。KMS不会记录或存储随机生成的数据密钥，您需要负责对数据密钥（密文）进行持久化。\n\n建议您使用以下方式在本地进行数据加密：\n\n1.调用GenerateDataKey接口，获得用于数据加密的密钥。\n\n2.使用数据密钥的明文（通过响应中的Plaintext字段返回），在本地完成离线数据加密，随后清除内存中的数据密钥明文。\n\n3.将数据密钥的密文（通过响应中的CiphertextBlob字段返回），和本地离线加密后的数据一并进行存储。\n\n在本地解密数据：\n\n- 调用[Decrypt](~~28950~~)接口解密本地存储的数据密钥的密文。该操作将返回数据密钥的明文。\n- 使用数据密钥的明文，在本地完成离线数据解密，随后清除内存中的数据密钥明文。\n\n本文将提供一个示例，为ID为`key-hzz630494463ejqjx****`的密钥生成随机的数据密钥。","requestParamsDescription":"关于公共请求参数的详情，请参见[公共参数](~~69007~~)。","responseParamsDescription":" ","extraInfo":" "}