{"summary":"来完成整个文件的分片上传。","path":"/{key}","methods":["post"],"schemes":["http","https"],"security":[{"AK":[]}],"consumes":["application/xml"],"produces":["application/xml"],"operationType":"write","deprecated":false,"systemTags":{"operationType":"create"},"parameters":[{"name":"bucket","in":"host","schema":{"description":"Bucket名称。","type":"string","required":true,"example":"examplebucket"}},{"name":"key","in":"path","schema":{"description":"Object完整路径。","type":"string","required":true,"example":"exampledir/exampleobject.txt"}},{"name":"uploadId","in":"query","schema":{"description":"此次MultipartUpload事件的唯一标识。","type":"string","required":true,"example":"0004B9895DBBB6E****"}},{"name":"encoding-type","in":"query","schema":{"description":"指定对返回的Key进行编码，目前只支持URL编码。\n\n\nKey使用UTF-8字符，但XML 1.0标准不支持解析一些控制字符，例如ASCII码值从0到10的字符。当Key中包含XML 1.0标准不支持的控制字符时，您可以通过指定Encoding-type对返回的Key进行编码。\n\n默认值：无\n\n有效值：url","required":false,"$ref":"#/components/schemas/EncodeType"}},{"name":"x-oss-forbid-overwrite","in":"header","schema":{"description":"指定CompleteMultipartUpload操作时是否覆盖同名Object。\n\n- 不指定x-oss-forbid-overwrite或者指定x-oss-forbid-overwrite为false时，表示允许覆盖同名Object。\n- 指定x-oss-forbid-overwrite为true时，表示禁止覆盖同名Object。\n\n> \n- 当目标Bucket的版本控制状态为“开启”或“暂停”时，x-oss-forbid-overwrite请求Header设置无效，即允许覆盖同名Object。\n- 设置x-oss-forbid-overwrite请求Header会导致QPS处理性能下降，如果您有大量的操作需要使用x-oss-forbid-overwrite请求Header（QPS > 1000），请工单联系我们进行确认，避免影响您的业务。","type":"string","required":false,"example":"true"}},{"name":"x-oss-complete-all","in":"header","schema":{"description":"指定是否列举当前UploadId已上传的所有Part。\n\n- 如果指定了x-oss-complete-all:yes，则OSS会列举当前UploadId已上传的所有Part，然后按照PartNumber的序号排序并执行CompleteMultipartUpload操作。执行CompleteMultipartUpload过程中无法检测正在上传或者漏传的Part，因此用户需要自己确保Part的完整性。\n- 如果指定了x-oss-complete-all:yes，则不允许继续指定body，否则报错。\n- 如果指定了x-oss-complete-all:yes，response的格式保持不变。","type":"string","required":false,"example":"yes"}},{"name":"body","in":"body","style":"xml","schema":{"description":"保存CompleteMultipartUpload请求内容的请求体。","type":"object","properties":{"CompleteMultipartUpload":{"description":"保存CompleteMultipartUpload请求内容的容器。","required":false,"$ref":"#/components/schemas/CompleteMultipartUpload"}},"required":false}}],"responses":{"200":{"headers":{"x-oss-version-id":{"schema":{"title":"文件版本id","type":"string"}}},"schema":{"description":"保存CompleteMultipartUpload请求结果的响应体。","type":"object","properties":{"CompleteMultipartUploadResult":{"description":"保存CompleteMultipartUpload请求响应内容的容器。","type":"object","properties":{"EncodingType":{"description":"是否对返回的key进行编码。","type":"string","example":"url"},"Location":{"description":"新创建Object的URL。","type":"string","example":"http://oss-example.oss-cn-hangzhou.aliyuncs.com/multipart.data"},"Bucket":{"description":"Bucket名称。","type":"string","example":"example-bucket"},"Key":{"description":"新创建Object的名字。","type":"string","example":"multipart.data"},"ETag":{"description":"Object生成时会创建相应的ETag ，ETag用于标识一个Object的内容。\n\n通过CompleteMultipartUpload请求创建的Object，ETag值是基于一定计算规则生成的唯一值，但不是其内容的MD5值。\n\n>ETag值可以用于检查Object内容是否发生变化。不建议使用ETag作为Object内容的MD5来校验数据完整性。","type":"string","example":"\"B864DB6A936D376F9F8D3ED3BBE540****\""}}}}}},"5XX":{}},"staticInfo":{"returnType":"synchronous"},"responseDemo":"[{\"errorExample\":\"\",\"example\":\"{\\n  \\\"CompleteMultipartUploadResult\\\": {\\n    \\\"EncodingType\\\": \\\"url\\\",\\n    \\\"Location\\\": \\\"http://oss-example.oss-cn-hangzhou.aliyuncs.com/multipart.data\\\",\\n    \\\"Bucket\\\": \\\"example-bucket\\\",\\n    \\\"Key\\\": \\\"multipart.data\\\",\\n    \\\"ETag\\\": \\\"\\\\\\\"B864DB6A936D376F9F8D3ED3BBE540****\\\\\\\"\\\"\\n  }\\n}\",\"type\":\"json\"}]","title":"完成整个文件的分片上传","description":"**注意事项**\n\n\n调用CompleteMultipartUpload操作时，用户必须提供所有有效的Part列表（包括PartNumber和ETag）。OSS收到用户提交的Part列表后，会逐一验证每个Part的有效性。当所有的Part验证通过后，OSS将把这些Part组合成一个完整的Object。\n- 确认Part的大小：CompleteMultipartUpload时会确认除最后一个Part以外所有Part的大小是否都大于或等于100 KB，并检查用户提交的Part列表中的每一个PartNumber和ETag。所以在上传Part时，客户端除了需要记录Part号码外，还需要记录每次上传Part成功后服务器返回的ETag值。\n\n- 处理请求：由于OSS处理CompleteMultipartUpload请求时会持续一定的时间。在这段时间内，如果客户端与OSS之间连接中断，OSS仍会继续该请求。\n\n- PartNumber：服务端在调用CompleteMultipartUpload接口时会对PartNumber做校验。\nPartNumber取值为1~10000。PartNumber可以不连续，但必须升序排列。例如第一个Part的PartNumber是1，第二个Part的PartNumber可以是5。\n\n- UploadId：同一个Object可以同时拥有不同的UploadId，当Complete一个UploadId后，此UploadId将无效，但该Object的其他UploadId不受影响。\n\n- x-oss-server-side-encryption请求头：如果调用InitiateMultipartUpload接口时，指定了x-oss-server-side-encryption请求头，则在CompleteMultipartUpload的响应头中返回x-oss-server-side-encryption，其值表示该Object的服务器端加密算法。\n\n**版本控制**\n\n在开启版本控制的情况下，调用CompleteMultipartUpload接口来完成整个文件的MultipartUpload，OSS会为整个文件生成唯一的版本ID，并在响应header中以x-oss-version-id的形式返回。"}