{"summary":"用自然语句从指定文档库检索向量和元数据。","methods":["post","get"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"readAndWrite","deprecated":false,"systemTags":{"operationType":"create","abilityTreeCode":"197792","abilityTreeNodes":["FEATUREgpdb4XJLZD"]},"parameters":[{"name":"DBInstanceId","in":"query","schema":{"description":"实例ID。\n\n> 您可以调用[DescribeDBInstances](~~86911~~)接口查看目标地域下所有的AnalyticDB PostgreSQL实例的详情，包括实例ID。","type":"string","required":true,"example":"gp-xxxxxxxxx"}},{"name":"Namespace","in":"query","schema":{"description":"命名空间，默认为public。\n\n> 您可以通过[CreateNamespace](~~2401495~~)接口创建，通过[ListNamespaces](~~2401502~~)接口查看列表。","type":"string","required":false,"example":"mynamespace","default":"public"}},{"name":"Collection","in":"query","schema":{"description":"文档库名称。\n\n> 由[CreateDocumentCollection](~~2618448~~)接口创建。您可以调用[ListDocumentCollections](~~2618452~~)接口查看已经创建的文档库。","type":"string","required":true,"example":"document"}},{"name":"RegionId","in":"query","schema":{"description":"实例所在的地域ID。","type":"string","required":true,"example":"cn-hangzhou"}},{"name":"NamespacePassword","in":"query","schema":{"description":"命名空间对应的密码。\n\n> 本值为[CreateNamespace](~~2401495~~)接口指定。","type":"string","required":true,"example":"testpassword"}},{"name":"Content","in":"query","schema":{"description":"用于检索的文本内容。","type":"string","required":false,"example":"ADBPG是什么？"}},{"name":"Filter","in":"query","schema":{"description":"要查询的数据的过滤条件，格式为SQL的WHERE格式。","type":"string","required":false,"example":"title = 'test'"}},{"name":"RecallWindow","in":"query","style":"json","schema":{"description":"召回窗口。当该值不为空时，增加返回检索结果的上下文。格式为2个元素的数组：List<A, B>，其中-10<=A<=0，0<=B<=10。\n> - 推荐当文档切分过碎、检索可能会丢失上下文信息时使用该参数。\n> - 重排优先窗口化，即先rerank，再窗口化处理。","type":"array","items":{"description":"召回窗口大小。","type":"integer","format":"int32","required":false,"example":"[-5, 5]"},"required":false}},{"name":"TopK","in":"query","schema":{"description":"设置返回top结果数量。","type":"integer","format":"int32","required":false,"maximum":"2147483647","minimum":"1","example":"10"}},{"name":"RerankFactor","in":"query","schema":{"description":"重排因子。当该值不为空时，会对向量检索结果再做一次重排。取值范围：1<RerankFactor<=5。\n> - 当文档切分稀疏时，重排效率慢。\n> - 建议重排个数（TopK*Factor（向上取整））不超过50。","type":"number","format":"double","required":false,"example":"2"}},{"name":"UseFullTextRetrieval","in":"query","schema":{"description":"是否使用全文检索（双路召回）。默认为false，仅采用向量检索。","type":"boolean","required":false,"example":"true","default":"false"}},{"name":"Metrics","in":"query","schema":{"description":"检索时的相似度算法。此值为空时则采用创建知识库时指定的算法，建议如无特殊需求不需设置。\n\n> 取值说明：\n> - **l2**：欧氏距离。\n> - **ip**：点积（内积）距离。\n> - **cosine**：余弦相似度。","type":"string","required":false,"example":"cosine"}},{"name":"FileName","in":"query","schema":{"description":"以图搜图场景中，待搜索的图片源文件名。\n\n> 图片文件必须带有文件后缀，当前支持的图片后缀：bmp、jpg、jpeg、png、 tiff。","type":"string","required":false,"example":"test.jpg"}},{"name":"FileUrl","in":"query","schema":{"description":"以图搜图场景中，公网可访问的图片文件URL地址。\n\n> 图片文件必须带有文件后缀，当前支持的图片后缀：bmp、jpg、jpeg、png、tiff。","type":"string","required":false,"example":"https://xx/myImage.jpg\n","isFileTransferUrl":true}},{"name":"IncludeVector","in":"query","schema":{"description":"是否返回向量。默认为false。\n> - **false**：不返回向量。\n> - **true**：返回向量。","type":"boolean","required":false,"example":"true"}},{"name":"HybridSearch","in":"query","schema":{"description":"双路召回算法，默认为空(即直接将向量和全文的分数比较并排序)。\n\n可选值：\n\n- RRF：倒数排序融合(Reciprocal rank fusion)，有一个参数k控制融合效果，详见HybridSearchArgs配置；\n- Weight：比重排序，采用一个参数alpha控制向量和全文的分数比重，然后再排序，参数详见HybridSearchArgs配置；\n- Cascaded：先全文检索再在其基础上进行向量检索；","type":"string","required":false,"example":"RRF"}},{"name":"HybridSearchArgs","in":"query","style":"json","schema":{"description":"双路召回的算法参数。目前支持RRF和Weight两种：\n\n- RRF：指定计算分数的算法的`1/(k+rank_i)`中的k常数，范围大于1的正整数，格式为：\n```\n{ \n   \"RRF\": {\n    \"k\": 60\n   }\n}\n```\n\n- Weight: 计算公式`alpha * vector_score + (1-alpha) * text_score`，参数alpha表示向量和全文的检索分数比重，范围为0～1，其中0表示只全文，1表示只向量：\n```\n{ \n   \"Weight\": {\n    \"alpha\": 0.5\n   }\n}\n```","type":"object","required":false,"additionalProperties":{"type":"object","additionalProperties":{"type":"any","example":"{ \n   \"RRF\": {\n    \"k\": 60\n   }\n}","description":"参数值。"},"description":"双路召回的参数名。"}}},{"name":"IncludeMetadataFields","in":"query","schema":{"description":"默认为空，表示要返回的metadata字段，多个字段用逗号分隔。","type":"string","required":false,"example":"title,page"}}],"responses":{"200":{"schema":{"type":"object","properties":{"RequestId":{"description":"请求ID。","type":"string","example":"ABB39CC3-4488-4857-905D-2E4A051D0521"},"Message":{"description":"返回信息。","type":"string","example":"success"},"Status":{"description":"状态，取值如下：\n\n- **success**：成功。\n- **fail**：失败。","type":"string","example":"success"},"Matches":{"type":"object","properties":{"MatchList":{"description":"匹配到的列表。","type":"array","items":{"description":"单条记录。","type":"object","properties":{"Id":{"description":"向量数据的唯一Id。","type":"string","example":"doca-1234"},"Content":{"description":"文本内容。","type":"string","example":"云原生数据仓库AnalyticDB PostgreSQL版提供简单、快速、经济高效的PB级云端数据仓库解决方案。"},"Metadata":{"description":"元数据Map。","type":"object","additionalProperties":{"type":"string","example":"{\"title\":\"test\"}","description":"元数据。"}},"Vector":{"type":"object","properties":{"VectorList":{"description":"向量数据List。","type":"array","items":{"description":"向量数据。","type":"number","format":"double","example":"[1.2123,-0.12314,...]"}}}},"FileName":{"description":"文件名。","type":"string","example":"my_doc.txt"},"Score":{"description":"此条数据的相似度分数，其分数算法和创建索引时指定的算法(l2/ip/cosine)相关。","type":"number","format":"double","example":"0.12345"},"RetrievalSource":{"description":"检索结果的来源。1表示向量检索，2表示全文检索，3表示双路召回。","type":"integer","format":"int32","example":"1"},"LoaderMetadata":{"description":"文档加载器加载时的元信息。","type":"string","example":"{\"page_pos\": 1}"},"FileURL":{"description":"查询结果图片的公网URL地址，有效时长2小时。","type":"string","example":"https://xxx-cn-beijing.aliyuncs.com/image/test.png"},"RerankScore":{"description":"重排分数。","type":"number","format":"double","example":"6.2345"}}}}}},"WindowMatches":{"type":"object","properties":{"windowMatches":{"description":"窗口化匹配到的列表。","type":"array","items":{"type":"object","properties":{"WindowMatch":{"type":"object","properties":{"windowMatch":{"description":"单个top窗口化匹配到的列表。","type":"array","items":{"type":"object","properties":{"Id":{"description":"向量数据的唯一ID。","type":"string","example":"doca-2345"},"Content":{"description":"文本内容。","type":"string","example":"云原生数据仓库AnalyticDB PostgreSQL版是一种大规模并行处理（MPP）数据仓库服务，可提供海量数据在线分析服务。"},"Metadata":{"description":"元数据Map。","type":"object","additionalProperties":{"type":"string","description":"元数据。","example":"{\"title\":\"test\"}"}},"FileName":{"description":"文件名。","type":"string","example":"my_doc.txt"},"LoaderMetadata":{"description":"文档加载器加载时的元信息。","type":"string","example":"{\"page_pos\": 2}"}}}}}}}}}}},"EmbeddingTokens":{"description":"向量化时使用的token数。\n\n> token是指将输入的文本分割成的最小单位；token可以是一个单词、一个词组、一个标点符号、一个字符等。","type":"string","example":"100"},"Usage":{"description":"本次查询的资源使用量","type":"object","properties":{"EmbeddingTokens":{"description":"向量化时使用的token数。\n\n> token是指将输入的文本分割成的最小单位；token可以是一个单词、一个词组、一个标点符号、一个字符等。","type":"string","example":"100"},"EmbeddingEntries":{"description":"向量化时使用的条目数。\n\n> 条目是指对文字、图片做向量化处理时的处理数目，如对文字做一次处理，条目数是1，对图片做一次处理是2。","type":"string","example":"10"}}}}}}},"responseDemo":"[{\"errorExample\":\"\",\"example\":\"{\\n  \\\"RequestId\\\": \\\"ABB39CC3-4488-4857-905D-2E4A051D0521\\\",\\n  \\\"Message\\\": \\\"success\\\",\\n  \\\"Status\\\": \\\"success\\\",\\n  \\\"Matches\\\": {\\n    \\\"MatchList\\\": [\\n      {\\n        \\\"Id\\\": \\\"doca-1234\\\",\\n        \\\"Content\\\": \\\"云原生数据仓库AnalyticDB PostgreSQL版提供简单、快速、经济高效的PB级云端数据仓库解决方案。\\\",\\n        \\\"Metadata\\\": {\\n          \\\"key\\\": \\\"{\\\\\\\"title\\\\\\\":\\\\\\\"test\\\\\\\"}\\\"\\n        },\\n        \\\"Vector\\\": {\\n          \\\"VectorList\\\": [\\n            0\\n          ]\\n        },\\n        \\\"FileName\\\": \\\"my_doc.txt\\\",\\n        \\\"Score\\\": 0.12345,\\n        \\\"RetrievalSource\\\": 1,\\n        \\\"LoaderMetadata\\\": \\\"{\\\\\\\"page_pos\\\\\\\": 1}\\\",\\n        \\\"FileURL\\\": \\\"https://xxx-cn-beijing.aliyuncs.com/image/test.png\\\",\\n        \\\"RerankScore\\\": 6.2345\\n      }\\n    ]\\n  },\\n  \\\"WindowMatches\\\": {\\n    \\\"windowMatches\\\": [\\n      {\\n        \\\"WindowMatch\\\": {\\n          \\\"windowMatch\\\": [\\n            {\\n              \\\"Id\\\": \\\"doca-2345\\\",\\n              \\\"Content\\\": \\\"云原生数据仓库AnalyticDB PostgreSQL版是一种大规模并行处理（MPP）数据仓库服务，可提供海量数据在线分析服务。\\\",\\n              \\\"Metadata\\\": {\\n                \\\"key\\\": \\\"{\\\\\\\"title\\\\\\\":\\\\\\\"test\\\\\\\"}\\\"\\n              },\\n              \\\"FileName\\\": \\\"my_doc.txt\\\",\\n              \\\"LoaderMetadata\\\": \\\"{\\\\\\\"page_pos\\\\\\\": 2}\\\"\\n            }\\n          ]\\n        }\\n      }\\n    ]\\n  },\\n  \\\"EmbeddingTokens\\\": \\\"100\\\",\\n  \\\"Usage\\\": {\\n    \\\"EmbeddingTokens\\\": \\\"100\\\",\\n    \\\"EmbeddingEntries\\\": \\\"10\\\"\\n  }\\n}\",\"type\":\"json\"}]","title":"查询文档内容"}