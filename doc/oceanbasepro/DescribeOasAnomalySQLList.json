{"summary":"该接口用于查询诊断系统判定可能存在性能问题的 SQL 列表。","methods":["post","get"],"schemes":["http","https"],"security":[{"AK":[]}],"deprecated":false,"systemTags":{"operationType":"get"},"parameters":[{"name":"InstanceId","in":"formData","schema":{"description":"OceanBase 集群 ID。","type":"string","required":true,"docRequired":true,"example":"ob317v4uif****"}},{"name":"TenantId","in":"formData","schema":{"description":"租户 ID。","type":"string","required":true,"docRequired":true,"example":"t4louaeei****"}},{"name":"StartTime","in":"formData","schema":{"description":"监控数据的起始时间。  \n该时间只支持 UTC 时间，格式为：YYYY-MM-DDThh:mm:ssZ。","type":"string","required":true,"docRequired":true,"example":"2023-04-12T04:38:38Z"}},{"name":"EndTime","in":"formData","schema":{"description":"监控数据的结束时间。  \n该时间只支持 UTC 时间，格式为：YYYY-MM-DDThh:mm:ssZ。","type":"string","required":true,"docRequired":true,"example":"2023-04-12T05:38:38Z"}},{"name":"DbName","in":"formData","schema":{"description":"数据库名称。","type":"string","required":false,"example":"db_****"}},{"name":"SearchKeyWord","in":"formData","schema":{"description":"关键字查询。","type":"string","required":false,"example":"update"}},{"name":"SearchParam","in":"formData","schema":{"description":"参数查询。","type":"string","required":false,"example":"cputime"}},{"name":"SearchRule","in":"formData","schema":{"description":"查询规则。  \n该参数取值包括：\"=\"，\">\"， “>=”， “<”，“<=\"","type":"string","required":false,"example":">"}},{"name":"SearchValue","in":"formData","schema":{"description":"查询值。","type":"string","required":false,"example":"0.01"}},{"name":"SqlId","in":"formData","schema":{"description":"SQL ID。","type":"string","required":false,"example":"8D6E84****0B8FB1823D199E2CA1****"}},{"name":"NodeIp","in":"formData","schema":{"description":"节点 IP。","type":"string","required":false,"example":"i-bp19y05uq6x*********"}},{"name":"FilterCondition","in":"formData","schema":{"description":"所有字段通过 @ 来引用。可选字段请参考[查询 SQL 的性能统计](https://www.oceanbase.com/docs/community-ocp-cn-10000000001832433)接口返回的所有列。","type":"string","required":false,"example":"@avgCpuTime > 20 and @executions > 100"}},{"name":"AcceptLanguage","in":"formData","schema":{"description":"返回数据的语言。  \n默认值：中国 CN，国外 EN。","type":"string","required":false,"example":"zh-CN"}},{"name":"SqlTextLength","in":"formData","schema":{"description":"返回 SQL 文本的最大长度。","type":"integer","format":"int64","required":false,"example":"65535"}},{"name":"Current","in":"formData","schema":{"description":"当前页。","type":"integer","format":"int64","required":false,"example":"1"}},{"name":"PageSize","in":"formData","schema":{"description":"分页查询的页码。\n- 起始值：1。\n- 默认值：1。","type":"integer","format":"int64","required":false,"example":"10"}},{"name":"DynamicSql","in":"formData","schema":{"title":"是否动态SQL","description":"是否动态 SQL。\n> <br>表示传入的 SQL ID 是否为动态 SQL 的 ID。","type":"boolean","required":false,"example":"false"}},{"name":"MergeDynamicSql","in":"formData","schema":{"title":"返回结果时，是否合并动态 SQL","description":"返回结果时，是否合并动态 SQL。\n> <br>表示输出结果时，是否聚合 in 查询的SQL 的结果。","type":"boolean","required":false,"example":"false"}}],"responses":{"200":{"schema":{"title":"","description":"请求的返回结果。","type":"object","properties":{"Data":{"title":"可疑SQL的个数","description":"可疑 SQL 信息列表。","type":"array","items":{"description":"可疑 SQL 信息。","type":"object","properties":{"AvgCpuTime":{"title":"可疑SQL的平均cpu时间","description":"可疑 SQL 的平均 CPU 时间。","type":"number","format":"double","example":"100.24"},"AvgElapsedTime":{"title":"可疑SQL的平均响应时间","description":"可疑 SQL 的平均响应时间。","type":"number","format":"double","example":"100.28"},"AvgGetPlanTime":{"title":"可疑SQL的平均获取执行计划的时间","description":"可疑 SQL 的平均获取执行计划的时间。","type":"number","format":"double","example":"0"},"CpuTime":{"title":"可疑SQL的cpu时间","description":"可疑 SQL 的 CPU 时间。","type":"number","format":"double","example":"100.23"},"DbName":{"title":"数据库名","description":"数据库名称。","type":"string","example":"db_***"},"DiagTypes":{"title":"诊断类型","description":"诊断类型。","type":"array","items":{"description":"诊断类型。","type":"string","example":"[\n      \"CPU_TIME_PROPORTION_HIGH\"\n]"}},"Diagnosis":{"title":"诊断详情","description":"诊断详情。\n> <br>此参数已废弃。","type":"string","example":"-"},"Executions":{"title":"可疑SQL的总执行次数","description":"可疑 SQL 的总执行次数。","type":"number","format":"double","example":"1"},"LastExecutedTime":{"title":"最后一次执行可疑SQL的时间","description":"最后一次执行可疑 SQL 的时间。","type":"number","format":"double","example":"2023-04-12T04:38:38Z"},"RiskLevel":{"title":"危险等级","description":"危险等级。","type":"string","example":"high"},"SqlId":{"title":"sql id ","description":"SQL ID。","type":"string","example":"8D6E84****0B8FB1823D199E2CA1****"},"SqlTextShort":{"title":"sql文本前缀","description":"SQL 文本前缀。","type":"string","example":"delete /*+ XXX PARALLEL(4) */ from"},"Suggestion":{"title":"可疑SQL的建议","description":"可疑 SQL 的建议。","type":"string","example":"review"},"SumElapsedTime":{"title":"可疑SQL的总响应时间","description":"可疑 SQL 的总响应时间。","type":"string","example":"11452126.36"},"UserName":{"title":"用户名","description":"用户名。","type":"string","example":"test_user"},"DynamicSql":{"title":"是否动态SQL","description":"是否动态 SQL。","type":"boolean","example":"false"},"SqlList":{"description":"SQL 列表。","type":"array","items":{"description":"SQL 列表。","type":"object","properties":{"AvgCpuTime":{"title":"可疑SQL的平均cpu时间","description":"平均 CPU 时间。","type":"number","format":"double","example":"100.24"},"AvgElapsedTime":{"title":"可疑SQL的平均响应时间","description":"平均响应时间。","type":"number","format":"double","example":"100.28"},"AvgGetPlanTime":{"title":"可疑SQL的平均获取执行计划的时间","description":"生成计划的平均时间。","type":"number","format":"double","example":"0"},"CpuTime":{"title":"可疑SQL的cpu时间","description":"总 CPU 时间。","type":"number","format":"double","example":"100.23"},"DbName":{"title":"数据库名","description":"数据库名。","type":"string","example":"test_hsp****eway"},"DiagTypes":{"title":"诊断类型","description":"诊断类型。","type":"array","items":{"description":"诊断类型。","type":"string","example":"[\n          \"CPU_TIME_PROPORTION_HIGH\"\n        ]"}},"Diagnosis":{"title":"诊断详情","description":"诊断详情。\n> <br>此参数已废弃。","type":"string","example":"-"},"Executions":{"title":"可疑SQL的总执行次数","description":"总执行次数。","type":"number","format":"double","example":"100"},"LastExecutedTime":{"title":"最后一次执行可疑SQL的时间","description":"最后一次运行时间。","type":"number","format":"double","example":"2023-04-12T04:38:38Z"},"RiskLevel":{"title":"危险等级","description":"危险等级。","type":"string","example":"LOW"},"SqlId":{"title":"sql id ","description":"SQL ID","type":"string","example":"3A645****789F13DE0CF6D084FF9****"},"SqlTextShort":{"title":"sql文本前缀","description":"SQL 文本。","type":"string","example":"select * from test"},"Suggestion":{"title":"可疑SQL的建议","description":"可疑 SQL 的建议。","type":"string","example":"{'Role': 'eSG', 'Result': '100', 'Suggestion': 'TRACER_OTHER_ERR'}"},"SumElapsedTime":{"title":"可疑SQL的总响应时间","description":"总响应时间。","type":"string","example":"11452126.36"},"UserName":{"title":"用户名","description":"用户名。","type":"string","example":"test_user"},"AvgDbTime":{"title":"平均数据库时间","description":"平均数据库时间。","type":"number","format":"double","example":"100"},"SumDbTime":{"title":"总数据库时间","description":"总数据库时间。","type":"number","format":"double","example":"100"},"AvgRetryCount":{"type":"number","format":"float"},"SumRetryCount":{"type":"number","format":"float"},"AvgLogicalReads":{"type":"number","format":"float"}}}},"AvgDbTime":{"description":"平均数据库时间。","type":"number","format":"double","example":"100"},"SumDbTime":{"title":"总数据库时间","description":"总数据库时间","type":"number","format":"double","example":"100"},"AvgRetryCount":{"type":"number","format":"float"},"SumRetryCount":{"type":"number","format":"float"},"AvgLogicalReads":{"type":"number","format":"float"}}}},"RequestId":{"title":"","description":"请求 ID。","type":"string","example":"473469**-AA6F-4D**-B3DB-A***********"},"TotalCount":{"description":"总数量。","type":"integer","format":"int64","example":"9"}}}}},"staticInfo":{"returnType":"synchronous"},"responseDemo":"[{\"errorExample\":\"\",\"example\":\"{\\n  \\\"Data\\\": [\\n    {\\n      \\\"AvgCpuTime\\\": 100.24,\\n      \\\"AvgElapsedTime\\\": 100.28,\\n      \\\"AvgGetPlanTime\\\": 0,\\n      \\\"CpuTime\\\": 100.23,\\n      \\\"DbName\\\": \\\"db_***\\\",\\n      \\\"DiagTypes\\\": [\\n        \\\"[\\\\n      \\\\\\\"CPU_TIME_PROPORTION_HIGH\\\\\\\"\\\\n]\\\"\\n      ],\\n      \\\"Diagnosis\\\": \\\"-\\\",\\n      \\\"Executions\\\": 1,\\n      \\\"LastExecutedTime\\\": 0,\\n      \\\"RiskLevel\\\": \\\"high\\\",\\n      \\\"SqlId\\\": \\\"8D6E84****0B8FB1823D199E2CA1****\\\",\\n      \\\"SqlTextShort\\\": \\\"delete /*+ XXX PARALLEL(4) */ from\\\",\\n      \\\"Suggestion\\\": \\\"review\\\",\\n      \\\"SumElapsedTime\\\": \\\"11452126.36\\\",\\n      \\\"UserName\\\": \\\"test_user\\\",\\n      \\\"DynamicSql\\\": false,\\n      \\\"SqlList\\\": [\\n        {\\n          \\\"AvgCpuTime\\\": 100.24,\\n          \\\"AvgElapsedTime\\\": 100.28,\\n          \\\"AvgGetPlanTime\\\": 0,\\n          \\\"CpuTime\\\": 100.23,\\n          \\\"DbName\\\": \\\"test_hsp****eway\\\",\\n          \\\"DiagTypes\\\": [\\n            \\\"[\\\\n          \\\\\\\"CPU_TIME_PROPORTION_HIGH\\\\\\\"\\\\n        ]\\\"\\n          ],\\n          \\\"Diagnosis\\\": \\\"-\\\",\\n          \\\"Executions\\\": 100,\\n          \\\"LastExecutedTime\\\": 0,\\n          \\\"RiskLevel\\\": \\\"LOW\\\",\\n          \\\"SqlId\\\": \\\"3A645****789F13DE0CF6D084FF9****\\\",\\n          \\\"SqlTextShort\\\": \\\"select * from test\\\",\\n          \\\"Suggestion\\\": \\\"{'Role': 'eSG', 'Result': '100', 'Suggestion': 'TRACER_OTHER_ERR'}\\\",\\n          \\\"SumElapsedTime\\\": \\\"11452126.36\\\",\\n          \\\"UserName\\\": \\\"test_user\\\",\\n          \\\"AvgDbTime\\\": 100,\\n          \\\"SumDbTime\\\": 100,\\n          \\\"AvgRetryCount\\\": 0,\\n          \\\"SumRetryCount\\\": 0,\\n          \\\"AvgLogicalReads\\\": 0\\n        }\\n      ],\\n      \\\"AvgDbTime\\\": 100,\\n      \\\"SumDbTime\\\": 100,\\n      \\\"AvgRetryCount\\\": 0,\\n      \\\"SumRetryCount\\\": 0,\\n      \\\"AvgLogicalReads\\\": 0\\n    }\\n  ],\\n  \\\"RequestId\\\": \\\"473469**-AA6F-4D**-B3DB-A***********\\\",\\n  \\\"TotalCount\\\": 9\\n}\",\"type\":\"json\"}]","title":"查询可疑 SQL 列表"}