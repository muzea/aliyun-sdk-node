{"methods":["post","get"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"readAndWrite","deprecated":false,"systemTags":{"operationType":"create"},"parameters":[{"name":"StackId","in":"query","schema":{"description":"创建更改集的资源栈的ID。ROS通过将此资源栈的信息与您提交的信息（例如：修改后的模板或不同的参数输入值）进行比较来生成更改集。  \n您可以通过调用[ListStacks - 查询资源栈列表](~~610818~~)接口获取资源栈ID。\n> 该参数仅在更改集类型为UPDATE或IMPORT时生效。","type":"string","required":false,"docRequired":false,"example":"4a6c9851-3b0f-4f5f-b4ca-a14bf691****"}},{"name":"StackPolicyURL","in":"query","schema":{"description":"包含资源栈策略的文件的位置。URL必须指向位于Web服务器（HTTP或HTTPS）或阿里云OSS存储空间（例如：oss://ros/stack-policy/demo、oss://ros/stack-policy/demo?RegionId=cn-hangzhou）的策略，策略文件长为16384个字节。\n\nURL的最大长度为1350个字节。       \n\n> OSS地域如未指定，默认与接口参数RegionId相同。\n\n当更改集类型为**CREATE**时，您仅能指定StackPolicyBody或StackPolicyURL参数之一。\n\n当更改集类型为**UPDATE**时，您仅能指定以下参数之一：\n\n- StackPolicyBody\n- StackPolicyURL\n- StackPolicyDuringUpdateBody\n- StackPolicyDuringUpdateURL","type":"string","required":false,"docRequired":false,"example":"oss://ros/stack-policy/demo"}},{"name":"StackPolicyBody","in":"query","schema":{"description":"资源栈策略的结构，长度为1~16,384个字节。\n\n当更改集类型为**CREATE**时，您仅能指定StackPolicyBody或StackPolicyURL其中一个参数。 \n\n当更改集类型为**UPDATE**时，您仅能指定以下参数之一：\n\n- StackPolicyBody\n- StackPolicyURL\n- StackPolicyDuringUpdateBody\n- StackPolicyDuringUpdateURL","type":"string","required":false,"docRequired":false,"example":"{\"Statement\":[{\"Effect\":\"Allow\",\"Action\":\"Update:*\",\"Principal\":\"*\",\"Resource\":\"*\"}]}"}},{"name":"StackName","in":"query","schema":{"description":"创建更改集的资源栈的名称。  \n长度不超过255个字符。必须以数字或英文字母开头，可包含数字、英文字母、短划线（-）和下划线（_）。\n\n> 该参数仅在更改集类型为CREATE或IMPORT时生效。","type":"string","required":false,"docRequired":false,"example":"MyStack"}},{"name":"UsePreviousParameters","in":"query","schema":{"description":"对于未传递的参数，是否使用上次传递的值。取值：\n\n- true\n- false（默认值）\n\n> 该参数仅在更改集类型为UPDATE或IMPORT时生效。\n","type":"boolean","required":false,"docRequired":false,"example":"true"}},{"name":"ChangeSetType","in":"query","schema":{"description":"更改集的类型。取值：\n- CREATE：为新资源栈创建更改集。\n- UPDATE（默认值）：为现有资源栈创建更改集。\n- IMPORT：为新资源栈或现有资源栈创建更改集导入非ROS托管资源。\n\n当您选择更改集类型为CREATE时，ROS会为您创建新的资源栈。此时资源栈将处于`REVIEW_IN_PROGRESS`状态，直到您执行更改集。\n\n> - 禁止使用UPDATE类型为新资源栈创建更改集，或使用CREATE类型为现有资源栈创建更改集。\n> - IMPORT类型的更改集不支持设置资源栈策略，请在创建或更新资源栈时设置相关参数。","type":"string","required":false,"docRequired":false,"example":"UPDATE"}},{"name":"Description","in":"query","schema":{"description":"更改集的描述。最大长度为1024个字节。","type":"string","required":false,"docRequired":false,"example":"It is a demo."}},{"name":"RegionId","in":"query","schema":{"description":"更改集所属的地域ID。\n\n您可以调用[DescribeRegions](~~131035~~)查看最新的阿里云地域列表。","type":"string","required":true,"docRequired":true,"example":"cn-hangzhou"}},{"name":"ClientToken","in":"query","schema":{"description":"保证请求的幂等性。该参数值由客户端生成，并且必须全局唯一。   \n长度不超过64个字符。可包含英文字母、数字、短划线（-）和下划线（_）。  \n更多详情，请参见[如何保证幂等性](~~134212~~)。","type":"string","required":false,"docRequired":false,"example":"123e4567-e89b-12d3-a456-42665544****"}},{"name":"TemplateURL","in":"query","schema":{"description":"包含模板主体的文件的位置。URL必须指向位于Web服务器（HTTP或HTTPS）或阿里云OSS存储空间（例如：oss://ros/template/demo、oss://ros/template/demo?RegionId=cn-hangzhou）中的模板，模板最大值为524,288个字节。  \n\n> 如果OSS地域未指定，默认与接口参数RegionId相同。\n  \n您仅能指定TemplateBody、TemplateURL或TemplateId其中一个参数。\n   \nURL最大长度为1024个字节。","type":"string","required":false,"docRequired":false,"example":"oss://ros/template/demo"}},{"name":"StackPolicyDuringUpdateURL","in":"query","schema":{"description":"更新资源栈策略的文件的位置。URL必须指向位于Web服务器（HTTP或HTTPS）或阿里云OSS存储空间（例如：oss://ros/stack-policy/demo、oss://ros/stack-policy/demo?RegionId=cn-hangzhou）中的策略，策略文件最长为16,384个字节。   \n\n> OSS地域如未指定，默认与接口参数RegionId相同。\n\nURL最大长度为1350个字节。  \n如果要更新受保护的资源，请在更新期间指定临时覆盖资源栈策略。如果未指定资源栈策略，则将使用与资源栈关联的当前策略。该参数仅在更改集类型为UPDATE时生效。您仅能指定以下参数之一：\n\n- StackPolicyBody\n- StackPolicyURL\n- StackPolicyDuringUpdateBody\n- StackPolicyDuringUpdateURL","type":"string","required":false,"docRequired":false,"example":"oss://ros/stack-policy/demo"}},{"name":"TemplateBody","in":"formData","schema":{"description":"模板主体的结构。长度为1~524,288个字节。如果长度较大，则建议通过HTTP POST+Body Param的方式，将参数放在请求体中进行传递，避免因URL过长而导致请求失败。                                                             \n>  您必须且仅能指定TemplateBody、TemplateURL或TemplateId其中一个参数。","type":"string","required":false,"docRequired":false,"example":"{\"ROSTemplateFormatVersion\":\"2015-09-01\"}"}},{"name":"TimeoutInMinutes","in":"query","schema":{"description":"资源栈状态变为CREATE_FAILED或UPDATE_FAILED之前可以经过的时间量。  \n当更改集类型为CREATE时，该参数为必选参数；当更改集类型为UPDATE时，该参数为可选参数。\n\n- 单位：分钟。\n\n- 取值范围：10~1440。\n\n- 默认值：60。","type":"integer","format":"int64","required":false,"docRequired":false,"example":"12"}},{"name":"DisableRollback","in":"query","schema":{"description":"当创建资源栈失败时，是否禁用回滚策略。  \n取值：  \n\n- true：禁用回滚，即在创建资源栈失败时不进行回滚。  \n\n- false（默认值）：不禁用回滚，即在创建资源栈失败时进行回滚。  \n\n> 该参数仅在更改集类型为CREATE或IMPORT时生效。","type":"boolean","required":false,"docRequired":false,"example":"false"}},{"name":"ChangeSetName","in":"query","schema":{"description":"更改集的名称。  \n长度不超过255个字符。必须以数字或英文字母开头，可包含数字、英文字母、短划线（-）和下划线（_）。\n\n> 更改集名称在与指定资源栈关联的所有更改集中必须是唯一的。","type":"string","required":true,"docRequired":true,"example":"MyChangeSet"}},{"name":"StackPolicyDuringUpdateBody","in":"query","schema":{"description":"临时覆盖资源栈策略的结构。长度为1~16,384个字节。  \n如果要更新受保护资源，请在此更新期间指定临时覆盖资源栈策略，如未指定，则将使用与资源栈关联的当前策略。  \n该参数仅在更改集类型为UPDATE时生效，您仅能指定以下参数之一：\n\n- StackPolicyBody\n- StackPolicyURL\n- StackPolicyDuringUpdateBody\n- StackPolicyDuringUpdateURL","type":"string","required":false,"docRequired":false,"example":"{\"Statement\":[{\"Effect\":\"Allow\",\"Action\":\"Update:*\",\"Principal\":\"*\",\"Resource\":\"*\"}]}"}},{"name":"RamRoleName","in":"query","schema":{"description":"RAM角色名称。ROS会扮演该角色创建资源栈，使用角色的凭证代表用户进行接口调用。  \nROS始终将此角色用于资源栈上将进行的操作。只要用户有权在资源栈上进行操作，即使用户无权使用角色，ROS也会使用此角色，确保角色授予最少的权限。   \n如果用户未指定该值，ROS将使用以前与资源栈关联的角色。如果没有可用角色，ROS将使用从您的用户凭证中生成的临时凭证。   \nRAM角色名称最大长度为64个字节。\n\nRAM角色的更多信息，请参见[资源栈角色](~~2568025~~)。","type":"string","required":false,"example":"test-role"}},{"name":"ReplacementOption","in":"query","schema":{"description":"如果资源的属性发生了变化，且变化的属性不支持修改更新（资源物理ID不变），是否使用替换更新（删除资源，重新创建，资源物理ID会发生变化）。取值：\n- Enabled：允许替换更新。\n- Disabled（默认）：不允许替换更新。\n\n> 修改更新的优先级高于替换更新。该参数仅在更改集类型为UPDATE时生效。","type":"string","required":false,"example":"Disabled"}},{"name":"TemplateId","in":"query","schema":{"description":"模板ID。支持共享模板和私有模板。\n\n您可以通过调用[ListTemplates - 查询模板列表](~~610842~~)接口查看模板ID。\n\n> 您仅能指定TemplateBody、TemplateURL或TemplateId其中一个参数。","type":"string","required":false,"example":"5ecd1e10-b0e9-4389-a565-e4c15efc****"}},{"name":"TemplateVersion","in":"query","schema":{"description":"模板版本。  \n> 该参数仅在指定TemplateId时生效。","type":"string","required":false,"example":"v1"}},{"name":"Parameters","in":"query","style":"repeatList","schema":{"description":"模板中已定义的参数。","type":"array","items":{"type":"object","properties":{"ParameterKey":{"description":"模板中已定义的参数的名称。如果未指定特定参数的名称和取值，则ROS将使用模板中指定的默认值。N的最大值为200。  \n\n> Parameters为可选参数。若指定了Parameters，则Parameters.N.ParameterKey为必选参数。","type":"string","required":true,"example":"Amount"},"ParameterValue":{"description":"模板中已定义的参数的取值。N的最大值为200。  \n\n> Parameters为可选参数。若指定了Parameters，则Parameters.N.ParameterValue为必选参数。","type":"string","required":true,"example":"12"}},"required":false},"required":false,"maxItems":200}},{"name":"NotificationURLs","in":"query","style":"repeatList","schema":{"description":"接收资源栈事件的回调地址列表。","type":"array","items":{"description":"接收资源栈事件的回调地址。取值：\n\n- HTTP POST URL      \n每个URL最大长度为1024个字节。  \n\n- eventbridge  \n资源栈状态变更会通知到事件总线（EventBridge）服务。您可以登录[事件总线控制台](https://eventbridge.console.aliyun.com) ，在左侧导航栏单击**事件总线**，查看事件信息。  \n> 当前支持华东1（杭州）、华东2（上海）、华北2（北京）、中国（香港）、华北3（张家口）五个地域。    \n\n  \nN最大值为5。资源栈的状态发生变化时，会进行通知。当资源栈启用回滚时，CREATE_FAILED（创建失败）和UPDATE_FAILED（更新失败）不会通知，而CREATE_ROLLBACK（创建失败回滚）和ROLLBACK（更新失败回滚）会进行通知。IN_PROGRESS状态不会通知。  \n无论资源栈是否定义了Outputs都会进行通知。通知内容示例如下：  \n ```\n{\n    \"Outputs\": [\n        {\n            \"Description\": \"No description given\",\n            \"OutputKey\": \"InstanceId\",\n            \"OutputValue\": \"i-xxx\"\n        }\n    ],\n    \"StackId\": \"80bd6b6c-e888-4573-ae3b-93d29113****\",\n    \"StackName\": \"test-notification-url\",\n    \"Status\": \"CREATE_COMPLETE\"\n}\n```   ","type":"string","required":false,"example":"http://example.com/ros-notify"},"required":false,"example":"http://my-site.com/ros-notify","maxItems":5}},{"name":"ResourcesToImport","in":"query","style":"repeatList","schema":{"description":"待导入资源列表。","type":"array","items":{"type":"object","properties":{"ResourceIdentifier":{"description":"字符串到字符串的键值映射。取值是JSON格式的字符串，用来标识要导入的资源。  \n键是资源的标识符属性（例如：ALIYUN::ECS::VPC资源的VpcId），值是属性的取值（例如：`vpc-2zevx9ios****`）。\n\n资源的标识符属性可以通过[GetTemplateSummary](~~172485~~)接口获取。\n\n> 该参数仅在更改集类型为IMPORT时生效。ResourcesToImport为可选参数。若指定了ResourcesToImport，则ResourcesToImport.N.ResourceIdentifier为必选参数。","type":"string","required":false,"example":"{\"VpcId\": \"vpc-2zevx9ios******\"}"},"LogicalResourceId":{"description":"资源逻辑ID，即模板中资源的名称。\n\n> 该参数仅在更改集类型为IMPORT时生效。ResourcesToImport为可选参数。若指定了ResourcesToImport，则ResourcesToImport.N.LogicalResourceId为必选参数。","type":"string","required":false,"example":"Vpc"},"ResourceType":{"description":"资源的类型，需要与模板中定义的类型一致。\n\n> 该参数仅在更改集类型为IMPORT时生效。ResourcesToImport为可选参数。若指定了ResourcesToImport，则ResourcesToImport.N.ResourceType为必选参数。","type":"string","required":false,"example":"ALIYUN::ECS::VPC"}},"required":false},"required":false,"maxItems":300}},{"name":"TemplateScratchId","in":"query","schema":{"description":"资源场景ID，即资源纳管场景ID。\n\n当ChangeSetType取值为IMPORT时，该参数才有效，该参数仅支持创建新的资源栈导入。\n\n如果您想通过资源纳管场景导入资源时，请只设置该参数，而不是模板相关参数。\n\n您可以通过调用[ListTemplateScratches - 查询资源场景列表](~~610832~~)查看资源纳管场景ID。","type":"string","required":false,"example":"4a6c9851-3b0f-4f5f-b4ca-a14bf691****"}},{"name":"Parallelism","in":"query","schema":{"description":"资源最大并发数。默认为空，用户可以输入大于等于零的整数。设置资源最大并发数后，将与资源栈进行关联，影响资源栈的后续操作。\n\n该参数仅在更改集类型为CREATE或UPDATE时生效，取值：\n\n- 当更改集类型为CREATE时\n  - 设置为大于零的整数：使用整数值。\n  - 设置为零或者不设置：对于ROS类型资源栈不限制，Terraform类型资源栈使用Terraform默认值（通常为10）。\n\n- 当更改集类型为UPDATE时\n  - 设置为大于零的整数：使用整数值。\n  - 设置为零：对于ROS类型资源栈不限制，Terraform类型资源栈使用Terraform默认值（通常为10）。\n  - 不设置：使用上次操作时设置的值。如果上次操作时未设置该参数，对于ROS类型资源栈不限制，Terraform类型资源栈使用Terraform默认值（通常为10）。\n","type":"integer","format":"int64","required":false,"example":"1"}}],"responses":{"200":{"schema":{"type":"object","properties":{"ChangeSetId":{"description":"更改集ID。","type":"string","example":"e85abe0c-6528-43fb-ae93-fdf8de22****"},"RequestId":{"description":"请求ID。","type":"string","example":"B288A0BE-D927-4888-B0F7-B35EF84B6E6F"},"StackId":{"description":"资源栈ID。","type":"string","example":"4a6c9851-3b0f-4f5f-b4ca-a14bf691****"}}}}},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"ChangeSetId\\\": \\\"e85abe0c-6528-43fb-ae93-fdf8de22****\\\",\\n  \\\"RequestId\\\": \\\"B288A0BE-D927-4888-B0F7-B35EF84B6E6F\\\",\\n  \\\"StackId\\\": \\\"4a6c9851-3b0f-4f5f-b4ca-a14bf691****\\\"\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<CreateChangeSetResponse>\\n    <ChangeSetId>e85abe0c-6528-43fb-ae93-fdf8de22****</ChangeSetId>\\n    <StackId>4a6c9851-3b0f-4f5f-b4ca-a14bf691****</StackId>\\n    <RequestId>B288A0BE-D927-4888-B0F7-B35EF84B6E6F</RequestId>\\n</CreateChangeSetResponse>\",\"errorExample\":\"\"}]","title":"创建更改集","summary":"为资源栈创建更改集，您可以在执行更改之前查看对应更改内容。","description":"### 使用场景\n#### 使用更改集创建资源栈\n如果您想管理大量的云资源，并在资源栈创建成功之前预览资源的创建效果，您可以选择使用更改集创建资源栈。此时您需要将`ChangeSetType`参数设置为CREATE并完成相关参数配置。关于更改集的更多信息，请参见[更改集](~~155649~~)。  \n#### 使用更改集更新资源栈\n如果您想在更新资源之前预览该操作对资源栈的影响，您可以选择为现有资源栈创建更改集。此时您需要将ChangeSetType参数设置为UPDATE并完成相关参数配置。\n关于更改集的更多信息，请参见[更改集](~~155649~~)。  \n#### 使用现有资源创建资源栈\n如果您需要将现有的云资源添加到一个新的资源栈中进行统一管理，您可以选择使用更改集创建资源栈并完成资源导入。此时您需要将ChangeSetType参数设置为IMPORT并完成相关参数配置。关于资源导入的更多信息，请参见[概览](~~193454~~)。\n\n#### 将现有资源导入资源栈\n如果您想要将现有资源导入到一个已有资源栈中进行统一管理，您可以选择使用更改集对已有资源栈进行更新。此时您需要将ChangeSetType参数设置为IMPORT并完成相关参数配置。关于资源导入的更多信息，请参见[概览](~~193454~~)。\n\n### 使用限制\n- 只有部分状态下的资源栈支持通过更改集更新。更多信息，请参见[通过更改集更新资源栈](~~155873~~)。\n- 一个资源栈最多同时存在20个更改集。  \n- 更改集只显示资源栈变化，不显示资源栈是否成功更新。  \n- 更改集不检查是否将超出账号限制、是否将更新不支持更新的资源、是否权限不足而无法修改资源，所有这些都将导致资源栈更新失败。如果更新失败，ROS将尝试将您的资源回滚到原始状态。  \n\n本文以使用更改集更新资源栈为例，在杭州地域`cn-hangzhou`创建一个名为`MyChangeSet`的更改集，将ID为`4a6c9851-3b0f-4f5f-b4ca-a14bf691****`的资源栈的模板更新为`{\"ROSTemplateFormatVersion\":\"2015-09-01\"}`。","requestParamsDescription":" 关于公共请求参数的详情，请参见[公共参数](~~131957~~)。","responseParamsDescription":" ","extraInfo":"| HttpCode | 错误码 | 错误信息 | 描述 |\n| ------------- | ------------- | ------------- | ------------- |\n| 400 | CircularDependency | Circular Dependency Found: {reason}. |模板包含循环引用。reason为具体原因。 |\n| 400 | InvalidSchema | {reason}. |模板格式不正确。reason为具体原因。 |\n| 400 | InvalidTemplateAttribute | The Referenced Attribute ({resource} {name}) is incorrect. |模板包含不正确的资源属性（输出）引用。resource为资源名，name为属性名。 |\n| 400 | InvalidTemplatePropertyType | The specified value type of ({resource} {section}) is incorrect. |模板资源定义中的字段类型不正确。resource为资源名，section为字段名。 |\n| 400 | InvalidTemplateReference | The specified reference \"{name}\" (in {referencer}) is incorrect. |模板包含不正确的引用。name为引用名，referencer为引用者。 |\n| 400 | InvalidTemplateSection | The template section is invalid: {section}. |模板包含无效的字段。section为字段名。 |\n| 400 | InvalidTemplateVersion | The template version is invalid: {reason}. |模板版本不正确。reason为具体原因。 |\n| 400 | StackPolicyValidationFailed | Action denied by stack policy: {reason}. |未通过资源栈策略校验。reason为具体原因。 |\n| 400 | StackValidationFailed | {reason}. |资源栈校验失败。reason为具体原因。 |\n| 400 | UnknownUserParameter | The Parameter ({name}) was not defined in template. |传递的参数在模板中未定义。name为参数名。 |\n| 400 | UserParameterMissing | The Parameter {name} was not provided. |参数在模板中已定义，但未传递值。name为参数名。 |\n| 404 | StackNotFound | The Stack ({name}) could not be found. |资源栈不存在。name为资源栈名称或ID。 |\n| 409 | ActionInProgress | Stack {name} already has an action ({action}) in progress. |资源栈在变更中。name为资源栈名称或ID，action为具体的变更操作。 |\n| 409 | ChangeSetExists | The ChangeSet ({name}) of Stack ({stack}) already exists. |同名更改集已存在。name为更改集名，stack为关联的资源栈名称或ID。 |\n| 409 | StackExists | The Stack ({name}) already exists. |同名资源栈已存在。name为资源栈名称。 |\n| 404 | TemplateNotFound |The Tempalte ({ ID }) could not be found. |模板不存在。ID为模板ID。 |\n| 404 | TemplateNotFound |The Template { ID } with version { version } could not be found. |模板或指定版本不存在。ID为模板ID，version为模板版本。 |"}