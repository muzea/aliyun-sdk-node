{"methods":["post","get"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"write","deprecated":false,"systemTags":{"operationType":"update","abilityTreeCode":"29324","abilityTreeNodes":["FEATUREecsPW0L5N"]},"parameters":[{"name":"RegionId","in":"query","schema":{"description":"实例所在地域ID。您可以调用[DescribeRegions](~~25609~~)查看最新的阿里云地域列表。","type":"string","required":true,"docRequired":true,"example":"cn-hangzhou"}},{"name":"RegionId","in":"query","schema":{"description":"实例所在地域ID。您可以调用[DescribeRegions](~~25609~~)查看最新的阿里云地域列表。","type":"string","required":true,"docRequired":true,"example":"cn-hangzhou"}},{"name":"InstanceId","in":"query","style":"repeatList","schema":{"description":"实例ID列表。","type":"array","items":{"description":"指定的ECS实例ID。N表示可以同时指定多台ECS实例，最多可指定10台ECS实例。N的取值范围：1~10。","type":"string","required":false,"example":"i-bp1eifrtpxa9tb****"},"required":true,"maxItems":100}},{"name":"PortNumber","in":"query","schema":{"description":"指定ECS实例的端口号，用于数据转发。一旦设置该参数，云助手Agent的数据转发会传到指定的端口号，用于端口转发。例如，SSH使用22端口。\n\n默认值为空，表示不设置数据转发的端口号。","type":"integer","format":"int32","required":false,"example":"22"}},{"name":"CommandLine","in":"query","schema":{"description":"发起会话后，指定执行的命令内容。长度不能超过512个字符。\n\n> 指定了`CommandLine`后，不能再指定`PortNumber`和`TargetServer`。","type":"string","required":false,"example":"ssh root@192.168.0.246"}},{"name":"TargetServer","in":"query","schema":{"description":"指定通过实例访问VPC内目标服务地址。\n\n>当该参数不为空时，`PortNumber`表示通过托管实例访问VPC内目标服务的端口号。","type":"string","required":false,"example":"192.168.0.246"}},{"name":"Username","in":"query","schema":{"description":"指定连接时的用户名称。","type":"string","required":false,"example":"testUser"}}],"responses":{"200":{"schema":{"type":"object","properties":{"RequestId":{"description":"请求ID。","type":"string","example":"EB5173B0-8E80-564E-AAD1-3135412*****"},"SessionId":{"description":"会话ID。","type":"string","example":"s-hz023od0x9****"},"SecurityToken":{"description":"附加在WebSocket的请求头部，用于系统校验本次请求。","type":"string","example":"d86c2df2-d19c-4bd8-b817-a19ef123****"},"WebSocketUrl":{"description":"远程连接ECS实例的WebSocket会话对应的URL。包含了会话ID（`SessionId`）以及用于系统校验的`SecurityToken`。","type":"string","example":"wss://cn-hangzhou.axt.aliyuncs.com/session?sessionId=s-hz023od0x9****&token=d86c2df2-d19c-4bd8-b817-a19ef123****"}}}}},"errorCodes":{"400":[{"errorCode":"RegionId.ApiNotSupported","errorMessage":"The api is not supported in this region."},{"errorCode":"PortNumber.Invalid","errorMessage":"The port number is invalid."}],"403":[{"errorCode":"InstanceIds.ExceedLimit","errorMessage":"The number of instance IDs exceeds the upper limit."},{"errorCode":"SessionCount.ExceedLimit","errorMessage":"The number of sessions exceeds the upper limit."},{"errorCode":"Operation.Forbidden","errorMessage":"The operation is not permitted."},{"errorCode":"PortForwarding.NotSupported","errorMessage":"Port forwarding is not supported currently."},{"errorCode":"UserBehavior.SessionManagerDisabled","errorMessage":"The api is disabled by user behavior."},{"errorCode":"InvalidCommandLine.Conflict","errorMessage":"The parameter PortNumber or TargetServer cannot be specified with parameter CommandLine."},{"errorCode":"InvalidTargetServer.MissingPortNumber","errorMessage":"The parameter PortNumber must be specified with parameter TargetServer."},{"errorCode":"InvalidCommandLine.LengthLimitExceeded","errorMessage":"The length of the parameter CommandLine exceeded the limit of 512 characters."},{"errorCode":"InvalidInstanceIds.CountLimitExceeded","errorMessage":"The count of Instances exceeded the maximum limit of 1 when TargetServer or CommandLine parameter was specified."},{"errorCode":"Username.ExceedLimit","errorMessage":"The length of the username exceeds the upper limit."},{"errorCode":"InvalidOperation.SecurityGroupRuleDenied","errorMessage":"The operation is not allowed by the security group inbound rules of the specified instance."}],"404":[{"errorCode":"InvalidRegionId.NotFound","errorMessage":"The RegionId provided does not exist in our records."},{"errorCode":"InvalidInstance.NotFound","errorMessage":"The specified instances not found."}],"500":[{"errorCode":"InternalError.Dispatch","errorMessage":"An error occurred when you dispatched the request."}]},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"RequestId\\\": \\\"EB5173B0-8E80-564E-AAD1-3135412*****\\\",\\n  \\\"SessionId\\\": \\\"s-hz023od0x9****\\\",\\n  \\\"SecurityToken\\\": \\\"d86c2df2-d19c-4bd8-b817-a19ef123****\\\",\\n  \\\"WebSocketUrl\\\": \\\"wss://cn-hangzhou.axt.aliyuncs.com/session?sessionId=s-hz023od0x9****&token=d86c2df2-d19c-4bd8-b817-a19ef123****\\\"\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<StartTerminalSessionResponse>\\n    <RequestId>EB5173B0-8E80-564E-AAD1-3135412*****</RequestId>\\n    <SessionId>s-hz023od0x9****</SessionId>\\n    <SecurityToken>d86c2df2-d19c-4bd8-b817-a19ef123****</SecurityToken>\\n    <WebSocketUrl>wss://cn-hangzhou.axt.aliyuncs.com/session?sessionId=s-hz023od0x9****&amp;token=d86c2df2-d19c-4bd8-b817-a19ef123****</WebSocketUrl>\\n</StartTerminalSessionResponse>\",\"errorExample\":\"\"}]","title":"开始终端会话","summary":"调用StartTerminalSession基于会话管理功能创建一个会话。您可以通过指定ECS实例ID与该实例建立一个WebSocket会话，通过接口返回的WebSocketUrl可以远程连接到ECS实例。","description":"## 接口说明\n\n当您通过代码定制化远程连接客户端时，可以调用该接口获取远程连接ECS实例的WebSocketUrl。调用该接口时您需要注意：\n\n- 指定的ECS实例必须处于运行中（Running）状态。\n- 指定的ECS实例必须安装了云助手Agent。您可以调用[DescribeCloudAssistantStatus](~~87346~~)查询ECS实例是否已安装云助手Agent，并可以查询云助手Agent的版本号。\n    - 如果您的ECS实例没有安装云助手Agent，请调用[InstallCloudAssistant](~~85916~~)安装。\n    - 云助手Agent的版本需要高于以下版本才支持会话管理功能。如果您需要升级云助手Agent版本，请参见[升级或禁止升级云助手Agent](~~134383~~)。\n        - Linux操作系统：2.2.3.256\n        - Windows操作系统：2.1.3.256\n- 成功调用该接口后，WebSocketUrl有效时长为10分钟。\n- 同一地域下，已创建并可用的会话不能超过1000个，单台ECS实例处于连接状态的会话不能超过20个。"}