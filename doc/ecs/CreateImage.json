{"summary":"调用CreateImage创建一份自定义镜像。您可以使用创建的自定义镜像创建ECS实例（RunInstances），或者更换实例的系统盘（ReplaceSystemDisk）。","methods":["post","get"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"write","deprecated":false,"systemTags":{"operationType":"create","abilityTreeCode":"28829","abilityTreeNodes":["FEATUREecsJ8B02D"]},"parameters":[{"name":"RegionId","in":"query","schema":{"description":"镜像所在的地域ID。您可以调用[DescribeRegions](~~25609~~)查看最新的阿里云地域列表。","type":"string","required":true,"docRequired":true,"example":"cn-hangzhou"}},{"name":"SnapshotId","in":"query","schema":{"description":"用于创建自定义镜像的快照ID。","type":"string","required":false,"example":"s-bp17441ohwkdca0****"}},{"name":"InstanceId","in":"query","schema":{"description":"实例ID。","type":"string","required":false,"example":"i-bp1g6zv0ce8oghu7****"}},{"name":"ImageName","in":"query","schema":{"description":"镜像名称。长度为2~128个英文或中文字符。必须以大小写字母或中文开头，不能以http://和https://开头。可以包含数字、半角冒号（:）、下划线（_）或者短划线（-）。","type":"string","required":false,"example":"TestCentOS"}},{"name":"ImageFamily","in":"query","schema":{"description":"镜像族系名称。长度为2~128个英文或中文字符。必须以大小写字母或中文开头，不能以aliyun和acs:开头，不能包含http://或者https://。可以包含数字、半角冒号（:）、下划线（_）或者短划线（-）。","type":"string","required":false,"example":"hangzhou-daily-update"}},{"name":"ImageVersion","in":"query","schema":{"description":"镜像版本。\n\n> 当您指定了实例ID（`InstanceId`），并且该实例的镜像是云市场镜像或者来自云市场镜像创建的自定义镜像时。该参数必须和当前实例的镜像的ImageVersion相同或置为空。","type":"string","required":false,"example":"2017011017"}},{"name":"Description","in":"query","schema":{"description":"镜像的描述信息。长度为2~256个英文或中文字符，不能以http://或https://开头。","type":"string","required":false,"example":"ImageTestDescription"}},{"name":"Platform","in":"query","schema":{"description":"指定数据盘快照做镜像的系统盘后，需要通过Platform确定系统盘的操作系统发行版。取值范围：\n\n- Aliyun\n- Anolis\n- CentOS\n- Ubuntu\n- CoreOS\n- SUSE\n- Debian\n- OpenSUSE\n- FreeBSD\n- RedHat\n- Kylin\n- UOS\n- Fedora\n- Fedora CoreOS\n- CentOS Stream\n- AlmaLinux\n- Rocky Linux\n- Gentoo\n- Customized Linux\n- Others Linux\n- Windows Server 2022\n- Windows Server 2019\n- Windows Server 2016\n- Windows Server 2012\n- Windows Server 2008\n- Windows Server 2003\n\n默认值：Others Linux。","type":"string","required":false,"example":"CentOS"}},{"name":"BootMode","in":"query","schema":{"description":"修改镜像的启动模式。取值范围：\n\n- BIOS：BIOS启动模式。\n- UEFI：UEFI启动模式。\n- UEFI-Preferred：双启动模式。\n\n> 建议您了解当前镜像支持的启动模式后再做修改，避免造成实例无法正常启动的情况出现。如果您不清楚当前镜像支持的启动模式，建议您使用镜像检测感知。关于镜像检测的更多信息，请参见[镜像检测概述](~~439819~~)。\n\n> 有关镜像UEFI-Preferred启动模式的说明，请参见[ECS实例启动模式最佳实践](~~2244655~~)。","type":"string","required":false,"enumValueTitles":{"BIOS":"BIOS","UEFI":"UEFI","UEFI-Preferred":"UEFI-Preferred"},"example":"BIOS"}},{"name":"Architecture","in":"query","schema":{"description":"指定数据盘快照做镜像的系统盘后，需要通过Architecture确定系统盘的系统架构。取值范围：\n\n- i386。\n- x86_64。\n- arm64。\n\n默认值为x86_64。","type":"string","required":false,"example":"x86_64"}},{"name":"ClientToken","in":"query","schema":{"description":"保证请求幂等性。从您的客户端生成一个参数值，确保不同请求间该参数值唯一。**ClientToken**只支持ASCII字符，且不能超过64个字符。更多信息，请参见[如何保证幂等性](~~25693~~)。","type":"string","required":false,"example":"123e4567-e89b-12d3-a456-426655440000"}},{"name":"ResourceGroupId","in":"query","schema":{"description":"自定义镜像所在的资源组ID。如果不设置该参数值，创建的镜像属于默认资源组。\n\n> 如果您当前使用的是RAM用户调用该接口，且`ResourceGroupId`取值为空，您需要注意，当RAM用户没有默认资源组权限时，调用接口会返回报错信息`Forbidden: User not authorized to operate on the specified resource`。请您设置RAM用户支持的资源组ID或者通过相应阿里云账号为该RAM用户授予默认资源组权限后，再次调用该接口。","type":"string","required":false,"example":"rg-bp67acfmxazb4p****"}},{"name":"DiskDeviceMapping","in":"query","style":"repeatList","schema":{"description":"创建的自定义镜像信息列表。","type":"array","items":{"description":"创建的自定义镜像信息列表。","type":"object","properties":{"SnapshotId":{"description":"根据指定的快照创建自定义镜像。","type":"string","required":false,"example":"s-bp17441ohwkdca0****"},"Size":{"description":"云盘的大小，单位为GiB。DiskDeviceMapping.N.Size的取值和默认值和DiskDeviceMapping.N.SnapshotId有关：\n\n- 如果没有指定SnapshotId，Size取值以及默认值为：\n    - 普通云盘：5~2000GiB，默认为5。\n    - 其他云盘：20~32768GiB，默认为20。\n- 如果指定了SnapshotId，Size取值必须大于等于SnapshotId的大小，默认为SnapshotId的大小。","type":"integer","format":"int32","required":false,"example":"2000"},"Device":{"description":"指定在自定义镜像中的设备名称。取值范围：\n\n- 其他云盘（例如SSD云盘、高效云盘和ESSD云盘）：/dev/vda~/dev/vdz。\n- 普通云盘：/dev/xvda~/dev/xvdz。","type":"string","required":false,"example":"/dev/vdb"},"DiskType":{"description":"指定在新镜像中的云盘类型。您可以通过该参数使用数据盘快照做为镜像的系统盘，如果不指定，默认为快照对应的云盘类型。取值范围：\n\n- system：系统盘。只能指定 1 块系统盘快照。\n- data：数据盘。最多可以指定 16 块数据盘快照。","type":"string","required":false,"example":"system"}},"required":false},"required":false,"maxItems":17}},{"name":"Tag","in":"query","style":"repeatList","schema":{"description":"标签列表。","type":"array","items":{"description":"标签列表。","type":"object","properties":{"key":{"description":"镜像的标签键。\n\n>为提高兼容性，建议您尽量使用Tag.N.Key参数。","type":"string","required":false,"example":"null"},"Key":{"description":"镜像的标签键。N的取值范围为1~20。一旦传入该值，则不允许为空字符串。最多支持128个字符，不能以`aliyun`或`acs:`开头，不能包含`http://`或者`https://`。","type":"string","required":false,"example":"KeyTest"},"Value":{"description":"镜像的标签值。N的取值范围为1~20。一旦传入该值，允许为空字符串。最多支持128个字符，不能以`acs:`开头，不能包含`http://`或者`https://`。","type":"string","required":false,"example":"ValueTest"},"value":{"description":"镜像的标签值。\n\n>为提高兼容性，建议您尽量使用Tag.N.Value参数。","type":"string","required":false,"example":"null"}},"required":false},"required":false,"maxItems":20}},{"name":"DetectionStrategy","in":"query","schema":{"description":"镜像检测策略，不配置此参数时不触发检测。仅支持标准（Standard）检测模式。 \n\n> 目前已支持大部分的Linux/Windows版本，关于镜像检测项与操作系统限制说明，请参见[镜像检测概述](~~439819~~)和[镜像检测操作系统限制](~~475800~~)。\n","type":"string","required":false,"example":"Standard"}}],"responses":{"200":{"schema":{"type":"object","properties":{"ImageId":{"description":"镜像ID。","type":"string","example":"m-bp146shijn7hujku****"},"RequestId":{"description":"请求ID。","type":"string","example":"C8B26B44-0189-443E-9816-*******"}}}}},"errorCodes":{"400":[{"errorCode":"InvalidImageName.Malformed","errorMessage":"The specified Image name is wrongly formed."},{"errorCode":"InvalidImageName.Duplicated","errorMessage":"The specified Image name has already bean used."},{"errorCode":"InvalidDescription.Malformed","errorMessage":"The specified description is wrongly formed."},{"errorCode":"InvalidImageVersion.Malformed","errorMessage":"The specified ImageVersion is wrongly formed."},{"errorCode":"IncorrectInstanceStatus","errorMessage":"The current status of the instance does not support this operation."},{"errorCode":"InstanceLockedForSecurity","errorMessage":"The specified operation is denied as your instance is locked for security reasons."},{"errorCode":"InvalidDevice.Malformed","errorMessage":"The specified parameter DiskDeviceMapping.n.Device is not valid."},{"errorCode":"MissingParameter","errorMessage":"The input parameter SnapshotId or InstanceId or DiskDeviceMapping that is mandatory for processing this request is not supplied."},{"errorCode":"InvalidSize.ValueNotSupported","errorMessage":"The specified parameter DiskDeviceMapping.n.Size beyond the permitted range."},{"errorCode":"InvalidDevice.InUse","errorMessage":"The specified parameter DiskDeviceMapping.n.Device has been occupied."},{"errorCode":"OperationDenied","errorMessage":"The specified parameter DiskDeviceMapping.n.SnapshotId does not contain system disk snapshot."},{"errorCode":"InvalidDiskCategory.CreateImage","errorMessage":"The specified diskCategory is not allowed to create image."},{"errorCode":"InvalidArchitecture.Malformed","errorMessage":"The specified Architecture is wrongly formed."},{"errorCode":"InvalidPlatform.Malformed","errorMessage":"The specified Platform is wrongly formed."},{"errorCode":"InvalidParameter.AllEmpty","errorMessage":"%s"},{"errorCode":"InvalidParameter.DiskType","errorMessage":"The specified disk type which has kms key can't convert to system disk."},{"errorCode":"Duplicate.TagKey","errorMessage":"The Tag.N.Key contain duplicate key."},{"errorCode":"InvalidTagKey.Malformed","errorMessage":"The specified Tag.n.Key is not valid."},{"errorCode":"InvalidTagValue.Malformed","errorMessage":"The specified Tag.n.Value is not valid."},{"errorCode":"InvalidInstance.NotFoundSystemDisk","errorMessage":"The specified instance does not have system disk."},{"errorCode":"InvalidImageFamily.Malformed","errorMessage":"The format of the specified image family is invalid."},{"errorCode":"ImageQuotaExceed.ImageFamily","errorMessage":"The specified image family exceeds the maximum number of images for one image family."},{"errorCode":"ImageFamilyQuotaExceed","errorMessage":"The number of image families exceeds the limit in the region."},{"errorCode":"InvalidDiskType.ValueNotSupported","errorMessage":"The specified disk type is not supported."},{"errorCode":"IdempotenceParamNotMatch","errorMessage":"Request uses a client token in a previous request but is not identical to that request."},{"errorCode":"InvalidBootMode.NotSupport","errorMessage":"The specified parameter BootMode is not supported for current image architecture."}],"403":[{"errorCode":"IncorrectDiskStatus.NeverAttached","errorMessage":"The specified disk has never been attached to instance."},{"errorCode":"InvalidSnapshotId.NotReady","errorMessage":"The current status of the DiskDeviceMapping.n.SnapshotId or SnapshotId does not support this operation."},{"errorCode":"InvalidSnapshot.TooOld","errorMessage":"This operation is denied because the specified snapshot by DiskDeviceMapping.n.SnapshotId or SnapshotId is created before 2013-07-15."},{"errorCode":"OperationDenied","errorMessage":"The specified snapshot is not allowed to create image."},{"errorCode":"QuotaExceed.Image","errorMessage":"The Image Quota exceeds."},{"errorCode":"InvalidParamter.Conflict","errorMessage":"The specified same token is trying to make requests with different parameters."},{"errorCode":"InvalidAccountStatus.NotEnoughBalance","errorMessage":"Your account does not have enough balance."},{"errorCode":"InvalidAccountStatus.SnapshotServiceUnavailable","errorMessage":"Snapshot service has not been opened yet."},{"errorCode":"UserNotInTheWhiteList","errorMessage":"The user is not in the white list of create image by data disk snapshot."},{"errorCode":"IncorrectDiskStatus.Invalid","errorMessage":"Device status is invalid, please restart instance and try again."},{"errorCode":"OperationDenied.InvalidSnapshotCategory","errorMessage":"%s"},{"errorCode":"QuotaExceed.Snapshot","errorMessage":"The snapshot quota exceeds."},{"errorCode":"IncorrectDiskStatus.Transferring","errorMessage":"The specified device is transferring, you can retry after the process is finished."},{"errorCode":"IncorrectDiskStatus","errorMessage":"The current disk status does not support this operation."},{"errorCode":"InvalidSystemSnapshot.Missing","errorMessage":"%s"},{"errorCode":"IncorrectDiskStatus.CreatingSnapshot","errorMessage":"A previous snapshot creation is in process."},{"errorCode":"InvalidParameter.KMSKeyId.CMKUnauthorized","errorMessage":"The CMK needs to be added ECS tag."},{"errorCode":"InvalidParameter.KMSKeyId.CMKNotEnabled","errorMessage":"The CMK needs to be enabled."},{"errorCode":"InvalidParameter.KMSKeyId.KMSUnauthorized","errorMessage":"ECS service have no right to access your KMS."},{"errorCode":"QuotaExceed.Tags","errorMessage":"%s"},{"errorCode":"InvalidSnapshotCategory.NotSupportImageCreation","errorMessage":"The specified snapshot category does not support create image."},{"errorCode":"TooManySnapshot.Unfinished","errorMessage":"There are too many snapshots being created, please wait for them to be created done."},{"errorCode":"HibernationConfigured.InstanceOperationForbidden","errorMessage":"The operation is not permitted due to limit of the hibernation configured instance."},{"errorCode":"SnapshotNotReady","errorMessage":"The specified snapshot is not ready."},{"errorCode":"IncorrectInstanceStatus.NeedRestart","errorMessage":"The instance needs to be restarted after adding a disk in a shutdown status."}],"404":[{"errorCode":"InvalidSnapshotId.NotFound","errorMessage":"The specified SnapshotId does not exist."},{"errorCode":"InvalidInstanceId.NotFound","errorMessage":"The specified InstanceId does not exist."},{"errorCode":"InvalidResourceGroup.NotFound","errorMessage":"The ResourceGroup provided does not exist in our records."}],"500":[{"errorCode":"InternalError","errorMessage":"The process of creating snapshot has failed due to some unknown error."}]},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"ImageId\\\": \\\"m-bp146shijn7hujku****\\\",\\n  \\\"RequestId\\\": \\\"C8B26B44-0189-443E-9816-*******\\\"\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<CreateImageResponse>\\n    <RequestId>C8B26B44-0189-443E-9816-*******</RequestId>\\n    <ImageId>m-bp146shijn7hujku****</ImageId>\\n</CreateImageResponse>\",\"errorExample\":\"\"}]","title":"创建一份自定义镜像","description":"## 接口说明\n调用该接口时，您需要注意：\n\n-  等待镜像状态变为可用（Available）后才能使用镜像资源。  \n-  查询ECS实例信息时，如果返回数据中包含`{\"OperationLocks\": {\"LockReason\" : \"security\"}}`，则禁止一切操作。\n-  强烈建议在创建镜像时配置镜像检测参数，有助于系统帮助优化您的镜像。更多信息，请参见[镜像检测概述](~~439819~~)。\n\n以下描述了三种通过该接口创建自定义镜像的方法。请求参数的优先级为：`InstanceId` > `DiskDeviceMapping` > `SnapshotId`，若您的请求中同时含有两个及以上参数，默认以优先级更高的参数为准创建镜像。\n\n- **方法一**：使用一台实例做模板，只需要指定实例ID（`InstanceId`）。该台实例的状态必须为运行中（`Running`）或者已停止（`Stopped`）。接口调用成功后，该台实例的每块云盘均会新增一份快照。由于运行中的实例存在缓存数据未落盘的情况，可能导致创建的自定义镜像数据与实例数据不完全一致。因此阿里云推荐您停止实例（[StopInstances](~~155372~~)）后创建镜像。\n- **方法二**：针对某一台实例的系统盘创建自定义镜像，只需要指定实例系统盘的一份历史快照ID（`SnapshotId`）。其中，指定的快照不能是2013年7月15日（含）之前创建的快照。 \n- **方法三**：将多份快照组合成一个镜像模板，需要建立几块云盘的数据关联（`DiskDeviceMapping`）。\n\n使用方法三创建自定义镜像时，请注意： \n\n-  只能指定一个系统盘快照，系统盘的设备名必须为/dev/xvda。 \n-  可以指定多个数据盘快照，最多不能超过16块，数据盘设备名默认由系统有序分配，从/dev/xvdb依次排序到/dev/xvdz，不能重复。 \n-  可以不指定`SnapshotId`，不指定时会创建一个指定大小的没有任何数据的空数据盘。  \n-  指定的快照不能是2013年7月15日（含）之前创建的快照。","requestParamsDescription":" ","responseParamsDescription":" ","extraInfo":" "}