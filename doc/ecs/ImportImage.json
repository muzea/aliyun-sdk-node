{"methods":["post","get"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"write","deprecated":false,"systemTags":{"operationType":"update","abilityTreeCode":"29034","abilityTreeNodes":["FEATUREecsZ3BT05"]},"parameters":[{"name":"RegionId","in":"query","schema":{"description":"源自定义镜像的地域ID。您可以调用[DescribeRegions](~~25609~~)查看最新的阿里云地域列表。","type":"string","required":true,"example":"cn-hangzhou"}},{"name":"ImageName","in":"query","schema":{"description":"镜像名称。长度为2~128个字符。必须以大小写字母或中文开头，不能以`aliyun`或`acs:`开头，不能包含`http://`或者`https://`。可以包含数字、半角句号（.）、半角冒号（:）、下划线（_）或者短划线（-）。","type":"string","required":false,"example":"ImageTestName"}},{"name":"Description","in":"query","schema":{"description":"镜像的描述信息。长度为2~256个英文或中文字符，不能以`http://`或`https://`开头。","type":"string","required":false,"example":"TestDescription"}},{"name":"Architecture","in":"query","schema":{"description":"系统架构。取值范围： \n\n- i386。\n- x86_64。\n- arm64。\n\n默认值：x86_64。","type":"string","required":false,"example":"x86_64"}},{"name":"OSType","in":"query","schema":{"description":"操作系统平台类型。取值范围： \n\n- windows。\n- linux。\n\n默认值：linux。","type":"string","required":false,"example":"linux"}},{"name":"Platform","in":"query","schema":{"description":"操作系统发行版。取值范围： \n- Aliyun\n- Anolis\n- CentOS\n- Ubuntu\n- CoreOS\n- SUSE\n- Debian\n- OpenSUSE\n- FreeBSD\n- RedHat\n- Kylin\n- UOS\n- Fedora\n- Fedora CoreOS\n- CentOS Stream\n- AlmaLinux\n- Rocky Linux\n- Gentoo\n- Customized Linux\n- Others Linux\n- Windows Server 2022\n- Windows Server 2019\n- Windows Server 2016\n- Windows Server 2012\n- Windows Server 2008\n- Windows Server 2003\n\n默认值：Others Linux。","type":"string","required":false,"example":"Aliyun"}},{"name":"BootMode","in":"query","schema":{"description":"修改镜像的启动模式。取值范围：\n\n- BIOS：BIOS启动模式。\n- UEFI：UEFI启动模式。\n\n默认值：BIOS。如果`Architecture=arm64`，则该参数默认值为UEFI，且只能设置为UEFI。\n\n> 您需要了解指定的镜像支持的启动模式，当通过该参数修改启动模式后，必须与镜像本身支持的启动模式匹配，实例才能正常启动。","type":"string","required":false,"example":"BIOS"}},{"name":"RoleName","in":"query","schema":{"description":"导入镜像时，使用的RAM角色名称。","type":"string","required":false,"example":"AliyunECSImageImportDefaultRole"}},{"name":"LicenseType","in":"query","schema":{"description":"导入镜像后，激活操作系统采用的许可证类型。取值范围：\n\n- Auto：由阿里云检测源操作系统并分配许可证。自动模式下，系统优先搜索您设置的`Platform`是否有阿里云官方渠道的许可证并分配给导入的镜像，如果缺乏该类许可，会切换成BYOL（Bring Your Own License）方式。\n- Aliyun：根据您设置的`Platform`采用阿里云官方渠道的许可证。\n- BYOL：源操作系统自带的许可证。采用BYOL时，您必须确保您的许可证密钥支持在阿里云使用。\n\n默认值：Auto。\n\n","type":"string","required":false,"example":"Auto"}},{"name":"ResourceGroupId","in":"query","schema":{"description":"导入镜像所在的企业资源组ID。","type":"string","required":false,"example":"rg-bp67acfmxazb4p****"}},{"name":"DiskDeviceMapping","in":"query","style":"repeatList","schema":{"description":"创建的自定义镜像信息列表。","type":"array","items":{"description":"创建的自定义镜像信息列表。","type":"object","properties":{"DiskImSize":{"description":"自定义镜像大小。单位：GiB。\n\n该空间由系统盘和数据盘组成，您必须保证系统盘的空间大小大于等于导入的镜像文件大小。取值范围：\n\n- N=1时，表示系统盘，取值范围：5 GiB~500 GiB。\n- N=2~17时，表示数据盘。取值范围：5 GiB~2000 GiB。\n\n当您将源镜像文件上传至OSS后，可以在OSS Bucket中查看镜像文件的大小。\n\n>该参数即将被弃用，为提高兼容性，请尽量使用`DiskDeviceMapping.N.DiskImageSize`参数。","type":"integer","format":"int32","required":false,"example":"80"},"Device":{"description":"指定DiskDeviceMapping.N.Device在自定义镜像中的设备名。\n\n> 该参数即将停止使用，为提高代码兼容性，建议您尽量不要使用该参数。","type":"string","required":false,"example":"null"},"OSSBucket":{"description":"镜像文件所在的OSS Bucket。\n\n> 首次导入镜像到该OSS Bucket前，请参见本文档的**接口说明**添加RAM授权策略，否则会报错`NoSetRoletoECSServiceAccount`。","type":"string","required":false,"example":"ecsimageos"},"Format":{"description":"镜像格式。取值范围：\n\n- RAW。\n- VHD。\n- QCOW2。\n\n默认值：无，表示阿里云自动检测镜像格式，以检测格式为准。","type":"string","required":false,"example":"QCOW2"},"OSSObject":{"description":"镜像上传至OSS Bucket后，保存在Bucket中的镜像文件的文件名（key）。","type":"string","required":false,"example":"CentOS_5.4_32.raw"},"DiskImageSize":{"description":"导入镜像后，自定义镜像的空间大小。\n\n该空间由系统盘和数据盘组成，您必须保证系统盘的空间大小大于等于导入的镜像文件大小。取值范围：\n\n- N=1时，表示系统盘，取值范围：5 GiB~500 GiB。\n- N=2~17时，表示数据盘。取值范围：5 GiB~2000 GiB。\n\n当您将源镜像文件上传至OSS后，可以在OSS Bucket中查看镜像文件的大小。","type":"integer","format":"int32","required":false,"example":"80"}},"required":false},"required":false,"maxItems":17}},{"name":"Tag","in":"query","style":"repeatList","schema":{"description":"镜像的标签列表。","type":"array","items":{"description":"镜像的标签列表。","type":"object","properties":{"Key":{"description":"镜像的标签键。N的取值范围：1~20。一旦传入该值，则不允许为空字符串。最多支持128个字符，不能以`aliyun`或者`acs:`开头，不能包含`http://`或者`https://`。","type":"string","required":false,"example":"TestKey"},"Value":{"description":"镜像的标签值。N的取值范围：1~20。一旦传入该值，允许为空字符串。最多支持128个字符，不能以`acs:`开头，不能包含`http://`或者`https://`。","type":"string","required":false,"example":"TestValue"}},"required":false},"required":false,"maxItems":20}},{"name":"DetectionStrategy","in":"query","schema":{"description":"镜像检测策略，不配置此参数时不触发检测。仅支持标准（Standard）检测模式。\n\n>目前已支持大部分的Linux/Windows版本，关于镜像检测项与操作系统限制说明，请参见[镜像检测概述](~~439819~~)和[镜像检测操作系统限制](~~475800~~)。\n","type":"string","required":false,"example":"Standard"}},{"name":"StorageLocationArn","in":"query","schema":{"description":"指定云盒的资源名称（ARN），用于唯一标识云端存储位置。\n\n>仅当您需要从OSS ON云盒中导入镜像文件时，才需提供此参数的值。如果您使用的存储服务不是OSS ON云盒，则无需设置此参数。更多信息，请参见[什么是OSS ON云盒](~~430190~~)。\n\n正确的ARN格式应遵循：`arn:acs:cloudbox:{RegionId}:{AliUid}:cloudbox/{CloudBoxId}`的模式，其中`{RegionId}`应替换为云盒实际所在的地域ID，`{AliUid}`是阿里云账号（主账号）ID，而`{CloudBoxId}`是云盒ID。","type":"string","required":false,"example":"arn:acs:cloudbox:cn-hangzhou:123456:cloudbox/cb-xx***123"}}],"responses":{"200":{"schema":{"type":"object","properties":{"RequestId":{"description":"请求ID。","type":"string","example":"473469C7-AA6F-4DC5-B3DB-A3DC0DE3****"},"ImageId":{"description":"镜像ID。","type":"string","example":"m-bp67acfmxazb4p****"},"TaskId":{"description":"导入镜像任务ID。","type":"string","example":"t-bp67acfmxazb4p****"},"RegionId":{"description":"地域ID。","type":"string","example":"cn-hangzhou"}}}}},"errorCodes":{"400":[{"errorCode":"UnsupportedSuffix.OSSObject","errorMessage":"The specified OSS object suffix is not supported."},{"errorCode":"MissingParameter","errorMessage":"An input parameter \"RegionId\" that is mandatory for processing the request is not supplied."},{"errorCode":"InvalidImageName.Malformed","errorMessage":"The specified Image name is wrongly formed."},{"errorCode":"InvalidOSSObject.Malformed","errorMessage":"The specified OSS object is wrongly formed."},{"errorCode":"InvalidOSSBucket.Malformed","errorMessage":"The specified OSS bucket is wrongly formed."},{"errorCode":"InvalidOSSObject.Size","errorMessage":"The specified OSS object size is zero."},{"errorCode":"InvalidDescription.Malformed","errorMessage":"The specified Image description is wrongly formed."},{"errorCode":"InvalidArchitecture.Malformed","errorMessage":"The specified Architecture is wrongly formed."},{"errorCode":"InvalidPlatform.Malformed","errorMessage":"The specified Platform is wrongly formed."},{"errorCode":"InvalidOSType.Malformed","errorMessage":"The specified OSType is wrongly formed."},{"errorCode":"InvalidImageName.Duplicated","errorMessage":"The destination image is exist."},{"errorCode":"InvalidImageSize","errorMessage":"%s"},{"errorCode":"InvalidDataDiskSize","errorMessage":"The specified DiskDeviceMapping.N.DiskImSize should be in the specified range."},{"errorCode":"InvalidImageFormat.Malformed","errorMessage":"The specified Image Format is wrongly formed."},{"errorCode":"InvalidRegionId.NotFound","errorMessage":"The specified RegionId does not exist."},{"errorCode":"InvalidRegion.NotSupport","errorMessage":"The specified region does not support image import or export."},{"errorCode":"InvalidOSSBucket.NotFound","errorMessage":"The specified OSS bucket does not exist in this region."},{"errorCode":"InvalidOSSObject.NotFound","errorMessage":"The specified OSS object does not exist in this region."},{"errorCode":"InvalidOSSObject.NeedRestore","errorMessage":"The specified OSS object is a archive object, need restore first."},{"errorCode":"InvalidOSSBucket.NotMatched","errorMessage":"The specified OSS bucket is incorrect, %s."},{"errorCode":"InvalidLicenseType.NotSupported","errorMessage":"The specified LicenseType is not supported."},{"errorCode":"InvalidLicenseType.BYOLOnly","errorMessage":"Only BYOL LicenseType is supported for the current platform provided."},{"errorCode":"InvalidOSSBucket.FlowLimit","errorMessage":"%s"},{"errorCode":"InvalidImageFormat.RegionNotSupported","errorMessage":"The specified image format is not supported in current region."},{"errorCode":"InvalidBootMode.Malformed","errorMessage":"The specified parameter \"BootMode\" is malformed."},{"errorCode":"InvalidParameter.DetectionStrategy","errorMessage":"The specified parameter DetectionStrategy is invalid."},{"errorCode":"InvalidBootMode.NotSupport","errorMessage":"The specified parameter BootMode is not supported for current image architecture."}],"403":[{"errorCode":"ImageIsImporting","errorMessage":"The specified Image is importing."},{"errorCode":"QuotaExceed.Image","errorMessage":"The Image Quota exceeds."},{"errorCode":"ImportImageFailed","errorMessage":"Importing image is failed, Please contact the administrator."},{"errorCode":"UserNotInTheWhiteList","errorMessage":"The user is not in the white list of importing image."},{"errorCode":"NoSetRoletoECSServiceAcount","errorMessage":"ECS service account Have no right to access your OSS.please attach a role of access your oss to ECS service account."},{"errorCode":"InvalidParameter.Malformed","errorMessage":"The specified parameter \"DiskDeviceMapping.n.Device \" is not valid."},{"errorCode":"MissingParameter.DiskDeviceMapping","errorMessage":"The specified parameter DiskDeviceMapping is not supplied."},{"errorCode":"InvalidOSS.NotAuthorized","errorMessage":"The specified OSS bucket or object is not allowed to access."},{"errorCode":"InvalidBlockSize.NotSupport","errorMessage":"%s"},{"errorCode":"InvalidImageFormat.Malformed","errorMessage":"%s"},{"errorCode":"ImageCheckUnsupported.WindowsImage","errorMessage":"Image check is unsupported for windows image."},{"errorCode":"InvalidVHDImage.IncorrectSize","errorMessage":"The specified size of the VHD image does not meet the 'header.MaxTableEntries * header.BlockSize' specification."},{"errorCode":"InvalidOSSBucket.EncryptUnsupported","errorMessage":"Accessing objects from encrypted OSS bucket is not supported."},{"errorCode":"InvalidArchitecture.PlatformUnsupported","errorMessage":"The OS platform you selected does not support the specified architecture."},{"errorCode":"InvalidAccountStatus.OSSDisabled","errorMessage":"OSS is disabled due to invalid account status."},{"errorCode":"InvalidStorageLocation.NotFound","errorMessage":"The specified cloud box storage location %s could not be found."},{"errorCode":"InvalidOperation.CloudBoxImageImportRoleRequired","errorMessage":"The role for cloud box image import is not set to the ECS service."},{"errorCode":"InvalidOperation.CloudBoxImageImportUnsupported","errorMessage":"Importing cloud box images is not supported."}],"404":[{"errorCode":"InvalidResourceGroup.NotFound","errorMessage":"The ResourceGroup provided does not exist in our records."}]},"staticInfo":{"returnType":"asynchronous","callback":"Ecs::2014-05-26::DescribeImages","callbackInterval":5000,"maxCallbackTimes":1000},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"RequestId\\\": \\\"473469C7-AA6F-4DC5-B3DB-A3DC0DE3****\\\",\\n  \\\"ImageId\\\": \\\"m-bp67acfmxazb4p****\\\",\\n  \\\"TaskId\\\": \\\"t-bp67acfmxazb4p****\\\",\\n  \\\"RegionId\\\": \\\"cn-hangzhou\\\"\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<ImportImageResponse>\\n    <RequestId>473469C7-AA6F-4DC5-B3DB-A3DC0DE3****</RequestId>\\n    <ImageId>m-bp67acfmxazb4p****</ImageId>\\n    <TaskId>t-bp67acfmxazb4p****</TaskId>\\n    <RegionId>cn-hangzhou</RegionId>\\n</ImportImageResponse>\",\"errorExample\":\"\"}]","title":"导入本地镜像文件","summary":"调用ImportImage导入一份您的本地镜像文件到云服务器ECS，作为自定义镜像出现在相应地域中。您可以使用导入的镜像创建ECS实例（RunInstances），或者更换实例的系统盘（ReplaceSystemDisk）。","description":"### 接口说明\n\n调用该接口时，您需要注意：\n\n- 您必须提前上传镜像文件到对象存储OSS。具体操作，请参见[上传文件](~~31886~~)。\n\n- 为避免部分服务器、虚拟机或者云主机的操作系统在导入自定义镜像后，创建的ECS实例无法启动，您需要在导入镜像前检查是否需要在源服务器中安装virtio驱动。具体操作，请参见[安装virtio驱动](~~62423~~)。\n\n- 首次导入镜像时，您必须提前通过访问控制RAM授权ECS访问您的OSS Bucket，否则会报错`NoSetRoletoECSServiceAccount`或`InvalidOperation.CloudBoxImageImportRoleRequired`。分为以下两种场景情况：\n\n  - **不通过云盒导入镜像文件**：您可以通过RAM管理控制台一键完成授权操作，具体的授权页面，请参见[云资源访问授权](https://ram.console.aliyun.com/?spm=5176.2020520101image.0.0.2ffa4df57kSoHX#/role/authorize?request=%7B%22Requests%22%3A%20%7B%22request1%22%3A%20%7B%22RoleName%22%3A%20%22AliyunECSImageImportDefaultRole%22%2C%20%22TemplateId%22%3A%20%22ECSImportRole%22%7D%2C%20%22request2%22%3A%20%7B%22RoleName%22%3A%20%22AliyunECSImageExportDefaultRole%22%2C%20%22TemplateId%22%3A%20%22ECSExportRole%22%7D%7D%2C%20%22ReturnUrl%22%3A%20%22https%3A//ecs.console.aliyun.com/%22%2C%20%22Service%22%3A%20%22ECS%22%7D)。您也可以手动完成授权操作，部分操作中策略与权限如下所示。具体操作，请参见[账号访问控制](~~25481~~)。\n\n    1. 创建角色`AliyunECSImageImportDefaultRole`（必须是这个名称，否则导入镜像会失败），角色的策略为：\n        ```\n        {\n\t\t\t\"Statement\": [\n\t\t\t{\n\t\t\t\t\"Action\": \"sts:AssumeRole\",\n\t\t\t\t\"Effect\": \"Allow\",\n\t\t\t\t\"Principal\": {\n\t\t\t\t\"Service\": [\n\t\t\t\t\t\"ecs.aliyuncs.com\"\n\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n        ],\n\t\t\t\"Version\": \"1\"\n        }\n        ```\n\n    2. 在该角色下，添加系统策略`AliyunECSImageImportRolePolicy`。您也可以创建自定义策略，权限必须包含：\n        ```\n\n        {\n\t\t\t\"Version\": \"1\",\n\t\t\t\"Statement\": [\n\t\t\t{\n\t\t\t\t\"Action\": [\n        \t\t\t\t\"oss:GetObject\",\n        \t\t\t\t\"oss:GetBucketLocation\",\n        \t\t\t\t\"oss:GetBucketInfo\"\n\t\t\t],\n        \t\t\t\"Resource\": \"*\",\n        \t\t\t\"Effect\": \"Allow\"\n        \t\t\t}\n\t\t\t]\n        }\n        \n        ```\n\n  - **通过云盒导入镜像文件**：您可以通过RAM管理控制台一键完成授权操作，具体的授权页面，请参见[云资源访问授权](https://ram.console.aliyun.com/role/authorize?request=%7B%22ReturnUrl%22%3A%22https%3A%2F%2Fecs.console.aliyun.com%2F%22%2C%22Services%22%3A%5B%7B%22Roles%22%3A%5B%7B%22RoleName%22%3A%22AliyunECSCloudBoxImageImportDefaultRole%22%2C%22TemplateId%22%3A%22AliyunECSCloudBoxImageImportDefaultRole%22%7D%5D%2C%22Service%22%3A%22ECS%22%7D%5D%7D)。您也可以手动完成授权操作，部分操作中策略与权限如下所示。具体操作，请参见[账号访问控制](~~25481~~)。\n\n    1. 创建角色`AliyunECSCloudBoxImageImportDefaultRole`（必须是这个名称，否则导入镜像会失败），角色的策略为：\n        ```\n        {\n\t\t\t\"Statement\": [\n\t\t\t{\n\t\t\t\t\"Action\": \"sts:AssumeRole\",\n\t\t\t\t\"Effect\": \"Allow\",\n\t\t\t\t\"Principal\": {\n\t\t\t\t\"Service\": [\n\t\t\t\t\t\"ecs.aliyuncs.com\"\n\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n        ],\n\t\t\t\"Version\": \"1\"\n        }\n        ```\n\n    2. 在该角色下，添加系统策略`AliyunECSCloudBoxImageImportRolePolicy`。您也可以创建自定义策略，权限必须包含：\n        ```\n\n        {\n\t\t\t\"Version\": \"1\",\n\t\t\t\"Statement\": [\n\t\t\t{\n\t\t\t\t\"Action\": [\n        \t\t\t\t\"oss-cloudbox:GetObject\",\n        \t\t\t\t\"oss-cloudbox:GetBucketLocation\",\n        \t\t\t\t\"oss-cloudbox:GetBucketInfo\"\n\t\t\t],\n        \t\t\t\"Resource\": \"*\",\n        \t\t\t\"Effect\": \"Allow\"\n        \t\t\t}\n\t\t\t]\n        }\n        \n        ```\n\n- 不能删除正在导入的镜像，只能调用[CancelTask](~~25624~~)取消导入镜像任务。\n\n- 导入镜像的地域必须跟镜像文件上传的OSS Bucket的地域相同。\n\n- 参数`DiskDeviceMapping.N`中N的取值范围为1~17。N为1时表示系统盘，N为2~17时表示数据盘，当N大于17时系统会自动忽略。\n\n- 当参数`Architecture`取值为`arm64`，或者参数`Platform`取值为`CentOS Stream`、`Anolis`、`AlmaLinux`、`UOS`、`Kylin`或`Rocky Linux`时，您需要注意：\n\n    - 为了使导入后的镜像支持配置密码或者支持修改密钥对，镜像必须满足以下条件：\n\n        - 操作系统的内核需要支持`CONFIG_FW_CFG_SYSFS`特性。Linux社区内核4.6版本之后默认支持该特性，CentOS的内核在3.10.0-826.el7版本之后默认支持该特性。您可以在该镜像对应的服务器内运行`grep -nr CONFIG_FW_CFG_SYSFS /boot/config-$(uname -r)`命令，如果回显结果中包含`CONFIG_FW_CFG_SYSFS=y`信息，则说明该镜像中的内核已支持`CONFIG_FW_CFG_SYSFS`特性。\n\n\n        - 操作系统中已安装阿里云最新版本cloud-init。其中，19.1版本cloud-init必须在19.1.3版本及以上，部分低版本操作系统中的0.7.6a版本cloud-init必须在0.7.6a15版本及以上。具体操作，请参见[安装cloud-init](~~57803~~)。\n\n        - 操作系统需要支持SHA-512加密算法。\n\n    - 为了使导入后的镜像支持扩容云盘与扩容文件系统，镜像必须满足以下条件：\n\n        - 操作系统的内核版本需要高于3.6版本。\n\n        - 支持growpart命令。支持该命令需要安装`cloud-utils-growpart`包，不同操作系统安装方式有所不同。具体操作，请参见[扩展分区和文件系统（Linux）](~~25451~~)。\n\n        - 支持resize2fs命令。支持该命令需要安装`e2fsprogs`包，该包在操作系统中默认已安装，如果没有安装您需要自行安装。\n\n        - 操作系统中已安装阿里云最新版本cloud-init。其中，19.1版本cloud-init必须在19.1.3版本及以上，部分低版本操作系统中的0.7.6a版本cloud-init必须在0.7.6a15版本及以上。具体操作，请参见[安装cloud-init](~~57803~~)。\n- 如果您待导入的自定义镜像对应的系统架构为arm64时，您需要设置其RTC时钟使用UTC时间标准。具体操作，请参见[Linux时间和时区说明](~~405080~~)。\n\n- 强烈建议在导入镜像时配置镜像检测参数，有助于系统帮助优化您的镜像。更多信息，请参见[镜像检测概述](~~439819~~)。"}