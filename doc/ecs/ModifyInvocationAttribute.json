{"summary":"修改云助手定时任务的执行信息，包括命令内容、定时执行方式、添加ECS实例或托管实例到任务。","methods":["post","get"],"schemes":["http","https"],"security":[{"AK":[]}],"systemTags":{"operationType":"update"},"parameters":[{"name":"RegionId","in":"query","schema":{"description":"地域ID。","type":"string","required":true,"example":"cn-hangzhou"}},{"name":"InstanceId","in":"query","style":"repeatList","schema":{"description":"待加入任务的ECS实例ID或托管实例ID。","type":"array","items":{"description":"待加入任务的ECS实例ID或托管实例ID。待加入的实例数量与已执行的实例数量总和不得超过100。","type":"string","required":false,"example":"i-bp1i7gg30r52z2em****"},"required":false,"maxItems":201}},{"name":"RegionId","in":"query","schema":{"description":"地域ID。","type":"string","required":true,"example":"cn-hangzhou"}},{"name":"InvokeId","in":"query","schema":{"description":"待修改任务的命令执行ID。","type":"string","required":true,"example":"t-hz0jdfwd9f****"}},{"name":"CommandContent","in":"query","schema":{"description":"待修改后的命令内容。命令内容可以是明文内容或Base64编码后的内容。您需要注意：\n\n- 若创建待修改任务时选择了保存命令，命令内容在Base64编码后的大小不能超过18 KB；若选择了不保存命令，命令内容在Base64编码后的大小不能超过24 KB。\n- 如果您的命令内容是Base64编码后的内容，则必须设置`ContentEncoding=Base64`。\n- 指定参数`EnableParameter=true`可在命令内容中启用自定义参数功能：\n    - 用`{{}}`包含的方式定义自定义参数，在`{{}}`内参数名前后的空格以及换行符会被忽略。\n    - 自定义参数个数不能超过20个。\n    - 自定义参数名允许a-zA-Z0-9-_的组合，不支持acs::前缀指定非内置环境参数，不支持其余字符，参数名不区分大小写。\n    - 单个自定义参数名不能超过64字节。\n\n- 您可以指定内置环境参数作为自定义参数，执行命令时无需手动对参数赋值，云助手将为您自动替换为环境中对应的值。支持指定以下内置环境参数：\n    - `{{ACS::RegionId}}`：地域ID。\n    - `{{ACS::AccountId}}`：阿里云主账号UID。\n    - `{{ACS::InstanceId}}`：实例ID。命令下发到多个实例时，如需指定`{{ACS::InstanceId}}`作为内置环境参数，需确保云助手Agent不低于以下版本：\n        - Linux：2.2.3.309\n        - Windows：2.1.3.309\n    - `{{ACS::InstanceName}}`：实例名称。命令下发到多个实例时，如需指定`{{ACS::InstanceName}}`作为内置环境参数，需确保云助手Agent不低于以下版本：\n        - Linux：2.2.3.344\n        - Windows：2.1.3.344\n    - `{{ACS::InvokeId}}`：命令执行ID。如需指定`{{ACS::InvokeId}}`作为内置环境参数，需确保云助手Agent不低于以下版本：\n        - Linux：2.2.3.309\n        - Windows：2.1.3.309\n    - `{{ACS::CommandId}}`：命令ID。通过调用本接口执行命令时，如需指定`{{ACS::CommandId}}`作为内置环境参数，需确保云助手Agent不低于以下版本： \n        - Linux：2.2.3.309\n        - Windows：2.1.3.309","type":"string","required":false,"example":"ZWNobyAxMjM="}},{"name":"EnableParameter","in":"query","schema":{"description":"修改命令中是否包含自定义参数。\n- 当您启用自定义参数或修改自定义参数`Parameters`时，该参数需设置为`true`。\n- 当您不修改自定义参数`Parameters`时，不设置该参数或设置为`false`。","type":"boolean","required":false,"example":"false"}},{"name":"Parameters","in":"query","style":"json","schema":{"description":"命令中包含自定义参数时，修改执行命令时传入的自定义参数的键值对。\n\n自定义参数的个数范围为0~10，且您需要注意：\n\n- 键不允许为空字符串，最多支持64个字符。\n- 值允许为空字符串。\n- 自定义参数与原始命令内容在Base64编码后，若创建待修改任务时选择了保存命令，命令内容在Base64编码后的大小不能超过 18 KB；若选择了不保存命令，命令内容在Base64编码后的大小不能超过 24 KB。\n- 设置的自定义参数名集合必须为创建命令时定义的参数集的子集。对于未传入的参数，您可以使用空字符串代替。\n\n默认值为空，表示不涉及自定义参数键值对的修改。","type":"object","required":false,"example":"{\"name\":\"Jack\", \"accessKey\":\"LTAIdyvdIqaRY****\"}"}},{"name":"Frequency","in":"query","schema":{"description":"待修改的定时执行频率。仅当`RepeatMode`为`Period`时生效。目前支持三种定时执行方式：固定时间间隔执行（基于Rate表达式）、仅在指定时间执行一次、基于时钟定时执行（基于Cron表达式）。\n\n- 固定时间间隔执行：基于Rate表达式，按照设置的时间间隔执行命令。时间间隔支持按秒（s） 、分钟（m） 、小时（h）和天（d）来选择，适用于在固定时间间隔执行任务的场景。格式为`rate(<执行间隔数值><执行间隔单位>)`，如5分钟执行一次，格式为`rate(5m)`。使用固定时间间隔执行有以下限制：\n    - 设置的时间间隔不大于7天、不小于60秒，且需大于创建定时任务时指定的超时时间。\n    - 执行间隔只基于固定频率，与任务实际执行需要的时间无关。例如设置每5分钟执行一次命令，任务需要2分钟执行完成，则在任务完成3分钟后继续执行下一轮。\n    - 按照任务的创建时间（参见`DescribeInvocations`返回的[CreationTime](~~64840~~)，请注意不是修改时间）及修改后的执行间隔计算下一次执行时间。\n\n- 仅在指定时间执行一次：按照设置的时区和执行时间点执行一次命令。格式为`at(yyyy-MM-dd HH:mm:ss <时区>)`，即`at(年-月-日 时:分:秒 <时区>)`。如果不指定时区，默认为UTC时区。时区支持以下三种形式：\n    - 时区全称：  如`Asia/Shanghai`（中国/上海时间）、`America/Los_Angeles`（美国/洛杉矶时间）等。\n    - 时区相对于格林威治时间的偏移量：  如`GMT+8:00`（东八区）、`GMT-7:00`（西七区）等。使用GMT格式时，小时位不支持添加前导零。\n    - 时区缩写：  仅支持UTC（协调世界时间）。\n\n  如果指定在中国/上海时间2022年06月06日13时15分30秒执行一次，格式为：`at(2022-06-06 13:15:30 Asia/Shanghai)`；如果指定在西七区2022年06月06日13时15分30秒执行一次，格式为：`at(2022-06-06 13:15:30 GMT-7:00)`。\n\n- 基于时钟定时执行（基于Cron表达式）：基于Cron表达式，按照设置的定时任务执行命令。格式为`<秒> <分钟> <小时> <日期> <月份> <星期> <年份（可选）> <时区>`，即`<Cron表达式> <时区>`。在指定的时区下，根据Cron表达式推算定时任务执行时间并执行。若不指定时区，默认为执行定时任务实例的系统内部时区。关于Cron表达式的更多信息，请参见[Cron表达式](~~64769~~)。时区支持以下三种形式：\n    - 时区全称：  如`Asia/Shanghai`（中国/上海时间）、`America/Los_Angeles`（美国/洛杉矶时间）等。\n    - 时区相对于格林威治时间的偏移量：  如`GMT+8:00`（东八区）、`GMT-7:00`（西七区）等。使用GMT格式时，小时位不支持添加前导零。\n    - 时区缩写：  仅支持UTC（协调世界时间）。\n  例如，在中国/上海时间，2022年每天上午10:15执行一次命令，格式为`0 15 10 ? * * 2022 Asia/Shanghai`；在东八区时间，2022年每天上午10:00到11:30每隔半小时执行，格式为`0 0/30 10-11 * * ? 2022 GMT+8:00`；在UTC时间，从2022年开始，每隔两年的10月每天下午14:00到下午14:55时间段内每隔5分钟执行，格式为`0 0/5 14 * 10 ? 2022/2 UTC`。\n\n    >设置的最小时间间隔需大于或等于创建定时任务时指定的超时时间，且不小于 10 秒。","type":"string","required":false,"example":"0 */20 * * * *"}},{"name":"ContentEncoding","in":"query","schema":{"description":"命令内容（`CommandContent`）的编码方式。取值范围（不区分大小写）：\n\n- PlainText：不编码，采用明文传输。\n- Base64：Base64编码。\n\n默认值：PlainText，填写错误时会当作PlainText处理。","type":"string","required":false,"example":"PlainText"}}],"responses":{"200":{"schema":{"type":"object","properties":{"RequestId":{"description":"请求ID。","type":"string","example":"473469C7-AA6F-4DC5-B3DB-A3DC0DE3****"},"CommandId":{"description":"命令ID。\n   - 只有`CommandContent`发生变更，才新增一条命令，返回新增的`CommandId`。\n   - 当`CommandContent`未变更时，不会新增命令，将返回当前正在执行命令的`CommandId`。\n   - 若调用[InvokeCommand](~~64841~~)，或调用[RunCommand](~~141751~~)时选择了`KeepCommand`为`true`，将会保留新增的命令；否则执行完成或手动停止任务时，将删除任务所有关联的命令。","type":"string","example":"c-hz01272yr52****"}}}}},"errorCodes":{"400":[{"errorCode":"InvalidParameter.Frequency","errorMessage":"The specified parameter Frequency is not valid."},{"errorCode":"InvalidParameters.KeyDuplicate","errorMessage":"The key in the parameter Parameters cannot be duplicated."},{"errorCode":"InvalidParameters.KeyNotMatch","errorMessage":"The key in the parameter Parameters do not match those defined when creating the command."},{"errorCode":"InvalidParameters.KeyMalformed","errorMessage":"The key in the parameter Parameters is not valid."},{"errorCode":"InvalidParameters.KeyEmpty","errorMessage":"The key in the parameter Parameters cannot be empty."},{"errorCode":"InvalidCommandContent.DecodeError","errorMessage":"The specified parameter CommandContent can not be Base64 decoded."}],"403":[{"errorCode":"InvalidInstanceId.OSTypeUnsupported","errorMessage":"The OS type of the instance corresponding to the parameter InstanceId does not support the specified command type."},{"errorCode":"InvalidOperation.RepeatModeUnsupported","errorMessage":"The operation is not supported for current repeat mode of invocation."},{"errorCode":"InvalidOperation.InvokeAlreadyFinished","errorMessage":"The operation is not supported for finished invocation."},{"errorCode":"InvalidOperation.CloudAssistantVersionUnsupported","errorMessage":"The operation is not supported for current CloudAssistant version of instance."},{"errorCode":"InvalidOperation.ModifyPublicCommandUnsupported","errorMessage":"Modification of the content of Public Command is not supported."},{"errorCode":"InvalidCommandContent.LengthLimitExceeded","errorMessage":"%s"},{"errorCode":"InvalidParameters.CountLimitExceeded","errorMessage":"The count of the parameter Parameters exceeds the limit of 10."},{"errorCode":"InvalidParameters.KeyLengthLimitExceeded","errorMessage":"The length of the key in the parameter Parameters exceeds the limit of 64 characters."},{"errorCode":"InvalidInstanceId.CountLimitExceeded","errorMessage":"%s"},{"errorCode":"CommandLimitExceeded","errorMessage":"%s"},{"errorCode":"InvalidParameters.ValueTypeUnsupported","errorMessage":"The type of the value in the parameter Parameters is not supported."}],"404":[{"errorCode":"InvalidInvokeId.NotFound","errorMessage":"The specified parameter InvokeId does not exist."},{"errorCode":"InvalidInstanceId.NotFound","errorMessage":"The specified parameter InstanceId does not exist."},{"errorCode":"InvalidRegionId.NotFound","errorMessage":"The specified parameter RegionId does not exist."}],"500":[{"errorCode":"InternalError","errorMessage":"An error occurred when you dispatched the request."}]},"responseDemo":"[{\"errorExample\":\"\",\"example\":\"{\\n  \\\"RequestId\\\": \\\"473469C7-AA6F-4DC5-B3DB-A3DC0DE3****\\\",\\n  \\\"CommandId\\\": \\\"c-hz01272yr52****\\\"\\n}\",\"type\":\"json\"}]","title":"修改任务的执行信息","description":"- 支持修改以下执行方式的任务（参见[DescribeInvocations](~~2679916~~)返回的`RepeatMode`值）：\n    - Period：周期执行。\n    - NextRebootOnly：当实例下一次启动时，自动执行命令。\n    - EveryReboot：实例每一次启动都将自动执行命令。\n- 支持修改以下状态的任务（参见[DescribeInvocations](~~2679916~~)返回的`InvocationStatus`值）：\n    - Pending：系统正在校验或发送命令。存在至少一台实例的命令执行状态为Pending，则总执行状态为Pending。\n    - Running：命令正在实例上运行。存在至少一台实例的命令执行状态为Running，则总执行状态为Running。\n    - Scheduled：定时执行的命令已发送，等待运行。存在至少一台实例的命令执行状态为Scheduled，则总执行状态为Scheduled。\n    - Stopping：正在停止任务。存在至少一台实例的命令执行状态为Stopping，则总执行状态为Stopping。\n- 修改定时任务执行信息（包括命令内容、自定义参数、执行频率）前，已执行的ECS实例或托管实例的云助手Agent版本需要高于以下对应的版本。\n    - Linux：2.2.3.541\n    - Windows：2.1.3.541\n    - 如果调用结果返回`InvalidOperation.CloudAssistantVersionUnsupported`错误码，请将云助手Agent更新至最新版本。\n- 当您执行一个云助手公共命令时，无法修改命令内容`CommandContent`。\n- 当您修改了命令内容`CommandContent`，且调用[InvokeCommand](~~64841~~)或调用[RunCommand](~~141751~~)时设置`KeepCommand`为`true`创建任务，将会新增一条命令并长期保留，并占用云助手命令配额；在一个地域下，您最多可以保有500～50,000条云助手命令。您也可以申请提升配额，关于如何查询及提升配额，请参见[配额管理](~~184116~~)。"}