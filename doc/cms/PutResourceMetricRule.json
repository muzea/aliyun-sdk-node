{"summary":"调用PutResourceMetricRule接口为指定资源的指定监控项设置一条阈值报警规则。","methods":["post","get","put"],"schemes":["http","https"],"security":[{"AK":[]}],"deprecated":false,"systemTags":{"operationType":"create"},"parameters":[{"name":"RuleId","in":"query","schema":{"description":"报警规则ID。\n\n您可以输入新的报警规则ID，也可以使用云监控已存在的报警规则ID。关于如何查询报警规则ID，请参见[DescribeMetricRuleList](~~114941~~)。\n\n> 输入新的报警规则ID，表示创建一条阈值报警规则。\n\n","type":"string","required":true,"docRequired":true,"example":"a151cd6023eacee2f0978e03863cc1697c89508****"}},{"name":"RuleName","in":"query","schema":{"description":"报警规则名称。\n\n您可以输入新的报警规则名称，也可以使用云监控已存在的报警规则名称。关于如何查询报警规则名称，请参见[DescribeMetricRuleList](~~114941~~)。\n\n> 输入新的报警规则名称，表示创建一条阈值报警规则。","type":"string","required":true,"example":"test123"}},{"name":"Namespace","in":"query","schema":{"description":"云产品的数据命名空间。关于如何查询云产品的数据命名空间，请参见[云产品监控项](~~163515~~)。\n\n> 当您为企业云监控创建Prometheus报警规则时，该参数必须为`acs_prometheus`。","type":"string","required":true,"docRequired":true,"example":"acs_ecs_dashboard"}},{"name":"MetricName","in":"query","schema":{"description":"监控项名称。关于如何查询监控项名称，请参见[云产品监控项](~~163515~~)。\n\n> 当您为企业云监控创建Prometheus报警规则时，该参数为指标仓库名称。关于如何获取指标仓库名称，请参见[DescribeHybridMonitorNamespaceList](~~428880~~)。","type":"string","required":true,"docRequired":true,"example":"cpu_total"}},{"name":"Resources","in":"query","schema":{"description":"资源信息，例如：`[{\"instanceId\":\"i-uf6j91r34rnwawoo****\"}]`、`[{\"userId\":\"100931896542****\"}]`。\n\n关于资源信息支持的维度Dimensions，请参见[云产品监控项](~~163515~~)。","type":"string","required":false,"docRequired":true,"example":"[{\"instanceId\":\"i-uf6j91r34rnwawoo****\"}]"}},{"name":"ContactGroups","in":"query","schema":{"description":"报警联系组。报警通知会发送给该报警联系组中的报警联系人。\n\n> 报警联系组是一组报警联系人，可以包含一个或多个报警联系人。关于如何创建报警联系人和报警联系组，请参见[PutContact](~~114923~~)和[PutContactGroup](~~114929~~)。","type":"string","required":true,"docRequired":true,"example":"ECS_Group"}},{"name":"Webhook","in":"query","schema":{"description":"报警发生回调时指定的URL地址，向URL发送POST请求。","type":"string","required":false,"example":"https://alert.aliyun.com.com:8080/callback"}},{"name":"EffectiveInterval","in":"query","schema":{"description":"报警规则的生效时间范围。","type":"string","required":false,"example":"00:00-23:59"}},{"name":"NoEffectiveInterval","in":"query","schema":{"description":"报警规则的失效时间范围。","type":"string","required":false,"example":"00:00-06:00"}},{"name":"SilenceTime","in":"query","schema":{"description":"通道沉默周期。单位：秒，默认值：86400。\n\n> 通道沉默周期是指报警发生后未恢复正常，间隔多久重新发送一次报警通知。","type":"integer","format":"int32","required":false,"example":"86400","default":"86400"}},{"name":"Period","in":"query","schema":{"description":"监控项的统计周期。单位：秒。默认为监控项的原始上报周期。\n\n>关于如何查询监控项的统计周期，请参见[云产品监控项](~~163515~~)。","type":"string","required":false,"example":"60"}},{"name":"Interval","in":"query","schema":{"description":"报警规则的触发周期。单位：秒。\n\n>关于如何查询监控项的统计周期，请参见[云产品监控项](~~163515~~)。","type":"string","required":false,"example":"60"}},{"name":"EmailSubject","in":"query","schema":{"description":"报警邮件主题。","type":"string","required":false,"example":"ECS实例报警"}},{"name":"Escalations.Critical.Statistics","in":"query","schema":{"description":"Critical级别报警统计方法。\n\n该参数的取值由指定云产品的`MetricName`对应的`Statistics`列决定，例如：Maximum、Minimum和Average。关于如何获取该参数的取值，请参见[云产品监控项](~~163515~~)。\n\n> 报警级别Critical（严重）、Warn（警告）或Info（信息）至少设置一个，且该报警级别中的参数Statistics、ComparisonOperator、Threshold和Times必须同时设置。","type":"string","required":false,"example":"Average"}},{"name":"Escalations.Critical.ComparisonOperator","in":"query","schema":{"description":"Critical级别阈值比较符。取值：\n\n- GreaterThanOrEqualToThreshold：大于等于。\n- GreaterThanThreshold：大于。\n- LessThanOrEqualToThreshold：小于等于。\n- LessThanThreshold：小于。\n- NotEqualToThreshold：不等于。\n- GreaterThanYesterday：同比昨天时间上涨。\n- LessThanYesterday：同比昨天时间下降。\n- GreaterThanLastWeek：同比上周同一时间上涨。\n- LessThanLastWeek：同比上周同一时间下降。\n- GreaterThanLastPeriod：环比上周期上涨。\n- LessThanLastPeriod：环比上周期下降。\n\n> 报警级别Critical（严重）、Warn（警告）或Info（信息）至少设置一个，且该报警级别中的参数Statistics、ComparisonOperator、Threshold和Times必须同时设置。","type":"string","required":false,"example":"GreaterThanOrEqualToThreshold"}},{"name":"Escalations.Critical.Threshold","in":"query","schema":{"description":"Critical级别报警阈值。\n\n\n> 报警级别Critical（严重）、Warn（警告）或Info（信息）至少设置一个，且该报警级别中的参数Statistics、ComparisonOperator、Threshold和Times必须同时设置。","type":"string","required":false,"example":"90"}},{"name":"Escalations.Critical.Times","in":"query","schema":{"description":"Critical级别报警重试次数。\n\n> 报警级别Critical（严重）、Warn（警告）或Info（信息）至少设置一个，且该报警级别中的参数Statistics、ComparisonOperator、Threshold和Times必须同时设置。","type":"integer","format":"int32","required":false,"example":"3"}},{"name":"Escalations.Warn.Statistics","in":"query","schema":{"description":"Warn级别报警统计方法。\n\n该参数的取值由指定云产品的`MetricName`对应的`Statistics`列决定，例如：Maximum、Minimum和Average。关于如何获取该参数的取值，请参见[云产品监控项](~~163515~~)。\n\n> 报警级别Critical（严重）、Warn（警告）或Info（信息）至少设置一个，且该报警级别中的参数Statistics、ComparisonOperator、Threshold和Times必须同时设置。","type":"string","required":false,"example":"Average"}},{"name":"Escalations.Warn.ComparisonOperator","in":"query","schema":{"description":"Warn级别阈值比较符。取值：\n\n- GreaterThanOrEqualToThreshold：大于等于。\n- GreaterThanThreshold：大于。\n- LessThanOrEqualToThreshold：小于等于。\n- LessThanThreshold：小于。\n- NotEqualToThreshold：不等于。\n- GreaterThanYesterday：同比昨天时间上涨。\n- LessThanYesterday：同比昨天时间下降。\n- GreaterThanLastWeek：同比上周同一时间上涨。\n- LessThanLastWeek：同比上周同一时间下降。\n- GreaterThanLastPeriod：环比上周期上涨。\n- LessThanLastPeriod：环比上周期下降。\n\n> 报警级别Critical（严重）、Warn（警告）或Info（信息）至少设置一个，且该报警级别中的参数Statistics、ComparisonOperator、Threshold和Times必须同时设置。","type":"string","required":false,"example":"GreaterThanOrEqualToThreshold"}},{"name":"Escalations.Warn.Threshold","in":"query","schema":{"description":"Warn级别报警阈值。\n> 报警级别Critical（严重）、Warn（警告）或Info（信息）至少设置一个，且该报警级别中的参数Statistics、ComparisonOperator、Threshold和Times必须同时设置。","type":"string","required":false,"example":"90"}},{"name":"Escalations.Warn.Times","in":"query","schema":{"description":"Warn级别报警重试次数。\n\n> 报警级别Critical（严重）、Warn（警告）或Info（信息）至少设置一个，且该报警级别中的参数Statistics、ComparisonOperator、Threshold和Times必须同时设置。","type":"integer","format":"int32","required":false,"example":"3"}},{"name":"Escalations.Info.Statistics","in":"query","schema":{"description":"Info级别报警统计方法。\n\n该参数的取值由指定云产品的`MetricName`对应的`Statistics`列决定，例如：Maximum、Minimum和Average。关于如何获取该参数的取值，请参见[云产品监控项](~~163515~~)。\n\n> 报警级别Critical（严重）、Warn（警告）或Info（信息）至少设置一个，且该报警级别中的参数Statistics、ComparisonOperator、Threshold和Times必须同时设置。","type":"string","required":false,"example":"Average"}},{"name":"Escalations.Info.ComparisonOperator","in":"query","schema":{"description":"Info级别阈值比较符。取值：\n\n- GreaterThanOrEqualToThreshold：大于等于。\n- GreaterThanThreshold：大于。\n- LessThanOrEqualToThreshold：小于等于。\n- LessThanThreshold：小于。\n- NotEqualToThreshold：不等于。\n- GreaterThanYesterday：同比昨天时间上涨。\n- LessThanYesterday：同比昨天时间下降。\n- GreaterThanLastWeek：同比上周同一时间上涨。\n- LessThanLastWeek：同比上周同一时间下降。\n- GreaterThanLastPeriod：环比上周期上涨。\n- LessThanLastPeriod：环比上周期下降。\n\n> 报警级别Critical（严重）、Warn（警告）或Info（信息）至少设置一个，且该报警级别中的参数Statistics、ComparisonOperator、Threshold和Times必须同时设置。","type":"string","required":false,"example":"GreaterThanOrEqualToThreshold"}},{"name":"Escalations.Info.Threshold","in":"query","schema":{"description":"Info级别报警阈值。\n\n> 报警级别Critical（严重）、Warn（警告）或Info（信息）至少设置一个，且该报警级别中的参数Statistics、ComparisonOperator、Threshold和Times必须同时设置。","type":"string","required":false,"example":"90"}},{"name":"Escalations.Info.Times","in":"query","schema":{"description":"Info级别报警重试次数。\n\n> 报警级别Critical（严重）、Warn（警告）或Info（信息）至少设置一个，且该报警级别中的参数Statistics、ComparisonOperator、Threshold和Times必须同时设置。","type":"integer","format":"int32","required":false,"example":"3"}},{"name":"NoDataPolicy","in":"query","schema":{"description":"无监控数据时报警的处理方式。取值：\n\n- KEEP\\_LAST\\_STATE（默认值）：不做任何处理。\n- INSUFFICIENT\\_DATA：报警内容为无数据。\n- OK：正常。","type":"string","required":false,"example":"KEEP_LAST_STATE"}},{"name":"CompositeExpression","in":"query","style":"json","schema":{"description":"多指标的报警条件。\n\n> 单指标和多指标互斥，不能同时设置。","type":"object","properties":{"ExpressionList":{"description":"标准创建的报警条件列表。","type":"array","items":{"description":"无。","type":"object","properties":{"MetricName":{"description":"云产品的监控项名称。","type":"string","required":false,"example":"cpu_total"},"Period":{"description":"监控项的聚合周期。\n\n单位：秒。","type":"integer","format":"int64","required":false,"example":"60"},"Statistics":{"description":"监控项的统计方法。取值：\n- $Maximum：最大值。\n- $Minimum：最小值。\n- $Average：平均值。\n- $Availability：可用率（通常用于站点监控）。\n\n> `$`为监控项的统一前缀符号。支持的云产品，请参见[云产品监控项](~~163515~~)。","type":"string","required":false,"example":"$Maximum"},"ComparisonOperator":{"description":"阈值比较符。取值：\n\n- GreaterThanOrEqualToThreshold：大于等于。\n- GreaterThanThreshold：大于。\n- LessThanOrEqualToThreshold：小于等于。\n- LessThanThreshold：小于。\n- NotEqualToThreshold：不等于。\n- GreaterThanYesterday：同比昨天时间上涨。\n- LessThanYesterday：同比昨天时间下降。\n- GreaterThanLastWeek：同比上周同一时间上涨。\n- LessThanLastWeek：同比上周同一时间下降。\n- GreaterThanLastPeriod：环比上周期上涨。\n- LessThanLastPeriod：环比上周期下降。","type":"string","required":false,"example":"GreaterThanOrEqualToThreshold"},"Threshold":{"description":"报警阈值。","type":"string","required":false,"example":"90"}},"required":false},"required":false},"ExpressionListJoin":{"description":"多指标报警条件之间的关系。取值： \n\n- `&&`：当所有指标都符合报警条件时，才触发报警。当ExpressionList下各表达式均为`true`时，才触发报警。\n\n- `||`：其中一个指标符合报警条件，即触发报警。","type":"string","required":false,"example":"||"},"ExpressionRaw":{"description":"表达式创建的报警条件。包括但不限于以下情况：\n\n- 为部分资源设置报警黑名单，例如：`$instanceId != 'i-io8kfvcpp7x5****' ``&&`` $Average > 50`，表示当报警规则中的实例`i-io8kfvcpp7x5****`的`Average`大于50时，也不会产生报警。\n- 对规则中的指定实例设置特殊报警阈值，例如：`$Average > ($instanceId == 'i-io8kfvcpp7x5****'? 80: 50)`，表示当报警规则中的实例`i-io8kfvcpp7x5****`的`Average`大于80时，才报警，其他实例的`Average`大于50，即可报警。\n- 对规则中超过阈值的实例数量进行限制，例如：`count($Average > 20) > 3`，表示当报警规则中的`Average`大于20的实例数大于3个时，才进行报警。\n","type":"string","required":false,"example":"$Average > ($instanceId == 'i-io8kfvcpp7x5****'? 80: 50)"},"Level":{"description":"报警级别。取值：\n- Critical：严重。\n- Warn：警告。\n- Info：信息。","type":"string","required":false,"example":"Critical"},"Times":{"description":"发出报警通知需要达到报警条件的次数。","type":"integer","format":"int32","required":false,"example":"3"}},"required":false}},{"name":"Labels","in":"query","style":"repeatList","schema":{"description":"当监控项达到报警条件并进行报警时，标签同时写入监控项，在报警通知中进行展示。\n\n> 该功能与Prometheus报警中的Label相同。","type":"array","items":{"description":"无。","type":"object","properties":{"Key":{"description":"标签键。","type":"string","required":false,"example":"tagKey1"},"Value":{"description":"标签值。\n\n> 标签值支持模板参数，将模板参数替换为实际标签值。","type":"string","required":false,"example":"ECS"}},"required":false},"required":false,"maxItems":20}},{"name":"Prometheus","in":"query","style":"json","schema":{"description":"Prometheus报警。\n\n> 仅当您为企业云监控创建Prometheus报警规则，需要设置该参数。","type":"object","properties":{"PromQL":{"description":"PromQL查询语句。\n\n> 通过PromQL查询语句获取的数据即为报警数据，请您在该语句中携带报警阈值。","type":"string","required":false,"example":"cpuUsage{instanceId=\"xxxx\"}[1m]>90"},"Level":{"description":"报警级别。取值：\n- Critical：严重。\n- Warn：警告。\n- Info：信息。","type":"string","required":false,"example":"Critical"},"Times":{"description":"发出报警通知需要达到报警条件的次数。","type":"integer","format":"int32","required":false,"example":"3"},"Annotations":{"description":"Prometheus报警时，将注释的键和值进行渲染，易于您对监控项或报警规则的理解。\n\n> 该功能等同于Prometheus的Annotation。","type":"array","items":{"description":"无。","type":"object","properties":{"Key":{"description":"注释的键。","type":"string","required":false,"example":"summary"},"Value":{"description":"注释的值。","type":"string","required":false,"example":"{{ $labels.instance }} CPU usage above 10% {current value: {{ humanizePercentage $value }} }"}},"required":false},"required":false}},"required":false}}],"responses":{"200":{"schema":{"description":"无。","type":"object","properties":{"Code":{"description":"状态码。\n\n>200表示成功。","type":"string","example":"200"},"Message":{"description":"错误信息。","type":"string","example":"The request processing has failed due to some unknown error."},"RequestId":{"description":"请求ID。","type":"string","example":"65D50468-ECEF-48F1-A6E1-D952E89D9436"},"Success":{"description":"操作是否成功。取值：\n\n- true：成功。\n\n- false：失败。","type":"boolean","example":"true"}}}}},"errorCodes":{"204":[{"errorCode":"%s","errorMessage":"%s"}],"206":[{"errorCode":"%s","errorMessage":"%s"}],"400":[{"errorCode":"%s","errorMessage":"%s"}],"403":[{"errorCode":"%s","errorMessage":"%s"}],"404":[{"errorCode":"%s","errorMessage":"%s"}],"406":[{"errorCode":"%s","errorMessage":"%s"}],"429":[{"errorCode":"ResourceOverLimit","errorMessage":"The resource has exceeded the limit. %s"}],"499":[{"errorCode":"%s","errorMessage":"%s"}],"500":[{"errorCode":"InternalError","errorMessage":"The request processing has failed due to some unknown error."}],"503":[{"errorCode":"%s","errorMessage":"%s"}]},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"Code\\\": \\\"200\\\",\\n  \\\"Message\\\": \\\"The request processing has failed due to some unknown error.\\\",\\n  \\\"RequestId\\\": \\\"65D50468-ECEF-48F1-A6E1-D952E89D9436\\\",\\n  \\\"Success\\\": true\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<PutResourceMetricRuleResponse>\\r\\n\\t<Code>200</Code>\\r\\n\\t<Message></Message>\\r\\n\\t<RequestId>65D50468-ECEF-48F1-A6E1-D952E89D9436</RequestId>\\r\\n\\t<Success>true</Success>\\r\\n</PutResourceMetricRuleResponse>\",\"errorExample\":\"\"}]","title":"为指定资源的指定监控项设置一条阈值报警规则","description":"本文将提供一个示例，为云服务器ECS `acs_ecs_dashboard`的实例`i-uf6j91r34rnwawoo****`中的监控项`cpu_total`设置阈值报警规则。该报警规则的报警联系组为`ECS_Group`、报警规则名称为`test123`、报警规则ID为`a151cd6023eacee2f0978e03863cc1697c89508****`、Critical级别的统计方法为`Average`、Critical级别的比较符为`GreaterThanOrEqualToThreshold`、Critical级别的阈值为`90`和Critical级别的报警重试次数为`3`。","requestParamsDescription":"关于公共请求参数的详情，请参见[公共参数](~~199331~~)。","responseParamsDescription":" ","extraInfo":" "}