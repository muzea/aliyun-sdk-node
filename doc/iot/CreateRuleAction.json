{"methods":["post","get"],"schemes":["http","https"],"security":[{"AK":[]}],"systemTags":{"operationType":"create"},"parameters":[{"name":"IotInstanceId","in":"query","schema":{"description":"实例ID。您可在物联网平台控制台的**实例概览**页面，查看当前实例的**ID**。\n\n><notice>\n- 若有ID值，必须传入该ID值，否则调用会失败。\n- 若无<props=\"intl\"><ph>**实例概览**页面或</ph></props>ID值，则无需传入。\n\n></notice>\n\n实例的更多信息，请参见[实例概述](~~356505~~)。","type":"string","required":false,"example":"iot-cn-0pp1n8t****"}},{"name":"RuleId","in":"query","schema":{"description":"要为其创建动作的规则ID。可在物联网平台控制台<props=\"china\"><ph>对应实例下</ph></props>，**规则引擎**>**云产品流转**页查看规则ID，或调用[ListRule](~~69486~~)从返回结果中查看。","type":"integer","format":"int64","required":true,"example":"100000"}},{"name":"Type","in":"query","schema":{"description":"规则动作类型，取值：\n\n- **REPUBLISH**：将根据规则处理后的Topic数据转发至另一个物联网平台 Topic。\n- **AMQP**：数据流转到AMQP消费组。\n<props=\"china\">- **DATAHUB**：将根据规则处理后的Topic数据转发至阿里云DataHub，进行流式数据处理。</props>\n<props=\"china\">- **ONS**：将根据规则处理后的Topic数据转发至阿里云消息队列RocketMQ，进行消息分发。</props>\n- **MNS**：将根据规则处理后的Topic数据发送至阿里云消息服务中，进行消息传输。\n- **FC**：将根据规则处理后的Topic数据发送至阿里云函数计算服务，进行事件计算。\n- **OTS**：将根据规则处理后的Topic数据发送至阿里云表格存储（Tablestore），进行NoSQL数据存储。\n\n> 数据格式为二进制的规则（即规则的**DataType**参数是**BINARY**）不支持转发数据至OTS（表格存储）。","type":"string","required":true,"example":"REPUBLISH"}},{"name":"Configuration","in":"query","schema":{"description":"该规则动作的配置信息，传入格式为JSON String。不同规则动作类型所需内容不同，具体要求和示例见下文请求参数补充说明。","type":"string","required":true,"example":"{\"topic\":\"/a1POX0c****/device1/user/get\",\"topicType\":1}"}},{"name":"ErrorActionFlag","in":"query","schema":{"description":"该规则动作是否为转发错误操作数据的转发动作，即转发流转到其他云产品失败且重试失败的数据。 可选值：\n\n- **true**：该规则动作转发错误操作数据。\n- **false**：该规则动作不转发错误操作数据，而是正常转发操作。\n\n默认值为**false**。","type":"boolean","required":false,"example":"false"}}],"responses":{"200":{"schema":{"description":"返回的数据。","type":"object","properties":{"Code":{"description":"调用失败时，返回的错误码。更多信息，请参见[错误码](~~87387~~)。","type":"string","example":"iot.system.SystemException"},"ActionId":{"description":"调用成功时，规则引擎为该规则动作生成的规则动作ID，作为其标识符。\n\n> 请妥善保管该信息。在调用与规则动作相关的接口时，您可能需要提供对应的规则动作ID。","type":"integer","format":"int64","example":"10003"},"ErrorMessage":{"description":"调用失败时，返回的出错信息。","type":"string","example":"系统异常"},"RequestId":{"description":"阿里云为该请求生成的唯一标识符。","type":"string","example":"21D327AF-A7DE-4E59-B5D1-ACAC8C024555"},"Success":{"description":"是否调用成功。\n\n- **true**：调用成功。\n- **false**：调用失败。","type":"boolean","example":"true"}}}}},"errorCodes":{},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"Code\\\": \\\"iot.system.SystemException\\\",\\n  \\\"ActionId\\\": 10003,\\n  \\\"ErrorMessage\\\": \\\"系统异常\\\",\\n  \\\"RequestId\\\": \\\"21D327AF-A7DE-4E59-B5D1-ACAC8C024555\\\",\\n  \\\"Success\\\": true\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\\r\\n<CreateRuleActionResponse>\\r\\n    <RequestId>21D327AF-A7DE-4E59-B5D1-ACAC8C024555</RequestId>\\r\\n    <ActionId>10003</ActionId>\\r\\n    <Success>true</Success>\\r\\n</CreateRuleActionResponse>\",\"errorExample\":\"\"}]","title":"CreateRuleAction","summary":"调用该接口在指定的规则下创建一个规则动作，定义将处理后的Topic数据，转发至物联网平台的其他Topic，或所支持的其他阿里云服务。","description":"## 使用说明\n\n- 服务地域不同，所支持的目标云产品有所不同。规则引擎支持的地域及目标云产品，请参见[地域与可用区](~~85669~~)。\n- 一个规则下面最多可创建10个规则动作。\n- 您可以通过调用该API创建规则动作，定义将数据转发至物联网平台其他Topic、AMQP消费组和其他阿里云产品（<props=\"china\"><ph>DataHub、消息队列RocketMQ、</ph></props>消息服务、函数计算和表格存储）。\n如果您想将数据转发至<props=\"china\"><ph>实例内的时序数据存储、时序数据库（TSDB）和</ph></props>云数据库RDS版，请在[物联网平台控制台](https://iot.console.aliyun.com)进行操作。\n\n\n\n## QPS限制\n单个阿里云账号调用该接口的每秒请求数（QPS）最大限制为50。\n> RAM用户共享该阿里云账号配额。","requestParamsDescription":"**REPUBLISH类型Configuration定义**\n|名称|描述|\n|------|------|\n|topic|转发的目标Topic（物模型通信Topic或自定义Topic）。支持将数据转发至数据下行的物模型通信Topic：<br>`/sys/${YourProductKey}/${YourDeviceName}/thing/service/property/set`<br>`/sys/${YourProductKey}/${YourDeviceName}/thing/service/${tsl.service.identifier}`<br>变量**${tsl.service.identifier}**的内容由该产品物模型中的服务决定。|\n|topicType|Topic的类型。<br>0：表示数据下行的物模型通信Topic。<br>1：表示自定义Topic。|\n\n\nREPUBLISH 类型**Configuration**示例：\n\n```\nsys类型：{\"topic\":\"/sys/a1TXXXXXWSN/xxx_cache001/thing/service/property/set\",\"topicType\":0}\n自定义类型：{\"topic\":\"/a1TXXXXXWSN/xxx_cache001/user/update\",\"topicType\":1}\n```\n**DATAHUB类型Configuration定义**\n\n|名称|描述|\n|-------------|------------ |\n|projectName|目标DataHub中用来接收信息的具体Project。|\n|topicName|目标DataHub中用来接收信息的具体Topic。|\n|regionName|目标DataHub所在的阿里云地域代码，例如cn-shanghai。|\n|role|授权角色信息。通过授予IoT指定的系统服务角色，您可以授权物联网平台访问您的DataHub。授权角色信息格式：<br>`{\"roleArn\":\"acs:ram::6541\\*\\**:role/aliyuniotaccessingdatahubrole\",\"roleName\": \"AliyunIOTAccessingDataHubRole\"}`<br>请将`6541\\*\\**`替换成您的阿里云账号ID。您可以登录控制台，在账号安全设置页面查看您的账号ID。<br>`AliyunIOTAccessingDataHubRole`是访问控制中定义的服务角色。用于授予物联网平台访问DataHub。关于角色的更多信息，请在访问控制RAM控制台的角色管理页面进行角色管理。|\n|schemaVals|目标DataHub中的Schema列表，详情参见下表schemaVals。|\n\nschemaVals\n\n\n|名称|描述|\n|-------------|------------|\n|name|列名。|\n|value|列值。|\n|type|列类型。<br>BIGINT：大整数型。<br>DOUBLE：双精度浮点型。<br>BOOLEAN：布尔型。<br>TIMESTAMP：时间戳型。<br>STRING：字符串型。<br>DECIMAL：小数型。|\n\nDATAHUB类型**Configuration**示例：\n\n```\n{\n    \"schemaVals\": [\n        {\n            \"name\": \"devicename\",\n            \"value\": \"${deviceName}\",\n            \"type\": \"STRING\"\n        },\n        {\n            \"name\": \"msgtime\",\n            \"value\": \"${msgTime}\",\n            \"type\": \"TIMESTAMP\"\n        }\n    ],\n    \"role\": {\n        \"roleArn\": \"acs:ram::6541***:role/aliyuniotaccessingdatahubrole\",\n        \"roleName\": \"AliyunIOTAccessingDataHubRole\"\n    },\n    \"projectName\": \"iot_datahub_stream\",\n    \"topicName\": \"device_message\",\n    \"regionName\": \"cn-shanghai\"\n}\n```\n\n**OTS类型Configuration定义**\n|名称|描述|\n|-------------|------------|\n|instanceName|表格存储中用来接收信息的实例名称。|\n|tableName|表格存储中用来接收信息的数据表名称。|\n|regionName|目标实例所在的阿里云地域代码，例如cn-shanghai。|\n|role|授权角色信息。通过授予物联网平台指定的系统服务角色，您可以授权物联网平台访问您的表格存储。授权角色信息：<br>`{\"roleArn\":\"acs:ram::6541*\\**:role/aliyuniotaccessingotsrole\",\"roleName\": \"AliyunIOTAccessingOTSRole\"}`<br>请将`6541*\\**`替换成您的阿里云账号ID。您可以登录控制台，在账号安全设置页面查看您的账号ID。<br>`AliyunIOTAccessingOTSRole`是访问控制中定义的服务角色。用于授予物联网平台访问表格存储。关于角色的更多信息，请在访问控制RAM控制台的角色管理页面进行角色管理。|\n|primaryKeys|目标表中的主键列表。详情参见下表PrimaryKeys。|\n\n PrimaryKeys\n|名称|描述|\n|-------------|------------|\n|columnType|主键类型。<br>INTEGER：整型。<br>STRING：字符串。<br>BINARY：二进制。|\n|columnName|主键名称。|\n|columnValue|主键值。|\n|option|主键是否为自增列，取值AUTO\\_INCREMENT或为空。当主键类型为INTEGER，且该字段为AUTO\\_INCREMENT时，主键为自增列。|\n\nOTS类型**Configuration**示例：\n\n```\n{\n    \"instanceName\": \"testaaa\",\n    \"tableName\": \"tt\",\n    \"primaryKeys\": [\n        {\n            \"columnType\": \"STRING\",\n            \"columnName\": \"ttt\",\n            \"columnValue\": \"${tt}\",\n            \"option\": \"\"\n        },\n        {\n            \"columnType\": \"INTEGER\",\n            \"columnName\": \"id\",\n            \"columnValue\": \"\",\n            \"option\": \"AUTO_INCREMENT\"\n        }\n    ],\n    \"regionName\": \"cn-shanghai\",\n    \"role\": {\n        \"roleArn\": \"acs:ram::5645***:role/aliyuniotaccessingotsrole\",\n        \"roleName\": \"AliyunIOTAccessingOTSRole\"\n    }\n}\n```\n\n**MNS类型Configuration定义**\n|名称|描述|\n|-------------|------------|\n|themeName| 消息服务中用来接收信息的目标主题名称。|\n|regionName| 目标消息服务所在的阿里云地域代码，例如cn-shanghai。|\n|role| 授权角色信息。通过授予物联网平台指定的系统服务角色，您可以授权物联网平台访问您的消息服务。授权角色信息：<br>`{\"roleArn\":\"acs:ram::6541*\\**:role/aliyuniotaccessingmnsrole\",\"roleName\": \"AliyunIOTAccessingMNSRole\"}`<br>请将`6541*\\**`替换成您的阿里云账号ID。您可以登录控制台，在账号安全设置页面查看您的账号ID。<br>`AliyunIOTAccessingMNSRole`是访问控制中定义的服务角色。用于授予物联网平台访问消息服务。关于角色的更多信息，请在访问控制RAM控制台的角色管理页面进行角色管理。|\n\nMNS类型**​Configuration**​​示例：\n\n```\n{\n    \"themeName\": \"mns-test-topic1\",\n    \"regionName\": \"cn-shanghai\",\n    \"role\": {\n        \"roleArn\": \"acs:ram::5645***:role/aliyuniotaccessingmnsrole\",\n        \"roleName\": \"AliyunIOTAccessingMNSRole\"\n    }\n}\n```\n\n**FC类型Configuration定义**\n\n|名称|描述|\n|-------------|------------|\n|functionName| 函数服务中用来接收信息的目标函数名称。|\n|serviceName| 函数服务中用来接收信息的目标服务名称。|\n|regionName| 目标函数服务实例所在阿里云地域的代码，如cn-shanghai。|\n|role| 授权角色信息。通过授予物联网平台指定的系统服务角色，您可以授权物联网平台访问您的函数计算服务。授权角色信息：<br>`{\"roleArn\":\"acs:ram::6541*\\**:role/aliyuniotaccessingfcrole\",\"roleName\": \"AliyunIOTAccessingFCRole\"}`<br>请将`6541*\\**`替换成您的阿里云账号ID。您可以登录控制台，在账号安全设置页面查看您的账号ID。<br>`AliyunIOTAccessingFCRole`是访问控制中定义的服务角色。用于授予物联网平台访问函数计算。关于角色的更多信息，请在访问控制RAM控制台的角色管理页面进行角色管理。|\n\nFC类型**Configuration**示例：\n\n```\n{\n    \"regionName\": \"cn-shanghai\",\n    \"role\": {\n        \"roleArn\": \"acs:ram::5645***:role/aliyuniotaccessingfcrole\",\n        \"roleName\": \"AliyunIOTAccessingFCRole\"\n    },\n    \"functionName\": \"weatherForecast\",\n    \"serviceName\": \"weather\"\n}\n```\n**ONS类型Configuration定义**\n\n> 您需通过调用消息队列RocketMQ的SDK，或在消息队列RocketMQ控制台，授权物联网平台访问消息队列RocketMQ（至少要授予物联网平台发布权限），然后才能够成功创建将Topic数据转发至消息队列RocketMQ的规则动作。\n\n|名称|描述|\n|-------------|------------|\n|instanceId|RocketMQ中用来接收消息的目标Topic所属的实例ID。|\n|topic|RocketMQ中用来接收信息的目标Topic。|\n|regionName|目标RocketMQ实例所在的阿里云地域代码，例如cn-shanghai。<br>> 公网和同区流转，使用普通版RocketMQ实例即可；如果您需要跨区流转，则RocketMQ实例必需是铂金版实例。|\n|tag|（可选）设置标签。长度限制为128字节。|\n|role|授权角色信息。通过授予物联网平台指定的系统服务角色，您可以授权物联网平台访问您的消息队列RocketMQ服务。授权角色信息：<br>`{\"roleArn\":\"acs:ram::6541*\\**:role/aliyuniotaccessingonsrole\",\"roleName\": \"AliyunIOTAccessingONSRole\"}`<br>请将`6541*\\**`替换成您的阿里云账号ID。您可以登录控制台，在账号安全设置页面查看您的账号ID。<br>`AliyunIOTAccessingONSRole`是访问控制中定义的服务角色。用于授予物联网平台访问消息队列RocketMQ。关于角色的更多信息，请在访问控制RAM控制台的角色管理页面进行角色管理。|\n\nONS类型**Configuration**示例：\n\n\n```\n{\n    \"instanceId\": \"MQ_INST_123157908552****_XXXXXX\"\n    \"topic\": \"aliyun-iot-XXXXX\",\n    \"regionName\": \"cn-hangzhou\",\n    \"role\": {\n        \"roleArn\": \"acs:ram::6541***:role/aliyuniotaccessingonsrole\",\n        \"roleName\": \"AliyunIOTAccessingONSRole\"\n    }\n}\n```\n\n**AMQP类型Configuration定义**\n\n|名称|描述|\n|-------------|------------|\n|groupId|消费组ID。|\n\nAMQP类型**Configuration**示例：\n\n```\n{\n    \"groupId\":\"ZTh1JmyLGuZcUfv44p4z00****\"\n}\n```\n\n调用API时，除了本文介绍的该API的特有请求参数，还需传入公共请求参数。公共请求参数说明，请参见[公共参数文档](~~30561~~)。","responseParamsDescription":" ","extraInfo":" "}