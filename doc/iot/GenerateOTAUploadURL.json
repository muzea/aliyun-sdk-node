{"methods":["post","get"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"readAndWrite","deprecated":false,"systemTags":{"operationType":"create"},"parameters":[{"name":"IotInstanceId","in":"query","schema":{"description":"实例ID。您可在物联网平台控制台的**实例概览**页面，查看当前实例的**ID**。\n\n><notice>\n- 若有ID值，必须传入该ID值，否则调用会失败。\n- 若无ID值，则无需传入。\n\n></notice>\n\n实例的更多信息，请参见[实例概述](~~356505~~)。","type":"string","required":false,"example":"iot-cn-0pp1n8t****"}},{"name":"FileSuffix","in":"query","schema":{"description":"升级包文件扩展名。可选扩展名：\n\n- **bin**（默认）\n- **dav**\n- **apk**\n- **tar**\n- **gz**\n- **tar.gz**\n- **zip**\n- **gzip**","type":"string","required":false,"example":"apk"}}],"responses":{"200":{"schema":{"type":"object","properties":{"Code":{"description":"调用失败时，返回的错误码。更多信息，请参见[错误码](~~87387~~)。","type":"string","example":"iot.system.SystemException"},"ErrorMessage":{"description":"调用失败时，返回的出错信息。","type":"string","example":"系统异常"},"RequestId":{"description":"阿里云为该请求生成的唯一标识符。","type":"string","example":"74C2BB8D-1D6F-41F5-AE68-6B2310883F63"},"Success":{"description":"是否调用成功。\n- **true**：调用成功。\n- **false**：调用失败。","type":"boolean","example":"true"},"Data":{"description":"调用成功时，返回的文件上传信息。详情见以下参数信息。","type":"object","properties":{"Key":{"description":"调用OSS的接口PostObject上传对象（即文件）的名称，包含OSS对象的完整路径。","type":"string","example":"ota/65dfcda0473be29836dfde585472****/ck2nfzljo00023g7kysg0****.bin"},"OSSAccessKeyId":{"description":"OSS Bucket拥有者的**AccessKey ID**。\n\n该OSS Bucket将存储文件。","type":"string","example":"cS8uRRy54Rsz****"},"Signature":{"description":"根据**AccessKeySecret**和**Policy**计算出的签名信息。调用OSS API时，OSS验证该签名信息，从而确认Post请求的合法性。","type":"string","example":"v6lViO4FBvfquajQjg20K5hK****"},"Host":{"description":"OSS的接入域名。","type":"string","example":"https://iotx-ota.oss-cn-shanghai.aliyuncs.com"},"Policy":{"description":"OSS通过该参数验证请求表单域的合法性。","type":"string","example":"eyJleHBpcmF****"},"ObjectStorage":{"description":"对象存储类型。默认为OSS。","type":"string","example":"OSS"},"FirmwareUrl":{"description":"文件的URL，即文件在对象存储（OSS）上的存储地址。\n\n文件URL的格式为`https://BucketName.Endpoint/ObjectName`。其中，BucketName是Bucket名称，Endpoint是文件访问域名（各地域的Endpoint信息，请参见[访问域名和数据中心](~~31837~~)），ObjectName是包含文件夹以及文件后缀在内的该文件的完整路径。\n\n升级包文件上传成功后，使用此参数调用[CreateOTAFirmware](~~147311~~)接口创建升级包。","type":"string","example":"https://iotx-ota.oss-cn-shanghai.aliyuncs.com/ota/65dfcda0473be29836dfde585472****/ck2nfzljo00023g7kysg0****.bin"},"UtcCreate":{"description":"生成文件上传URL的时间，UTC格式。","type":"string","example":"2019-11-04T06:21:54.607Z"}}}}}}},"errorCodes":{},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"Code\\\": \\\"iot.system.SystemException\\\",\\n  \\\"ErrorMessage\\\": \\\"系统异常\\\",\\n  \\\"RequestId\\\": \\\"74C2BB8D-1D6F-41F5-AE68-6B2310883F63\\\",\\n  \\\"Success\\\": true,\\n  \\\"Data\\\": {\\n    \\\"Key\\\": \\\"ota/65dfcda0473be29836dfde585472****/ck2nfzljo00023g7kysg0****.bin\\\",\\n    \\\"OSSAccessKeyId\\\": \\\"cS8uRRy54Rsz****\\\",\\n    \\\"Signature\\\": \\\"v6lViO4FBvfquajQjg20K5hK****\\\",\\n    \\\"Host\\\": \\\"https://iotx-ota.oss-cn-shanghai.aliyuncs.com\\\",\\n    \\\"Policy\\\": \\\"eyJleHBpcmF****\\\",\\n    \\\"ObjectStorage\\\": \\\"OSS\\\",\\n    \\\"FirmwareUrl\\\": \\\"https://iotx-ota.oss-cn-shanghai.aliyuncs.com/ota/65dfcda0473be29836dfde585472****/ck2nfzljo00023g7kysg0****.bin\\\",\\n    \\\"UtcCreate\\\": \\\"2019-11-04T06:21:54.607Z\\\"\\n  }\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\\n<GenerateOTAUploadURLResponse>\\n  <Data>\\n    <Key>ota/65dfcda0473be29836dfde585472****/ck2nfzljo00023g7kysg0****.bin</Key>\\n    <Host>https://iotx-ota.oss-cn-shanghai.aliyuncs.com</Host>\\n    <Policy>eyJleHBpcmF****</Policy>\\n    <OSSAccessKeyId>cS8uRRy54Rsz****</OSSAccessKeyId>\\n    <ObjectStorage>OSS</ObjectStorage>\\n    <UtcCreate>2019-11-04T06:21:54.607Z</UtcCreate>\\n    <Signature>PKmRTy40QxqIUUWy325SCT/****</Signature>\\n    <FirmwareUrl>https://iotx-ota.oss-cn-shanghai.aliyuncs.com/ota/65dfcda0473be29836dfde585472****/ck2nfzljo00023g7kysg0****.bin</FirmwareUrl>\\n  </Data>\\n  <RequestId>B6E77674-09C4-4647-BF85-59CB72A72E4B</RequestId>\\n  <Success>true</Success>\\n</GenerateOTAUploadURLResponse>\",\"errorExample\":\"\"}]","title":"生成升级包文件URL","summary":"生成升级包文件上传到OSS的URL及详细信息。","description":"## 使用说明\n该接口与其他接口结合使用完成升级包创建。创建升级包的步骤：\n\n1. 调用本接口生成升级包文件上传到对象存储（OSS）的信息。\n本接口的返回参数包含：\n    - 调用OSS [PostObject](~~31988~~)上传升级包文件的请求参数：**Host**、**Key**、**OSSAccessKeyId**、**Signature**和**Policy**。\n    - 调用[CreateOTAFirmware](~~147311~~)创建升级包的请求参数**FirmwareUrl**。\n\n2. 请在本接口返回结果后的1分钟之内，使用[OSS SDK](~~52834~~)调用[PostObject](~~31988~~)接口上传升级包文件。上传文件的代码示例，请参见下文“返回参数的用途”章节。\n\n    ><notice> 本接口返回的参数信息有效期为1分钟，请在1分钟内上传升级包。上传的升级包文件大小不能超过1,000 MB。\n    ></notice>\n\n\n3. 升级包上传完成后，请在60分钟内，调用物联网平台API [CreateOTAFirmware](~~147311~~)接口创建升级包。\n    如果上传了升级包，但未调用CreateOTAFirmware接口创建升级包，上传的文件将被系统定期自动清理。\n\n\n## QPS限制\n单个阿里云账号调用该接口的每秒请求数（QPS）最大限制为10。\n> 单个阿里云账号下的所有RAM用户共享该阿里云账号的配额。","requestParamsDescription":"调用API时，除了本文介绍的该API的特有请求参数，还需传入公共请求参数。公共请求参数说明，请参见[公共参数文档](~~30561~~)。","responseParamsDescription":"## 返回参数的用途\n\n调用OSS [PostObject](~~31988~~)接口时，使用本接口的返回参数值作为请求参数值，将您编辑好的升级包文件上传到对象存储（OSS）。\n\n以下是向对象存储OSS上传文件的Java代码示例。示例代码详细内容，请参见[表单上传](~~84788~~)。\n\n- 在pom.xml中添加以下依赖。\n```\n<dependency>\n  <groupId>org.apache.httpcomponents</groupId>\n  <artifactId>httpclient</artifactId>\n  <version>4.5.3</version>\n</dependency>\n\n<dependency>\n  <groupId>org.apache.httpcomponents</groupId>\n  <artifactId>httpmime</artifactId>\n  <version>4.5.10</version>\n</dependency>\n```\n\n- 上传升级包文件的代码如下。\n```\npublic static boolean postObject(String key,\n                                  String host,\n                                  String policy,\n                                  String ossAccessKeyId,\n                                  String signature,\n                                  String data) throws IOException {\n  CloseableHttpClient httpClient = HttpClients.createDefault();\n  HttpPost uploadFile = new HttpPost(host);\n\n  MultipartEntityBuilder builder = MultipartEntityBuilder.create();\n  builder.addTextBody(\"key\", key, ContentType.TEXT_PLAIN);\n  builder.addTextBody(\"policy\", policy, ContentType.TEXT_PLAIN);\n  builder.addTextBody(\"OSSAccessKeyId\", ossAccessKeyId, ContentType.TEXT_PLAIN);\n  builder.addTextBody(\"signature\", signature, ContentType.TEXT_PLAIN);\n  builder.addTextBody(\"success_action_status\", \"200\", ContentType.TEXT_PLAIN);\n  builder.addBinaryBody(\"file\", data.getBytes());\n\n  HttpEntity multipart = builder.build();\n  uploadFile.setEntity(multipart);\n  CloseableHttpResponse response = httpClient.execute(uploadFile);\n\n  if (response.getStatusLine().getStatusCode() == 200) {\n    return true;\n  }\n\n  return false;\n}\n```","extraInfo":" "}