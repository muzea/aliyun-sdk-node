{"summary":"更新Logtail流水线配置。","path":"/pipelineconfigs/{configName}","methods":["put"],"schemes":["https"],"security":[{"AK":[]}],"consumes":["application/json"],"produces":[],"operationType":"write","deprecated":false,"systemTags":{"operationType":"update","riskType":"none","chargeType":"free"},"parameters":[{"name":"project","in":"host","schema":{"title":"Project名称","description":"Project名称。","type":"string","required":true,"example":"test-project"}},{"name":"configName","in":"path","schema":{"title":"Logtail流水线配置名称","description":"Logtail流水线配置名称。","type":"string","required":true,"example":"test-config","pattern":"^[0-9a-zA-Z][0-9a-zA-Z-_]{0,126}[0-9a-zA-Z]$"}},{"name":"body","in":"body","style":"json","schema":{"title":"Logtail流水线配置内容","description":"Logtail流水线配置内容。","type":"object","properties":{"configName":{"title":"配置名称","description":"配置名称。\n\n><notice>需要与外层的configName参数保持一致。></notice>","type":"string","required":true,"example":"test-config","pattern":"^[0-9a-zA-Z][0-9a-zA-Z-_]{0,126}[0-9a-zA-Z]$"},"logSample":{"title":"日志样例","description":"日志样例。支持多条日志。","type":"string","required":false,"example":"2022-06-14 11:13:29.796 | DEBUG    | __main__:<module>:1 - hello world"},"global":{"title":"全局配置","description":"全局配置。","type":"object","required":false},"inputs":{"title":"输入插件列表","description":"输入插件列表。\n\n><notice>目前，只允许配置1个输入插件。></notice>","type":"array","items":{"title":"输入插件","description":"输入插件。\n\n> 文件输入插件参数请参见[文件插件](~~65064~~)，其余输入插件参数请参见[处理插件](~~64957~~)。","type":"object","required":false,"example":"{\n    \"Type\": \"input_file\",\n    \"FilePaths\": [\"/var/log/*.log\"]\n}"},"required":true,"minItems":1},"processors":{"title":"输入插件列表","description":"输入插件列表。\n\n> 可分为原生处理插件和扩展处理插件，详情请参见[处理插件](~~64957~~)。\n\n><notice>\n\n> - 原生插件仅可用于采集文本日志。\n> - 不支持同时添加原生插件和扩展插件。\n> - 使用原生插件时，须符合如下要求：\n>   - 第一个处理插件必须为正则解析插件、分隔符模式解析插件、JSON解析插件、NGINX模式解析插件、Apache模式解析插件或IIS模式解析插件。\n>   - 第一个处理插件之后仅允许存在1个时间解析处理插件，1个过滤插件和多个脱敏插件。></notice>","type":"array","items":{"title":"输入插件","description":"处理插件。\n\n>详情请参见[处理插件](~~64957~~)。","type":"object","required":false,"example":"{\n    \"Type\": \"processor_parse_json_native\",\n    \"SourceKey\": \"content\"\n}"},"required":false,"minItems":1},"aggregators":{"title":"聚合插件列表","description":"聚合插件列表。\n\n><notice>仅当使用了扩展处理插件时有效，且最多允许使用1个聚合插件。></notice>","type":"array","items":{"title":"聚合插件","description":"聚合插件。","type":"object","required":false},"required":false,"minItems":1},"flushers":{"title":"输出插件列表","description":"输出插件列表。\n\n><notice>目前，只允许存在1个SLS输出插件。></notice>","type":"array","items":{"title":"输出插件","description":"输出插件。","type":"object","required":false,"example":"{\n    \"Type\": \"flusher_sls\",\n    \"Logstore\": \"test\"\n}"},"required":true,"minItems":1}},"required":false}}],"responses":{"200":{"headers":{"Server":{"schema":{"title":"服务器名称。","type":"string","example":"nginx"}},"Content-Type":{"schema":{"title":"返回的响应体的内容格式。","type":"string","example":"application/json"}},"Content-Length":{"schema":{"title":"响应内容长度。","type":"string","example":"0"}},"Connection":{"schema":{"title":"是否长链接。取值包括：  close：不是长链接，则每个HTTP请求都会重新建立TCP连接。 keep-alive：长链接，TCP连接建立后保持连接状态，节省连接所需时间和带宽。","type":"string","example":"close"}},"Date":{"schema":{"title":"返回响应的时间。","type":"string","example":"Sun, 27 May 2018 08:25:04 GMT"}},"x-log-requestid":{"schema":{"title":"服务端产生的标识，该请求的唯一ID。","type":"string","example":"5B0A6B60BB6EE39764D458B5"}}}}},"staticInfo":{"returnType":"synchronous"},"responseDemo":"[{\"errorExample\":\"\",\"example\":\"{}\",\"type\":\"json\"}]","title":"更新Logtail流水线配置","requestParamsDescription":"# 全局配置\n\n|  **参数**  |  **类型**  |  **是否必填**  |  **默认值**  |  **示例**  |  **说明**  |\n| --- | --- | --- | --- | --- | --- |\n|  TopicType  |  string  |  否  |  空  |  filepath  |  Topic类型。可选值包括：<ul><li>filepath：从日志文件路径中提取信息作为Topic。仅当输入插件为input\\_file时有效。</li><li>machine\\_group\\_topic：将应用该配置的机器组Topic作为Topic。</li><li>custom：自定义Topic      更多信息，请参见[日志主题](~~60069~~)。</li></ul>  |\n|  TopicFormat  |  string  |  否，当TopicType取值为filepath或custom时必填  |  /  |  /var/log/(.\\*).log  |  Topic格式。  |\n|  EnableTimestampNanosecond  |  bool  |  否  |  false  |  false  |  是否启用时间纳秒精度。  |\n\n# 输入插件\n\n## 文件输入插件\n\n|  **参数**  |  **类型**  |  **是否必填**  |  **默认值**  |  **示例**  |  **说明**  |\n| --- | --- | --- | --- | --- | --- |\n|  Type  |  string  |  是  |  /  |  input\\_file  |  插件类型。固定为input\\_file。  |\n|  FilePaths  |  \\[string\\]  |  是  |  /  |  \\[\"/var/log/\\*.log\"\\]  |  待采集的日志文件路径列表（目前仅限1个路径）。路径中支持使用\\*和\\*\\*通配符，其中\\*\\*通配符仅能出现一次且仅限用于文件名前。  |\n|  MaxDirSearchDepth  |  uint  |  否  |  0  |  0  |  文件路径中\\*\\*通配符匹配的最大目录深度。仅当日志路径中存在\\*\\*通配符时有效，取值范围为0～1000。  |\n|  ExcludeFilePaths  |  \\[string\\]  |  否  |  空  |  \\[\"/home/admin/\\*.log\"\\]  |  文件路径黑名单。路径必须为绝对路径，支持使用\\*通配符  |\n|  ExcludeFiles  |  \\[string\\]  |  否  |  空  |  \\[\"app\\*.log\", \"password\"\\]  |  文件名黑名单。支持使用\\*通配符  |\n|  ExcludeDirs  |  \\[string\\]  |  否  |  空  |  \\[\"/home/admin/dir1\", \"/home/admin/dir2\\*\"\\]  |  目录黑名单。路径必须为绝对路径，支持使用\\*通配符  |\n|  FileEncoding  |  string  |  否  |  utf8  |  utf8  |  文件编码格式。可选值包括utf8和gbk。  |\n|  TailSizeKB  |  uint  |  否  |  1024  |  1024  |  配置首次生效时，匹配文件的起始采集位置距离文件结尾的大小。如果文件大小小于该值，则从头开始采集，取值范围为0～10485760KB。  |\n|  Multiline  |  object  |  否  |  空  |  /  |  多行聚合选项。  |\n|  Multiline.Mode  |  string  |  否  |  custom  |  custom  |  多行聚合模式。可选值包括custom和JSON。  |\n|  Multiline.StartPattern  |  string  |  当Multiline.Mode取值为custom时必填  |  空  |  \\d+-\\d+-\\d+.\\*  |  行首正则表达式。  |\n|  EnableContainerDiscovery  |  bool  |  否  |  false  |  true  |  是否启用容器发现功能。仅当Logtail以Daemonset模式运行，且采集文件路径为容器内路径时有效。  |\n|  ContainerFilters  |  object  |  否  |  空  |  /  |  容器过滤选项。多个选项之间为“且”的关系，仅当EnableContainerDiscovery取值为true时有效。  |\n|  ContainerFilters.K8sNamespaceRegex  |  string  |  否  |  空  |  default  |  对于部署于K8s环境的容器，指定待采集容器所在Pod所属的命名空间条件。如果未添加该参数，则表示采集所有容器。支持正则匹配。  |\n|  ContainerFilters.K8sPodRegex  |  string  |  否  |  空  |  test-pod  |  对于部署于K8s环境的容器，指定待采集容器所在Pod的名称条件。如果未添加该参数，则表示采集所有容器。支持正则匹配。  |\n|  ContainerFilters.IncludeK8sLabel  |  map  |  否  |  空  |  /  |  对于部署于K8s环境的容器，指定待采集容器所在pod的标签条件。多个条件之间为“或”的关系，如果未添加该参数，则表示采集所有容器。支持正则匹配。 map中的key为Pod标签名，value为Pod标签的值，说明如下：<ul><li>如果map中的value为空，则pod标签中包含以key为键的pod都会被匹配；</li><li>如果map中的value不为空，则：<ul></li><li>若value以`^`开头并且以`$`结尾，则当pod标签中存在以key为标签名且对应标签值能正则匹配value的情况时，相应的pod会被匹配；</li><li>其他情况下，当pod标签中存在以key为标签名且以value为标签值的情况时，相应的pod会被匹配。</li></ul></ul>       |\n|  ContainerFilters.ExcludeK8sLabel  |  map  |  否  |  空  |  /  |  对于部署于K8s环境的容器，指定需要排除采集容器所在pod的标签条件。多个条件之间为“或”的关系，如果未添加该参数，则表示采集所有容器。支持正则匹配。 map中的key为pod标签名，value为pod标签的值，说明如下：<ul><li>如果map中的value为空，则pod标签中包含以key为键的pod都会被匹配；</li><li>如果map中的value不为空，则：<ul></li><li>若value以`^`开头并且以`$`结尾，则当pod标签中存在以key为标签名且对应标签值能正则匹配value的情况时，相应的pod会被匹配；</li><li>其他情况下，当pod标签中存在以key为标签名且以value为标签值的情况时，相应的pod会被匹配。</li></ul></ul>       |\n|  ContainerFilters.K8sContainerRegex  |  string  |  否  |  空  |  test-container  |  对于部署于K8s环境的容器，指定待采集容器的名称条件。如果未添加该参数，则表示采集所有容器。支持正则匹配。  |\n|  ContainerFilters.IncludeEnv  |  map  |  否  |  空  |  /  |  指定待采集容器的环境变量条件。多个条件之间为“或”的关系，如果未添加该参数，则表示采集所有容器。支持正则匹配。 map中的key为环境变量名，value为环境变量的值，说明如下：<ul><li>如果map中的value为空，则容器环境变量中包含以key为键的容器都会被匹配；</li><li>如果map中的value不为空，则：<ul></li><li>若value以`^`开头并且以`$`结尾，则当容器环境变量中存在以key为环境变量名且对应环境变量值能正则匹配value的情况时，相应的容器会被匹配；</li><li>其他情况下，当容器环境变量中存在以key为环境变量名且以value为环境变量值的情况时，相应的容器会被匹配。</li></ul></ul>      |\n|  ContainerFilters.ExcludeEnv  |  map  |  否  |  空  |  /  |  指定需要排除采集容器的环境变量条件。多个条件之间为“或”的关系，如果未添加该参数，则表示采集所有容器。支持正则匹配。 map中的key为环境变量名，value为环境变量的值，说明如下：<ul><li>如果map中的value为空，则容器环境变量中包含以key为键的容器都会被匹配；</li><li>如果map中的value不为空，则：<ul></li><li>若value以`^`开头并且以`$`结尾，则当容器环境变量中存在以key为环境变量名且对应环境变量值能正则匹配value的情况时，相应的容器会被匹配；</li><li>其他情况下，当容器环境变量中存在以key为环境变量名且以value为环境变量值的情况时，相应的容器会被匹配。</li></ul></ul>      |\n|  ContainerFilters.IncludeContainerLabel  |  map  |  否  |  空  |  /  |  指定待采集容器的标签条件。多个条件之间为“或”的关系，如果未添加该参数，则默认为空，表示采集所有容器。支持正则匹配。 map中的key为容器标签名，value为容器标签的值，说明如下：<ul><li>如果map中的value为空，则容器标签中包含以key为键的容器都会被匹配；</li><li>如果map中的value不为空，则：<ul></li><li>若value以`^`开头并且以`$`结尾，则当容器标签中存在以key为标签名且对应标签值能正则匹配value的情况时，相应的容器会被匹配；</li><li>其他情况下，当容器标签中存在以key为标签名且以value为标签值的情况时，相应的容器会被匹配。</li></ul></ul>       |\n|  ContainerFilters.ExcludeContainerLabel  |  map  |  否  |  空  |  /  |  指定需要排除采集容器的标签条件。多个条件之间为“或”的关系，如果未添加该参数，则默认为空，表示采集所有容器。支持正则匹配。 map中的key为容器标签名，value为容器标签的值，说明如下：<ul><li>如果map中的value为空，则容器标签中包含以key为键的容器都会被匹配；</li><li>如果map中的value不为空，则：<ul></li><li>若value以`^`开头并且以`$`结尾，则当容器标签中存在以key为标签名且对应标签值能正则匹配value的情况时，相应的容器会被匹配；</li><li>其他情况下，当容器标签中存在以key为标签名且以value为标签值的情况时，相应的容器会被匹配。</li></ul></ul>  |\n|  ExternalK8sLabelTag  |  map  |  否  |  空  |  /  |  对于部署于K8s环境的容器，需要在日志中额外添加的与Pod标签相关的tag。map中的key为Pod标签名，value为对应的tag名。 例如：在map中添加`app: k8s\\_label\\_app`，则若pod中包含`app=serviceA`的标签时，会将该信息以tag的形式添加到日志中，即添加字段`__tag__:k8s_label_app: serviceA`；若不包含`app`标签，则会添加空字段`__tag__:k8s_label_app: `。 |\n|  ExternalEnvTag  |  map  |  否  |  空  |  /  |  对于部署于K8s环境的容器，需要在日志中额外添加的与容器环境变量相关的tag。map中的key为环境变量名，value为对应的tag名。 例如：在map中添加`VERSION: env\\_version`，则当容器中包含环境变量`VERSION=v1.0.0`时，会将该信息以tag的形式添加到日志中，即添加字段`__tag__:env_version: v1.0.0`；若不包含`VERSION`环境变量，则会添加空字段`__tag__:env_version:`  |\n|  CollectingContainersMeta  |  bool  |  否  |  false  |  true  |  是否启用容器元信息预览。  |\n|  AppendingLogPositionMeta  |  bool  |  否  |  false  |  false  |  是否在日志中添加该条日志所属文件的元信息，包括\\_\\_tag\\_\\_:\\_\\_inode\\_\\_字段和\\_\\_file\\_offset\\_\\_字段。  |\n|  AllowingIncludedByMultiConfigs  |  bool  |  否  |  false  |  false  |  是否允许当前配置采集其它配置已匹配的文件。  |\n\n# 原生处理插件\n\n## 正则解析原生处理插件\n\n|  **参数**  |  **类型**  |  **是否必填**  |  **默认值**  |  **示例**  |  **说明**  |\n| --- | --- | --- | --- | --- | --- |\n|  Type  |  string  |  是  |  /  |  processor\\_parse\\_regex\\_native  |  插件类型。固定为processor\\_parse\\_regex\\_native。  |\n|  SourceKey  |  string  |  是  |  /  |  content  |  源字段名。  |\n|  Regex  |  string  |  是  |  /  |  (\\d+-\\d+-\\d+)\\s+(.\\*)  |  正则表达式。  |\n|  Keys  |  \\[string\\]  |  是  |  /  |  \\[\"time\", \"msg\"\\]  |  提取的字段列表。  |\n|  KeepingSourceWhenParseFail  |  bool  |  否  |  false  |  false  |  当解析失败时，是否保留源字段。  |\n|  KeepingSourceWhenParseSucceed  |  bool  |  否  |  false  |  false  |  当解析成功时，是否保留源字段。  |\n|  RenamedSourceKey  |  string  |  否  |  空  |  key  |  当源字段被保留时，用于存储源字段的字段名。若不填，默认不改名。  |\n\n## JSON解析原生处理插件\n\n|  **参数**  |  **类型**  |  **是否必填**  |  **默认值**  |  **示例**  |  **说明**  |\n| --- | --- | --- | --- | --- | --- |\n|  Type  |  string  |  是  |  /  |  processor\\_parse\\_json\\_native  |  插件类型。固定为processor\\_parse\\_json\\_native。  |\n|  SourceKey  |  string  |  是  |  /  |  content  |  源字段名。  |\n|  KeepingSourceWhenParseFail  |  bool  |  否  |  false  |  false  |  当解析失败时，是否保留源字段。  |\n|  KeepingSourceWhenParseSucceed  |  bool  |  否  |  false  |  false  |  当解析成功时，是否保留源字段。  |\n|  RenamedSourceKey  |  string  |  否  |  空  |  key  |  当源字段被保留时，用于存储源字段的字段名。若不填，默认不改名。  |\n\n## 分隔符解析原生处理插件\n\n|  **参数**  |  **类型**  |  **是否必填**  |  **默认值**  |  **示例**  |  **说明**  |\n| --- | --- | --- | --- | --- | --- |\n|  Type  |  string  |  是  |  /  |  processor\\_parse\\_delimiter\\_native  |  插件类型。固定为processor\\_parse\\_delimiter\\_native。  |\n|  SourceKey  |  string  |  是  |  /  |  content  |  源字段名。  |\n|  Separator  |  string  |  是  |  /  |  ,  |  分隔符。  |\n|  Quote  |  string  |  否  |  \"  |  \"  |  引用符。  |\n|  Keys  |  \\[string\\]  |  是  |  /  |  \\[\"time\", \"msg\"\\]  |  提取的字段列表。  |\n|  AllowingShortenedFields  |  bool  |  否  |  true  |  true  |  是否允许提取的字段数量小于Keys的数量。若不允许，则此情景会被视为解析失败。  |\n|  OverflowedFieldsTreatment  |  string  |  否  |  extend  |  extend  |  当提取的字段数量大于Keys的数量时的行为。可选值包括：<ul><li>extend：保留多余的字段，且每个多余的字段都作为单独的一个字段加入日志，多余字段的字段名为\\_\\_column$i\\_\\_，其中$i代表额外字段序号，从0开始计数。</li><li>keep：保留多余的字段，但将多余内容作为一个整体字段加入日志，字段名为\\_\\_column0\\_\\_.</li><li>discard：丢弃多余的字段。</li></ul>       |\n|  KeepingSourceWhenParseFail  |  bool  |  否  |  false  |  false  |  当解析失败时，是否保留源字段。  |\n|  KeepingSourceWhenParseSucceed  |  bool  |  否  |  false  |  false  |  当解析成功时，是否保留源字段。  |\n|  RenamedSourceKey  |  string  |  否  |  空  |  key  |  当源字段被保留时，用于存储源字段的字段名。若不填，默认不改名。  |\n\n## 飞天解析原生处理插件\n\n|  **参数**  |  **类型**  |  **是否必填**  |  **默认值**  |  **示例**  |  **说明**  |\n| --- | --- | --- | --- | --- | --- |\n|  Type  |  string  |  是  |  /  |  processor\\_parse\\_apsara\\_native  |  插件类型。固定为processor\\_parse\\_apsara\\_native。  |\n|  SourceKey  |  string  |  是  |  /  |  content  |  源字段名。  |\n|  Timezone  |  string  |  否  |  空  |  GMT+08:00  |  日志时间所属时区。格式为GMT+HH:MM（东区）或GMT-HH:MM（西区）。  |\n|  KeepingSourceWhenParseFail  |  bool  |  否  |  false  |  false  |  当解析失败时，是否保留源字段。  |\n|  KeepingSourceWhenParseSucceed  |  bool  |  否  |  false  |  false  |  当解析成功时，是否保留源字段。  |\n|  RenamedSourceKey  |  string  |  否  |  空  |  key  |  当源字段被保留时，用于存储源字段的字段名。若不填，默认不改名。  |\n\n## 时间解析原生处理插件\n\n|  **参数**  |  **类型**  |  **是否必填**  |  **默认值**  |  **示例**  |  **说明**  |\n| --- | --- | --- | --- | --- | --- |\n|  Type  |  string  |  是  |  /  |  processor\\_parse\\_timestamp\\_native  |  插件类型。固定为processor\\_parse\\_timestamp\\_native。  |\n|  SourceKey  |  string  |  是  |  /  |  content  |  源字段名。  |\n|  SourceFormat  |  string  |  是  |  /  |  %Y/%m/%d %H:%M:%S  |  日志时间格式。更多信息，请参见[时间格式](~~28980~~)。  |\n|  SourceTimezone  |  string  |  否  |  空  |  GMT+08:00  |  日志时间所属时区。格式为GMT+HH:MM（东区）或GMT-HH:MM（西区）。  |\n\n## 过滤原生处理插件\n\n|  **参数**  |  **类型**  |  **是否必填**  |  **示例**  |  **默认值**  |  **说明**  |\n| --- | --- | --- | --- | --- | --- |\n|  Type  |  string  |  是  |  processor\\_filter\\_regex\\_native  |  /  |  插件类型。固定为processor\\_filter\\_regex\\_native。  |\n|  Include  |  map  |  是  |  /  |  /  |  日志字段白名单，其中key为字段名，value为正则表达式，表示如果当前事件要被采集，则key指定的字段内容所需要满足的条件。多个条件之间为“且”的关系，仅当所有条件均满足时，该条日志才会被采集。  |\n\n## 脱敏原生处理插件\n\n|  **参数**  |  **类型**  |  **是否必填**  |  **默认值**  |  **示例**  |  **说明**  |\n| --- | --- | --- | --- | --- | --- |\n|  Type  |  string  |  是  |  /  |  processor\\_desensitize\\_native  |  插件类型。固定为processor\\_desensitize\\_native。  |\n|  SourceKey  |  string  |  是  |  /  |  content  |  源字段名。  |\n|  Method  |  string  |  是  |  /  |  const  |  脱敏方式。可选值包括： *   const：用常量替换敏感内容。      *   md5：用敏感内容的MD5值替换相应内容。       |\n|  ReplacingString  |  string  |  否，当Method取值为const时必选  |  /  |  \\*\\*\\*\\*\\*\\*  |  用于替换敏感内容的常量字符串。  |\n|  ContentPatternBeforeReplacedString  |  string  |  是  |  /  |  'password:'  |  敏感内容的前缀正则表达式。  |\n|  ReplacedContentPattern  |  string  |  是  |  /  |  \\[^'\\]\\*  |  敏感内容的正则表达式。  |\n|  ReplacingAll  |  bool  |  否  |  true  |  true  |  是否替换所有的匹配的敏感内容。  |\n\n# 输出插件\n\n## SLS输出插件\n\n|  **参数**  |  **类型**  |  **是否必填**  |  **默认值**  |  **示例**  |  **说明**  |\n| --- | --- | --- | --- | --- | --- |\n|  Type  |  string  |  是  |  /  |  flusher\\_sls  |  插件类型。固定为flusher\\_sls。  |\n|  Logstore  |  stirng  |  是  |  /  |  test-logstore  |  LogStrore名称。  |"}