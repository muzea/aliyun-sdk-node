{"summary":"在阿里云日志服务平台上，提供了基础数据（Log、Metric、Trace）的智能分析能力。用户调用相关模型，可以直接得到模型的分析结果。目前主要涉及：日志数据的NER任务、时间序列数据的异常检测、高延时链路数据的Span根因定位。","path":"/ml/service/{serviceName}/analysis","methods":["post"],"schemes":["https"],"security":[{"AK":[]}],"consumes":["application/json"],"produces":["application/json"],"deprecated":false,"systemTags":{"operationType":"none","abilityTreeCode":"200786","abilityTreeNodes":["FEATUREsls4A0DBM"]},"parameters":[{"name":"serviceName","in":"path","schema":{"description":"服务名。","type":"string","required":false,"enumValueTitles":{"sls_builtin_service_trace_rca":"高延时trace请求链路分析的服务名","sls_builtin_service_log_struct":"LogNER的服务名","sls_builtin_service_metric_anomaly":"单维度时间序列异常检测的服务名"},"example":"sls_builtin_service_log_struct"}},{"name":"allowBuiltin","in":"query","schema":{"description":"+ true 表示请求允许使用系统内置的服务\n+ false 表示请求不允许使用系统内置的服务","type":"boolean","required":false,"enumValueTitles":{"true":"允许使用系统内置的服务","false":"不允许使用系统内置的服务名"},"example":"true"}},{"name":"version","in":"query","allowEmptyValue":true,"schema":{"type":"string","required":false}},{"name":"body","in":"body","schema":{"description":"请求结构体。","required":false,"enumValueTitles":{"others":"根据不同的serviceName有不一样的说明"},"$ref":"#/components/schemas/MLServiceAnalysisParam"}}],"responses":{"200":{"headers":{"Server":{"schema":{"title":"服务器名称。","type":"string","example":"nginx"}},"Content-Type":{"schema":{"title":"返回的响应体的内容格式。","type":"string","example":"application/json"}},"Content-Length":{"schema":{"title":"响应内容长度。","type":"string","example":"0"}},"Connection":{"schema":{"title":"是否长链接。取值包括：  close：不是长链接，则每个HTTP请求都会重新建立TCP连接。 keep-alive：长链接，TCP连接建立后保持连接状态，节省连接所需时间和带宽。","type":"string","example":"close"}},"Date":{"schema":{"title":"返回响应的时间。","type":"string","example":"Sun, 27 May 2018 08:25:04 GMT"}},"x-log-requestid":{"schema":{"title":"服务端产生的标识，该请求的唯一ID。","type":"string","example":"5B0A6B60BB6EE39764D458B5"}}},"schema":{"description":"返回的结构体","type":"object","properties":{"status":{"description":"任务的状态","type":"object","additionalProperties":{"type":"string","example":"200","description":"默认为空，表示返回所有状态的任务，支持success、fail和running状态。","enumValueTitles":{"无":"无"}},"enumValueTitles":{"无":"无"}},"data":{"description":"返回的数据。","type":"array","items":{"description":"数据集结构体","type":"object","additionalProperties":{"type":"string","example":"{'marker': ''}","description":"返回结果。"}}}},"enumValueTitles":{"无":"无"}}}},"staticInfo":{"returnType":"synchronous"},"responseDemo":"[{\"errorExample\":\"\",\"example\":\"{\\n  \\\"status\\\": {\\n    \\\"key\\\": \\\"200\\\"\\n  },\\n  \\\"data\\\": [\\n    {\\n      \\\"key\\\": \\\"{'marker': ''}\\\"\\n    }\\n  ]\\n}\",\"type\":\"json\"}]","title":"获取指定场景任务的算法分析结果","description":"需要具备的基本权限如下\n\n```\n{\n    \"Version\": \"1\",\n    \"Statement\": [\n        {\n            \"Action\": [\n                \"log:Get*\"\n            ],\n            \"Resource\": [\n                \"acs:log:*:*:/ml/service/sls_builtin_service_log_struct/\",\n                \"acs:log:*:*:/ml/service/sls_builtin_service_metric_anomaly/\",\n                \"acs:log:*:*:/ml/service/sls_builtin_service_trace_rca/\"\n            ],\n            \"Effect\": \"Allow\"\n        }\n    ]\n}\n```","requestParamsDescription":"在不同的情况，对于请求中的参数会不一样，具体如下：\n## 日志内容实体识别（sls_builtin_service_log_struct）\nbody.parameter相关的内容\n```\n{\n  \"is_struct\": \"true\",\n  \"use_gpu\": \"true/false\",\n  \"max_fields\": \"1\"\n}\n```\n+ is_struct 为 true 时，表示日志格式为JSON结构。目前只支持设置为 true\n+ use_gpu 表示是否使用 gpu 资源\n+ max_fields 表示当日志格式为JSON结构时，最多分析其中的几个字段，默认只分析一个字段\n\nbody.input相关的内容\n```\n[\n  {\n    \"{column_name}\": \"{column_value}\"\n  }\n]\n```\n输入的内容是一个是JSON结构数组，其中\n+ column_name 表示JSON结构的日志的某个字段名称\n+ column_value 表示JSON结构的日志的某个字段的值\n\n## 时间序列异常检测（sls_builtin_service_metric_anomaly）\nbody.parameter的相关内容\n```\n{\n  \"isOrdered\": \"true/false\",\n  \"keys\": \"[]\",\n  \"timeColumnName\": \"\",\n  \"analysisColumnNames\": \"[]\",\n  \"interval\": \"-1\"\n}\n```\n+ isOrdered 表示输入的数据是否是有序的，如果输入的序列是按照时间维度从小到大，升序排列的，设置为true，否则设置为false\n+ interval 表示时间序列的间隔大小，按照秒来描述。比如：序列是每分钟一个点，则设置为60；如果不确定序列的间隔，则设置为 -1\n+ timeColumnName 表示输入的序列中，时间维度的名称\n+ analysisColumnNames 表示输入的序列中，带分析的数值特征维度的名称，使用数组来表示，且需要将这个数组序列化成字符串\n+ keys 表示输入的数据的各列的名称，使用数组表示，且需要将这个数组序列化成字符串\n\nbody.input的相关内容\n```\n[\n  {\n    \"{column_name}\": \"{column_value}\"\n  }\n]\n```\n输入的内容是一个是数组，其中\n+ column_name 表示序列中某个字段的名称\n+ column_value 表示序列中某个字段的值的内容。当 {column_name} 等于 {timeColumnName} 时，对应的值表示的是时间大小，使用 unixtime 时间戳来表示，单位是秒\n\n## 高延时链路数据检测（sls_builtin_service_trace_rca）\nbody.parameter的相关内容\n```\n{\n  \"project\": \"\",\n  \"logstore\": \"\",\n  \"endpoint\": \"\",\n  \"role_arn\": \"\"\n}\n```\n+ project 表示待分析的Trace数据存储在SLS中的Project的名称\n+ logstore 表示待分析的Trace数据存储在SLS中的Logstore的名称\n+ endpoint 表示project所在地域的endpoint信息，这里必须使用公网域名，内网域名无法访问\n+ role_arn 表示已经对该资源进行授权的角色信息，这里务必使用 ETLRole 或者 AuditRole 的arn信息\n\nbody.input的相关内容\n```\n[\n  {\n    \"service\": \"\",\n    \"name\": \"\",\n    \"from_ts_sec\": \"\",\n    \"to_ts_sec\": \"\",\n    \"slo_ts_micro\": \"\",\n    \"batch_id\": \"\",\n    \"trace_ids\": \"[]\"\n  }\n]\n```\n输入的内容是一个是数组，切输入的数组的长度是1，其中对应的参数的含义解释如下：\n+ service 表示某个或者某一批待诊断的TraceID的服务名称，可以从logstore中获得\n+ name 表示某个或者某一批待诊断的TraceID的服务名称，可以从logstore中获得\n+ from_ts_sec 表示待分析的开始时间戳，单位是秒\n+ to_ts_sec 表示待分析的结束时间戳，单位是秒\n+ batch_id 表示当前待分析的一批TraceID的名称\n+ trace_ids 表示当前请求中对应的trace_id的列表，使用JSON序列化成字符串","responseParamsDescription":"在不同的情况，对于请求的返回值会不一样，具体如下：\n## 日志内容实体识别（sls_builtin_service_log_struct）\ndata相关的内容\n```\n[\n  {\n    \"{column_name}\": \"{column_value}\"\n  }\n]\n```\n输出内容中每一个JSON结构与输入的JSON结构日志相对应，其中\n+ column_name 表示JSON结构的日志的被分析了的某个字段名称，最多有 max_fields 个字段被分析\n+ column_value 表示JSON结构的日志的被分析了的某个字段的值，字段值中的 NER 结果被标签 <ml_ner_${ner_type}></ml_ner_${ner_type}> 包裹，其中 ${ner_type} 是具体的 NER 类型\n\n## 时间序列异常检测（sls_builtin_service_metric_anomaly）\ndata的相关内容\n```\n[\n  {\n    \"start\": \"\",\n    \"end\": \"\",\n    \"label\": \"\"\n  }\n]\n```\n+ start 表示检测出来的异常区间的开始时间\n+ end 表示检测出来的异常区间的结束时间\n+ label 表示检测出来的当前区间的异常类型\n    + SPIKE_UP_TYPE\n    + SPIKE_DOWN_TYPE\n    + TREND_UP_TYPE\n    + TREND_DOWN_TYPE\n    + MEANSHIFT_UPWARD_TYPE\n    + MEANSHIFT_DOWNWARD_TYPE\n\n## 高延时链路数据检测（sls_builtin_service_trace_rca）\ndata的相关内容\n```\n[\n  {\n    \"traceID\": \"\",\n    \"service\": \"\",\n    \"name\": \"\",\n    \"rootCauses\": \"[{}]\"\n  }\n]\n```\n+ traceID 表示待检测的traceID信息\n+ service 表示当前这个Trace的根节点的service名称\n+ name 表示当前这个Trace的根节点的name名称\n+ rootCauses 表示当前这个高延时请求的Trace中，导致高延时的span的列表信息，使用序列化后的字符串来表示。该字段的值反序列化后的结构如下：\n```\n[\n  {\n    \"spanID\": \"\",\n    \"service\": \"\",\n    \"name\": \"\",\n    \"host\": \"xxxx\",\n    \"predicateDuration\": 10\n  }\n]\n```"}