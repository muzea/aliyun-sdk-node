{"summary":"本接口用于授权 SysOM 对本账号下的 ECS 实例进行诊断，只有在调用本接口对特定的ECS进行授权后，才可以调用 InvokeDiagnosis 接口对其发起诊断。","path":"/api/v1/openapi/diagnosis/auth","methods":["post"],"schemes":["https"],"security":[{"AK":[]}],"consumes":["application/json"],"produces":["application/json"],"operationType":"write","deprecated":false,"systemTags":{"operationType":"none","riskType":"none","chargeType":"free"},"parameters":[{"name":"body","in":"body","style":"json","schema":{"description":"请求体参数。","type":"object","properties":{"instances":{"title":"授权诊断的机器列表","description":"授权诊断的机器列表","type":"array","items":{"type":"object","properties":{"instance":{"description":"实例ID。","type":"string","required":false,"example":"i-wz9b9vucz1iubsz8sjqo"},"region":{"description":"地域ID。","type":"string","required":false,"example":"cn-hangzhou"}},"required":false,"example":"i-wz9gdv7qmdhntqmc4rjd"},"required":true,"docRequired":true}},"required":false}}],"responses":{"200":{"schema":{"title":"Schema of Response","description":"返回结果","type":"object","properties":{"code":{"title":"Id of the request","description":"状态码\n- `code == Success` 则代表授权成功；\n- 其它状态码代表授权失败，授权失败时查看 `message` 字段获取详细的错误信息；","type":"string","example":"Success"},"message":{"description":"错误信息\n- 如果 `code == Success`，则本字段为空；\n- 否则本字段包含请求错误信息。","type":"string","example":"SysomOpenAPIAssumeRoleException: EntityNotExist.Role The role not exists: acs:ram::xxxxx:role/aliyunserviceroleforsysom"},"data":{"description":"本接口没有返回数据","type":"any","example":"{}"},"request_id":{"description":"请求 RequestId","type":"string","example":"35F91AAB-5FDF-5A22-B211-C7C6B00817D0"}}}}},"staticInfo":{"returnType":"synchronous"},"responseDemo":"[{\"errorExample\":\"\",\"example\":\"{\\n  \\\"code\\\": \\\"Success\\\",\\n  \\\"message\\\": \\\"SysomOpenAPIAssumeRoleException: EntityNotExist.Role The role not exists: acs:ram::xxxxx:role/aliyunserviceroleforsysom\\\",\\n  \\\"data\\\": \\\"{}\\\",\\n  \\\"request_id\\\": \\\"35F91AAB-5FDF-5A22-B211-C7C6B00817D0\\\"\\n}\",\"type\":\"json\"}]","title":"授权诊断","description":"><notice>诊断功能需要在 RAM 用户下创建服务角色，调用本接口会自定检查服务角色是否创建，如果服务角色不存在则会自动创建，这要求调用本接口的 RAM 用户具有 ram:CreateServiceLinkedRole 权限</notice>\n\n调用本接口授权 SysOM 对 ECS 进行诊断有如下注意事项：\n- 一次授权有效期为 7 天，7 天之后授权会失效，需要再次调用本接口进行授权；\n- 调用本接口进行授权时如果SysOM服务关联角色（AliyunServiceRoleForSysom）不存在会自动创建，这要求调用本接口的RAM用户具有 `ram:CreateServiceLinkedRole` 权限。\n- 调用本接口对特定实例进行授权，会自动给目标ecs实例打上标签 `sysom:diagnosis`，sysom只允许对打了这个标签的实例进行诊断。"}