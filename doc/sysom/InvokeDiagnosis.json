{"summary":"对指定的 ECS 实例发起诊断。","path":"/api/v1/openapi/diagnosis/invoke_diagnosis","methods":["post"],"schemes":["https"],"security":[{"AK":[]}],"consumes":["application/json"],"produces":["application/json"],"operationType":"write","deprecated":false,"systemTags":{"operationType":"create","riskType":"high","chargeType":"free"},"parameters":[{"name":"body","in":"body","style":"json","schema":{"description":"请求体参数","type":"object","properties":{"service_name":{"title":"诊断类型","description":"诊断类型，用于区分不同类型的诊断","type":"string","required":true,"docRequired":true,"enumValueTitles":{"iofsstat":"IO流量分析","jruntime":"Java运行时分析","oomcheck":"内存OOM诊断","iohang":"IO Hang诊断","pingtrace":"网络时延诊断","rtdelay":"RT时延分析","memgraph":"内存大盘诊断","retran":"网络重传诊断","jitter":"网络抖动诊断","iolatency":"IO时延分析","procdiag":"应用抖动诊断","loadtask":"系统负载诊断","filecache":"内存Cache分析诊断","schedmoni":"调度抖动诊断","packetdrop":"网络丢包诊断"},"example":"memgraph"},"channel":{"title":"诊断通道，固定为 openapi_cloud_assist","description":"诊断通道（目前固定为ecs通道）","type":"string","required":true,"enumValueTitles":{"ecs":"ECS通道"},"example":"ecs"},"params":{"description":"诊断参数，不同类型的诊断要求传递不同的诊断参数，每种诊断所需的参数参见下面的请求参数补充说明。\n\n><notice>请传递 json 格式的字符串></notice>","type":"string","required":true,"example":"{\n    \"instance\": \"i-wz9gdv7qmdhusamc4dl01\",\n    \"uid\": \"xxxxxxxxxxxxxx\",\n    \"region\": \"cn-shenzhen\"\n}"}},"required":false}}],"responses":{"200":{"schema":{"title":"Schema of Response","description":"Schema of Response","type":"object","properties":{"code":{"description":"状态码\n- `code == Success` 则代表授权成功；\n- 其它状态码代表授权失败，授权失败时查看 `message` 字段获取详细的错误信息；","type":"string","example":"Success"},"message":{"description":"错误信息\n- 如果 `code == Success`，则本字段为空；\n- 否则本字段包含请求错误信息。","type":"string","example":"SysomOpenAPIAssumeRoleException: EntityNotExist.Role The role not exists: acs:ram::xxxxx:role/aliyunserviceroleforsysom"},"data":{"description":"返回结果。","type":"object","properties":{"task_id":{"description":"诊断任务ID，可以凭借该ID调用 `GetDiagnosisResult` 接口查询诊断结果","type":"string","example":"ihqhAcrt"}}},"request_id":{"description":"请求 RequestId","type":"string","example":"43A910E9-A739-525E-855D-A32C257F1826"}}}}},"staticInfo":{"returnType":"synchronous"},"responseDemo":"[{\"errorExample\":\"\",\"example\":\"{\\n  \\\"code\\\": \\\"Success\\\",\\n  \\\"message\\\": \\\"SysomOpenAPIAssumeRoleException: EntityNotExist.Role The role not exists: acs:ram::xxxxx:role/aliyunserviceroleforsysom\\\",\\n  \\\"data\\\": {\\n    \\\"task_id\\\": \\\"ihqhAcrt\\\"\\n  },\\n  \\\"request_id\\\": \\\"43A910E9-A739-525E-855D-A32C257F1826\\\"\\n}\",\"type\":\"json\"}]","title":"发起诊断","description":"对目标 ECS 实例进行诊断有如下要求：\n- 目标 ECS 实例状态必须为运行中（Running）；\n- 目标 ECS 实例必须已经安装云助手，如果未安装，请参考 [安装云助手Agent](https://help.aliyun.com/zh/ecs/user-guide/install-the-cloud-assistant-agent) 进行安装；\n- 必须调用 AuthDiagnosis 接口授权 SysOM 对目标 ECS 进行诊断，如果没有授权本接口会直接失败；\n- 本接口依赖于SysOM服务关联角色（AliyunServiceRoleForSysom）已经创建，本接口不会主动创建服务角色，如果服务角色不存在需要首先调用 AuthDiagnosis 进行授权，该接口会创建前述服务角色。","requestParamsDescription":"## 诊断参数说明\n\n### 内存大盘诊断（memgraph）参数\n\n| 参数名称 | 参数类型 | 参数说明 | 是否必填 | 默认值 | 备注                                                    |\n| -------- | -------- | -------- | -------- | ------ | ------------------------------------------------------- |\n| instance | string   | 实例ID   | 是       |        | 请输入你要诊断的实例ID， 我们将在会这台机器内部发起诊断 |\n\n### 内存Cache分析诊断（filecache）参数\n\n| 参数名称 | 参数类型 | 参数说明 | 是否必填 | 默认值 | 备注                                                       |\n| -------- | -------- | -------- | -------- | ------ | ---------------------------------------------------------- |\n| instance | string   | 实例ID   | 是       |        | 请输入你要诊断的实例ID， 我们将在会这台机器内部发起诊断    |\n| value    | string   | 容器     | 否       |        | 请输入你要诊断的容器ID,Pod名,cgroup                        |\n| type     | string   | 诊断类型 | 否       | all    | 请输入需要诊断的类型(容器,POD,cgroup, host, all(所有容器)) |\n\n### 内存OOM诊断（oomcheck）参数\n\n| 参数名称 | 参数类型 | 参数说明 | 是否必填 | 默认值 | 备注                                                    |\n| -------- | -------- | -------- | -------- | ------ | ------------------------------------------------------- |\n| instance | string   | 实例ID   | 是       |        | 请输入你要诊断的实例ID， 我们将在会这台机器内部发起诊断 |\n| time     | string   | 诊断时间 | 否       |        | 请输入需要诊断OOM的时间点，默认为最近一次               |\n\n### 系统负载诊断（loadtask）参数\n\n| 参数名称 | 参数类型 | 参数说明 | 是否必填 | 默认值 | 备注                                                    |\n| -------- | -------- | -------- | -------- | ------ | ------------------------------------------------------- |\n| instance | string   | 实例ID   | 是       |        | 请输入你要诊断的实例ID， 我们将在会这台机器内部发起诊断 |\n\n### 调度抖动诊断（schedmoni）参数\n\n| 参数名称  | 参数类型 | 参数说明 | 是否必填 | 默认值 | 备注                                                    |\n| --------- | -------- | -------- | -------- | ------ | ------------------------------------------------------- |\n| instance  | string   | 实例ID   | 是       |        | 请输入你要诊断的实例ID， 我们将在会这台机器内部发起诊断 |\n| timeout   | string   | 诊断时间 | 否       | 20     | 本次的期望的诊断时间，默认20秒                          |\n| threshold | string   | 诊断阈值 | 否       | 20     | 延迟的阈值，超过这个阈值就记录，默认20ms                |\n\n### IO延迟诊断（iolatency）参数\n\n| 参数名称  | 参数类型 | 参数说明 | 是否必填 | 默认值 | 备注                                                         |\n| --------- | -------- | -------- | -------- | ------ | ------------------------------------------------------------ |\n| instance  | string   | 实例ID   | 是       |        | 请输入你要诊断的实例ID，我们将在会这台机器内部发起IO时延诊断 |\n| timeout   | string   | 诊断时长 | 否       | 10     | 请输入你要诊断的时长,单位秒                                  |\n| threshold | string   | 时间阈值 | 否       | 1000   | 保留IO延迟大于设定时间阈值的IO（时间单位：ms）               |\n| disk      | string   | 目标磁盘 | 否       | \"\"     | 请输入你要诊断的磁盘,如vda,sdb,缺省为所有磁盘                |\n\n### IO流量分析诊断（iofsstat）参数\n\n| 参数名称 | 参数类型 | 参数说明 | 是否必填 | 默认值 | 备注                                                         |\n| -------- | -------- | -------- | -------- | ------ | ------------------------------------------------------------ |\n| instance | string   | 实例ID   | 是       |        | 请输入你要诊断的实例ID，我们将在会这台机器内部发起IO流量统计 |\n| timeout  | string   | 诊断时长 | 否       | 15     | 诊断时长,也是IO流量统计周期,单位秒,建议不超过60秒            |\n| disk     | string   | 目标磁盘 | 否       | \"\"     | 请输入你要诊断的磁盘,如vda,sda,缺省为所有磁盘                |\n\n### IO Hang诊断（iohang）参数\n\n| 参数名称  | 参数类型 | 参数说明 | 是否必填 | 默认值 | 备注                                                         |\n| --------- | -------- | -------- | -------- | ------ | ------------------------------------------------------------ |\n| instance  | string   | 实例ID   | 是       |        | 请输入你要诊断的实例ID，我们将在会这台机器内部发起IO HANG诊断 |\n| timeout   | string   | 诊断时长 | 否       | 10     | 请输入你要诊断的时长,单位秒                                  |\n| threshold | string   | 时间阈值 | 否       | 5000   | 保留IO HANG住时间超过阈值的IO,单位毫秒                       |\n| disk      | string   | 目标磁盘 | 否       | \"\"     | 请输入你要诊断的磁盘,如vda,sda,缺省为所有磁盘                |\n\n### 网络丢包诊断（packetdrop）参数\n\n| 参数名称 | 参数类型 | 参数说明 | 是否必填 | 默认值 | 备注                                                    |\n| -------- | -------- | -------- | -------- | ------ | ------------------------------------------------------- |\n| instance | string   | 实例ID   | 是       |        | 请输入你要诊断的实例ID， 我们将在会这台机器内部发起诊断 |\n| time     | string   | 运行时间 | 否       | 10     | 请输入你要诊断的时间，单位秒                            |\n\n### 网络重传诊断（retran）参数\n\n| 参数名称 | 参数类型 | 参数说明 | 是否必填 | 默认值 | 备注                                                    |\n| -------- | -------- | -------- | -------- | ------ | ------------------------------------------------------- |\n| instance | string   | 实例ID   | 是       |        | 请输入你要诊断的实例ID， 我们将在会这台机器内部发起诊断 |\n| time     | string   | 运行时间 | 否       | 10     | 请输入你要诊断的时间，单位秒                            |\n\n### 网络抖动诊断（jitter）参数\n\n| 参数名称 | 参数类型 | 参数说明 | 是否必填 | 默认值 | 备注                                                    |\n| -------- | -------- | -------- | -------- | ------ | ------------------------------------------------------- |\n| instance | string   | 实例ID   | 是       |        | 请输入你要诊断的实例ID， 我们将在会这台机器内部发起诊断 |\n| time     | string   | 运行时间 | 否       | 10     | 请输入你要诊断的时间，单位秒                            |\n\n### 网络时延诊断（pingtrace）参数\n\n| 参数名称        | 参数类型 | 参数说明   | 是否必填 | 默认值 | 备注                                                         |\n| --------------- | -------- | ---------- | -------- | ------ | ------------------------------------------------------------ |\n| origin_instance | string   | 源实例ID   | 是       |        | 请输入你要诊断的源实例ID， 我们将在会这台机器内部发起SysAK诊断 |\n| target_instance | string   | 目标实例ID | 是       |        | 请输入你要诊断的目标实例ID， 我们将在会这台机器内部发起SysAK诊断 |\n| pkg_num         | string   | 追踪包数   | 否       | 100    | 请输入你要追踪的包数                                         |\n| time_gap        | string   | 间隔毫秒数 | 否       | 1000   | 请输入发包间隔                                               |\n| type            | string   | 报文协议   | 否       | icmp   | 请输入报文协议(icmp,tcp,udp)                                 |"}