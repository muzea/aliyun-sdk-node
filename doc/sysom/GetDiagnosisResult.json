{"summary":"获取诊断结果。","path":"/api/v1/openapi/diagnosis/get_diagnosis_results","methods":["get"],"schemes":["https"],"security":[{"AK":[]}],"consumes":["application/json"],"produces":["application/json"],"operationType":"read","deprecated":false,"systemTags":{"operationType":"get","riskType":"none","chargeType":"free"},"parameters":[{"name":"task_id","in":"query","schema":{"description":"诊断任务ID","type":"string","required":true,"example":"quzuYl23"}}],"responses":{"200":{"schema":{"title":"Schema of Response","description":"Schema of Response","type":"object","properties":{"code":{"description":"状态码\n- `code == Success` 则代表授权成功；\n- 其它状态码代表授权失败，授权失败时查看 `message` 字段获取详细的错误信息；","type":"string","example":"Success"},"message":{"description":"错误信息\n- 如果 `code == Success`，则本字段为空；\n- 否则本字段包含请求错误信息。","type":"string","example":"\"\""},"data":{"description":"返回数据。","type":"object","properties":{"task_id":{"description":"任务ID。","type":"string","example":"grcuU21a"},"status":{"description":"诊断任务执行状态。\n取值：\n- **Ready**：就绪\n- **Running**：正在执行\n- **Success**：执行成功\n- **Fail**：执行失败","type":"string","example":"Running","enum":["Success","Fail","Ready","Running"]},"service_name":{"description":"诊断类型","type":"string","example":"memgraph"},"command":{"description":"诊断命令","type":"any","example":"{\n    \"jobs\":[\n        {\n            \"cmd\":\"mkdir -p /var/log/sysak && sysak podmem -r 100  -a -j /var/log/sysak/podmem.json > /dev/null 2>&1 && cat /var/log/sysak/podmem.json\",\n            \"instance\":\"172.20.12.174\",\n            \"fetch_file_list\":[\n\n            ]\n        }\n    ],\n    \"in_order\":true,\n    \"offline_mode\":false,\n    \"offline_results\":[\n\n    ]\n}"},"params":{"description":"诊断参数","type":"any","example":"{\n    \"type\":\"all\",\n    \"value\":\"\",\n    \"channel\":\"ssh\",\n    \"instance\":\"172.1.2.174\",\n    \"service_name\":\"filecache\"\n}"},"code":{"description":"错误码（0表示无错误）","type":"integer","format":"int32","example":"0"},"err_msg":{"description":"错误信息","type":"string","example":"Diagnosis failed"},"result":{"description":"诊断结果","type":"any","example":"{\n    \"summary\":\"  memory cgroup leak\",\n    \"dataMemEvent\":{\n        \"data\":[\n            {\n                \"key\":\"Util\",\n                \"value\":20\n            },\n            {\n                \"key\":\"MemLeak\",\n                \"value\":\"OK\"\n            },\n            {\n                \"key\":\"MemcgLeak\",\n                \"value\":\"NG\"\n            },\n            {\n                \"key\":\"MemFrag\",\n                \"value\":\"OK\"\n            }\n        ]\n    },\n    \"dataMemOverView\":{\n        \"data\":[\n            {\n                \"key\":\"app\",\n                \"value\":10937332\n            },\n            {\n                \"key\":\"free\",\n                \"value\":806800\n            },\n            {\n                \"key\":\"kernel\",\n                \"value\":4527660\n            }\n        ]\n    },\n    \"dataKerMem\":{\n        \"data\":[\n            {\n                \"key\":\"SReclaimable\",\n                \"value\":3411292\n            },\n            {\n                \"key\":\"VmallocUsed\",\n                \"value\":30980\n            },\n            {\n                \"key\":\"allocPage\",\n                \"value\":177732\n            },\n            {\n                \"key\":\"KernelStack\",\n                \"value\":9280\n            },\n            {\n                \"key\":\"PageTables\",\n                \"value\":38056\n            },\n            {\n                \"key\":\"SUnreclaim\",\n                \"value\":170248\n            },\n            {\n                \"key\":\"reserved\",\n                \"value\":690072\n            }\n        ]\n    },\n    \"dataUserMem\":{\n        \"data\":[\n            {\n                \"key\":\"filecache\",\n                \"value\":8010008\n            },\n            {\n                \"key\":\"anon\",\n                \"value\":2468608\n            },\n            {\n                \"key\":\"mlock\",\n                \"value\":0\n            },\n            {\n                \"key\":\"huge1G\",\n                \"value\":0\n            },\n            {\n                \"key\":\"huge2M\",\n                \"value\":0\n            },\n            {\n                \"key\":\"buffers\",\n                \"value\":458608\n            },\n            {\n                \"key\":\"shmem\",\n                \"value\":2284\n            }\n        ]\n    },\n    \"dataCacheList\":{\n        \"data\":[\n            {\n                \"key\":0,\n                \"Name\":\"/var/lib/mysql/sysom/sys_handler_log.ibd\",\n                \"cached\":576764,\n                \"Task\":\"mysqld_78575 \"\n            },\n            {\n                \"key\":1,\n                \"Name\":\"/var/log/sysom/sysom-migration-access.log\",\n                \"cached\":276688,\n                \"Task\":\"gunicorn_33647 ,gunicorn_460836 ,gunicorn_559934 ,gunicorn_731758 ,gunicorn_2362682 \"\n            },\n            {\n                \"key\":2,\n                \"Name\":\"/var/log/sysom/sysom-rtdemo-access.log\",\n                \"cached\":229404,\n                \"Task\":\"gunicorn_60718 ,gunicorn_720734 ,gunicorn_722168 \"\n            },\n            {\n                \"key\":3,\n                \"Name\":\"/var/log/sysom/sysom-monitor-server-access.log\",\n                \"cached\":197368,\n                \"Task\":\"gunicorn_33682 ,gunicorn_671155 ,gunicorn_714998 \"\n            },\n            {\n                \"key\":4,\n                \"Name\":\"/var/log/sysom/sysom-channel-access.log\",\n                \"cached\":180276,\n                \"Task\":\"gunicorn_33233 ,gunicorn_499735 ,gunicorn_725497 \"\n            },\n            {\n                \"key\":5,\n                \"Name\":\"total cached of close file\",\n                \"cached\":3729668,\n                \"Task\":\"\"\n            }\n        ]\n    },\n    \"dataProcMemList\":{\n        \"data\":[\n            {\n                \"key\":0,\n                \"task\":\"mysqld\",\n                \"MemTotal\":240856,\n                \"RssAnon\":218248,\n                \"RssFile\":22608\n            },\n            {\n                \"key\":1,\n                \"task\":\"systemd-journal\",\n                \"MemTotal\":150248,\n                \"RssAnon\":74300,\n                \"RssFile\":75944\n            },\n            {\n                \"key\":2,\n                \"task\":\"gunicorn\",\n                \"MemTotal\":144640,\n                \"RssAnon\":114200,\n                \"RssFile\":30440\n            },\n            {\n                \"key\":3,\n                \"task\":\"gunicorn\",\n                \"MemTotal\":141480,\n                \"RssAnon\":111040,\n                \"RssFile\":30440\n            },\n            {\n                \"key\":4,\n                \"task\":\"grafana-server\",\n                \"MemTotal\":103660,\n                \"RssAnon\":42732,\n                \"RssFile\":60928\n            },\n            {\n                \"key\":5,\n                \"task\":\"gunicorn\",\n                \"MemTotal\":97444,\n                \"RssAnon\":76256,\n                \"RssFile\":21188\n            },\n            {\n                \"key\":6,\n                \"task\":\"gunicorn\",\n                \"MemTotal\":97260,\n                \"RssAnon\":76072,\n                \"RssFile\":21188\n            },\n            {\n                \"key\":7,\n                \"task\":\"prometheus\",\n                \"MemTotal\":95356,\n                \"RssAnon\":45376,\n                \"RssFile\":49980\n            },\n            {\n                \"key\":8,\n                \"task\":\"gunicorn\",\n                \"MemTotal\":90144,\n                \"RssAnon\":76456,\n                \"RssFile\":13688\n            },\n            {\n                \"key\":9,\n                \"task\":\"gunicorn\",\n                \"MemTotal\":89796,\n                \"RssAnon\":76108,\n                \"RssFile\":13688\n            }\n        ]\n    }\n}"},"url":{"description":"诊断详情URL","type":"string","example":"/diagnose/detail/qe3Z34sa"}}},"request_id":{"description":"请求 RequestId","type":"string","example":"9515E5A0-8905-59B0-9BBF-5F0BE568C3A0"}}}}},"staticInfo":{"returnType":"synchronous"},"responseDemo":"[{\"errorExample\":\"\",\"example\":\"{\\n  \\\"code\\\": \\\"Success\\\",\\n  \\\"message\\\": \\\"\\\\\\\"\\\\\\\"\\\",\\n  \\\"data\\\": {\\n    \\\"task_id\\\": \\\"grcuU21a\\\",\\n    \\\"status\\\": \\\"Running\\\",\\n    \\\"service_name\\\": \\\"memgraph\\\",\\n    \\\"command\\\": \\\"{\\\\n    \\\\\\\"jobs\\\\\\\":[\\\\n        {\\\\n            \\\\\\\"cmd\\\\\\\":\\\\\\\"mkdir -p /var/log/sysak && sysak podmem -r 100  -a -j /var/log/sysak/podmem.json > /dev/null 2>&1 && cat /var/log/sysak/podmem.json\\\\\\\",\\\\n            \\\\\\\"instance\\\\\\\":\\\\\\\"172.20.12.174\\\\\\\",\\\\n            \\\\\\\"fetch_file_list\\\\\\\":[\\\\n\\\\n            ]\\\\n        }\\\\n    ],\\\\n    \\\\\\\"in_order\\\\\\\":true,\\\\n    \\\\\\\"offline_mode\\\\\\\":false,\\\\n    \\\\\\\"offline_results\\\\\\\":[\\\\n\\\\n    ]\\\\n}\\\",\\n    \\\"params\\\": \\\"{\\\\n    \\\\\\\"type\\\\\\\":\\\\\\\"all\\\\\\\",\\\\n    \\\\\\\"value\\\\\\\":\\\\\\\"\\\\\\\",\\\\n    \\\\\\\"channel\\\\\\\":\\\\\\\"ssh\\\\\\\",\\\\n    \\\\\\\"instance\\\\\\\":\\\\\\\"172.1.2.174\\\\\\\",\\\\n    \\\\\\\"service_name\\\\\\\":\\\\\\\"filecache\\\\\\\"\\\\n}\\\",\\n    \\\"code\\\": 0,\\n    \\\"err_msg\\\": \\\"Diagnosis failed\\\",\\n    \\\"result\\\": \\\"{\\\\n    \\\\\\\"summary\\\\\\\":\\\\\\\"  memory cgroup leak\\\\\\\",\\\\n    \\\\\\\"dataMemEvent\\\\\\\":{\\\\n        \\\\\\\"data\\\\\\\":[\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"Util\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":20\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"MemLeak\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":\\\\\\\"OK\\\\\\\"\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"MemcgLeak\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":\\\\\\\"NG\\\\\\\"\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"MemFrag\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":\\\\\\\"OK\\\\\\\"\\\\n            }\\\\n        ]\\\\n    },\\\\n    \\\\\\\"dataMemOverView\\\\\\\":{\\\\n        \\\\\\\"data\\\\\\\":[\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"app\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":10937332\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"free\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":806800\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"kernel\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":4527660\\\\n            }\\\\n        ]\\\\n    },\\\\n    \\\\\\\"dataKerMem\\\\\\\":{\\\\n        \\\\\\\"data\\\\\\\":[\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"SReclaimable\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":3411292\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"VmallocUsed\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":30980\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"allocPage\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":177732\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"KernelStack\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":9280\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"PageTables\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":38056\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"SUnreclaim\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":170248\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"reserved\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":690072\\\\n            }\\\\n        ]\\\\n    },\\\\n    \\\\\\\"dataUserMem\\\\\\\":{\\\\n        \\\\\\\"data\\\\\\\":[\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"filecache\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":8010008\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"anon\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":2468608\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"mlock\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":0\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"huge1G\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":0\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"huge2M\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":0\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"buffers\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":458608\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":\\\\\\\"shmem\\\\\\\",\\\\n                \\\\\\\"value\\\\\\\":2284\\\\n            }\\\\n        ]\\\\n    },\\\\n    \\\\\\\"dataCacheList\\\\\\\":{\\\\n        \\\\\\\"data\\\\\\\":[\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":0,\\\\n                \\\\\\\"Name\\\\\\\":\\\\\\\"/var/lib/mysql/sysom/sys_handler_log.ibd\\\\\\\",\\\\n                \\\\\\\"cached\\\\\\\":576764,\\\\n                \\\\\\\"Task\\\\\\\":\\\\\\\"mysqld_78575 \\\\\\\"\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":1,\\\\n                \\\\\\\"Name\\\\\\\":\\\\\\\"/var/log/sysom/sysom-migration-access.log\\\\\\\",\\\\n                \\\\\\\"cached\\\\\\\":276688,\\\\n                \\\\\\\"Task\\\\\\\":\\\\\\\"gunicorn_33647 ,gunicorn_460836 ,gunicorn_559934 ,gunicorn_731758 ,gunicorn_2362682 \\\\\\\"\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":2,\\\\n                \\\\\\\"Name\\\\\\\":\\\\\\\"/var/log/sysom/sysom-rtdemo-access.log\\\\\\\",\\\\n                \\\\\\\"cached\\\\\\\":229404,\\\\n                \\\\\\\"Task\\\\\\\":\\\\\\\"gunicorn_60718 ,gunicorn_720734 ,gunicorn_722168 \\\\\\\"\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":3,\\\\n                \\\\\\\"Name\\\\\\\":\\\\\\\"/var/log/sysom/sysom-monitor-server-access.log\\\\\\\",\\\\n                \\\\\\\"cached\\\\\\\":197368,\\\\n                \\\\\\\"Task\\\\\\\":\\\\\\\"gunicorn_33682 ,gunicorn_671155 ,gunicorn_714998 \\\\\\\"\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":4,\\\\n                \\\\\\\"Name\\\\\\\":\\\\\\\"/var/log/sysom/sysom-channel-access.log\\\\\\\",\\\\n                \\\\\\\"cached\\\\\\\":180276,\\\\n                \\\\\\\"Task\\\\\\\":\\\\\\\"gunicorn_33233 ,gunicorn_499735 ,gunicorn_725497 \\\\\\\"\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":5,\\\\n                \\\\\\\"Name\\\\\\\":\\\\\\\"total cached of close file\\\\\\\",\\\\n                \\\\\\\"cached\\\\\\\":3729668,\\\\n                \\\\\\\"Task\\\\\\\":\\\\\\\"\\\\\\\"\\\\n            }\\\\n        ]\\\\n    },\\\\n    \\\\\\\"dataProcMemList\\\\\\\":{\\\\n        \\\\\\\"data\\\\\\\":[\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":0,\\\\n                \\\\\\\"task\\\\\\\":\\\\\\\"mysqld\\\\\\\",\\\\n                \\\\\\\"MemTotal\\\\\\\":240856,\\\\n                \\\\\\\"RssAnon\\\\\\\":218248,\\\\n                \\\\\\\"RssFile\\\\\\\":22608\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":1,\\\\n                \\\\\\\"task\\\\\\\":\\\\\\\"systemd-journal\\\\\\\",\\\\n                \\\\\\\"MemTotal\\\\\\\":150248,\\\\n                \\\\\\\"RssAnon\\\\\\\":74300,\\\\n                \\\\\\\"RssFile\\\\\\\":75944\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":2,\\\\n                \\\\\\\"task\\\\\\\":\\\\\\\"gunicorn\\\\\\\",\\\\n                \\\\\\\"MemTotal\\\\\\\":144640,\\\\n                \\\\\\\"RssAnon\\\\\\\":114200,\\\\n                \\\\\\\"RssFile\\\\\\\":30440\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":3,\\\\n                \\\\\\\"task\\\\\\\":\\\\\\\"gunicorn\\\\\\\",\\\\n                \\\\\\\"MemTotal\\\\\\\":141480,\\\\n                \\\\\\\"RssAnon\\\\\\\":111040,\\\\n                \\\\\\\"RssFile\\\\\\\":30440\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":4,\\\\n                \\\\\\\"task\\\\\\\":\\\\\\\"grafana-server\\\\\\\",\\\\n                \\\\\\\"MemTotal\\\\\\\":103660,\\\\n                \\\\\\\"RssAnon\\\\\\\":42732,\\\\n                \\\\\\\"RssFile\\\\\\\":60928\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":5,\\\\n                \\\\\\\"task\\\\\\\":\\\\\\\"gunicorn\\\\\\\",\\\\n                \\\\\\\"MemTotal\\\\\\\":97444,\\\\n                \\\\\\\"RssAnon\\\\\\\":76256,\\\\n                \\\\\\\"RssFile\\\\\\\":21188\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":6,\\\\n                \\\\\\\"task\\\\\\\":\\\\\\\"gunicorn\\\\\\\",\\\\n                \\\\\\\"MemTotal\\\\\\\":97260,\\\\n                \\\\\\\"RssAnon\\\\\\\":76072,\\\\n                \\\\\\\"RssFile\\\\\\\":21188\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":7,\\\\n                \\\\\\\"task\\\\\\\":\\\\\\\"prometheus\\\\\\\",\\\\n                \\\\\\\"MemTotal\\\\\\\":95356,\\\\n                \\\\\\\"RssAnon\\\\\\\":45376,\\\\n                \\\\\\\"RssFile\\\\\\\":49980\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":8,\\\\n                \\\\\\\"task\\\\\\\":\\\\\\\"gunicorn\\\\\\\",\\\\n                \\\\\\\"MemTotal\\\\\\\":90144,\\\\n                \\\\\\\"RssAnon\\\\\\\":76456,\\\\n                \\\\\\\"RssFile\\\\\\\":13688\\\\n            },\\\\n            {\\\\n                \\\\\\\"key\\\\\\\":9,\\\\n                \\\\\\\"task\\\\\\\":\\\\\\\"gunicorn\\\\\\\",\\\\n                \\\\\\\"MemTotal\\\\\\\":89796,\\\\n                \\\\\\\"RssAnon\\\\\\\":76108,\\\\n                \\\\\\\"RssFile\\\\\\\":13688\\\\n            }\\\\n        ]\\\\n    }\\\\n}\\\",\\n    \\\"url\\\": \\\"/diagnose/detail/qe3Z34sa\\\"\\n  },\\n  \\\"request_id\\\": \\\"9515E5A0-8905-59B0-9BBF-5F0BE568C3A0\\\"\\n}\",\"type\":\"json\"}]","title":"获取诊断结果","description":"诊断的流程是异步的，因此调用本接口时，诊断可能还在执行没有结束，可以通过返回数据中 `data.status` 字段进行判断，当 `data.status == Success ` 时，表示诊断成功，可以从 `data.result` 中读取到诊断的结果。"}