{"summary":"Elasticsearch集群升配，增加节点数，角色，规格，磁盘配置。","path":"/openapi/instances/{InstanceId}","methods":["put"],"schemes":["http","https"],"security":[{"AK":[]}],"consumes":["application/json"],"produces":["application/json"],"operationType":"write","deprecated":false,"systemTags":{"operationType":"update"},"parameters":[{"name":"InstanceId","in":"path","schema":{"description":"实例ID。","type":"string","required":true,"docRequired":true,"example":"es-cn-n6w1ptcb30009****"}},{"name":"clientToken","in":"query","schema":{"description":"用于保证请求的幂等性。由客户端生成该参数值，要保证在不同请求间唯一，最大不超过64个ASCII字符。","type":"string","required":false,"example":"5A2CFF0E-5718-45B5-9D4D-70B3FF****"}},{"name":"orderActionType","in":"query","schema":{"description":"配置变更类型，可选值：\n\n- upgrade（默认）：升配\n- downgrade：降配","type":"string","required":false,"example":"upgrade"}},{"name":"body","in":"body","style":"json","schema":{"description":"请求体参数。","type":"object","properties":{"nodeAmount":{"description":"节点数量。","type":"integer","format":"int32","required":false,"example":"3"},"nodeSpec":{"description":"数据节点配置。","required":false,"$ref":"#/components/schemas/NodeSpec"},"masterConfiguration":{"description":"专有主节点配置。","required":false,"$ref":"#/components/schemas/MasterNodeConfiguration"},"clientNodeConfiguration":{"description":"协调节点配置。","required":false,"$ref":"#/components/schemas/ClientNodeConfiguration"},"warmNodeConfiguration":{"description":"冷数据节点配置。","required":false,"$ref":"#/components/schemas/WarmNodeConfiguration"},"kibanaConfiguration":{"description":"kibana节点配置。","required":false,"$ref":"#/components/schemas/KibanaNodeConfiguration"},"elasticDataNodeConfiguration":{"description":"弹性节点配置。","required":false,"$ref":"#/components/schemas/ElasticDataNodeConfiguration"},"instanceCategory":{"description":"版本类型。可选值：\n\n- x-pack：商业版实例\n- advanced：增强版实例\n- IS：开启Indexing Service的增强版实例\n- community：基础版实例\n> 创建增强版开启OpenStore的实例需要同时开启Indexing Service。\n","type":"string","required":false,"example":"advanced"}},"required":false,"example":"{   \"nodeSpec\": {     \"spec\": \"elasticsearch.r5.xlarge\"   } }"}},{"name":"force","in":"query","schema":{"description":"是否强制重启：\n\n- true：是\n- false（默认）：否","type":"boolean","required":false,"example":"false"}}],"responses":{"200":{"headers":{},"schema":{"type":"object","properties":{"RequestId":{"description":"请求ID。","type":"string","example":"5FFD9ED4-C2EC-4E89-B22B-1ACB6FE1****"},"Result":{"description":"返回结果。","type":"object","properties":{"nodeAmount":{"description":"数据节点的数量。","type":"integer","format":"int32","example":"2"},"createdAt":{"description":"实例创建时间。","type":"string","example":"2018-07-13T03:58:07.253Z"},"status":{"description":"实例的状态。支持：\n\n- active：正常\n- activating：生效中\n- inactive：冻结\n- invalid：失效","type":"string","example":"active"},"paymentType":{"description":"实例的付费方式。支持：\n\n- prepaid：包年包月\n- postpaid：按量付费","type":"string","example":"postpaid"},"domain":{"description":"实例的私网访问域名。","type":"string","example":"es-cn-abc.elasticsearch.aliyuncs.com"},"description":{"description":"实例名称。","type":"string","example":"test"},"esVersion":{"description":"实例版本。","type":"string","example":"5.5.3_with_X-Pack"},"instanceId":{"description":"实例ID。","type":"string","example":"es-cn-abc"},"nodeSpec":{"description":"数据节点配置信息。","type":"object","properties":{"spec":{"description":"节点规格。","type":"string","example":"elasticsearch.sn2ne.xlarge"},"disk":{"description":"节点存储空间大小，单位：GB。","type":"integer","format":"int32","example":"40"},"diskType":{"description":"节点存储类型。支持：\n\n- cloud_ssd：SSD云盘\n- cloud_efficiency：高效云盘","type":"string","example":"cloud_ssd"}}},"kibanaConfiguration":{"description":"Kibana节点配置。","type":"object","properties":{"spec":{"description":"节点规格。","type":"string","example":"elasticsearch.n4.small"},"amount":{"description":"节点数量。","type":"integer","format":"int32","example":"1"},"disk":{"description":"节点存储空间大小。","type":"integer","format":"int32","example":"20"},"diskType":{"description":"节点存储类型（可忽略该参数）。","type":"string","example":"cloud_ssd"}}},"masterConfiguration":{"description":"Master节点配置。","type":"object","properties":{"spec":{"description":"节点规格。","type":"string","example":"elasticsearch.sn2ne.large"},"amount":{"description":"节点数量。","type":"integer","format":"int32","example":"3"},"disk":{"description":"节点的存储空间大小，单位：GB。","type":"integer","format":"int32","example":"20"},"diskType":{"description":"节点的存储类型。只支持cloud_ssd（SSD云盘）。\n","type":"string","example":"cloud_ssd"}}}}},"Code":{"type":"string"},"Message":{"type":"string"}}}},"400":{"schema":{"type":"object","properties":{"RequestId":{"type":"string"},"Code":{"type":"string"},"Message":{"type":"string"}}}},"401":{"schema":{"type":"object","properties":{"RequestId":{"type":"string"},"Code":{"type":"string"},"Message":{"type":"string"}}}},"404":{"schema":{"type":"object","properties":{"RequestId":{"type":"string"},"Code":{"type":"string"},"Message":{"type":"string"}}}},"500":{"schema":{"type":"object","properties":{"RequestId":{"type":"string"},"Code":{"type":"string"},"Message":{"type":"string"}}}}},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"RequestId\\\": \\\"5FFD9ED4-C2EC-4E89-B22B-1ACB6FE1****\\\",\\n  \\\"Result\\\": {\\n    \\\"nodeAmount\\\": 2,\\n    \\\"createdAt\\\": \\\"2018-07-13T03:58:07.253Z\\\",\\n    \\\"status\\\": \\\"active\\\",\\n    \\\"paymentType\\\": \\\"postpaid\\\",\\n    \\\"domain\\\": \\\"es-cn-abc.elasticsearch.aliyuncs.com\\\",\\n    \\\"description\\\": \\\"test\\\",\\n    \\\"esVersion\\\": \\\"5.5.3_with_X-Pack\\\",\\n    \\\"instanceId\\\": \\\"es-cn-abc\\\",\\n    \\\"nodeSpec\\\": {\\n      \\\"spec\\\": \\\"elasticsearch.sn2ne.xlarge\\\",\\n      \\\"disk\\\": 40,\\n      \\\"diskType\\\": \\\"cloud_ssd\\\"\\n    },\\n    \\\"kibanaConfiguration\\\": {\\n      \\\"spec\\\": \\\"elasticsearch.n4.small\\\",\\n      \\\"amount\\\": 1,\\n      \\\"disk\\\": 20,\\n      \\\"diskType\\\": \\\"cloud_ssd\\\"\\n    },\\n    \\\"masterConfiguration\\\": {\\n      \\\"spec\\\": \\\"elasticsearch.sn2ne.large\\\",\\n      \\\"amount\\\": 3,\\n      \\\"disk\\\": 20,\\n      \\\"diskType\\\": \\\"cloud_ssd\\\"\\n    }\\n  },\\n  \\\"Code\\\": \\\"\\\",\\n  \\\"Message\\\": \\\"\\\"\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"\",\"errorExample\":\"\"}]","title":"集群升配","description":"调用该接口时，请注意：\n\n- 当实例状态为生效中（activating）、失效（invalid）和冻结（inactive）时，无法变更配置。\n- 如果集群负载过高且索引没有副本，同时在升配或者降配过程中存在大量的写入或查询等情况，业务可能会出现偶发的访问超时现象。建议在集群变更前，在客户端访问机制中配置重试机制，以减小对业务的影响。\n- 每次只能变更一种类型的节点（数据节点、专有主节点、冷数据节点、协调节点、Kibana节点、弹性节点）的配置。\n- 出于您的集群健康和稳定性的考虑，自2021年5月起，阿里云Elasticsearch已不支持购买1核2 GB规格、专有主节点的2核2 GB规格和7.4版本实例，如果您已确认已购规格不再支持售卖，那么您需要先完成以下操作：\n  - 对于1核2 GB和2核2 GB规格，建议提前升配至购买页开放的稳定的售卖规格。购买页开放的售卖规格请参见<props=\"china\"><ph>[购买页面参数（商业版）](~~97672~~)或者[购买页面参数（增强版）](~~143091~~)</ph></props><props=\"intl\">[购买页面参数](~~163243~~)</props>。\n  - 对于7.4版本，建议您重新选购7.10版本实例，然后再进行数据迁移。<props=\"china\"><ph>数据迁移请参见[迁移方案选取指南](~~96650~~)。</ph></props>\n\n更多注意事项，请参见[升配集群](~~96650~~)和[降配集群](~~198887~~)。\n","requestParamsDescription":"\nElasticsearch支持的节点规格列表，请参见[阿里云Elasticsearch定价信息](https://www.aliyun.com/price/product?spm=a2c4g.11186623.2.10.653c6c88NcQPZY#/elasticsearch/detail)、[产品规格](~~271718~~)。\n\n\n请求体参数示例如下：\n**升配**\n\n  > 升配时，不支持降低存储空间数值、存储类型配置、节点数量、规格的CPU核数或内存值。\n\n\n- 升配存储空间\n  目前仅支持数据节点、冷数据节点和弹性数据节点升配存储空间。\n\n   将冷数据节点的存储空间升配至1000 GiB。\n```\n{\n  \"warmNodeConfiguration\": {\n   \"disk\": 1000\n  }\n}\n```\n\n- 升配存储类型\n  目前仅支持数据节点、弹性数据节点和专有主节点升配存储类型。\n\n   - 将专有主节点的存储类型升配为ESSD云盘类型。\n```\n{\n  \"masterConfiguration\": {\n    \"diskType\": \"cloud_essd\"\n  }\n}\n```\n\n   - 当专有主节点的存储类型为ESSD云盘类型时，将节点存储性能级别升配为PL3。\n     指定**performanceLevel**后，**diskType**会默认填充为**cloud_essd**。\n     指定**cloud_essd**后，**performanceLevel**默认为**PL1**。\n\n\t```\n\t{\n\t  \"masterConfiguration\": {\n\t\t\"performanceLevel\": \"PL3\"\n\t  }\n\t}\n\t```\n\n- 升配节点数量\n  目前仅支持数据节点、冷数据节点、弹性数据节点和协调节点升配节点数量。\n  数据节点升配节点数量的方式与其他节点不同，具体参见下文示例。\n\n   - 将数据节点的节点数量升至12个。\n```\n{\n  \"nodeAmount\": 12\n}\n```\n\n   - 将其他类型节点（以冷数据节点为例）的节点数量升至12个。\n```\n{\n  \"warmNodeConfiguration\": {\n    \"amount\": 12\n  }\n}\n```\n\n- 升配节点规格\n将数据节点的规格升至4核32 GB。\n```\n{\n  \"nodeSpec\": {\n    \"spec\": \"elasticsearch.r5.xlarge\"\n  }\n}\n```\n- 同时升配同一节点的几种配置\n  同时升配同一节点的几种配置，需要您同时写入升配资源RequestBody。\n\n   - 将协调节点的节点数量升至8，规格升至4核8 GB。\n```\n{\n  \"clientNodeConfiguration\": {\n    \"amount\": 8,\n    \"spec\": \"elasticsearch.sn1ne.xlarge\"\n  }\n}\n```\n   - 将数据节点的节点数量升至12，存储类型升至ESSD云盘。\n```\n{\n  \"nodeAmount\": 12,\n  \"nodeSpec\": {\n    \"diskType\": \"cloud_essd\"\n  }\n}\n```\n- 启用节点\n  您可以参见[createInstance](~~148782~~)接口设置完整的节点资源配置。\n\n   - 启用协调节点，同时设置协调节点配置。\n```\n{\n  \"clientNodeConfiguration\": {\n    \"amount\": 5,\n    \"disk\": 20,\n    \"spec\": \"elasticsearch.sn1ne.xlarge\"\n  }\n}\n```\n\n   - 启用弹性数据节点，同时设置弹性数据节点配置（此配置只适用于中国站）。\n```\n{\n  \"elasticNodeConfiguration\": {\n    \"disk\": 200,\n    \"amount\": 5,\n    \"diskType\": \"cloud_essd\",\n    \"spec\": \"elasticsearch.sn1ne.xlarge\"\n  }\n}\n```\n\n   - 启用冷数据节点，同时设置冷数据节点配置。\n```\n{\n  \"warmNodeConfiguration\": {\n    \"disk\": 1000,\n    \"amount\": 3,\n    \"spec\": \"elasticsearch.sn1ne.xlarge\"\n  }\n}\n```\n- 升配开启OpenStore（此配置只适用于中国站）\n  已启用冷数据节点的实例以及数据节点存储类型为ESSD云盘的实例，目前不支持升配开启OpenStore。\n  如果实例类型为普通商业版，升配开启OpenStore后，实例类型同时由普通商业版升配至开启Indexing Service的日志增强版。\n\n   - 冷数据节点打开OpenStore。\n```\n{\n  \"warmNodeConfiguration\": {\n    \"amount\": 5,\n    \"spec\": \"openstore.i2g.4xlarge\"\n  }\n}\n```\n\n   - 数据节点规格转换为OpenStore。\n```\n{\n  \"nodeAmount\": 6,\n  \"nodeSpec\": {\n    \"spec\": \"openstore.i2g.4xlarge\",\n    \"diskType\": \"cloud_ssd\",\n    \"disk\": 100\n  }\n}\n```\n\n- 指定变更方式\n   - 变更方式默认为智能变更，将其指定为蓝绿变更（blue_green）或原地变更（normal）。\n```\n{\n  \"nodeSpec\": {\n    \"spec\": \"elasticsearch.r5.xlarge\"\n  },\n  \"updateType\": \"blue_green\"  ## 原地变更为normal。\n}\n```\n   - 开启强制变更。\n```\n{\n  \"nodeSpec\": {\n    \"spec\": \"elasticsearch.r5.xlarge\"\n  },\n  \"force\": true\n}\n```\n- 使用dryRun接口进行升配预校验\n在RequestBody中添加dryRun字段。\n```\n{\n  \"nodeSpec\": {\n    \"spec\": \"elasticsearch.r5.xlarge\"\n  },\n  \"dryRun\": true\n}\n```\n\n\n**降配**\n   > 降配时，不支持升级存储空间数值、存储类型、节点数量、规格的CPU核数或内存值。<br>UpdateInstance接口无法降低节点数量，如有需求请使用[ShrinkNode](~~144668~~)接口。<br>不支持降配节点存储空间大小，启用的节点不支持关闭。<br>不支持选择强制变更，不支持指定变更类型，默认使用智能变更。<br>降配时，**orderActionType**参数需要设置为**Downgrade**。<br>您可以同时降配多个资源配置，也可以进行dryRun预校验。\n\n- 降配存储类型\n  降配时，不支持变更冷数据节点（不变更实例类型）、协调节点、Kibana节点的存储类型。\n\n 将专有主节点的存储类型变更为SSD云盘。\n```\n{\n  \"masterConfiguration\": {\n    \"diskType\": \"cloud_ssd\"\n  }\n}\n```\n- 降配规格\n将数据节点的规格降配至4核32 GB。\n```\n{\n  \"nodeSpec\": {\n    \"spec\": \"elasticsearch.r5.xlarge\"\n  }\n}\n```","extraInfo":" "}