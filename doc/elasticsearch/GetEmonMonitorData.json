{"path":"/openapi/emon/projects/{ProjectId}/metrics/query","methods":["post"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"read","deprecated":false,"systemTags":{"operationType":"get"},"parameters":[{"name":"ProjectId","in":"path","schema":{"description":"项目ID，格式为`es-当前账号ID`。","type":"string","required":true,"docRequired":true,"example":"es-185320276651****"}},{"name":"body","in":"body","schema":{"description":"指定指标监控参数。","type":"string","required":false,"docRequired":false,"example":"{     \"start\": 1522127381471,      \"queries\": [     {         \"metric\": \"elasticbuild.elasticsearch.source.total_doc_count\",         \"aggregator\": \"sum\",         \"downsample\": \"avg\",          \"tags\": {           \"taskName\": \"et-testtsk\",           \"userId\":\"123456\"          },          \"granularity\": \"1m\"        }     ],      \"limit\": \"\",       \"end\": 1522129151000 }"}}],"responses":{"200":{"schema":{"type":"object","properties":{"Code":{"description":"请求状态码。","type":"string","example":"200"},"Message":{"description":"请求结果。","type":"string","example":"\"\""},"RequestId":{"description":"请求ID。","type":"string","example":"2D184B55-FA51-43F7-A1EF-E68A0545****"},"Success":{"description":"请求是否成功：\n- true：成功\n- false：不成功","type":"boolean","example":"true"},"Result":{"description":"返回结果。","type":"array","items":{"type":"object","properties":{"integrity":{"description":"指标查询返回的结果里，时序曲线数据点的完整度。1.0表示100%完整。","type":"number","format":"float","example":"1.0"},"summary":{"description":"queries里如果有通配符，result会包含多条匹配到的时间序列数据，summary是在每个时间点上对这些时间线的value集合，按照query里提供的aggregator类型来聚合。目前聚合方式仅支持avg。","type":"number","format":"float","example":"10"},"messageWatermark":{"description":"请求到达服务端的时间戳，用于排查问题。","type":"integer","format":"int64","example":"1522127381471"},"dps":{"description":"指标实时监控数据。格式为`{时间戳:数据}`。","type":"object","example":" { \"1586249280\": 465.1980465119913, \"1586249300\": 213.45243650423305 }"},"tags":{"description":"查询标签。\n\n","type":"object","example":"{\"taskName\":\"et-xxx\",\"userId\":\"123456\"}"},"metric":{"description":"指标名称。","type":"string","example":"elasticbuild.elasticsearch.source.total_doc_count"}}}}}}},"5XX":{"schema":{"type":"object","properties":{"Code":{"type":"string"},"Message":{"type":"string"},"RequestId":{"type":"string"}}}}},"errorCodes":{"400":[{"errorCode":"InstanceActivating","errorMessage":"Instance is activating."},{"errorCode":"InstanceNotFound","errorMessage":"The instanceId provided does not exist."}]},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"Code\\\": \\\"200\\\",\\n  \\\"Message\\\": \\\"\\\\\\\"\\\\\\\"\\\",\\n  \\\"RequestId\\\": \\\"2D184B55-FA51-43F7-A1EF-E68A0545****\\\",\\n  \\\"Success\\\": true,\\n  \\\"Result\\\": [\\n    {\\n      \\\"integrity\\\": 1,\\n      \\\"summary\\\": 10,\\n      \\\"messageWatermark\\\": 1522127381471,\\n      \\\"dps\\\": {\\n        \\\"1586249280\\\": 465.1980465119913,\\n        \\\"1586249300\\\": 213.45243650423305\\n      },\\n      \\\"tags\\\": {\\n        \\\"taskName\\\": \\\"et-xxx\\\",\\n        \\\"userId\\\": \\\"123456\\\"\\n      },\\n      \\\"metric\\\": \\\"elasticbuild.elasticsearch.source.total_doc_count\\\"\\n    }\\n  ]\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"\",\"errorExample\":\"\"}]","title":"查询实例的Grafana指标监控数据","summary":"查询Elasticsearch实例的Grafana指标监控数据。","requestParamsDescription":"## RequestBody\n\n| 参数名 | 类型 | 是否必填 | 示例值 | 描述 |\n| -------- | -------- | -------- | -------- | -------- |\n|start | Long | 是 | 1522127381471 | 指标监控开始的时间戳。单位：毫秒。|\n|expression | String | 否 |  a+b | 指标数据查询表达式。|\n|queries | List | 是 |  | 指标查询条件。|\n| └id | String | 否 | a | 查询条件queries如果用到了表达式expression，queries json数组里会描述expression里参与运算的指标，id就是每个指标在expression里的代数符号，真正的指标名称在queries数组的每个元素里。|\n| └metric | String | 是  | elasticbuild.elasticsearch.source.total_doc_count  | 指标名称。|\n| └aggregator | String | 是 | sum | 指标按tags维度聚合方式。即对指标按给定的tags group by，进行sum、avg、max、min等聚合运算。|\n| └downsample | String | 是 | avg | 指标按时间精度聚合方式。即对指标在[start,end]窗口内的时间线，在时间维度降精度，例如把20s精度聚合为1min、10min、1hour精度，根据时间窗口的大小会自动降精度。|\n| └tags | Map | 是 | [env,dev] | 指标查询标签。格式为[key,value]，key要明确指定，value支持通配符，使用通配符可返回满足条件的多序列数据。|\n| └granularity | String | 是 | 1m | 指标查询的时间精度。范围为[start,end]。单位：毫秒。 |\n|limit | String | 是 |\"100 \"| 限定返回结果集的大小。为空则不限制，返回所有查询数据。一般用于tags里value使用通配符，返回结果集非常大的情况。|\n|end | String | 是 | 1522129151000 | 指标监控结束的时间戳。单位：毫秒。|\n\n> └表示子参数。\n\n示例如下。\n\n```\n{\n    \"start\": 1522127381471, \n    \"queries\": [\n    {\n        \"metric\": \"elasticbuild.elasticsearch.source.total_doc_count\",\n        \"aggregator\": \"sum\",\n        \"downsample\": \"avg\", \n        \"tags\": {\n          \"taskName\": \"et-testtsk\",\n          \"userId\":\"123456\" \n        }, \n        \"granularity\": \"1m\" \n      }\n    ], \n    \"limit\": \"\",  \n    \"end\": 1522129151000\n}\n```","responseParamsDescription":"以下返回示例中，本文只保证包含返回数据列表中的参数，而未提到的参数仅供参考，程序中不能强制依赖获取这些参数。","extraInfo":" "}