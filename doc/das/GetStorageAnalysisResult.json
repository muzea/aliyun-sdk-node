{"summary":"调用GetStorageAnalysisResult接口，查询空间分析任务状态和分析结果。","methods":["get","post"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"read","deprecated":false,"systemTags":{"operationType":"none","riskType":"none","chargeType":"free","abilityTreeCode":"204031","abilityTreeNodes":["FEATUREhdm3TU4OK"]},"parameters":[{"name":"InstanceId","in":"query","schema":{"description":"实例ID。","type":"string","required":true,"example":"rm-2ze1jdv45i7l6****"}},{"name":"NodeId","in":"query","schema":{"description":"节点ID。\n\n> 预留参数。","type":"string","required":false,"example":"None"}},{"name":"TaskId","in":"query","schema":{"description":"任务ID，调用[CreateStorageAnalysisTask](~~2639140~~)接口返回的任务ID。","type":"string","required":true,"example":"910f83f4b96df0524ddc5749f615****"}}],"responses":{"200":{"schema":{"type":"object","properties":{"Code":{"description":"返回的状态码。","type":"integer","format":"int64","example":"200"},"Message":{"description":"请求返回消息。\n\n> 请求成功时该参数返回**Successful**，请求失败时会返回请求异常信息（如错误码等）。","type":"string","example":"Successful"},"Data":{"description":"返回的数据。","type":"object","properties":{"TaskId":{"description":"任务ID。","type":"string","example":"910f83f4b96df0524ddc5749f615****"},"TaskFinish":{"description":"任务是否结束：\n\n- **true**：任务结束。\n- **false**：任务未结束。","type":"boolean","example":"true"},"TaskSuccess":{"description":"任务是否成功：\n- **true**：执行成功。\n- **false**：执行失败。\n\n> 当任务结束时才返回该字段。","type":"boolean","example":"true"},"TaskState":{"description":"空间分析任务的状态：\n\n- **INIT**：初始化。\n- **PENDING**：等待执行。\n- **RECEIVED**：任务已选择。\n- **RUNNING**：任务执行中。\n- **RETRY**：重试任务。\n- **SUCCESS**：任务成功。\n- **FAILURE**：任务失败。","type":"string","example":"SUCCESS"},"TaskProgress":{"description":"任务进度，取值为0~100的整数。\n\n> 例如取值为100时，表示任务进度100%。","type":"integer","format":"int64","example":"100"},"TotalDbCount":{"description":"空间分析任务需要分析的数据库数量。","type":"integer","format":"int64","example":"32"},"AnalyzedDbCount":{"description":"已分析结束的数据库数量。","type":"integer","format":"int64","example":"2"},"StorageAnalysisResult":{"description":"空间分析详情。","type":"object","properties":{"TotalStorageSize":{"description":"实例总空间大小，单位为Byte。\n\n> 当前仅支持RDS MySQL。","type":"integer","format":"int64","example":"214748364800"},"TotalUsedStorageSize":{"description":"已使用的空间，单位为Byte。","type":"integer","format":"int64","example":"68345135104"},"TotalFreeStorageSize":{"description":"剩余可用空间，单位为Byte。\n\n> 当前仅支持RDS MySQL。","type":"integer","format":"int64","example":"146403229696"},"DailyIncrement":{"description":"近一周空间日均增长量估算值，单位为Byte。","type":"integer","format":"int64","example":"0"},"EstimateAvailableDays":{"description":"剩余空间可使用天数估算值。","type":"integer","format":"int64","example":"99"},"AnalysisSuccess":{"description":"数据库和表空间分析是否成功。\n\n- **true**：成功。\n- **false**：失败。","type":"boolean","example":"true"},"AnalysisErrorType":{"description":"数据库和表空间分析任务失败类型：\n- **DB_OR_TABLE_NOT_EXIST**：指定的数据库或表不存在。\n- **DB_NOT_EXIST**：指定的数据库不存在。","type":"string","example":"DB_NOT_EXIST"},"NeedOptimizeItemList":{"description":"根据DAS默认规则生成的待优化项列表。用户也可根据自身业务情况忽略该列表中的内容，然后根据接口返回的其他基础数据自定义规则生成待优化项列表。","type":"array","items":{"type":"object","properties":{"DbName":{"description":"数据库名。","type":"string","example":"testdb01"},"TableName":{"description":"表名。","type":"string","example":"test_table"},"OptimizeItemName":{"description":"待优化项：\n- **NEED_ANALYZE_TABLE**：`information_schema.tables`中该表空间统计数据和物理文件大小差值超过50 GB。仅适用于RDS MySQL和PolarDB MySQL版。\n- **NEED_OPTIMIZE_TABLE**：表的碎片空间大于6 GB，并且碎片率大于30%。表的碎片率计算方式：\n  - RDS MySQL和PolarDB MySQL版为：`DataFree/(DataSize+IndexSize+DataFree)`，本接口中即`DataFree/PhyTotalSize`。\n  -  MongoDB为：`FragmentSize/PhyTotalSize`。\n- **TABLE_ENGINE**：表使用的存储引擎不是InnoDB或者XEngine。仅适用于RDS MySQL和PolarDB MySQL版。\n- **AUTO_INCREMENT_ID_BE_TO_RUN_OUT**：表自增ID使用率超过80%。仅适用于RDS MySQL和PolarDB MySQL版。\n- **DUPLICATE_INDEX**：索引冗余或者重复。仅适用于RDS MySQL和PolarDB MySQL版。\n- **TABLE_SIZE**：单表空间大于50 GB。仅适用于RDS MySQL和PolarDB MySQL版。\n- **TABLE_ROWS_AND_AVG_ROW_LENGTH**：单表行数大于500万，且平均行长大于10 KB。仅适用于RDS MySQL和PolarDB MySQL版。\n- **TOTAL_DATA_FREE**：实例可回收空间大于60 GB，且总碎片率大于5%。\n- **STORAGE_USED_PERCENT**：实例空间使用率大于90%。","type":"string","example":"NEED_OPTIMIZE_TABLE"},"OptimizeAdvice":{"description":"优化建议：\n- **NEED_ANALYZE_TABLE**：如有需要可在业务低峰时期对相关的表执行`ANALYZE TABLE`。仅适用于RDS MySQL和PolarDB MySQL版。\n- **NEED_OPTIMIZE_TABLE**：如有需要可在业务低峰时期进行表空间碎片回收。\n- **CHANGE_TABLE_ENGINE_IF_NECESSARY**：如果有需要可以在评估风险后更改表的存储引擎类型。仅适用于RDS MySQL和PolarDB MySQL版。\n- **AUTO_INCREMENT_ID_BE_TO_RUN_OUT**：注意自增ID使用情况。仅适用于RDS MySQL和PolarDB MySQL版。\n- **DUPLICATE_INDEX**：建议优化精简表上的索引。仅适用于RDS MySQL和PolarDB MySQL版。\n- **TABLE_SIZE**：注意表大小。仅适用于RDS MySQL和PolarDB MySQL版。\n- **TABLE_ROWS_AND_AVG_ROW_LENGTH**：注意表行数以及平均行长。仅适用于RDS MySQL和PolarDB MySQL版。\n- **STORAGE_USED_PERCENT**：注意空间使用情况，避免实例写满后锁定。","type":"string","example":"NEED_OPTIMIZE_TABLE"},"AssociatedData":{"description":"待优化项关联数据，以JSON格式返回。","type":"string","example":"{\n    \"autoIncrementCurrentValue\": 2147483647,\n    \"autoIncrementRatio\": 1,\n    \"dbName\": \"testdb01\",\n    \"maximumValue\": 2147483647,\n    \"columnName\": \"id\",\n    \"tableName\": \"test_table\"\n}"}}}},"TableStats":{"description":"表空间数据列表。","type":"array","items":{"type":"object","properties":{"DbName":{"description":"数据库名。","type":"string","example":"testdb01"},"TableName":{"description":"表名。","type":"string","example":"test_table"},"TableType":{"description":"表类型。\n\n> 该参数适用于RDS MySQL和PolarDB MySQL版。","type":"string","example":"BASE TABLE"},"Engine":{"description":"表使用的存储引擎类型。\n\n> 该参数适用于RDS MySQL和PolarDB MySQL版。","type":"string","example":"InnoDB"},"PhysicalFileSize":{"description":"表物理文件大小，单位为Byte。\n> 该参数适用于RDS MySQL和PolarDB MySQL版。部分实例因部署形态的原因不支持获取该数据。","type":"integer","format":"int64","example":"3057655808"},"PhyTotalSize":{"description":"表空间大小，单位为Byte。\n> 对于RDS MySQL和PolarDB MySQL版，取值为**DataSize**、**IndexSize**、**DataFree**之和；对于MongoDB，取值为**DataSize**、**IndexSize**之和。","type":"integer","format":"int64","example":"3012493312"},"TotalSize":{"description":"- 对于RDS MySQL和PolarDB MySQL版，该参数是表数据和索引占用空间大小，单位为Byte。取值为**DataSize**、**IndexSize**之和。\n\n- 对于MongoDB，该参数是Block Manager实际分配的空间大小，单位为Byte。MongoDB实例压缩率计算方式为：`TotalSize/DataSize`。","type":"integer","format":"int64","example":"3005153280"},"IndexSize":{"description":"索引占用的空间大小，单位为Byte。","type":"integer","format":"int64","example":"1022296064"},"DataSize":{"description":"- 对于RDS MySQL和PolarDB MySQL版，该参数是数据占用的空间大小，单位为Byte。\n- 对于MongoDB，该参数是未压缩数据的大小，即数据量，单位为Byte。","type":"integer","format":"int64","example":"1982857216"},"DataFree":{"description":"碎片空间大小，单位为Byte。\n\n> 该参数适用于RDS MySQL和PolarDB MySQL版。表碎片率计算方式一般为：`DataFree/(DataSize+IndexSize+DataFree)`，本接口中即`DataFree/PhyTotalSize`。","type":"integer","format":"int64","example":"7340032"},"TableRows":{"description":"表行数。","type":"integer","format":"int64","example":"12794732"},"AvgRowLength":{"description":"平均行长，单位为Byte。","type":"integer","format":"int64","example":"154"},"FragmentSize":{"description":"可回收空间大小（碎片空间大小），单位为Byte。\n\n> 该参数仅适用于MongoDB实例。表碎片率计算方式为：`FragmentSize/PhyTotalSize`。","type":"integer","format":"int64","example":"362221568"}}}}}}}},"RequestId":{"description":"请求ID。","type":"string","example":"B6D17591-B48B-4D31-9CD6-9B9796B2****"},"Success":{"description":"请求是否执行成功：\n\n- **true**：执行成功。\n- **false**：执行失败。","type":"boolean","example":"true"}}}}},"errorCodes":{"400":[{"errorCode":"InvalidParams","errorMessage":"The request parameters are invalid."}],"403":[{"errorCode":"NoPermission","errorMessage":"You are not authorized to do this action."}]},"staticInfo":{"returnType":"synchronous"},"responseDemo":"[{\"errorExample\":\"\",\"example\":\"{\\n  \\\"Code\\\": 200,\\n  \\\"Message\\\": \\\"Successful\\\",\\n  \\\"Data\\\": {\\n    \\\"TaskId\\\": \\\"910f83f4b96df0524ddc5749f615****\\\",\\n    \\\"TaskFinish\\\": true,\\n    \\\"TaskSuccess\\\": true,\\n    \\\"TaskState\\\": \\\"SUCCESS\\\",\\n    \\\"TaskProgress\\\": 100,\\n    \\\"TotalDbCount\\\": 32,\\n    \\\"AnalyzedDbCount\\\": 2,\\n    \\\"StorageAnalysisResult\\\": {\\n      \\\"TotalStorageSize\\\": 214748364800,\\n      \\\"TotalUsedStorageSize\\\": 68345135104,\\n      \\\"TotalFreeStorageSize\\\": 146403229696,\\n      \\\"DailyIncrement\\\": 0,\\n      \\\"EstimateAvailableDays\\\": 99,\\n      \\\"AnalysisSuccess\\\": true,\\n      \\\"AnalysisErrorType\\\": \\\"DB_NOT_EXIST\\\",\\n      \\\"NeedOptimizeItemList\\\": [\\n        {\\n          \\\"DbName\\\": \\\"testdb01\\\",\\n          \\\"TableName\\\": \\\"test_table\\\",\\n          \\\"OptimizeItemName\\\": \\\"NEED_OPTIMIZE_TABLE\\\",\\n          \\\"OptimizeAdvice\\\": \\\"NEED_OPTIMIZE_TABLE\\\",\\n          \\\"AssociatedData\\\": \\\"{\\\\n    \\\\\\\"autoIncrementCurrentValue\\\\\\\": 2147483647,\\\\n    \\\\\\\"autoIncrementRatio\\\\\\\": 1,\\\\n    \\\\\\\"dbName\\\\\\\": \\\\\\\"testdb01\\\\\\\",\\\\n    \\\\\\\"maximumValue\\\\\\\": 2147483647,\\\\n    \\\\\\\"columnName\\\\\\\": \\\\\\\"id\\\\\\\",\\\\n    \\\\\\\"tableName\\\\\\\": \\\\\\\"test_table\\\\\\\"\\\\n}\\\"\\n        }\\n      ],\\n      \\\"TableStats\\\": [\\n        {\\n          \\\"DbName\\\": \\\"testdb01\\\",\\n          \\\"TableName\\\": \\\"test_table\\\",\\n          \\\"TableType\\\": \\\"BASE TABLE\\\",\\n          \\\"Engine\\\": \\\"InnoDB\\\",\\n          \\\"PhysicalFileSize\\\": 3057655808,\\n          \\\"PhyTotalSize\\\": 3012493312,\\n          \\\"TotalSize\\\": 3005153280,\\n          \\\"IndexSize\\\": 1022296064,\\n          \\\"DataSize\\\": 1982857216,\\n          \\\"DataFree\\\": 7340032,\\n          \\\"TableRows\\\": 12794732,\\n          \\\"AvgRowLength\\\": 154,\\n          \\\"FragmentSize\\\": 362221568\\n        }\\n      ]\\n    }\\n  },\\n  \\\"RequestId\\\": \\\"B6D17591-B48B-4D31-9CD6-9B9796B2****\\\",\\n  \\\"Success\\\": true\\n}\",\"type\":\"json\"}]","title":"获取空间分析任务的结果","description":"> 物理文件大小获取的是文件真实大小（需实例部署形态支持）；表级别其他数据基于`information_schema.tables`。由于MySQL中统计信息不是实时更新，所以可能和物理文件大小存在差异，如有需要获取最新数据，可在业务低峰时期对相关的表执行`ANALYZE TABLE`。\n\n- 本接口只适用于RDS MySQL、PolarDB MySQL版和MongoDB实例。\n- 对于RDS MySQL和PolarDB MySQL版实例，本接口对应于旧版空间分析功能，该接口生成的任务无法在DAS控制台新版空间分析页面查看。如有需要查看任务及结果，请调用接口后自行保存数据。\n- 使用阿里云或DAS的SDK时，建议使用最新版本。\n- 在使用SDK调用DAS服务时，需要将地域指定为cn-shanghai。"}