{"summary":"调用SetEventSubscription接口，配置数据库实例的事件订阅设置。","methods":["post","get"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"readAndWrite","systemTags":{"operationType":"update"},"parameters":[{"name":"InstanceId","in":"query","schema":{"title":"实例ID","description":"实例ID。","type":"string","required":true,"example":"rm-2ze8g2am97624****"}},{"name":"EventContext","in":"query","schema":{"title":"事件场景","description":"支持的事件场景，当前仅支持**AllContext**，表示支持所有场景。","type":"string","required":false,"enumValueTitles":{},"example":"AllContext"}},{"name":"Lang","in":"query","schema":{"title":"语言","description":"事件通知的语言，当前仅支持**zh-CN**，表示事件通知为中文。","type":"string","required":false,"enumValueTitles":{},"example":"zh-CN"}},{"name":"MinInterval","in":"query","schema":{"title":"通知最小间隔","description":"通知最小间隔时间，单位为秒（s）。","type":"string","required":false,"example":"60"}},{"name":"ContactName","in":"query","schema":{"title":"告警订阅人","description":"告警事件订阅人名称，多个名称间以英文逗号分隔。","type":"string","required":false,"example":"默认联系人"}},{"name":"ChannelType","in":"query","schema":{"title":"通知方式","description":"通知方式。\n- **hdm\\_alarm\\_sms**：手机短信。\n- **dingtalk**：钉钉机器人。\n- **hdm\\_alarm\\_sms\\_and\\_email**：手机短信+邮件。\n- **hdm\\_alarm\\_sms,dingtalk**：手机短信+钉钉机器人。","type":"string","required":false,"enumValueTitles":{},"example":"hdm_alarm_sms,dingtalk"}},{"name":"ContactGroupName","in":"query","schema":{"title":"告警订阅组","description":"告警事件订阅组名称，多个名称以英文逗号分隔。","type":"string","required":false,"example":"默认联系组"}},{"name":"Level","in":"query","schema":{"title":"事件风险级别","description":"需要进行通知的事件级别，取值：\n- **Notice**：通知（包含**Notice**、**Optimization**、**Warn**和**Critical**级别的事件）。\n- **Optimization**：优化（包含**Optimization**、**Warn**和**Critical**级别的事件）。\n- **Warn**：警告（包含**Warn**和**Critical**级别的事件）。\n- **Critical**：严重（仅包含**Critical**级别的事件）。\n\n各个级别事件的含义如下：\n\n- 通知：暂无建议的数据库异常事件。\n- 优化：根据数据库运行情况给出优化建议的事件。\n- 警告：需要关注的可能会影响数据库的事件。\n- 严重：影响数据库运行的事件。","type":"string","required":false,"enumValueTitles":{},"example":"Optimization"}},{"name":"Active","in":"query","schema":{"title":"是否启用","description":"是否启用事件订阅功能：\n- **0**：关闭。\n- **1**：开启。","type":"string","required":false,"enumValueTitles":{},"example":"1"}},{"name":"Severity","in":"query","schema":{"description":"按照事件类型设置事件的告警级别。\n\n输入格式：`{\"事件类型1\":\"告警级别\", \"事件类型2\":\"告警级别\"}`。\n\n事件类型：\n\n- **AutoScale**：弹性伸缩事件。\n- **SQLThrottle**：限流事件。\n- **TimeSeriesAbnormal**：时序异常检测事件。\n- **SQLOptimize**：SQL优化事件。\n- **ResourceOptimize**：空间优化事件。\n\n告警级别：\n- **info**：一般。\n- **noticed**：通知。\n- **warning**：警告。\n- **critical**：严重。","type":"string","required":false,"example":"{\"AutoScale\":\"critical\",\"SQLThrottle\":\"info\",\"TimeSeriesAbnormal\":\"warning\"}"}},{"name":"DispatchRule","in":"query","schema":{"description":"按照事件类型设置事件的消息通知规则，此参数为空时，以**MinInterval**和**ChannelType**设置为准。\n\n输入格式：`{\"silenced\": {\"事件类型1\":是否打开自适应静默, \"事件类型2\":是否打开自适应静默},\"min_interval\":{\"事件类型1\":通知最小间隔, \"事件类型2\":通知最小间隔},\"alert_type\": {\"事件类型1\":\"通知方式\", \"事件类型2\":\"通知方式\"}}`。\n\n- **silenced**：是否打开自适应静默。打开自适应静默后，事件中连续告警的发送间隔变为**min\\_interval**设置值和该事件持续时间1/3中的最大值。\n    - 1：打开。\n    - 2：关闭。\n- **min\\_interval**：通知最小间隔时间，单位为秒（s）。\n- **alert_type**：通知方式，取值：\n    - **hdm\\_alarm\\_sms**：手机短信。\n    - **dingtalk**：钉钉机器人。\n    - **hdm\\_alarm\\_sms\\_and\\_email**：手机短信+邮件。\n    - **hdm\\_alarm\\_sms,dingtalk**：手机短信+钉钉机器人。","type":"string","required":false,"example":"{\"silenced\": {\"AutoScale\":1, \"SQLThrottle\":0, \"TimeSeriesAbnormal\": 1}, \"min_interval\": {\"AutoScale\":300, \"SQLThrottle\":360, \"TimeSeriesAbnormal\": 120}, \"alert_type\": {\"AutoScale\":\"hdm_alarm_sms\", \"SQLThrottle\":\"hdm_alarm_sms_and_email\", \"TimeSeriesAbnormal\": \"hdm_alarm_sms,dingtalk\"}}"}}],"responses":{"200":{"headers":{},"schema":{"description":"返回信息列表。","type":"object","properties":{"RequestId":{"description":"请求ID。","type":"string","example":"097F0C56-B252-515A-B602-FC56EF93EF8A"},"Message":{"description":"请求返回消息。\n\n> 请求成功时该参数返回**Successful**，请求失败时会返回请求异常信息（如错误码等）。","type":"string","example":"Successful"},"Data":{"description":"详细信息列表。","type":"object","properties":{"userId":{"title":"用户ID ","description":"用户ID。","type":"string","example":"1088760496****"},"instanceId":{"title":"实例ID","description":"实例ID。","type":"string","example":"rm-2ze8g2am97624****"},"eventContext":{"title":"事件场景","description":"支持的事件场景，当前仅支持**AllContext**，表示支持所有场景。","type":"string","example":"AllContext"},"lang":{"title":"语言","description":"事件通知的语言，当前仅支持**zh-CN**，表示事件通知为中文。","type":"string","example":"zh_CN"},"active":{"title":"是否启用","description":"是否启用事件订阅：\n- **0**：关闭。\n- **1**：开启。","type":"integer","format":"int32","example":"1"},"minInterval":{"title":"通知最小间隔","description":"通知最小间隔时间，单位秒（s）。","type":"integer","format":"int32","example":"60"},"contactName":{"title":"告警订阅人","description":"告警事件订阅人名称，多个名称间以英文逗号分隔。","type":"string","example":"默认联系人"},"contactGroupName":{"title":"告警订阅组","description":"告警事件订阅组名称，多个名称间以英文逗号分隔。","type":"string","example":"默认联系组"},"channelType":{"title":"通知方式","description":"通知方式：\n- **hdm\\_alarm\\_sms**：手机短信。\n- **dingtalk**：钉钉机器人。\n- **hdm\\_alarm\\_sms\\_and\\_email**：手机短信+邮件。\n- **hdm\\_alarm\\_sms,dingtalk**：手机短信+钉钉机器人。","type":"string","example":"hdm_alarm_sms,dingtalk"},"level":{"title":"事件风险级别","description":"事件风险级别：\n- **Notice**：通知。\n- **Optimization**：优化。\n- **Warn**：警告。\n- **Critical**：严重。\n","type":"string","example":"Optimization"}}},"Code":{"description":"返回的状态码。","type":"string","example":"200"},"Success":{"description":"请求是否执行成功：\n\n- **true**：执行成功。\n- **false**：执行失败。","type":"string","example":"true"}}}}},"errorCodes":{"400":[{"errorCode":"InvalidParams","errorMessage":"The request parameters are invalid."}],"403":[{"errorCode":"NoPermission","errorMessage":"You are not authorized to do this action."}]},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"RequestId\\\": \\\"097F0C56-B252-515A-B602-FC56EF93EF8A\\\",\\n  \\\"Message\\\": \\\"Successful\\\",\\n  \\\"Data\\\": {\\n    \\\"userId\\\": \\\"1088760496****\\\",\\n    \\\"instanceId\\\": \\\"rm-2ze8g2am97624****\\\",\\n    \\\"eventContext\\\": \\\"AllContext\\\",\\n    \\\"lang\\\": \\\"zh_CN\\\",\\n    \\\"active\\\": 1,\\n    \\\"minInterval\\\": 60,\\n    \\\"contactName\\\": \\\"默认联系人\\\",\\n    \\\"contactGroupName\\\": \\\"默认联系组\\\",\\n    \\\"channelType\\\": \\\"hdm_alarm_sms,dingtalk\\\",\\n    \\\"level\\\": \\\"Optimization\\\"\\n  },\\n  \\\"Code\\\": \\\"200\\\",\\n  \\\"Success\\\": \\\"true\\\"\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<SetEventSubscriptionResponse>\\n    <RequestId>097F0C56-B252-515A-B602-FC56EF93EF8A</RequestId>\\n    <Message>Successful</Message>\\n    <Data>\\n        <userId>1088760496****</userId>\\n        <instanceId>rm-2ze8g2am97624****</instanceId>\\n        <eventContext>AllContext</eventContext>\\n        <lang>zh_CN</lang>\\n        <active>1</active>\\n        <minInterval>60</minInterval>\\n        <contactName>默认联系人</contactName>\\n        <contactGroupName>默认联系组</contactGroupName>\\n        <channelType>hdm_alarm_sms,dingtalk</channelType>\\n        <level>Optimization</level>\\n    </Data>\\n    <Code>200</Code>\\n    <Success>true</Success>\\n</SetEventSubscriptionResponse>\",\"errorExample\":\"\"}]","title":"配置事件订阅设置","description":"使用该接口需满足以下前提条件：\n\n- 使用阿里云或DAS的SDK时，建议使用最新版本。\n- 使用SDK调用DAS服务时，需要将地域指定为cn-shanghai。\n- 数据库实例已接入DAS。\n\n<props=\"china\"> <note>事件订阅已集成至告警功能。如果在控制台配置了事件告警，通过该API接口配置的事件订阅设置将被事件告警覆盖。配置事件告警请参见[配置告警](~~87017~~)。</note></props>"}