{"summary":"调用GetRequestDiagnosisResult接口，查询SQL诊断的结果。","methods":["post","get"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"read","systemTags":{"operationType":"get"},"parameters":[{"name":"InstanceId","in":"query","schema":{"description":"实例ID。","type":"string","required":true,"example":"rm-0iwhhl8gx0ld6****"}},{"name":"NodeId","in":"query","schema":{"description":"节点ID。\n\n> 对于PolarDB MySQL版、PolarDB PostgreSQL版（兼容Oracle）和云数据库MongoDB等集群实例，需要提供节点ID。\n","type":"string","required":false,"example":"202****"}},{"name":"MessageId","in":"query","schema":{"description":"诊断ID，[CreateRequestDiagnosis](~~341609~~)接口返回的诊断唯一标识。","type":"string","required":true,"example":"61820b594664275c4429****"}},{"name":"SqlId","in":"query","schema":{"title":"SQL模板ID","description":"SQL模板ID。\n\n> 此参数是DAS控制台调用API时使用，用户使用此API时无需传入。","type":"string","required":false,"example":"None"}},{"name":"Source","in":"query","schema":{"title":"诊断来源","description":"任务来源。\n\n> 此参数是DAS控制台调用API时使用，用户使用此API时无需传入。","type":"string","required":false,"example":"None"}}],"responses":{"200":{"headers":{},"schema":{"type":"object","properties":{"Message":{"description":"请求返回消息。\n\n> 请求成功时该参数返回Successful，请求失败时会返回请求异常信息（如错误码等）。","type":"string","example":"Successful"},"RequestId":{"description":"请求ID。\n\n","type":"string","example":"800FBAF5-A539-5B97-A09E-C63AB2F7****"},"Data":{"description":"返回数据","type":"object","properties":{"messageId":{"description":"诊断ID，唯一标识。","type":"string","example":"61820b594664275c4429****"},"uuid":{"description":"诊断实例唯一标识。","type":"string","example":"hdm_51fe9bc19ec413f4d530431af87a****"},"accountId":{"description":"用户ID。","type":"string","example":"2093****"},"sqlId":{"description":"SQL模板ID。","type":"string","example":"0c95dae3afef77be06572612df9b****"},"engine":{"description":"数据库引擎，取值：\n\n- **MySQL**\n- **PostgreSQL**\n- **SQLServer**\n- **PolarDBMySQL**\n- **PolarDBOracle**\n- **MongoDB**\n\n\n\n\n\n\n\n\n\n\n","type":"string","example":"MySQL"},"dbSchema":{"description":"数据库名。","type":"string","example":"das"},"param":{"description":"额外信息。","type":"string","example":"{\"\":\"\"}"},"state":{"description":"诊断状态：\n\n- **0**：诊断中。\n- **1**：诊断错误。\n- **2**：诊断完成。\n- **3**：SQL错误。\n- **4**：引擎错误。","type":"integer","format":"int32","example":"2"},"result":{"description":"SQL诊断结果。\n\n- **endTime**：SQL诊断的结束时间。\n- **errorCode**：错误码。\n    - **0001**：诊断成功。\n    - **0003**：诊断失败。\n- **errorMessage**：错误信息。\n- **estimateCost**：预估得消耗。\n\t- **cpu**：索引的CPU消耗预估值。\n\t- **io**：索引的IO消耗预估值。\n\t- **rows**：索引的返回列预估值。\n- **improvement**：性能提升比。\n- **indexAdvices**：索引建议。\n\t- **columns**：索引列。\n\t- **ddlAddIndex**：索引DDL语句。\n\t- **indexName**：索引名。\n\t- **schemaName**：数据库名。\n\t- **tableName**：表名。\n\t- **unique**：是否唯一索引。\n- **ip**：实例的IP地址。\n- **messageId**：诊断ID。\n- **port**：实例的端口。\n- **sqlTag**：SQL标签。\n- **startTime**：SQL诊断的开始时间。\n- **success**：请求是否执行成功。\n- **support**：SQL语句是否支持诊断。\n    - **true**：支持。\n    - **false**：不支持。\n- **tuningAdvices**：SQL改写建议。","type":"string","example":"{ \"endTime\":1636354256000, \"errorCode\":\"0001\", \"errorMessage\":\"TFX成功\", \"estimateCost\":{ \"cpu\":1.7878745150389268, \"io\":9.948402604746128, \"rows\":8.889372575194633 }, \"improvement\":12933.97, \"indexAdvices\":[ { \"columns\":[ \"work_no\" ], \"ddlAddIndex\":\"ALTER TABLE `test`.`work_order` ADD INDEX `idx_workno` (`work_no`)\", \"indexName\":\"idx_workno\", \"schemaName\":\"test\", \"tableName\":\"work_order\", \"unique\":false } ], \"ip\":\"****.mysql.rds.aliyuncs.com\", \"messageId\":\"6188c8cb2f1365b16aee****\", \"port\":3306, \"sqlTag\":\"{\\\"PRED_EQUAL\\\":\\\"Y\\\",\\\"CNT_QB\\\":\\\"1\\\",\\\"CNT_TB\\\":\\\"1\\\"}\", \"startTime\":1636354252000, \"success\":true, \"support\":true, \"tuningAdvices\":[ ] }"},"gmtCreate":{"description":"SQL诊断创建时间，格式为Unix时间戳，单位为毫秒。","type":"string","example":"1633071840000"},"gmtModified":{"description":"SQL诊断修改时间，格式为Unix时间戳，单位为毫秒。","type":"string","example":"1633071850000"}}},"Code":{"description":"返回的状态码。","type":"string","example":"200"},"Success":{"description":"请求是否执行成功：\n\n- **true**：执行成功。\n\n- **false**：执行失败。","type":"string","example":"true"}}}}},"errorCodes":{"400":[{"errorCode":"InvalidParams","errorMessage":"The request parameters are invalid."}],"403":[{"errorCode":"NoPermission","errorMessage":"You are not authorized to do this action."}]},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"Message\\\": \\\"Successful\\\",\\n  \\\"RequestId\\\": \\\"800FBAF5-A539-5B97-A09E-C63AB2F7****\\\",\\n  \\\"Data\\\": {\\n    \\\"messageId\\\": \\\"61820b594664275c4429****\\\",\\n    \\\"uuid\\\": \\\"hdm_51fe9bc19ec413f4d530431af87a****\\\",\\n    \\\"accountId\\\": \\\"2093****\\\",\\n    \\\"sqlId\\\": \\\"0c95dae3afef77be06572612df9b****\\\",\\n    \\\"engine\\\": \\\"MySQL\\\",\\n    \\\"dbSchema\\\": \\\"das\\\",\\n    \\\"param\\\": \\\"{\\\\\\\"\\\\\\\":\\\\\\\"\\\\\\\"}\\\",\\n    \\\"state\\\": 2,\\n    \\\"result\\\": \\\"{ \\\\\\\"endTime\\\\\\\":1636354256000, \\\\\\\"errorCode\\\\\\\":\\\\\\\"0001\\\\\\\", \\\\\\\"errorMessage\\\\\\\":\\\\\\\"TFX成功\\\\\\\", \\\\\\\"estimateCost\\\\\\\":{ \\\\\\\"cpu\\\\\\\":1.7878745150389268, \\\\\\\"io\\\\\\\":9.948402604746128, \\\\\\\"rows\\\\\\\":8.889372575194633 }, \\\\\\\"improvement\\\\\\\":12933.97, \\\\\\\"indexAdvices\\\\\\\":[ { \\\\\\\"columns\\\\\\\":[ \\\\\\\"work_no\\\\\\\" ], \\\\\\\"ddlAddIndex\\\\\\\":\\\\\\\"ALTER TABLE `test`.`work_order` ADD INDEX `idx_workno` (`work_no`)\\\\\\\", \\\\\\\"indexName\\\\\\\":\\\\\\\"idx_workno\\\\\\\", \\\\\\\"schemaName\\\\\\\":\\\\\\\"test\\\\\\\", \\\\\\\"tableName\\\\\\\":\\\\\\\"work_order\\\\\\\", \\\\\\\"unique\\\\\\\":false } ], \\\\\\\"ip\\\\\\\":\\\\\\\"****.mysql.rds.aliyuncs.com\\\\\\\", \\\\\\\"messageId\\\\\\\":\\\\\\\"6188c8cb2f1365b16aee****\\\\\\\", \\\\\\\"port\\\\\\\":3306, \\\\\\\"sqlTag\\\\\\\":\\\\\\\"{\\\\\\\\\\\\\\\"PRED_EQUAL\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"Y\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"CNT_QB\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"1\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"CNT_TB\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"1\\\\\\\\\\\\\\\"}\\\\\\\", \\\\\\\"startTime\\\\\\\":1636354252000, \\\\\\\"success\\\\\\\":true, \\\\\\\"support\\\\\\\":true, \\\\\\\"tuningAdvices\\\\\\\":[ ] }\\\",\\n    \\\"gmtCreate\\\": \\\"1633071840000\\\",\\n    \\\"gmtModified\\\": \\\"1633071850000\\\"\\n  },\\n  \\\"Code\\\": \\\"200\\\",\\n  \\\"Success\\\": \\\"true\\\"\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<GetRequestDiagnosisResultResponse>\\n    <Message>Successful</Message>\\n    <RequestId>800FBAF5-A539-5B97-A09E-C63AB2F7****</RequestId>\\n    <Data>\\n        <messageId>61820b594664275c4429****</messageId>\\n        <uuid>hdm_51fe9bc19ec413f4d530431af87a****</uuid>\\n        <accountId>2093****</accountId>\\n        <sqlId>0c95dae3afef77be06572612df9b****</sqlId>\\n        <engine>MySQL</engine>\\n        <dbSchema>das</dbSchema>\\n        <param>{\\\"\\\":\\\"\\\"}</param>\\n        <state>2</state>\\n        <result>{ \\\"endTime\\\":1636354256000, \\\"errorCode\\\":\\\"0001\\\", \\\"errorMessage\\\":\\\"TFX成功\\\", \\\"estimateCost\\\":{ \\\"cpu\\\":1.7878745150389268, \\\"io\\\":9.948402604746128, \\\"rows\\\":8.889372575194633 }, \\\"improvement\\\":12933.97, \\\"indexAdvices\\\":[ { \\\"columns\\\":[ \\\"work_no\\\" ], \\\"ddlAddIndex\\\":\\\"ALTER TABLE `test`.`work_order` ADD INDEX `idx_workno` (`work_no`)\\\", \\\"indexName\\\":\\\"idx_workno\\\", \\\"schemaName\\\":\\\"test\\\", \\\"tableName\\\":\\\"work_order\\\", \\\"unique\\\":false } ], \\\"ip\\\":\\\"****.mysql.rds.aliyuncs.com\\\", \\\"messageId\\\":\\\"6188c8cb2f1365b16aee****\\\", \\\"port\\\":3306, \\\"sqlTag\\\":\\\"{\\\\\\\"PRED_EQUAL\\\\\\\":\\\\\\\"Y\\\\\\\",\\\\\\\"CNT_QB\\\\\\\":\\\\\\\"1\\\\\\\",\\\\\\\"CNT_TB\\\\\\\":\\\\\\\"1\\\\\\\"}\\\", \\\"startTime\\\":1636354252000, \\\"success\\\":true, \\\"support\\\":true, \\\"tuningAdvices\\\":[ ] }</result>\\n        <gmtCreate>1633071840000</gmtCreate>\\n        <gmtModified>1633071850000</gmtModified>\\n    </Data>\\n    <Code>200</Code>\\n    <Success>true</Success>\\n</GetRequestDiagnosisResultResponse>\",\"errorExample\":\"\"}]","title":"查询SQL诊断的结果","description":"使用该接口需满足以下前提条件：\n\n- 在使用SDK调用DAS服务时，需要将地域指定为cn-shanghai。\n- 本接口适用的数据库引擎为：\n\n    - RDS MySQL\n    - RDS PostgreSQL\n    - RDS SQL Server\n    - PolarDB MySQL版\n    - PolarDB PostgreSQL版（兼容Oracle）\n    - 云数据库MongoDB版\n\n> RDS PostgreSQL实例内核小版本为20220130及以上。查看和升级内核小版本，请参见[升级内核小版本](~~146895~~)。\n"}