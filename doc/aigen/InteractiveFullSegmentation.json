{"summary":"本文介绍生成专区（aigen）类目下的全图分割InteractiveFullSegmentation的语法及示例。","methods":["post"],"schemes":["https"],"security":[{"AK":[]}],"deprecated":false,"systemTags":{"operationType":"none"},"parameters":[{"name":"ImageUrl","in":"formData","schema":{"description":"输入的图像URL。推荐使用上海地域的OSS链接，对于文件在本地或者非上海地域OSS链接的情况，请参见[文件URL处理](~~155645~~)。输入限制如下：\n- 图像格式：JPG、JPEG、PNG、BMP、WEBP。\n- 图像大小：不超过10 MB。\n- 输入图像：大于等于32x32像素，小于等于4096x4096像素。\n- URL地址中不能包含中文字符。","type":"string","required":true,"example":"http://viapi-test.oss-cn-shanghai.aliyuncs.com/viapi-3.0domepic/aigen/xxx01.png","isFileTransferUrl":true}},{"name":"ReturnFormat","in":"formData","schema":{"description":"输出图像格式。支持JPG、PNG，默认为PNG。","type":"string","required":false,"example":"PNG"}}],"responses":{"200":{"schema":{"title":"Schema of Response","description":"Schema of Response","type":"object","properties":{"RequestId":{"title":"Id of the request","description":"请求ID。","type":"string","example":"7574ee8f-38a3-4b1e-9280-11c33ab46e51"},"Data":{"description":"返回的结果数据内容。该数据需要在异步任务执行成功后，通过调用[GetAsyncJobResult](~~607824~~)接口，对其Result字段进行JSON反序列化之后得到。","type":"object","properties":{"ResultUrl":{"description":"存放结果的txt文件的地址，包含如下信息：\n- output.region_index：索引图像，取值范围0~255。\n- output.region_info：由所有分割结果组成的列表，每个分割结果中的`region`值就是对应的分割图像，有效分割区域可视化为白色（像素值255），其他区域可视化为黑色（像素值0），`index`值为该分割结果的对应的索引值。\n\n> 该URL地址为临时地址，有效期为30分钟，过期后将无法访问。若需要长时间或者永久保存文件，请在30分钟内访问URL地址，下载文件转存到自己的OSS或者其他存储空间。","type":"string","example":"https://dashscope-result-sh.oss-cn-shanghai.aliyuncs.com/viapi-video/interactive_seg_wanx/2024-02-21/6013dba4-2ce3-4f00-a2e7-14b8d22e81a5/20240221_120038993181_wcmohvxj9a.txt?Expires=1708574441&OSSAccessKeyId=LTAI5tQZd8AEcZX6KZV4****&Signature=GZuvrbw8F3GOv0ykq9al%2FFBdg8****"}}},"Message":{"description":"提交异步任务后的提示信息。","type":"string","example":"该调用为异步调用，任务已提交成功，请以requestId的值作为jobId参数调用同类目下GetAsyncJobResult接口查询任务执行状态和结果。"}}}}},"staticInfo":{"returnType":"synchronous"},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"RequestId\\\": \\\"7574ee8f-38a3-4b1e-9280-11c33ab46e51\\\",\\n  \\\"Data\\\": {\\n    \\\"ResultUrl\\\": \\\"https://dashscope-result-sh.oss-cn-shanghai.aliyuncs.com/viapi-video/interactive_seg_wanx/2024-02-21/6013dba4-2ce3-4f00-a2e7-14b8d22e81a5/20240221_120038993181_wcmohvxj9a.txt?Expires=1708574441&OSSAccessKeyId=LTAI5tQZd8AEcZX6KZV4****&Signature=GZuvrbw8F3GOv0ykq9al%2FFBdg8****\\\"\\n  },\\n  \\\"Message\\\": \\\"该调用为异步调用，任务已提交成功，请以requestId的值作为jobId参数调用同类目下GetAsyncJobResult接口查询任务执行状态和结果。\\\"\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<InteractiveFullSegmentationResponse>\\n    <RequestId>7574ee8f-38a3-4b1e-9280-11c33ab46e51</RequestId>\\n    <Message>该调用为异步调用，任务已提交成功，请以requestId的值作为jobId参数调用同类目下GetAsyncJobResult接口查询任务执行状态和结果。</Message>\\n</InteractiveFullSegmentationResponse>\",\"errorExample\":\"\"}]","title":"交互式全图分割","description":"## 功能描述\n交互式全图分割能力支持以单张图片作为输入，无需任何其他提示，即可返回图片中所有元素的分割结果。用户可以通过点击操作选择其中所需的元素，实现图片中分割元素的自由选择。\n关于该接口功能的示例图如下：\n\n- 输入原图\n![](https://img.alicdn.com/imgextra/i3/O1CN01lCAP981RoPdPWzKLg_!!6000000002158-0-tps-750-500.jpg\" width=\"500)\n- 全图分割\n![](https://img.alicdn.com/imgextra/i4/O1CN01Yva0je1jNXTkrGbO9_!!6000000004536-0-tps-750-500.jpg\" width=\"500)\n- 点选操作后的mask\n![](https://img.alicdn.com/imgextra/i2/O1CN015PLtdV1PV3fH2nxF9_!!6000000001845-0-tps-750-500.jpg\" width=\"500)\n- 分割结果\n![](https://img.alicdn.com/imgextra/i2/O1CN01GPJfUh1J6QfiuDwdc_!!6000000000979-2-tps-1000-667.png\" width=\"500)\n\n> - 您可以进入[在线咨询](https://www.aliyun.com/core/online-consult?from=aZgW6LJHr2)获取在线人工帮助。\n- 当前能力可在视觉智能开放平台有完整的免费产品体验，您可以单击[立即试用](https://vision.aliyun.com/experience/detail?tagName=aigen&children=InteractiveFullSegmentation)对该能力进行更直观试用以及在线购买。\n- 阿里云视觉智能开放平台视觉AI能力API接入、接口使用或问题咨询等，请通过钉钉群（23109592）加入阿里云视觉智能开放平台咨询群联系我们。\n\n## 应用场景\n图片编辑：可对图像中的任意涂抹元素进行选择并智能分离，实现图像后续的二次编辑。\n\n## 特色优势\n- 图片元素识别：根据涂抹区域的位置和大小，自动对涂抹目标进行识别和分割。\n- 自由开放选择：允许用户通过鼠标涂抹操作自由选择和排除所需的分割对象。\n- 适用多种场景：适用于人、动物、食物、物品、家居等各种抠图场景，使用范围广。\n\n## 接入指引\n1. 注册阿里云账号：打开[阿里云官网](https://www.aliyun.com)，在阿里云官网右上角，单击**立即注册**，按照操作提示完成账号注册。\n2. 开通能力：请确保您已开通创新专区服务，若未开通服务请[立即开通](https://common-buy.aliyun.com/?commodityCode=viapi_synthesis_public_cn)。\n3. 创建AccessKey：请确保您已[创建AccessKey](~~175144~~)，如果您使用的是子账号AccessKey，您需要给子账号赋予AliyunVIAPIFullAccess权限，具体操作，请参见[RAM授权](~~145025~~)。\n4. 在线调试（可选）：您可以通过[OpenAPI Explorer](https://next.api.aliyun.com/api/aigen/2024-01-11/InteractiveFullSegmentation)在线调试能力，查看完整的调用示例代码及SDK依赖信息，也可以下载完整的工程。\n5. 开发接入步骤：\n- 在[SDK总览](~~145033~~)中选择您要接入使用的SDK语言。\n- 在对应语言的SDK文档中找到AI类目为创新专区（aigen）的SDK包进行安装。\n- 参考文档中提供的示例代码进行适当修改后调用。\n\n6. 示例代码：该能力常用语言的示例代码，请参见[交互式全图分割示例代码](~~2699417~~)，常用语言查询异步任务结果的示例代码，请参见[查询异步任务结果示例代码](~~607974~~)。\n7. 客户端直接调用：该能力常用的客户端调用方式包括以下几种。\n- [Web前端直接调用](~~467779~~)\n- [小程序场景下直接调用](~~467780~~)\n- [Android端直接调用](~~467781~~)\n- [iOS端直接调用](~~467782~~)\n\n## 输入限制\n\n- 图像格式：JPG、JPEG、PNG、BMP、WEBP。\n- 图像大小：不超过10 MB。\n- 输入图像：大于等于32x32像素，小于等于4096x4096像素。\n- URL地址中不能包含中文字符。\n\n## 调用步骤\n该能力为异步能力，需分两步进行调用。\n第一步调用InteractiveFullSegmentation接口提交任务，请求成功后，得到一个任务ID。\n第二步调用[GetAsyncJobResult](~~607824~~)接口查询结果，根据任务ID查询任务执行状态和结果。如果任务还在处理中，可稍等一段时间后再进行查询。\n\n## 计费说明\n交互式全图分割能力目前处于公测期，可免费调用。","responseParamsDescription":"## 结果文件格式\n分割的结果会以JSON字符串的形式存储在输出的文本文件中，对应的图像会以Base64的结构存储在对应的Base64字段中。\n| 名称 | 类型 | 示例值 | 描述 |\n| --- | --- | --- | --- |\n| output.region_info | List | [{\"region\": \"data:image/png;base64,/9j/4AAQ........GBlPjwh//2Q==\", \"area\": 178579,\"index\": 1}, ...] | 所有输出mask的信息。region为mask的Base64编码，area为mask的面积, index为该mask的索引，index从1开始，0表示没有结果。 |\n| output.region_index | String | \"data:image/png;base64,/9j/4AAQSkZJR........GBlPjwh//2Q==\" | 所有mask index的整合，值为0~255，输出为Base64编码。 |\n| bbox     | Array of Integer     | [303,0,21,14]      | 包含mask的bounding box的坐标，按照XYWH的顺序。      |\n| crop_box     | Array of Integer     | [0,0,585,390]      | 预测mask时用到的image切片的坐标，按照XYWH的顺序。      |\n| point_coords     | Array of Integer     | [310.78125,12.1875]      | 生成mask对应的预测点坐标。      |\n| predicted_iou    | Float     | 0.9326171875      |  预测的置信度。     |\n| stability_score   | Float     | 0.9660193920135498      | mask质量的评估。      |\n| area     | Long     |  204     | mask所占的像素数，可以理解为面积。      |\n\n结果文件示例\n`{\n  \"output\":{\n    \"region_index\":\"<BASE64_CODE>\",\n    \"region_info\":[\n      {\n        \"area\":204,\n        \"bbox\":[303,0,21,14],\n        \"crop_box\":[0,0,585,390],\n        \"index\":1,\n        \"point_coords\":[\n          [310.78125,12.1875]\n        ],\n        \"predicted_iou\":0.9326171875,\n        \"region\":\"<BASE64_CODE>\",\n        \"stability_score\":0.9660193920135498\n      },\n      ... ...\n      ... ...\n      {\n        \"area\":1353,\n        \"bbox\":Array[4],\n        \"crop_box\":Array[4],\n        \"index\":10,\n        \"point_coords\":Array[1],\n        \"predicted_iou\":0.94873046875,\n        \"region\":\"<BASE64_CODE>\",\n        \"stability_score\":0.9708878993988037\n      },\n    ]\n  }\n}`\n返回值的可视化效果示例图如下：\n- 第一列为`output.region_index`的可视化结果，取值0~255，尺寸与原图一致，该返回值起索引作用，实际渲染时不会用到。\n- 第二列为`output.region_info`的部分mask的可视化结果示意，每个mask取值为0和255，尺寸与原图一致。`output.region_info`是由所有分割结果组成的列表，通过`output.region_index`与原图建立映射。\n\n![](https://img.alicdn.com/imgextra/i4/O1CN01FjYgjm1F5HEcololR_!!6000000000435-2-tps-1465-1036.png\" width=\"500)\n\n\n## 查询结果\n该接口为异步接口，当前并未返回真实的请求结果，您需要通过返回的RequestId调用GetAsyncJobResult接口来获取该接口的真实请求结果。详情请参见[GetAsyncJobResult](~~607824~~)。\n\n## SDK参考\n阿里云视觉AI创新专区类目下的交互式全图分割能力推荐使用SDK调用，支持多种编程语言，调用时请选择AI类目为创新专区（aigen）的SDK包，文件参数通过SDK调用可支持本地文件及任意URL，具体可参见[SDK总览](~~145033~~)。\n\n## 示例代码\n该能力常用语言的示例代码，请参见[交互式全图分割示例代码](~~2699417~~)。","extraInfo":"## 错误码\n关于交互式全图分割的错误码，具体请参见[常见错误码](~~2699435~~)。\n\n## 安全声明\n- 请确保上传的图片或文件来源符合相应的法律法规。\n- 通过体验调试上传的临时文件有效期为1小时，在24小时后会被系统自动清理删除。"}