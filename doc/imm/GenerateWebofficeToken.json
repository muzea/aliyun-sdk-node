{"summary":"获取Weboffice访问凭证。Weboffice提供文档的在线协作功能，包括文档预览、文档编辑，多人协作等，支持协作记录，支持多版本，支持版本回滚等。","methods":["get","post"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"write","deprecated":false,"systemTags":{"operationType":"none","abilityTreeCode":"161499","abilityTreeNodes":["FEATUREimm4TQO1Z"]},"parameters":[{"name":"ProjectName","in":"query","schema":{"title":"项目名称","description":"项目名称，获取方式请参见[创建项目](~~478153~~)。","type":"string","required":true,"example":"test-project"}},{"name":"SourceURI","in":"query","schema":{"title":"预览编辑地址","description":"待预览或编辑文档的OSS地址。\n\nOSS地址规则为`oss://${Bucket}/${Object}`，其中`Bucket`为和当前项目处于同一地域的OSS Bucket名称，`Object`为包含文件扩展名的文件完整路径。","type":"string","required":true,"example":"oss://test-bucket/test-object.docx"}},{"name":"Filename","in":"query","schema":{"title":"文件名，必须带文件名后缀，默认是 SourceUri 的最后一级","description":"文件名称，必须包含文件扩展名。默认为参数**SourceURI**的最后一级。\n\n支持的文件扩展名（其中PDF只支持预览）：\n\n- 文字文档（Word）：doc、docx、txt、dot、wps、wpt、dotx、docm、dotm、rtf\n- 演示文档（PPT）：ppt、pptx、pptm、ppsx、ppsm、pps、potx、potm、dpt、dps\n- 表格文档（Excel）：et、xls、xlt、xlsx、xlsm、xltx、xltm、csv\n- PDF 文档：pdf","type":"string","required":false,"example":"test-Object.pptx"}},{"name":"CachePreview","in":"query","schema":{"title":"缓存预览标识","description":"缓存预览标识：\n\n-  true：开启后，文档预览时将不再更新协同编辑内容，适用于仅预览的场景。\n-  false：关闭时，默认采用协同预览，及预览时候可以同步更新协同编辑内容。\n\n><notice>缓存预览和非缓存预览的单价不同，详情请查看计费项说明。></notice>","type":"boolean","required":false,"example":"true、false"}},{"name":"Referer","in":"query","schema":{"title":"oss 防盗链 referer","description":"OSS防盗链。IMM需要从OSS中获取源文件，如果OSS进行了防盗链设置，IMM需要将对应的头部传给OSS才能获取源文件。\n> 如果访问文档所在的Bucket设置了Referer，请设置此参数。","type":"string","required":false,"example":"*"}},{"name":"UserData","in":"query","schema":{"title":"用户自定义数据，在消息通知中返回","description":"用户自定义信息，必须填写Notification参数传入MNS配置时才能生效，在异步消息通知中会为您返回，用于方便您系统内对消息通知进行关联处理。最大长度为2048字节。","type":"string","required":false,"example":"{\n      \"id\": \"test-id\",\n      \"name\": \"test-name\"\n}"}},{"name":"PreviewPages","in":"query","schema":{"title":"预览前几页","description":"限制只能预览前几页，默认不限制。最大不能超过5000","type":"integer","format":"int64","required":false,"example":"5"}},{"name":"Password","in":"query","schema":{"title":"文件密码","description":"文档的打开密码。\n>如果需要预览或编辑有密码的文档，请设置此参数。","type":"string","required":false,"example":"123456"}},{"name":"ExternalUploaded","in":"query","schema":{"title":"是否支持外部上传","description":"是否支持直接上传文档到OSS。可取值如下：\n\n- true：支持，上传的文档将覆盖原文档生成新版本。在开启后，仍需先关闭当前正在编辑的文档，然后等待约5分钟后重新打开，才能加载新的文档。仅当文档处于关闭状态时才可上传，文档处于打开状态时，新的保存会覆盖掉上传的文件。\n- false（默认）：不支持，上传文档是非预期行为，会返回错误。","type":"boolean","required":false,"example":"false"}},{"name":"NotifyTopicName","in":"query","schema":{"title":"mns 消息通知 topic","description":"支持将一些事件以 MNS 消息的方式通知给客户。该参数为 MNS 异步消息通知的 topic。","type":"string","required":false,"example":"test-topic"}},{"name":"Hidecmb","in":"query","schema":{"title":"隐藏工具栏，预览模式下使用","description":"是否隐藏工具栏，文档预览模式下支持设置此参数。可取值如下：\n\n- false（默认）：不隐藏工具栏。\n\n- true：隐藏工具栏。","type":"boolean","required":false,"example":"false"}},{"name":"Permission","in":"query","style":"json","schema":{"title":"权限","description":"用户权限信息，以JSON格式表示。\n\n用户权限包括如下选项：\n\n每个选项的类型均为Boolean，默认值均为false，可选值为true和false。\n\n- Readonly（可选）：预览模式。\n\n- Rename（可选）：重命名文件权限，只提供消息通知功能，重命名事件会发送到MNS中。\n\n- History（可选）：查看历史版本的权限。\n\n- Copy（可选）：拷贝权限。\n\n- Export（可选）：导出PDF权限。\n\n- Print（可选）：打印权限。\n\n\n>PDF仅支持预览功能，因此必须将” Readonly“参数设置为true。\n>\n\n> 若要使用多版本功能，必须先在OSS中开通多版本功能，然后将 ”History“参数设置为true。\n>","required":false,"$ref":"#/components/schemas/WebofficePermission"}},{"name":"User","in":"query","style":"json","schema":{"title":"用户","description":"用户信息。可以传业务的用户信息，WebOffice页面会进行显示，如无特殊要求可填入\"Unknown\"。如果不传入此字段，用户信息会默认显示为“Unknown”。","required":false,"$ref":"#/components/schemas/WebofficeUser"}},{"name":"Watermark","in":"query","style":"json","schema":{"title":"水印","description":"水印信息。该水印在前端生成，并没有写入到源文档中，同一个文档传入不同的参数会得到不同的水印。","required":false,"$ref":"#/components/schemas/WebofficeWatermark"}},{"name":"CredentialConfig","in":"query","style":"json","schema":{"description":"链式授权配置，非必填。更多信息，请参见[使用链式授权访问其他实体资源](~~465340~~)。","required":false,"$ref":"#/components/schemas/CredentialConfig"}},{"name":"Notification","in":"query","style":"json","schema":{"description":"Notification 消息通知配置，目前仅支持MNS，异步通知消息格式请参考[WebOffice消息通知格式](https://help.aliyun.com/zh/imm/developer-reference/weboffice-notification-message-examples?spm=a2c4g.11186623.0.0.7ee46295bRAbGt)。\n\n> 文件保存和文件重命名时会有消息通知。","required":false,"$ref":"#/components/schemas/Notification"}}],"responses":{"200":{"schema":{"title":"文档转换任务","description":"Weboffice 访问凭证。","type":"object","properties":{"RequestId":{"title":"请求 id","description":"请求ID。","type":"string","example":"1759315A-CB33-0A75-A72B-62D7********"},"WebofficeURL":{"title":"预览编辑地址","description":"Weboffice 入口 URL。在线预览或者编辑文档。\n> 无法通过浏览器直接打开，需要配合Weboffice JS-SDK，和访问凭证（AccessToken）一起才可以预览或编辑文档。更多信息，请参见[快速入门](~~468066~~)。","type":"string","example":"https://office-cn-shanghai.imm.aliyuncs.com/office/s/dd221b2cdb44fb66e9070d1d70a8b9bbb6d6fff7?_w_tokentype=1"},"AccessToken":{"title":"access token","description":"Weboffice 访问凭证。","type":"string","example":"2d73dd5d87524c5e8a194c3eb5********"},"RefreshToken":{"title":"refresh token","description":"Weboffice 刷新凭证。","type":"string","example":"e374995ec532432bb678074d36********"},"AccessTokenExpiredTime":{"title":"access token 过期时间","description":"访问凭证的过期时间。过期时间30分钟。","type":"string","example":"2021-08-30T13:13:11.347146982Z"},"RefreshTokenExpiredTime":{"title":"refresh token 过期时间","description":"刷新凭证的过期时间。过期时间 1 天。","type":"string","example":"2021-08-31T12:43:11.347146982Z"}}}},"500":{}},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"RequestId\\\": \\\"1759315A-CB33-0A75-A72B-62D7********\\\",\\n  \\\"WebofficeURL\\\": \\\"https://office-cn-shanghai.imm.aliyuncs.com/office/s/dd221b2cdb44fb66e9070d1d70a8b9bbb6d6fff7?_w_tokentype=1\\\",\\n  \\\"AccessToken\\\": \\\"2d73dd5d87524c5e8a194c3eb5********\\\",\\n  \\\"RefreshToken\\\": \\\"e374995ec532432bb678074d36********\\\",\\n  \\\"AccessTokenExpiredTime\\\": \\\"2021-08-30T13:13:11.347146982Z\\\",\\n  \\\"RefreshTokenExpiredTime\\\": \\\"2021-08-31T12:43:11.347146982Z\\\"\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"\",\"errorExample\":\"\"}]","title":"获取Weboffice凭证","description":"- **请确保在使用该接口前，已充分了解智能媒体管理产品的收费方式和[价格](~~477042~~)**。\n\n- 访问凭证过期时间为30分钟，刷新凭证过期时间为1天。\n- 返回的过期时间为UTC时间，和北京时间有8小时的时差。\n- 支持的输入文件格式：\n    - 文字文档（Word）：doc、docx、txt、dot、wps、wpt、dotx、docm、dotm、rtf。\n    - 演示文档（PPT）：ppt、pptx、pptm、ppsx、ppsm、pps、potx、potm、dpt、dps。\n    - 表格文档（Excel）：et、xls、xlt、xlsx、xlsm、xltx、xltm、csv\n    - PDF 文档：pdf。\n- 支持最大的文件200MB。\n- 支持最大的文档页数 5000 页。\n- 2023-12-01之前创建的项目，按照文档打开次数计费。当前按照API接口调用次数计费。如需切换成新的计费模式，创建新的项目即可，但需要注意，一次API调用只能给一个用户使用，若重复使用，则只有最后一个用户可以正常访问，其余用户的访问权限将被回收。\n\n- 在与智能媒体管理相同的地域下开通MNS服务，创建主题和队列，并配置订阅关系，可以通过NotifyTopicName参数传入MNS主题名称来接收文件保存的消息通知。关于MNS SDK的更多信息，请参见[接收和删除消息](~~32449~~)。\n文件保存消息通知Message字段JSON格式示例请参考[WebOffice消息通知格式](https://help.aliyun.com/zh/imm/developer-reference/weboffice-notification-message-examples?spm=a2c4g.11186623.0.0.7ee46295bRAbGt)。\n\n\n>PDF仅支持预览功能，因此必须将” Readonly“参数设置为true。\n>\n\n> 若要使用多版本功能，必须先在OSS中开通多版本功能，然后将 ”History“参数设置为true。\n>","responseParamsDescription":"**常见错误**\n\nProjectName对应的项目未找到，请到新版本IMM控制台检查地域下该项目是否存在。\n```\n{\n    \"Code\": \"ResourceNotFound\",\n    \"Message\": \"The specified resource acs:imm::xxx:project/xxx is not found\"\n}\n```\n\nUser参数是必填参数，请检查该参数是否填写。\n```\n{\n    \"Code\": \"InvalidArgument.User\",\n    \"Message\": \"The parameter User is required but not provided\"\n}\n```\n\nUser参数不正确，请检查该参数值是否是正确的JSON格式。\n```\n{\n    \"Code\": \"InvalidJSON parsing error, User\",\n    \"Message\": \"Specified parameter JSON parsing error, User is not valid.\"\n}\n```\n\nPermission参数不正确，请检查该参数值是否是正确的JSON格式。\n```\n{\n    \"Code\": \"InvalidJSON parsing error, Permission\",\n    \"Message\": \"Specified parameter JSON parsing error, Permission is not valid.\"\n}\n```\n\nWatermark参数不正确，请检查该参数值是否是正确的JSON格式。\n```\n{\n    \"Code\": \"InvalidJSON parsing error, Watermark\",\n    \"Message\": \"Specified parameter JSON parsing error, Watermark is not valid.\"\n}\n```\n\nPreviewPages参数格式不正确，请检查PreviewPages参数值。\n``` \n{\n    \"Code\": \"InvalidPreviewPages\",\n    \"Message\": \"Specified parameter PreviewPages is not valid.\"\n}\n```\n\nSourceURI对应的OSS文件不存在，请检查Bucket下该文件是否存在。\n```\n{\n    \"Code\": \"ResourceNotFound\",\n    \"Message\": \"The specified resource oss://xx is not found\"\n}\n```","extraInfo":"###  相关文档   \n  - 关于OSS多版本的介绍，请参见[OSS版本控制概述](https://help.aliyun.com/zh/oss/user-guide/overview-78?spm=a2c4g.11186623.0.0.29d91d94zxAKSU)"}