{"path":"/pop/v1/sam/scale/applicationScalingRule","methods":["post"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"write","deprecated":false,"systemTags":{"operationType":"create","abilityTreeCode":"6304","abilityTreeNodes":["FEATUREsae5HLO11"]},"parameters":[{"name":"AppId","in":"query","schema":{"description":"应用ID。","type":"string","required":true,"example":"7171a6ca-d1cd-4928-8642-7d5cfe69****"}},{"name":"ScalingRuleName","in":"query","schema":{"description":"自定义的弹性伸缩策略名。应用内，策略名称不可重复，必须以小写字母开头，仅可包含小写字母、数字及短划线（-），不超过32个字符。\n> 弹性伸缩策略创建成功后，不可修改策略名。","type":"string","required":true,"example":"timer-0800-2100"}},{"name":"ScalingRuleType","in":"query","schema":{"description":"弹性伸缩策略类型。取值说明如下：\n\n- **timing**：定时弹性。\n- **metric**：监控指标弹性。","type":"string","required":true,"example":"timing"}},{"name":"ScalingRuleTimer","in":"query","schema":{"description":"定时弹性策略的配置。当您选择定时弹性策略或使用SDK设置时，该参数必选。\n\n参数说明如下：\n- **beginDate**和**endDate**：**beginDate**为起始日期，**endDate**为结束日期，用于配置定时弹性伸缩策略的时间。取值说明如下：\n\n    - 当取值均为**null**时，表示长期执行，为默认值。\n    - 当取值为具体日期时，例如**beginDate**为**2021-03-25**，**endDate**为**2021-04-25**，表示执行有效期为1个月。\n\n- **period**：执行定时弹性伸缩策略的周期。取值说明如下：\n    - **\\* \\* \\***：每天指定时间执行定时策略。\n    - **\\* \\* Fri,Mon**：每周指定天数的指定时间执行定时策略，支持多选，GMT+8时区。取值说明如下： \n        - **Sun**：星期日\n        - **Mon**：星期一\n        - **Tue**：星期二\n        - **Wed**：星期三\n        - **Thu**：星期四\n        - **Fri**：星期五\n        - **Sat**：星期六\n    - **1,2,3,28,31 \\* \\***：每月指定日期的指定时间执行定时策略，支持多选。取值范围\\[1,31\\]。若当月无31日，则跳过该日期执行定时策略。\n- **schedules**：弹性伸缩策略触发的时间，以及该时间段内需要保持的应用实例数。最多支持20个时间点。参数说明如下：\n    - **atTime**：触发时间点。支持格式**时:分**，例如**08:00**。\n    - **targetReplicas**：该参数可以指定应用的实例数，也可以是每次部署最小存活的实例数。取值范围\\[1,50\\]。\n        > 每次滚动部署最小存活的实例数建议大于等于**1**，保证业务不中断。如果设置为**0**，应用在升级过程中将会中断业务。","type":"string","required":false,"example":"{\"beginDate\":null,\"endDate\":null,\"period\":\"* * *\",\"schedules\":[{\"atTime\":\"08:00\",\"targetReplicas\":10},{\"atTime\":\"20:00\",\"targetReplicas\":3}]}"}},{"name":"ScalingRuleMetric","in":"query","schema":{"description":"监控指标弹性策略的配置。当您选择监控指标弹性策略设置时，该参数必选。\n\n参数说明如下：\n\n- **maxReplicas**：应用最大实例数。\n- **minReplicas**：应用最小实例数。\n- **metricType**：监控指标触发条件。\n    - **CPU**：CPU使用率。\n    - **MEMORY**：内存使用率。\n    - **QPS**：JAVA应用1分钟内单个实例的平均QPS。\n    - **RT**：JAVA应用1分钟内应用所有服务接口平均RT值。\n    - **tcpActiveConn**：30秒内单个实例的平均TCP活跃连接数。\n    - **SLB\\_QPS**：15秒内单个实例的平均公网SLB QPS。\n    - **SLB\\_RT**：15秒内公网SLB平均响应时间。\n    - **INTRANET\\_SLB\\_QPS**：15秒内单个实例的平均私网SLB QPS。\n    - **INTRANET\\_SLB\\_RT**：15秒内私网SLB平均响应时间。\n- **metricTargetAverageUtilization**：根据不同的**metricType**，设置对应的监控指标的目标值。\n    - CPU使用率目标值，单位为百分比。\n    - 内存使用率目标值，单位为百分比。\n    - QPS，单位为秒。\n    - 响应时间，单位为毫秒。\n    - TCP活跃连接数平均值，单位为个/秒。\n    - 公网SLB QPS，单位为秒。\n    - 公网SLB响应时间，单位为毫秒。\n    - 私网SLB QPS，单位为秒。\n    - 私网SLB响应时间，单位为毫秒。\n- **slbId**：SLB ID。\n- **slbProject**：日志服务Project。\n- **slbLogstore**：日志服务Logstore。\n- **vport**：SLB监听端口，支持HTTP协议和HTTPS协议。\n- **scaleUpRules**：应用扩容规则。\n- **scaleDownRules**：应用缩容规则。\n- **step**：弹性扩容或缩容步长。单位时间内最多扩容或缩容的实例数。\n- **disabled**：是否禁止缩容。开启后将永远不会缩容该应用的实例，能有效防止在流量高峰期缩容造成业务风险。\n    - **true**：开启。\n    - **false**：关闭。默认值。\n- **stabilizationWindowSeconds**：扩容或缩容的冷却时间。取值范围\\[0, 3600\\]，单位为秒。默认为0秒。\n\n> 您可以选择设置一个或多个监控指标。当设置多个监控指标时，只要任何一个指标大于或者等于目标值，则应用进行扩容，扩容后实例数不高于应用最大实例数；如果所有指标均小于目标值，则应用进行缩容，缩容后实例数不低于应用最小实例数。","type":"string","required":false,"example":"{\"maxReplicas\":3,\"minReplicas\":1,\"metrics\":[{\"metricType\":\"CPU\",\"metricTargetAverageUtilization\":20},{\"metricType\":\"MEMORY\",\"metricTargetAverageUtilization\":30},{\"metricType\":\"tcpActiveConn\",\"metricTargetAverageUtilization\":20},{\"metricType\":\"SLB_QPS\",\"MetricTargetAverageUtilization\":25,\"slbId\":\"lb-xxx\",\"slbProject\":\"aliyun-fc-cn-hangzhou-d95881d9-5d3c-5f26-a6b8-************\",\"slbLogstore\":\"function-log\",\"vport\":\"80\"},{\"metricType\":\"SLB_RT\",\"MetricTargetAverageUtilization\":35,\"slbId\":\"lb-xxx\",\"slbProject\":\"aliyun-fc-cn-hangzhou-d95881d9-5d3c-5f26-a6b8-************\",\"slbLogstore\":\"function-log\",\"vport\":\"80\"}],\"scaleUpRules\":{\"step\":\"100\",\"disabled\":false,\"stabilizationWindowSeconds\":0},\"scaleDownRules\":{\"step\":\"100\",\"disabled\":false,\"stabilizationWindowSeconds\":300}}"}},{"name":"MinReadyInstances","in":"query","schema":{"description":"最小存活实例数。取值说明如下：\n\n- 如果设置为**0**，应用在升级过程中将会中断业务。\n- 如果设置为**-1**，最小存活实例数将使用系统推荐值，即取现有实例数的25%。如果当前为5个实例，5×25%=1.25，向上取整后，最小存活实例数为2。\n\n> 每次滚动部署最小存活的实例数建议≥1，保证业务不中断。","type":"integer","format":"int32","required":false,"example":"3"}},{"name":"MinReadyInstanceRatio","in":"query","schema":{"description":"最小存活实例数百分比。取值说明如下：\n\n- **-1**：初始化值，表示不采用百分比。\n- **0~100**：单位为百分比，向上取整。例如设置为50%，如果当前为5个实例，则最小存活实例数为3。\n\n> 当**MinReadyInstance**和**MinReadyInstanceRatio**同时传递时，且**MinReadyInstanceRatio**的取值非**-1**时，以**MinReadyInstanceRatio**参数为准。假设**MinReadyInstances**取值为**5**，**MinReadyInstanceRatio**取值为**50**，则会用**50**来计算最小存活实例数。","type":"integer","format":"int32","required":false,"example":"-1"}},{"name":"ScalingRuleEnable","in":"query","schema":{"description":"是否启用弹性伸缩策略。取值说明如下：\n\n- **true**：启用状态。\n- **false**：禁用状态。","type":"boolean","required":false,"example":"true"}}],"responses":{"200":{"headers":{},"schema":{"description":"返回信息。","type":"object","properties":{"RequestId":{"description":"请求ID。","type":"string","example":"91F93257-7A4A-4BD3-9A7E-2F6EAE6D****"},"TraceId":{"description":"调用链ID，用于精确查询调用信息。","type":"string","example":"0a98a02315955564772843261e****"},"Data":{"description":"返回结果。","type":"object","properties":{"Timer":{"description":"定时弹性伸缩。","type":"object","properties":{"EndDate":{"description":"定时弹性伸缩策略的短期结束日期。\n\n- 当**BeginDate**和**EndDate**取值均为**null**时，表示长期执行，为默认值。\n- 当取值为具体日期时，例如**BeginDate**为2021-03-25，**EndDate**为2021-04-25，表示执行有效期为1个月。","type":"string","example":"2021-04-25"},"BeginDate":{"description":"定时弹性伸缩策略的短期起始日期。\n\n- 当**BeginDate**和**EndDate**取值均为**null**时，表示长期执行，为默认值。\n- 当取值为具体日期时，例如**BeginDate**为2021-03-25，**EndDate**为2021-04-25，表示执行有效期为1个月。\n","type":"string","example":"2021-03-25"},"Schedules":{"description":"单天内触发时间点。","type":"array","items":{"description":"时间点数据。","type":"object","properties":{"AtTime":{"description":"时间点。格式：**时:分**。","type":"string","example":"08:00"},"TargetReplicas":{"description":"目标实例数。","type":"integer","format":"int32","example":"3"},"MaxReplicas":{"description":"最大实例数。","type":"integer","format":"int32","example":"10"},"MinReplicas":{"description":"最小实例数。","type":"integer","format":"int32","example":"5"}}}},"Period":{"description":"执行定时弹性伸缩策略的周期。取值说明如下：\n\n- **\\* \\* \\***：每天指定时间执行定时策略。\n- **\\* \\* Fri,Mon**：每周指定天数的指定时间执行定时策略，支持多选，GMT+8时区。取值说明如下： \n\n    - **Sun**：星期日\n    - **Mon**：星期一\n    - **Tue**：星期二\n    - **Wed**：星期三\n    - **Thu**：星期四\n    - **Fri**：星期五\n    - **Sat**：星期六\n- **1,2,3,28,31 \\* \\***：每月指定日期的指定时间执行定时策略，支持多选。取值范围\\[1,31\\]。若当月无31日，则跳过该日期执行定时策略。","type":"string","example":"* * *"}}},"UpdateTime":{"description":"弹性伸缩策略的更新时间。单位：毫秒。","type":"integer","format":"int64","example":"1616642248938"},"AppId":{"description":"应用ID。","type":"string","example":"7171a6ca-d1cd-4928-8642-7d5cfe69****"},"CreateTime":{"description":"弹性伸缩策略的创建时间。单位：毫秒。","type":"integer","format":"int64","example":"1616642248938"},"LastDisableTime":{"description":"最近一次禁用弹性伸缩策略的时间。","type":"integer","format":"int64","example":"1641882854484"},"ScaleRuleEnabled":{"description":"是否启用弹性伸缩策略。取值说明如下：\n\n- **true**：启用状态。\n- **false**：禁用状态。","type":"boolean","example":"true"},"ScaleRuleType":{"description":"弹性伸缩策略类型。取值说明如下：\n\n- **timing**：定时弹性。\n- **metric**：监控指标弹性。\n- **mix**：混合弹性。","type":"string","example":"timing"},"Metric":{"description":"监控指标弹性伸缩。","type":"object","properties":{"Metrics":{"description":"监控指标弹性伸缩列表。","type":"array","items":{"description":"监控指标数据。","type":"object","properties":{"MetricTargetAverageUtilization":{"description":"监控指标的目标值。\n\n- CPU使用率目标值，单位为百分比。\n- 内存使用率目标值，单位为百分比。\n- QPS，单位为秒。\n- 响应时间，单位为毫秒。\n- TCP活跃连接数平均值，单位为个/秒。\n- 公网SLB QPS，单位为秒。\n- 公网SLB响应时间，单位为毫秒。\n- 私网SLB QPS，单位为秒。\n- 私网SLB响应时间，单位为毫秒。","type":"integer","format":"int32","example":"20"},"MetricType":{"description":"监控指标触发条件。取值说明如下：\n\n- **CPU**：CPU使用率。\n- **MEMORY**：内存使用率。\n- **QPS**：JAVA应用1分钟内单个实例的平均QPS。\n- **RT**：JAVA应用1分钟内应用所有服务接口平均RT值。\n- **tcpActiveConn**：30秒内单个实例的平均TCP活跃连接数。\n- **SLB\\_QPS**：15秒内单个实例的平均公网SLB QPS。\n- **SLB\\_RT**：15秒内公网SLB平均响应时间。\n- **INTRANET\\_SLB\\_QPS**：15秒内单个实例的平均私网SLB QPS。\n- **INTRANET\\_SLB\\_RT**：15秒内私网SLB平均响应时间。","type":"string","example":"CPU"},"SlbProject":{"description":"SLB访问日志Project。","type":"string","example":"test"},"SlbLogstore":{"description":"SLB访问日志Logstore。","type":"string","example":"test"},"Vport":{"description":"SLB端口。","type":"string","example":"80"},"SlbId":{"description":"SLB实例ID。","type":"string","example":"lb-xxx"}}}},"MaxReplicas":{"description":"最大实例数。","type":"integer","format":"int32","example":"3"},"MinReplicas":{"description":"最小实例数。","type":"integer","format":"int32","example":"1"}}},"ScaleRuleName":{"description":"弹性伸缩策略的名称。","type":"string","example":"test"}}},"Message":{"description":"附加信息。取值说明如下：\n\n- 请求正常，返回**success**。\n- 请求异常，返回具体异常错误码。","type":"string","example":"success"},"ErrorCode":{"description":"错误码。取值说明如下：\n\n- 请求成功：不返回**ErrorCode**字段。\n- 请求失败：返回**ErrorCode**字段。具体信息，请参见本文的**错误码**列表。","type":"string","example":"空"},"Code":{"description":"接口状态或POP错误码。取值说明如下：\n\n- **2xx**：成功。\n- **3xx**：重定向。\n- **4xx**：请求错误。\n- **5xx**：服务器错误。","type":"string","example":"200"},"Success":{"description":"重启应用实例是否成功。取值说明如下：\n\n- **true**：重启成功。\n- **false**：重启失败。","type":"boolean","example":"true"}}}}},"errorCodes":{"400":[{"errorCode":"InstanceExist.ScalingRuleName","errorMessage":"The specified ScalingRuleName already exists."},{"errorCode":"InvalidScalingRuleDate.BeginAfterEnd","errorMessage":"The specified beginning time is later than the ending time."},{"errorCode":"InvalidScalingRuleDate.Format","errorMessage":"The specified date is invalid."},{"errorCode":"InvalidScalingRuleName.NotFound","errorMessage":"The specified ScalingRuleName does not exist."},{"errorCode":"InvalidScalingRuleTime.Conflict","errorMessage":"The specified scaling rule time is invalid. Another schedule has been set for the specified time range. Please set a different time."},{"errorCode":"InvalidScalingRuleTime.Format","errorMessage":"The specified time is invalid."},{"errorCode":"QuotaExceeded.ScalingRule","errorMessage":"The maximum number of application scaling rules is exceeded."},{"errorCode":"QuotaExceeded.ScalingRuleTime","errorMessage":"The maximum number of scaling policy trigger time is exceeded."},{"errorCode":"NoComputeResourceQuota.App.Exceed","errorMessage":"You can create %s instances for each application.  Please submit a ticket to raise the quota."},{"errorCode":"NoComputeResourceQuota.Exceed","errorMessage":"Your compute resource is insufficient. Please contact us to raise the quota."},{"errorCode":"NoComputeResourceQuota.User.Exceed","errorMessage":"Your account is limited to create %s instances.  Please submit a ticket to raise the quota."},{"errorCode":"System.Upgrading","errorMessage":"The system is being upgraded. Please try again later."},{"errorCode":"OperationDenied.SDKNotSupported","errorMessage":"Metrics is not supported in SDK"},{"errorCode":"MinReadyInstances.Not.Smaller.Replicas","errorMessage":"The minimum number of available instances must be less than the number of application instances."},{"errorCode":"MinReadyInstanceRatio.Invalid","errorMessage":"The ratio of minimum available instances must be between 0 and 100."}]},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"RequestId\\\": \\\"91F93257-7A4A-4BD3-9A7E-2F6EAE6D****\\\",\\n  \\\"TraceId\\\": \\\"0a98a02315955564772843261e****\\\",\\n  \\\"Data\\\": {\\n    \\\"Timer\\\": {\\n      \\\"EndDate\\\": \\\"2021-04-25\\\",\\n      \\\"BeginDate\\\": \\\"2021-03-25\\\",\\n      \\\"Schedules\\\": [\\n        {\\n          \\\"AtTime\\\": \\\"08:00\\\",\\n          \\\"TargetReplicas\\\": 3,\\n          \\\"MaxReplicas\\\": 10,\\n          \\\"MinReplicas\\\": 5\\n        }\\n      ],\\n      \\\"Period\\\": \\\"* * *\\\"\\n    },\\n    \\\"UpdateTime\\\": 1616642248938,\\n    \\\"AppId\\\": \\\"7171a6ca-d1cd-4928-8642-7d5cfe69****\\\",\\n    \\\"CreateTime\\\": 1616642248938,\\n    \\\"LastDisableTime\\\": 1641882854484,\\n    \\\"ScaleRuleEnabled\\\": true,\\n    \\\"ScaleRuleType\\\": \\\"timing\\\",\\n    \\\"Metric\\\": {\\n      \\\"Metrics\\\": [\\n        {\\n          \\\"MetricTargetAverageUtilization\\\": 20,\\n          \\\"MetricType\\\": \\\"CPU\\\",\\n          \\\"SlbProject\\\": \\\"test\\\",\\n          \\\"SlbLogstore\\\": \\\"test\\\",\\n          \\\"Vport\\\": \\\"80\\\",\\n          \\\"SlbId\\\": \\\"lb-xxx\\\"\\n        }\\n      ],\\n      \\\"MaxReplicas\\\": 3,\\n      \\\"MinReplicas\\\": 1\\n    },\\n    \\\"ScaleRuleName\\\": \\\"test\\\"\\n  },\\n  \\\"Message\\\": \\\"success\\\",\\n  \\\"ErrorCode\\\": \\\"空\\\",\\n  \\\"Code\\\": \\\"200\\\",\\n  \\\"Success\\\": true\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<CreateApplicationScalingRuleResponse>\\n    <RequestId>91F93257-7A4A-4BD3-9A7E-2F6EAE6D****</RequestId>\\n    <TraceId>0a98a02315955564772843261e****</TraceId>\\n    <Data>\\n        <Timer>\\n            <EndDate>2021-04-25</EndDate>\\n            <BeginDate>2021-03-25</BeginDate>\\n            <Schedules>\\n                <AtTime>08:00</AtTime>\\n                <TargetReplicas>3</TargetReplicas>\\n                <MaxReplicas>10</MaxReplicas>\\n                <MinReplicas>5</MinReplicas>\\n            </Schedules>\\n            <Period>* * *</Period>\\n        </Timer>\\n        <UpdateTime>1616642248938</UpdateTime>\\n        <AppId>7171a6ca-d1cd-4928-8642-7d5cfe69****</AppId>\\n        <CreateTime>1616642248938</CreateTime>\\n        <LastDisableTime>1641882854484</LastDisableTime>\\n        <ScaleRuleEnabled>true</ScaleRuleEnabled>\\n        <ScaleRuleType>timing</ScaleRuleType>\\n        <Metric>\\n            <Metrics>\\n                <MetricTargetAverageUtilization>20</MetricTargetAverageUtilization>\\n                <MetricType>CPU</MetricType>\\n                <SlbProject>test</SlbProject>\\n                <SlbLogstore>test</SlbLogstore>\\n                <Vport>80</Vport>\\n                <SlbId>lb-xxx</SlbId>\\n            </Metrics>\\n            <MaxReplicas>3</MaxReplicas>\\n            <MinReplicas>1</MinReplicas>\\n        </Metric>\\n        <ScaleRuleName>test</ScaleRuleName>\\n    </Data>\\n    <Message>success</Message>\\n    <Code>200</Code>\\n    <Success>true</Success>\\n</CreateApplicationScalingRuleResponse>\",\"errorExample\":\"\"}]","title":"CreateApplicationScalingRule","summary":"创建应用弹性伸缩策略。","description":"## 使用须知\n- 您最多可以为1个应用创建5条弹性策略。\n- 您最多可以为1条定时弹性策略，创建20条单天内触发时间点。\n- 弹性策略启用时，请勿手动执行应用生命周期管理操作，例如应用扩缩容、部署应用、更改规格、重启应用或停止应用。如果您需要对应用执行该类操作，请停用弹性策略后，再手动执行操作。\n- 如果当前应用处于扩容、缩容、部署（单批、分批或灰度）、更改规格、重启或停止等过程中，该应用暂时无法添加或者启动弹性策略。\n- 如果单个应用需要弹出超过50个实例，请联系SAE技术支持并申请白名单。更多信息，请参见[联系我们](~~146530~~)。"}