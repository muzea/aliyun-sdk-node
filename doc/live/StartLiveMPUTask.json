{"methods":["post","get"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"readAndWrite","deprecated":false,"systemTags":{"operationType":"create","abilityTreeCode":"178410","abilityTreeNodes":["FEATUREliveK6LRQR"]},"parameters":[{"name":"AppId","in":"query","schema":{"description":"应用ID，仅支持传单个ID。由大小写字母、数字、下划线、短划线（-）组成，最大64字符。","type":"string","required":true,"example":"yourAppId"}},{"name":"ChannelId","in":"query","schema":{"description":"频道ID，仅支持传单个ID。由大小写字母、数字、下划线、短划线（-）组成，最大64字符。","type":"string","required":true,"example":"yourChannelId"}},{"name":"TaskId","in":"query","schema":{"description":"任务ID，仅支持传单个ID。由大小写字母、数字、下划线、短划线（-）组成，最大55字符。此ID为旁路转推的标识，需保证唯一。","type":"string","required":true,"example":"yourTaskId"}},{"name":"MixMode","in":"query","schema":{"description":"混流模式。取值：\n- **0**：单路转推，不混流转码，仅转推原始单路流，无需配置混流转码参数。\n- **1（默认值）**：混流转码转推。","type":"string","required":true,"example":"0"}},{"name":"StreamURL","in":"query","schema":{"description":"直播推流地址，仅支持RTMP协议，仅支持传单个地址，最大长度不超过2048个字符。生成规则请参见[推流地址和播放地址](~~199339~~)。\n\n>- 对已开防盗链鉴权的域名，需要在推流地址中包含鉴权串。\n- 禁止同一个StreamURL在不同任务中同时使用。\n- 任务停止10S之内，禁止使用同一个StreamURL。","type":"string","required":true,"example":"rtmp://example.com/live/stream"}},{"name":"Region","in":"query","schema":{"description":"请求的混流服务所在区域。取值：\n\n- **CN-Shanghai<props=\"china\"><ph>（默认值）</ph></props>**：上海。\n- **AP-Singapore<props=\"intl\"><ph>（默认值）</ph></props>**：新加坡。\n- **EMAA-Saudi**：沙特。\n","type":"string","required":false,"example":"CN-Shanghai"}},{"name":"SingleSubParams","in":"query","style":"json","schema":{"description":"单流转推参数，单流转推（MixMode=0）时必填。需要混流转码时不填。","type":"object","properties":{"SourceType":{"description":"单流转推模式下视频输入流类型，仅针对视频流（StreamType=2）有效。取值：\n- **camera（默认值）**：摄像头。\n- **shareScreen**：屏幕共享。","type":"string","required":false,"example":"camera"},"StreamType":{"description":"单流转推模式下转推流类型。取值：\n- **0（默认值）**：转推原始流。\n- **1**：仅转推音频流。\n- **2**：仅转推视频流。","type":"string","required":false,"example":"0"},"UserId":{"description":"单流转推的用户ID，一次只能转推一路流。","type":"string","required":true,"example":"yourSubUserId"}},"required":false}},{"name":"TranscodeParams","in":"query","style":"json","schema":{"description":"混流转码转推参数，混流转码转推（MixMode=1）时必填。需要单流转推时不填。","type":"object","properties":{"Background":{"description":"混流全局背景图。","type":"object","properties":{"RenderMode":{"description":"子画面输出时的显示模式：\n- **0**：缩放并显示黑底。\n- **1**（默认）：裁剪。","type":"string","required":false,"example":"1"},"URL":{"description":"全局背景图URL，最大长度不超过2048个字符。","type":"string","required":false,"example":"yourImageUrl"}},"required":false},"EncodeParams":{"description":"转推输出的编码参数。","type":"object","properties":{"AudioOnly":{"description":"是否为纯音频，取值：\n- **true**：纯音频，仅需要设置音频相关参数。\n- **false（默认值）**：非纯音频，除VideoCodec参数与EnhancedParam参数外，其它参数均不能为空。","type":"string","required":false,"example":"false"},"AudioBitrate":{"description":"音频码率，取值范围：\\[8, 500\\]，单位：kbps。","type":"string","required":false,"example":"128"},"AudioChannels":{"description":"音频声道数，取值：1、2。","type":"string","required":false,"example":"2"},"AudioSampleRate":{"description":"音频采样率，取值：8000、16000、32000、44100、48000，单位：Hz。","type":"string","required":false,"example":"44100"},"VideoCodec":{"description":"视频编码格式。默认值H.264。","type":"string","required":false,"example":"H.264"},"VideoBitrate":{"description":"视频码率，取值范围：\\[1, 10000\\]，单位：kbps。","type":"string","required":false,"example":"3500"},"VideoFramerate":{"description":"视频帧率，取值范围：\\[1, 60\\]，单位：fps。","type":"string","required":false,"example":"25"},"VideoGop":{"description":"视频GOP，取值范围：\\[1, 60\\]。","type":"string","required":false,"example":"20"},"VideoHeight":{"description":"视频高，取值范围：\\[0, 1920\\]，单位：px。","type":"string","required":false,"example":"1000"},"VideoWidth":{"description":"视频宽，取值范围：\\[0, 1920\\]，单位：px。","type":"string","required":false,"example":"1920"},"EnhancedParam":{"description":"编码增强参数，JSON字符串，目前支持的可选配置包括profile与preset。\n- profile：编码级别。当视频编码格式为H.264时，profile支持的可选值包括：\"baseline\", \"main\", \"high\"。\n\n- preset：调节编码速度和质量的平衡。preset支持的可选值包括：\"ultrafast\", \"superfast\", \"veryfast\", \"faster\", \"fast\", \"medium\", \"slow\", \"slower\", \"veryslow\" \"placebo\"。每个值代表了一种编码速度与输出视频质量的策略，从\"ultrafast\"（极快，编码速度优先）到\"placebo\"（追求极致质量，编码极慢）。\n\n> 例如设置superfast，主要用于实时通讯领域。建议非编码器专业技术人员，不设置该选项。","type":"string","required":false,"example":"{\"profile\": \"high\", \"preset\": \"veryfast\"}"}},"required":false},"Layout":{"description":"视频布局信息。\n> 视频转码时，需要指定视频布局信息，包括布局坐标(X，Y)，布局窗格(Width，Height)，叠放顺序(ZOrder)；纯音频转码时，禁止填写视频布局信息。\n","type":"object","properties":{"UserPanes":{"description":"混流用户窗格信息。","type":"array","items":{"description":"混流用户窗格信息。","type":"object","properties":{"UserInfo":{"description":"该窗格对应的混流用户信息，不填时后台按照上行主播的进房顺序自动填充。\n>- 如果指定混流用户信息，该用户信息需要已在TranscodeParams.UserInfos参数中配置。 \n- 仅针对原始流和视频流有效。","type":"object","properties":{"SourceType":{"description":"混流转码模式下视频输入流类型，仅针对视频流（StreamType=2）有效。取值：\n- **camera（默认值）**：摄像头。\n- **shareScreen**：屏幕共享。","type":"string","required":false,"example":"camera"},"UserId":{"description":"混流用户ID。","type":"string","required":false,"example":"yourSubUserId"}},"required":false},"Height":{"description":"窗格高，归一化百分比。","type":"string","required":false,"example":"0.2632"},"Width":{"description":"窗格宽，归一化百分比。","type":"string","required":false,"example":"0.3564"},"X":{"description":"坐标X，归一化百分比。","type":"string","required":false,"example":"0.2456"},"Y":{"description":"坐标Y，归一化百分比。","type":"string","required":false,"example":"0.3789"},"ZOrder":{"description":"叠放顺序，0为最底层，1层在0层之上，以此类推。","type":"string","required":false,"example":"0"},"BackgroundImageUrl":{"description":"子画面的背景图URL，最大长度不超过2048个字符。当用户关闭摄像头或未进入房间时，会在布局位置填充为此图片。","type":"string","required":false,"example":"yourImageUrl"},"RenderMode":{"description":"子画面输出时的显示模式，取值：\n- **0**：缩放并显示黑底。\n- **1（默认值）**：裁剪。","type":"string","required":false,"example":"1","default":"1"}},"required":false},"required":false}},"required":false},"UserInfos":{"description":"混流用户信息，不指定用户则所有用户混流。","type":"array","items":{"description":"混流用户信息。","type":"object","properties":{"SourceType":{"description":"混流转码模式下视频输入流类型，仅针对视频流（StreamType=2）有效。取值：\n- **camera（默认值）**：摄像头。\n- **shareScreen**：屏幕共享。","type":"string","required":false,"example":"camera"},"StreamType":{"description":"混流转码模式下转推流类型。取值：\n- **0（默认值）**：转推原始流。\n- **1**：仅转推音频流。\n- **2**：仅转推视频流。","type":"string","required":false,"example":"0"},"UserId":{"description":"混流用户ID。","type":"string","required":true,"example":"yourSubUserId"}},"required":false},"required":false}},"required":false}},{"name":"SeiParams","in":"query","style":"json","schema":{"description":"SEI配置参数。","type":"object","properties":{"LayoutVolume":{"description":"布局和音量SEI，该参数内容可以为空，表示携带默认的布局和音量SEI。","type":"object","properties":{"FollowIdr":{"description":"发送IDR关键帧时是否确保携带SEI，取值：\n- **0**：不确保带SEI。\n- **1**：确保带SEI。","type":"string","required":false,"example":"0"},"Interval":{"description":"SEI发送间隔，取值范围：\\[1000, 5000\\]，单位：毫秒。","type":"string","required":false,"example":"1000"}},"required":false},"PassThrough":{"description":"透传SEI。","type":"object","properties":{"FollowIdr":{"description":"发送IDR关键帧时是否确保携带SEI，取值：\n- **0**：不确保带SEI。\n- **1**：确保带SEI。","type":"string","required":false,"example":"0"},"Interval":{"description":"SEI发送间隔，取值范围：\\[1000, 5000\\]，单位：毫秒。","type":"string","required":false,"example":"1000"},"PayloadContent":{"description":"透传SEI的payload内容。","type":"string","required":false,"example":"yourPayloadContent"},"PayloadContentKey":{"description":"透传SEI的payload内容对应的key值。不设置时，key为默认值udd。","type":"string","required":false,"example":"yourPayloadContentKey"}},"required":false},"PayloadType":{"description":"SEI消息的自定义payload_type，取值范围100-254。不设置时，SEI的payload_type为默认值为5。","type":"string","required":false,"example":"100"}},"required":false}}],"responses":{"200":{"schema":{"description":"请求ID。","type":"object","properties":{"RequestId":{"description":"请求ID。","type":"string","example":"0F72851F-5DC1-1979-9B2C-450040316C3E"}}}}},"errorCodes":{"400":[{"errorCode":"InvalidParam","errorMessage":"%s"},{"errorCode":"InvalidAppId","errorMessage":"%s"}],"403":[{"errorCode":"OperationDenied","errorMessage":"Your account has not enabled the Live service"},{"errorCode":"Forbidden","errorMessage":"%s"}],"404":[{"errorCode":"MissingParam","errorMessage":"%s"}],"500":[{"errorCode":"InternalError","errorMessage":"InternalError"}]},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"RequestId\\\": \\\"0F72851F-5DC1-1979-9B2C-450040316C3E\\\"\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<StartLiveMPUTaskResponse>\\n    <RequestId>0F72851F-5DC1-1979-9B2C-450040316C3E</RequestId>\\n</StartLiveMPUTaskResponse>\",\"errorExample\":\"\"}]","title":"创建混流转推任务（新）","summary":"调用StartLiveMPUTask创建混流转推任务。","description":"## 使用说明\n单个应用ID默认支持单路转推任务上限为200个，混流转码转推任务上限为40。如果您需要提升配额，请[提交工单](https://smartservice.console.aliyun.com/service/create-ticket)。\n### 混流任务生命周期\n**启动**\n- 主播首次开播，可以调用StartLiveMPUTask启动旁路。\n    \n    - 若无用户入会，会返回channel不存在错误。\n    -   用户开始推流时才会输出旁路流。若单路任务用户未推流，则旁路流无法播放。\n    -   混流任务需保证至少有一个用户有推流，旁路流才可播放。未推流的用户对应的布局画面会展示黑屏。\n\n- 客户业务服务器建议记录旁路任务状态、任务类型、任务参数。\n    - 任务状态：启动、停止。\n    - 任务类型：单路、混流。\n    - 任务参数：即最新的入参，例如：调用UpdateLiveMPUTask成功后，记录最新任务参数。\n- 在连麦或者PK场景下，此时任务已经被更新为混流。若当前主播异常退出重新入会后，客户业务服务器可以根据保存的最新的任务类型和任务参数，直接调用StartLiveMPUTask启动混流任务。\n    - 如果启动前任务未被系统自动清理，则直接启动成功。\n    - 如果任务还未被系统自动清理，则会返回**任务已存在**错误码。\n\n**结束**\n- 主播离会，需要主动调用[StopLiveMPUTask](~~2362742~~)停止旁路任务。\n- 若任务所指定的所有用户均已离会但未主动调用StopLiveMPUTask，系统会在2分钟后对旁路任务进行停止。\n\n## QPS限制\n本接口的单用户QPS限制为500次/秒。超过限制，API调用会被限流，这可能会影响您的业务，请合理调用。更多信息，请参见[QPS限制](~~343507~~)。","requestParamsDescription":"### 布局和音量SEI\n\n| 参数 | 说明 |\n| ----- | --------- |\n| canvas | 画布信息，参数信息：<br>- w：画布宽，单位：像素。<br>- h：画布高，单位：像素。<br>- bgnd：画布的背景颜色，格式为RGB定义下的十六进制整数。 |\n| stream  | 视频流信息，参数信息：<br>- uid：主播的用户ID。<br>- paneid：该区域在窗格编号，取值[0,8]。<br>- zorder：该区域的叠放层级，取值范围 [0,99]。<br>- x：该区域在画布中对应的x坐标，归一化百分比。<br>- y：该区域在画布中对应的y坐标，归一化百分比。<br>- w：该区域的宽度，归一化百分比。<br>- h：该区域的高度，归一化百分比。<br>- type：该区域视频流的类型，取值：0：摄像头；1：屏幕共享。<br>- status：该区域视频流的状态，取值：0：还未拉取到；1：已拉取到。<br>- muted：主播被静音状态，取值：0：未被静音；1：被静音。主播PK时，A主播将B主播静音，B主播muted字段将显示被静音状态。<br>- vol：主播的音量（分贝），取值：[0,255]。<br>- vad ：语音检测，取值：[0,150]，150是有人声，非150就是从有人声到无声的拖尾时间。     |\n| ts  | 生成该信息时的操作系统时间戳，单位为毫秒。     |\n| ver  | SEI格式版本信息，如当前版本为1.0.0.20220915。     |\n| udd  | 客户自定义的场景化事件，通过PassThrough参数下发，内容由PayloadContent参数指定。     |\n\n**以直播连麦场景为例：**\n\n如果只是单主播，观众端接收的SEI信息里stream集合只有一个成员信息；如果是主播正在连麦或者PK，观众端接收的SEI信息里stream集合会有多个成员信息。\n例如，当主播111单主播推流时，观众端收到的SEI帧格式如下：<br>`{\"canvas\":{\"w\":1920,\"h\":1080,\"bgnd\":0},\"stream\":[{\"uid\":\"111\",\"paneid\":-1,\"zorder\":0,\"x\":0,\"y\":0,\"w\":0,\"h\":0,\"type\":0,\"status\":1,\"muted\":0,\"vol\":0,\"vad\":0}],\"ver\":\"1.0.0.20220915\",\"ts\":1697696105170}`\n当主播111和观众222进行连麦时，观众端收到的SEI帧格式如下：<br>`{\"canvas\":{\"w\":1920,\"h\":1080,\"bgnd\":0},\"stream\":[{\"uid\":\"111\",\"paneid\":0,\"zorder\":1,\"x\":0,\"y\":0.25,\"w\":0.5,\"h\":0.5,\"type\":0,\"status\":1,\"muted\":0,\"vol\":1,\"vad\":119},{\"uid\":\"222\",\"paneid\":1,\"zorder\":1,\"x\":0.5018382,\"y\":0.25,\"w\":0.5,\"h\":0.5,\"type\":0,\"status\":1,\"muted\":0,\"vol\":60,\"vad\":123}],\"ver\":\"1.0.0.20220915\",\"ts\":1697696106230}`\n判断stream数组的个数可以知道当前直播布局是否发生切换，stream数组的个数为1时，则是单主播推流；stream数组的个数大于1，则主播在连麦或PK中。通过成员的布局信息，知道每个成员在混流布局中的具体位置。\n\n### 透传SEI\n- 自定义SEI，通过StartLiveMPUTask命令启动混流转推任务，在PassThrough参数中，指定PayloadContent内容；也可以在UpdateLiveMPUTask命令更新混流转推任务时，在PassThrough参数中，指定PayloadContent内容。\n- 自定义SEI可以周期性发送，通过PassThrough参数中的Interval来设定周期，单位为ms；\n- 自定义SEI也可以跟随关键帧发送，通过PassThrough参数中的FollowIdr来设定。\n    - 既可以按照Interval来周期性发送，也可以将SEI跟随关键帧来发送，如Interval:1000，FollowIdr: 1 表示每隔1000ms发送一次自定义SEI，并且在发送关键帧时携带自定义SEI。\n    - 当不携带Interval以及不携带FollowIdr时，表示该自定义SEI只在调用时发送一次。\n\n例如，当主播111单主播推流时，调用UpdateLiveMPUTask命令下发周期性SEI，PassThrough参数中的Interval设置为1000，FollowIdr设置为0，PayloadContent设置为\"hello world\"，那么每隔1000ms将发送一次自定义SEI，观众端收到的SEI帧格式如下：<br>`{\"canvas\":{\"w\":1920,\"h\":1080,\"bgnd\":0},\"stream\":[{\"uid\":\"111\",\"paneid\":-1,\"zorder\":0,\"x\":0,\"y\":0,\"w\":0,\"h\":0,\"type\":0,\"status\":1,\"muted\":0,\"vol\":0,\"vad\":0}],\"ver\":\"1.0.0.20220915\",\"ts\":1697696109876,\"udd\":\"hello world\"}`\n### 跨频道多用户混流\n若您需要将跨多个频道中的多个主播进行混流布局并转推到直播服务时，您需要将发起跨频道通话的主播的UserID、ChannelID，以及对端的UserID作为入参创建混流任务。示例如下：\n在直播PK场景中，频道channelA的主播userA，通过客户端接口发起了和频道channelB主播userB的跨频道PK，并将两个主播的混流画面输出给频道channelA的麦下观众观看。则，此时创建混流任务时关于频道和用户参数的指定示范如下：\n- ChannelID： 指定为channelA\n- UserInfos->UserId ：分别指定userA和userB\n\n> 创建跨频道多用户的混流任务的前提是，已经通过客户端SDK接口发起了跨频道通话。如果不同频道的用户没有进行通话，则无法创建跨房间混流任务。如何发起跨房间通话，请参见[跨房间订阅功能](~~2642837~~)。"}