{"methods":["post","get"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"readAndWrite","deprecated":false,"systemTags":{"operationType":"create","abilityTreeCode":"219222","abilityTreeNodes":["FEATUREliveK6LRQR"]},"parameters":[{"name":"AppId","in":"query","schema":{"description":"订阅的应用ID。\n> 应用ID由大小写字母、数字、下划线、短划线（-）组成，最大64字符。","type":"string","required":true,"example":"yourAppId"}},{"name":"ChannelIds","in":"query","schema":{"description":"指定接收回调的混流任务的频道ID，可以同时填多个频道ID，多个频道ID之间采用英文逗号“,”隔开。\n> - 如果不填，则默认接收该AppId下所有混流转推任务的回调事件。\n- 同时填多个频道ID时，不能填写重复的频道ID，最多同时填20个频道ID。\n- 每个频道ID由大小写字母、数字、下划线、短划线（-）组成，最大64字符。","type":"string","required":false,"example":"yourChannelIds"}},{"name":"CallbackUrl","in":"query","schema":{"description":"回调地址。地址格式请参见以下回调内容规范。\n> 回调地址协议头为HTTP、HTTPS等，仅可包含以下字符：a-z 、A-Z、0-9、-、_、?、%、=、#、.、/ 和 +，不超过2083个字符。","type":"string","required":true,"example":"http://****.com/callback"}}],"responses":{"200":{"schema":{"type":"object","properties":{"RequestId":{"description":"请求ID。","type":"string","example":"******3B-0E1A-586A-AC29-742247******"},"SubId":{"description":"订阅ID。","type":"string","example":"Sub-******9799B2C4500******"}}}}},"errorCodes":{"400":[{"errorCode":"InvalidParam","errorMessage":"%s"},{"errorCode":"InvalidAppId","errorMessage":"%s"}],"403":[{"errorCode":"OperationDenied","errorMessage":"Your account has not enabled the Live service"},{"errorCode":"Forbidden","errorMessage":"%s"}],"404":[{"errorCode":"MissingParam","errorMessage":"%s"}],"500":[{"errorCode":"InternalError","errorMessage":"InternalError"}]},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"RequestId\\\": \\\"******3B-0E1A-586A-AC29-742247******\\\",\\n  \\\"SubId\\\": \\\"Sub-******9799B2C4500******\\\"\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<CreateRtcMPUEventSubResponse>\\n    <RequestId>******3B-0E1A-586A-AC29-742247******</RequestId>\\n    <SubId>Sub-******9799B2C4500******</SubId>\\n</CreateRtcMPUEventSubResponse>\",\"errorExample\":\"\"}]","title":"创建混流转推事件订阅","summary":"调用CreateRtcMPUEventSub创建混流转推事件订阅。","description":"## 使用说明\n本接口用于创建混流转推事件订阅。在创建订阅时，您可以配置回调地址、订阅应用与频道信息等参数。\n## QPS限制\n本接口的单用户QPS限制为50次/秒。超过限制，API调用会被限流，这可能会影响您的业务，请合理调用。更多信息，请参见[QPS限制](~~343507~~)。","requestParamsDescription":"## 回调内容示例\n回调内容以**HTTP/HTTPS POST**请求发送到您的业务服务器，字符编码格式为**UTF-8**格式，请求体为**JSON**结构体，当您的业务服务器响应**HTTP状态码为200**时，认定为回调成功。回调内容示例如下：\n\n>  建议在判断混流转推是否正常时，不仅需要根据回调通知判断，也要同时配合接入的对应cdn厂商提供的在线流状态判断是否正常。\n\n```\n{\n\t\"EventType\": 1,\n\t\"MsgId\": \"42bba8b5-94ab-468c-9dae-9b501dd6cb6e\",\n\t\"AppId\": \"rtcdev\",\n\t\"SubId\": \"Sub-9799B2C45009799B2C4500\",\n\t\"TaskId\": \"mpucallbacktest\",\n\t\"CallbackTs\": 1712656430476,\n\t\"Payload\": {\n\t\t\"DstUrl\": \"rtmp://domain/app/stream?auth\",\n\t\t\"EventTs\": 1712656430384,\n\t\t\"EventCode\": 1,\n\t\t\"ErrorCode\": 0,\n\t\t\"ErrorMessage\": \"\"\n\t}\n}\n```\n\n### 回调信息\n回调信息的header包括如下字段：\n\n| 属性 | 描述 |\n| ------ | ----- |\n| Content-Type | 数据类型，固定值：application/json |\n| Ali-Rtc-Timestamp | 时间戳 |\n| Ali-Rtc-Signature | 签名值 |\n\n回调信息的回调内容包括如下字段：\n| 属性 | 类型| 描述 | 示例值 |\n| ------ | ----- | ----- | -----|\n| EventType | Integer| 回调事件类型，对于混流转推回调，类型为固定值：1| 1 |\n| MsgId| String| 回调ID，唯一表示本次回调 | \\*\\*\\*\\*\\*973C-4529-A334\\*\\*\\*\\*\\*|\n| AppId| String| 订阅的应用ID | yourAppId |\n| SubId| String| 订阅ID | Sub-\\*\\*\\*\\*\\*\\*9799B2C4500\\*\\*\\*\\*\\*\\* |\n| TaskId| String| 旁路任务ID | yourTaskId |\n| CallbackTs| Integer| 发起回调请求的毫秒时间戳 | 1712656430476 |\n| Payload| JSON Object| 回调事件信息 | - |\n\n* 回调事件信息（Payload）\n\n| 属性 | 类型| 描述 | 示例值 |\n| ------ | ----- | ----- | -----|\n| DstUrl | String | 转推目的URL地址 | rtmp://domain/app/stream?auth |\n| EventTs | Integer | 回调事件发生的毫秒时间戳 | 1712656430384 |\n| EventCode | Integer | 回调事件Code | 1 |\n| ErrorCode | Integer | 回调事件的错误码 | 10001 |\n | ErrorMessage | String| 回调事件的错误原因 | rtmp server init failed |\n\n## 回调事件Code\n| 字段名 | 值| 含义 | 回调频率 |\n| ------ | ----- | ----- | -----|\n| MPU_STATE_PREPARING | 0 | 旁路转推任务创建成功，任务被触发 | 仅回调1次 |\n| MPU_STATE_ESTABLISHING | 1 | 旁路转推任务建联中 | 每5秒回调1次 |\n| MPU_STATE_RUNNING | 2 | 旁路转推任务运行中 | 仅回调1次 |\n| MPU_STATE_RECOVERING | 3 | 旁路转推异常中断，正在恢复中 | 每5秒回调1次 |\n| MPU_STATE_TERMINATED | 4 | 旁路转推任务结束，包括正常停止、启动失败、异常退出等，通过ErrorCode与ErrorMessage区分 | 仅回调1次 |\n\n回调事件的状态转移示例如下：\n![](https://img.alicdn.com/imgextra/i2/O1CN01XYVSiA1oERjKdEOgt_!!6000000005193-0-tps-1277-328.jpg)\n**注意：** \n1. 回调信息有可能会乱序到达您的业务服务器，您可以根据 Payload 中的 EventTs 做事件排序，如果您只关心回调事件的最新状态，可以忽略后续到达的过期事件。\n2. 对于通过API[创建混流转推任务（新）](~~2360995~~)创建的混流转推任务，当房间内所有用户均离开房间后一段时间，任务会自动停止，停止时会发送一个MPU_STATE_TERMINATED的回调。\n3. 回调配置只影响增量任务，不影响存量任务。即：\n\n a. 开启回调配置前已启动的任务，不发送回调；\n\n b. 开启回调配置后启动的任务，会发送回调；\n\n c. 删除回调配置前已启动的任务，会继续发送回调直到任务结束；\n\n d. 删除回调配置后启动的任务，不发送回调。\n\n### 回调错误码\n当旁路转推任务结束时，通过ErrorCode与ErrorMessage标识结束的原因。\n\n| 错误码 | 错误信息 | 含义 |\n| ------ | ----- | ----- |\n| 0 |   | 任务正常停止 |\n| 10001 | rtmp server init failed | 建联失败，任务异常结束 |\n| 10002 | rtmp server internal error| 服务内部错误，任务异常结束 |\n\n## 回调鉴权说明\n事件回调鉴权功能默认开启，鉴权逻辑如下所示：\n- 阿里云视频直播服务发起回调请求时，在HTTP(S)请求头中包含Ali-Rtc-Timestamp和Ali-Rtc-Signature字段，供回调消息接收服务端进行签名认证。Ali-Rtc-Signature值计算方式为：Ali-Rtc-Signature=MD5SUM(MD5CONTENT)。其中，MD5CONTENT=回调域名|Ali-Rtc-Timestamp取值|鉴权Key；回调域名指配置回调URL的域名，鉴权Key指用户创建AppId时生成的AppKey。\n- 回调消息接收服务端接收回调消息时，将回调域名、Ali-Rtc-Timestamp取值、鉴权Key进行拼接后计算MD5值，得到加密字符串，再将计算出的加密字符串与音视频通信服务发起的HTTP(S)请求头中的Ali-Rtc-Signature字段值进行对比，如果不一致，则请求非法。\n## 回调异常重试\n阿里云发起回调请求时，仅当您的业务服务器响应HTTP状态码为200时认定为回调成功。若回调失败，阿里云会重试7次，分别间隔1秒、2秒、5秒、10秒、1分钟、2分钟、5分钟。每次重试请求均会产生对应的回调记录。\n"}