{"summary":"如果您需要通过配置文件方式快速创建、管理伸缩组，则可以通过调用API ApplyScalingGroup来创建和管理伸缩组。","methods":["post"],"schemes":["https"],"security":[{"AK":[]}],"deprecated":false,"systemTags":{"operationType":"create","abilityTreeCode":"206521","abilityTreeNodes":["FEATUREessGIWHSQ","FEATUREessXN6KX4"]},"parameters":[{"name":"Content","in":"query","allowEmptyValue":false,"schema":{"description":"配置文件内容。","type":"string","required":true,"example":"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\n  labels:\n    app: nginx\n  spec:\n    replicas: 3\n    selector:\n       matchLabels:\n        app: nginx\n    template:\n      metadata:\n        labels:\n          app: nginx\n        annotations:\n          k8s.aliyun.com/eip-bandwidth: 10\n          k8s.aliyun.com/eci-with-eip: true\n        spec:\n          containers:\n          - name: nginx\n            image: nginx:1.14.2\n            ports:\n            - containerPort: 80"}},{"name":"RegionId","in":"query","schema":{"description":"所属地域的ID。","type":"string","required":false,"example":"cn-hangzhou"}},{"name":"Format","in":"query","schema":{"description":"可选，默认值 YAML，当前仅支持YAML格式。","type":"string","required":false,"example":"YAML"}}],"responses":{"200":{"schema":{"title":"Schema of Response","description":"Schema of Response","type":"object","properties":{"RequestId":{"title":"Id of the request","description":"请求ID。","type":"string","example":"CC107349-57B7-4405-B1BF-9BF5AF7F****"},"ScalingGroupId":{"description":"生效伸缩组的ID。","type":"string","example":"asg-bp1igpak5ft1flyp****"}}}}},"staticInfo":{"returnType":"synchronous"},"responseDemo":"[{\"errorExample\":\"\",\"example\":\"{\\n  \\\"RequestId\\\": \\\"CC107349-57B7-4405-B1BF-9BF5AF7F****\\\",\\n  \\\"ScalingGroupId\\\": \\\"asg-bp1igpak5ft1flyp****\\\"\\n}\",\"type\":\"json\"}]","title":"基于配置文件管理伸缩组","description":"ApplyScalingGroup目前支持Kubernetes Deployment资源定义格式快速创建ECI伸缩组。同时支持ECI对Kubernetes YAML拓展annotation，详情参考《支持annotation列表》。\n\nYAML配置与伸缩组映射关系：通过YAML定义中的namespace、kind、name三元组映射伸缩组name。一个region下同一个YAML配置只能映射同一个伸缩组。示例：如果使用默认namespace下name为nginx的Deployment  YAML配置，则映射同region下名称为k8s_default_Deployment_nginx伸缩组。\n\n基于YAML配置管理伸缩组逻辑：\n\n- 当YAML配置映射伸缩组存在时，会基于YAML配置更新伸缩组；\n- 当YAML配置映射伸缩组不存在时，会基于YAML配置创建对应伸缩组。\n\n### 注意事项 \n\n1. 当YAML配置未指定专有网络、vSwitch、安全组\nannotation时，系统会自动创建默认VPC，在该VPC下创建默认交换机，以及ESS默认安全组ess-default-sg。其中安全组策略默认开放TCP协议的22、3389端口以及ICMP（IPv4）协议，如果用户有其他端口协议需求，可以另行调整安全组策略。\n2. 当使用公网镜像时，需配置开启公网访问能力，设置k8s.aliyun.com/eci-with-eip pod annotation开启eip。\n3. ApplyScalingGroup应用YAML配置后，伸缩组、伸缩配置会立即生效，如果指定replicas > 0时，会自动创建资源。\n\n### 支持的annotation列表\nannotation参考自[ECI Pod Annotation](~~186939~~) 。\n|参数|示例值|说明|\n|-----|-----|-----|\n|k8s.aliyun.com/ess-scaling-group-min-size|1|伸缩组最小值。默认值0。\n|k8s.aliyun.com/ess-scaling-group-max-size|20|伸缩组最大值。默认为max(replicas, 30)。\n|k8s.aliyun.com/eci-ntp-server|100.100.*.*|NTP Server。\n|k8s.aliyun.com/eci-use-specs|2-4Gi|2核4G规格配置。更多信息，请参见[多规格创建Pod](~~451267~~)。\n|k8s.aliyun.com/eci-vswitch|vsw-bp1xpiowfm5vo8o3c****|指定交换机ID，支持指定多个交换机实现多可用区功能。\n|k8s.aliyun.com/eci-security-group|sg-bp1dktddjsg5nktv****|指定安全组ID。要求如下：<ul><li>支持指定一个或多个安全组，最多可以指定5个安全组。</li><li>指定的安全组必须属于同一VPC。</li><li>指定的安全组的类型必须相同。</li></ul>\n|k8s.aliyun.com/eci-sls-enable|\"false\"|配置为false表示关闭日志采集功能。<p> 通过SLS CRD方式采集日志时，如果某些Pod不需要采集日志，可配置该Annotation来关闭日志采集功能，避免系统自动创建Logtail而造成资源浪费。</p> \n|k8s.aliyun.com/eci-spot-strategy|SpotAsPriceGo|抢占式实例的出价策略。可根据需要配置为：<ul><li>SpotWithPriceLimit：自定义设置抢占实例价格上限。此时必须设置k8s.aliyun.com/eci-spot-price-limit。</li><li>SpotAsPriceGo：系统自动出价，跟随当前市场实际价格。</li></ul>\n|k8s.aliyun.com/eci-spot-price-limit|\"0.5\"|抢占式实例的每小时价格上限，最多支持精确到小数点后三位。<p>仅当k8s.aliyun.com/eci-spot-strategy设置为SpotWithPriceLimit时有效。</p>\n|k8s.aliyun.com/eci-with-eip|\"true\"|配置为true表示自动创建并绑定EIP。\n|k8s.aliyun.com/eci-data-cache-bucket|default|指定DataCache的Bucket。使用DataCache创建Pod时必须配置。\n|k8s.aliyun.com/eci-data-cache-pl|PL1|基于DataCache创建的云盘的性能等级。<p>默认使用ESSD云盘，性能等级默认为PL1。</p>\n|k8s.aliyun.com/eci-data-cache-provisionedIops|\"40000\"|ESSD AutoPL云盘预配置的读写IOPS。取值范围：0~min{50000, 1000 * 容量-基准性能}。基准性能=min{1800+50 * 容量, 50000}。更多信息，请参见[ESSD AutoPL云盘](~~368372~~)。<p>如果添加了该Annotation，则基于DataCache创建的云盘类型为ESSD AutoPL云盘。</p>\n|k8s.aliyun.com/eci-data-cache-burstingEnabled|\"true\"|ESSD AutoPL云盘是否开启Burst（性能突发）。更多信息，请参见[ESSD AutoPL云盘](~~368372~~)。<p>如果添加了该Annotation，则基于DataCache创建的云盘类型为ESSD AutoPL云盘。</p>\n|k8s.aliyun.com/eci-custom-tags|\"env:test,name:alice\"|绑定的标签（Tag）字符串，最多可以绑定3个标签。标签键和标签值之间用半角冒号隔开，多个标签之间用半角逗号隔开。"}