{"methods":["post","get"],"schemes":["http","https"],"security":[{"AK":[]}],"systemTags":{"operationType":"create"},"parameters":[{"name":"ScalingGroupId","in":"query","schema":{"description":"目标伸缩组的ID。","type":"string","required":true,"example":"asg-bp1eyv4qn8ssgv43****"}},{"name":"LifecycleHookName","in":"query","schema":{"description":"生命周期挂钩的名称。不能与当前伸缩组其他生命周期挂钩重名，长度为2~64个英文或中文字符，以数字、大小写字母或中文开头，可包含数字、下划线（_）、短划线（-）和英文句号（.）。\n\n默认值为LifecycleHookId的值。","type":"string","required":false,"example":"lifecyclehook****"}},{"name":"LifecycleTransition","in":"query","schema":{"description":"生命周期挂钩适用的伸缩活动类型，取值范围： \n         \n- SCALE_OUT：伸缩组弹性扩张活动 \n- SCALE_IN：伸缩组弹性收缩活动 \n         ","type":"string","required":true,"example":"SCALE_OUT"}},{"name":"DefaultResult","in":"query","schema":{"description":"等待状态结束后的下一步动作，取值范围： \n\n- CONTINUE：继续响应弹性扩张活动或者继续响应弹性收缩活动。\n- ABANDON：直接释放弹性扩张活动创建出来的ECS实例或者直接将弹性收缩活动中的ECS实例从伸缩组移除。 \n- ROLLBACK：针对弹性收缩活动，会拒绝释放ECS实例，进行回滚；针对弹性扩张活动，会直接释放创建出来的ECS实例，效果同ABANDON一样。\n\n当伸缩组发生弹性收缩活动（SCALE_IN）并触发多个生命周期挂钩时，如果一个生命周期挂钩的DefaultResult取值为ABANDON或ROLLBACK，且该挂钩等待状态结束时，会提前将其他生命周期挂钩对应的等待状态提前结束。其他情况下，下一步动作均以最后一个结束等待状态的下一步动作为准。\n\n\n\n默认值：CONTINUE","type":"string","required":false,"example":"CONTINUE"}},{"name":"HeartbeatTimeout","in":"query","schema":{"description":"生命周期挂钩为伸缩组活动设置的等待时间，等待状态超时后会执行下一步动作。取值范围：30~21600，单位：秒。\n\n创建了生命周期挂钩后，您可以调用RecordLifecycleActionHeartbeat延长ECS实例的等待时间，也可以调用CompleteLifecycleAction提前结束伸缩活动的等待状态。 \n\n默认值：600","type":"integer","format":"int32","required":false,"example":"600"}},{"name":"NotificationMetadata","in":"query","schema":{"description":"生命周期挂钩暂停伸缩活动时推送给NotificationArn（通知对象）的通知信息，便于管理和标记不同类别的通知信息。必须同时指定NotificationArn。参数长度不能超过4096个字符。\n\n如果NotificationArn指定为OOS模板，包括公共模板或者自定义模板，则NotificationMetadata必须指定为JSON字符串，且与OOS模板的参数相符。比如，`{\"dbInstanceId\": \"dds-bp17661e0135****\",  \"modifyMode\": \"Append\"}`，`dbInstanceId`和`modifyMode`为OOS模板中已定义的参数。OOS模板的部分参数有默认值，NotificationMetadata必须指定无默认值的参数，指定有默认值的参数时会覆盖原默认值，但以下参数请保持默认值，用于在伸缩活动运行时获取相关信息：\n\n- `regionId`：伸缩活动执行的地域，默认为${regionId}\n\n- `instanceIds`：伸缩活动关联的实例列表，默认为${instanceIds}\n\n- `lifecycleHookId`：生命周期挂钩ID，默认为${lifecycleHookId}\n\n- `lifecycleActionToken`：伸缩活动的等待状态标识符，用于提前结束当前的挂起活动，默认为${lifecycleActionToken}\n\n- `scalingGroupId`：伸缩活动所属的伸缩组ID，默认为${scalingGroupId}\n\n- `lifecycleActionResult` ：生命周期挂钩等待状态结束后的下一步动作，用于在OOS模板执行失败时提前结束当前的挂起活动，当DefaultResult为ROLLBACK时，参数值默认为ROLLBACK，其余情况默认为ABANDON。\n\n>- 您可以根据需要设置lifecycleActionResult的值来覆盖当前默认值，取值范围为ABANDON、CONTINUE、ROLLBACK、${lifecycleActionResult}。\n其中，${lifecycleActionResult}表示lifecycleActionResult的值和DefaultResult保持一致。\n- 您可以在[OOS控制台](https://oos.console.aliyun.com/)获取对应模板的参数的详细信息。","type":"string","required":false,"example":"Test lifecycle hook."}},{"name":"NotificationArn","in":"query","schema":{"description":"生命周期挂钩通知对象标识符，不设置本参数表示不发送通知，设置本参数时支持以下通知方式：\n- 消息服务MNS队列，参数取值格式：acs:mns:{region-id}:{account-id}:queue/{queuename} 。\n- 消息服务MNS主题，参数取值格式：acs:mns:{region-id}:{account-id}:topic/{topicname}。\n- 运维编排OOS模板，参数取值格式：acs:oos:{region-id}:{account-id}:template/{templatename}。\n- 事件总线 ，参数取值格式：acs:eventbridge:{region-id}:{account-id}:eventbus/default。\n\n参数格式中的变量含义如下：\n- region-id：伸缩组所在的地域的ID。\n- account-id：阿里云账号ID，不支持RAM用户的账号ID。\n- queuename：MNS队列的名称。\n- topicname：MNS主题的名称。\n- templatename：OOS模板的名称。","type":"string","required":false,"example":"acs:mns:cn-beijing:161456884340****:queue/modifyLifecycleHo****"}}],"responses":{"200":{"schema":{"type":"object","properties":{"RequestId":{"description":"请求ID。","type":"string","example":"473469C7-AA6F-4DC5-B3DB-A3DC0DE3C83E"},"LifecycleHookId":{"description":"生命周期挂钩的ID。","type":"string","example":"ash-bp1at9ufhmcf9cmy****"}}}}},"responseDemo":"[{\"errorExample\":\"\",\"example\":\"{\\n  \\\"RequestId\\\": \\\"473469C7-AA6F-4DC5-B3DB-A3DC0DE3C83E\\\",\\n  \\\"LifecycleHookId\\\": \\\"ash-bp1at9ufhmcf9cmy****\\\"\\n}\",\"type\":\"json\"}]","title":"为伸缩组创建一个或多个生命周期挂钩","summary":"CreateLifecycleHook API用于在指定的弹性伸缩组中创建一个或多个生命周期挂钩。这些挂钩在实例的生命周期关键阶段（如启动、终止前）介入，使您能够执行自定义操作，如发送通知或执行自动化脚本等。通过此功能，您可以实现更细粒度的控制和管理，例如在实例被自动伸缩活动影响前后执行验证、配置或数据备份任务，从而增强应用部署的灵活性和可靠性。","description":"一个伸缩组最多可以创建6个生命周期挂钩。创建了生命周期挂钩的伸缩组，在发生伸缩活动时，生命周期挂钩会暂停伸缩活动一段时间，具体等待时长可以通过HeartbeatTimeout参数指定。您可以在等待期间进行初始化ECS实例配置、获取ECS实例数据等操作。\n\n弹性扩张活动时，ECS实例添加至RDS实例白名单后进入等待状态，等待状态结束后再加入SLB实例后端服务器组。弹性收缩活动时，ECS实例从SLB实例后端服务器组移出后进入等待状态，等待状态结束后再从RDS实例白名单移出。\n\n生命周期挂钩可以配置通知方式，支持MNS主题、MNS队列和OOS模板。如果配置OOS模板，您需要为OOS服务创建RAM角色。具体操作，请参见[为OOS服务设置RAM权限](~~120810~~)。\n\n> 如果伸缩组有存量的ECS实例，且配置的OOS模板用于加入或移出除RDS外的其他云数据库白名单，则您必须手动将存量的ECS实例加入云数据库的白名单。"}