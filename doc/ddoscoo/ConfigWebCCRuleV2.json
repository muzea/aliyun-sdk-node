{"summary":"创建或编辑网站业务频率控制防护（CC防护）的自定义规则。","methods":["post","get"],"schemes":["http","https"],"security":[{"AK":[]}],"operationType":"write","deprecated":false,"systemTags":{"operationType":"update","chargeType":"free","abilityTreeCode":"198715","abilityTreeNodes":["FEATUREddosOZ1QOD"]},"parameters":[{"name":"Domain","in":"query","schema":{"description":"网站业务的域名。\n> 域名必须已配置网站业务转发规则。您可以调用[DescribeDomains](~~91724~~)查询所有域名。","type":"string","required":true,"example":"www.example.com"}},{"name":"RuleList","in":"query","schema":{"description":"频率控制规则的配置，使用JSON格式的字符串表述，具体结构如下。\n- **action**：String类型，必选，匹配动作。取值：\n    - **block**：封禁\n    - **challenge**：挑战\n    - **watch**：观察\n- **name**：String类型，必选，规则名称。\n- **condition**：Map类型，必选，匹配条件。具体结构如下。\n\n    > 如果设置了多个匹配条件，则多个条件间是且的关系。\n\n    - **field**：String类型，必选，匹配字段。\n    - **match_method**：String类型，必选，匹配方法。\n \n        > 关于**field**和**match_method**的取值，请参见请求参数表下的补充描述。\n\n    - **header_name**：String类型，可选，自定义HTTP头部字段名称。\n\n        > 仅在**field**为**header**时有效。\n\n    - **content**：String类型，必选，匹配内容。\n- **ratelimit**：String类型，可选，频率控制字段，可以按照IP或者自定义Header进行频率统计。具体结构如下。\n  - **interval**：Integer类型，必选，统计时长（秒）。\n  - **ttl**：Integer类型，必选，处置时长（秒）。\n  - **threshold**：Integer类型，必选，阈值（次）。\n  - **subkey**：String类型，可选，字段名称（仅当统计源为header时设置）。\n  - **target**：String类型，必选，统计源，支持ip和header。\n- **status_code**：String类型，可选，频率控制字段，可以根据状态码出现数量或频率进行统计。具体结构如下。\n  - **enabled**：Boolean类型，必选，是否开启状态码统计。\n  - **code**：Integer类型，必选，状态码，值范围**100**~**599**。\n  - **use_ratio**：Boolean类型，必选，为true时使用比率。\n  - **ratio_threshold**：Integer类型，可选，状态码出现比率，使用比率时，仅在对应状态码达到 **ratio_threshold** 时触发处置动作，值范围**1**~**100**。\n  - **count_threshold**：Integer类型，可选，状态码出现数量，不使用比率时，仅在对应状态码达到 **count_threshold** 时触发处置动作，值范围**2**~**50000**。\n- **statistics**：String类型，可选，去重统计，可缺省（缺省为不去重统计）。具体结构如下。\n  - **mode**：String类型，必选，是否开启状态码统计。取值：\n    - **count**：不去重统计\n    - **distinct**：去重统计\n  - **field**：String类型，必选，统计源，去重统计，仅支持ip、header和uri。\n  - **header_name**：String类型，可选，字段名称，仅当统计源为header时设置。","type":"string","required":true,"example":"[{\"action\":\"block\",\"name\":\"trdsss\",\"statistics\":{\"mode\":\"count\",\"field\":\"header\",\"header_name\":\"hahah\"},\"ratelimit\":{\"interval\":60,\"ttl\":300,\"threshold\":70,\"target\":\"ip\"},\"status_code\":{\"enabled\":true,\"code\":404,\"use_ratio\":true,\"ratio_threshold\":80,\"count_threshold\":2},\"condition\":[{\"field\":\"ip\",\"match_method\":\"belong\",\"content\":\"1.1.1.1\"}]}]"}},{"name":"Expires","in":"query","schema":{"description":"规则有效期。单位：秒。\n   > 规则的匹配动作为封禁时（action为block）生效，在规则有效期内阻断访问请求。不传入该参数表示永久生效。","type":"integer","format":"int64","required":false,"example":"600"}}],"responses":{"200":{"schema":{"type":"object","properties":{"RequestId":{"description":"本次调用请求的 ID，是由阿里云为该请求生成的唯一标识符，可用于排查和定位问题。","type":"string","example":"0bcf28g5-d57c-11e7-9bs0-d89d6717dxbc"}}}}},"staticInfo":{"returnType":"synchronous"},"responseDemo":"[{\"errorExample\":\"\",\"example\":\"{\\n  \\\"RequestId\\\": \\\"0bcf28g5-d57c-11e7-9bs0-d89d6717dxbc\\\"\\n}\",\"type\":\"json\"}]","title":"创建或编辑网站业务频率控制防护（CC防护）的自定义规则","requestParamsDescription":"**field和match_method的取值及对应关系**\n\n| 匹配字段（field） | 描述 | 适用的逻辑符（match_method） |\n|-----------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------|\n| **ip** | 访问请求的来源IP。 | **belong** ：属于<br>**nbelong** ：不属于 |\n| **uri** | 访问请求的URI地址。 | **contain** ：包含<br>**ncontain** ：不包含<br>**equal** ：等于<br>**nequal** ：不等于<br>**lless** ：长度小于<br>**lequal** ：长度等于<br>**lgreat** ：长度大于<br>**prefix** ：前缀匹配 |\n| **referer** | 访问请求的来源网址，即该访问请求是从哪个页面跳转产生的。 | **contain** ：包含<br>**ncontain** ：不包含<br>**equal** ：等于<br>**nequal** ：不等于<br>**lless** ：长度小于<br>**lequal** ：长度等于<br>**lgreat** ：长度大于<br>**nexist** ：不存在 |\n| **user-agent** | 发起访问请求的客户端的浏览器标识、渲染引擎标识和版本信息等浏览器相关信息。 | **contain** ：包含<br>**ncontain** ：不包含<br>**equal** ：等于<br>**nequal** ：不等于<br>**lless** ：长度小于<br>**lequal** ：长度等于<br>**lgreat** ：长度大于 |\n| **params** | 访问请求的URL地址中的参数部分，通常指URL中”?”后面的部分。例如，`demo.aliyundoc.com/index.html?action=login`中的`action=login`就是参数部分。 | **contain** ：包含<br>**ncontain** ：不包含<br>**equal** ：等于<br>**nequal** ：不等于<br>**lless** ：长度小于<br>**lequal** ：长度等于<br>**lgreat** ：长度大于 |\n| **cookie** | 访问请求中的Cookie信息。 | **contain** ：包含<br>**ncontain** ：不包含<br>**equal** ：等于<br>**nequal** ：不等于<br>**lless** ：长度小于<br>**lequal** ：长度等于<br>**lgreat** ：长度大于<br>**nexist** ：不存在 |\n| **content-type** | 访问请求指定的响应HTTP内容类型，即MIME类型信息。 | **contain** ：包含<br>**ncontain** ：不包含<br>**equal** ：等于<br>**nequal** ：不等于<br>**lless** ：长度小于<br>**lequal** ：长度等于<br>**lgreat** ：长度大于 |\n| **x-forwarded-for** | 访问请求的客户端真实IP。X-Forwarded-For（XFF）用来识别通过HTTP代理或负载均衡方式转发的访问请求的客户端最原始的IP地址的HTTP请求头字段，只有通过HTTP代理或者负载均衡服务器转发的访问请求才会包含该项。 | **contain** ：包含<br>**ncontain** ：不包含<br>**equal** ：等于<br>**nequal** ：不等于<br>**lless** ：长度小于<br>**lequal** ：长度等于<br>**lgreat** ：长度大于<br>**nexist** ：不存在 |\n| **content-length** | 访问请求的所包含的字节数。 | **vless** ：值小于<br>**vequal** ：值等于<br>**vgreat** ：值大于 |\n| **post-body** | 访问请求的内容信息。 | **contain** ：包含<br>**ncontain** ：不包含<br>**equal** ：等于<br>**nequal** ：不等于 |\n| **http-method** | 访问请求的方法，如GET、POST等。 | **equal** ：等于<br>**nequal** ：不等于 |\n| **header** | 访问请求的头部信息，用于自定义HTTP头部字段。 | **contain** ：包含<br>**ncontain** ：不包含<br>**equal** ：等于<br>**nequal** ：不等于<br>**lless** ：长度小于<br>**lequal** ：长度等于<br>**lgreat** ：长度大于<br>**nexist** ：不存在 |"}