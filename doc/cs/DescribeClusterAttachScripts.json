{"summary":"如果需要将已有ECS实例添加到ACK集群中作为Worker节点，或移除Worker节点后需将节点实例重新加入节点池，ACK支持手动将已有节点到节点池。您可以调用DescribeClusterAttachScripts接口获取添加已有节点的脚本。","path":"/clusters/{ClusterId}/attachscript","methods":["post"],"schemes":["http","https"],"security":[{"AK":[]}],"consumes":["application/json"],"produces":["application/json"],"operationType":"read","deprecated":false,"systemTags":{"operationType":"update"},"parameters":[{"name":"ClusterId","in":"path","schema":{"title":"集群ID。","description":"集群ID。","type":"string","required":true,"example":"ca375a93a30474552ad2a0ebe183e****"}},{"name":"body","in":"body","schema":{"title":"请求体参数","description":"请求体参数。","type":"object","properties":{"nodepool_id":{"title":"节点池ID。将节点加入指定节点池。","description":"节点池ID，添加节点时可以将该节点添加到指定的节点池中。\n\n> 如果不指定节点池ID，默认将节点添加至默认节点池。","type":"string","required":false,"example":"np1c9229d9be2d432c93f77a88fca0****"},"format_disk":{"title":"数据盘挂载","description":"手动添加已有实例到集群时，是否对该实例进行数据盘挂载，将容器和镜像存储在数据盘上。取值：\n\n- `true`：对实例进行数据盘挂载，数据盘内原有数据将丢失，请注意备份数据。\n- `false`：不对实例进行数据盘挂载。\n\n默认值：`false`。\n\n数据挂载规则：\n\n- 如果 ECS 已挂载数据盘，且最后一块数据盘的文件系统未初始化，系统会自动将该数据盘格式化为 ext4，用来存放内容/var/lib/docker、/var/lib/kubelet 。\n- 如果 ECS 未挂载数据盘，则不会挂载新的数据盘。\n\n","type":"boolean","required":false,"example":"false"},"keep_instance_name":{"title":"保留实例名称","description":"添加已有实到集群时，是否保留实例名称。如果不保留，则实例名称格式为`worker-k8s-for-cs-<clusterid>`。取值：\n\n- `true`：保留实例名称。\n- `false`：不保留实例名称，会用系统规则进行替换。\n\n默认值：`true`。","type":"boolean","required":false,"example":"true"},"rds_instances":{"title":"RDS白名单","description":"如果指定了RDS实例列表，集群节点ECS会自动加入RDS访问白名单。","type":"array","items":{"description":"RDS实例名称。","type":"string","required":false,"example":"rm-xxx"},"required":false},"arch":{"title":"节点CPU架构,支持amd64、arm、arm64。边缘托管集群专有字段。","description":"节点CPU架构。支持的CPU架构包括`amd64`、`arm`、`arm64`。\n\n默认值：`amd64`。\n\n> 当集群类型为边缘托管版时必填。","type":"string","required":false,"example":"amd64"},"options":{"title":"边缘托管版集群节点的接入配置。","description":"节点的接入配置参数。\n\n> 当集群类型为边缘托管版时必填。","type":"string","required":false,"example":"{\\\"enableIptables\\\": true,\\\"manageRuntime\\\": true,\\\"quiet\\\": true,\\\"allowedClusterAddons\\\": [\\\"kube-proxy\\\",\\\"flannel\\\",\\\"coredns\\\"]}"}},"required":false,"example":"amd64"}}],"responses":{"200":{"schema":{"title":"添加节点脚本。","description":"节点接入脚本。","type":"string","example":"\"curl http://aliacs-k8s-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/public/pkg/run/attach/1.12.6-aliyunedge.1/edgeadm -O edgeadm; chmod u+x edgeadm; ./edgeadm join --openapi-token=XXX --node-spec=\"{\\\"flannelIface\\\":\\\"eth0\\\",\\\"enableIptables\\\":true,\\\"assumeYes\\\":true,\\\"manageRuntime\\\":true,\\\"nodeNameStrategy\\\":\\\"hostname\\\",\\\"enabledAddons\\\":[\\\"kube-proxy\\\",\\\"flannel\\\",\\\"coredns\\\"]}\"\""}},"5XX":{}},"responseDemo":"[{\"type\":\"json\",\"example\":\"\\\"\\\\\\\"curl http://aliacs-k8s-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/public/pkg/run/attach/1.12.6-aliyunedge.1/edgeadm -O edgeadm; chmod u+x edgeadm; ./edgeadm join --openapi-token=XXX --node-spec=\\\\\\\"{\\\\\\\\\\\\\\\"flannelIface\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"eth0\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"enableIptables\\\\\\\\\\\\\\\":true,\\\\\\\\\\\\\\\"assumeYes\\\\\\\\\\\\\\\":true,\\\\\\\\\\\\\\\"manageRuntime\\\\\\\\\\\\\\\":true,\\\\\\\\\\\\\\\"nodeNameStrategy\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"hostname\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"enabledAddons\\\\\\\\\\\\\\\":[\\\\\\\\\\\\\\\"kube-proxy\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"flannel\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"coredns\\\\\\\\\\\\\\\"]}\\\\\\\"\\\\\\\"\\\"\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"\",\"errorExample\":\"\"}]","title":"查询添加已有节点到集群节点池的脚本"}