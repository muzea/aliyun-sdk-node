{"summary":"ACK集群容器安全策略供了种类丰富的内置规则库，包括Compliance、Infra、K8s-general和PSP，旨在确保容器在生产环境中的安全运行。您可以调用DescribePolicyGovernanceInCluster接口，查询目标集群策略治理的详细信息，例如集群当前启用的不同等级策略计数统计、策略治理审计日志、拦截和告警情况等。","path":"/clusters/{cluster_id}/policygovernance","methods":["get"],"schemes":["http","https"],"security":[{"AK":[]}],"consumes":["application/json"],"produces":["application/json"],"operationType":"read","deprecated":false,"systemTags":{"operationType":"get"},"parameters":[{"name":"cluster_id","in":"path","schema":{"title":"目标集群ID","description":"目标集群ID","type":"string","required":true,"example":"c8155823d057948c69a****"}}],"responses":{"200":{"schema":{"title":"Schema of Response","description":"Schema of Response","type":"object","properties":{"on_state":{"title":"当前集群中开启的不同等级策略计数统计","description":"当前集群中开启的不同等级策略计数统计","type":"array","items":{"type":"object","properties":{"enabled_count":{"title":"当前开启的策略种类计数","description":"当前开启的策略种类计数","type":"integer","format":"int32","example":"3"},"total":{"title":"该等级下策略种类总数","description":"该等级下策略种类总数","type":"integer","format":"int32","example":"8"},"severity":{"title":"策略治理等级","description":"策略治理等级","type":"string","example":"high"}}}},"admit_log":{"title":"集群当前策略治理审计日志","description":"集群当前策略治理审计日志","type":"object","properties":{"progress":{"title":"查询结果的状态","description":"查询结果的状态，取值：\n* `Complete`：查询已经完成，返回结果为完整结果。\n* `Incomplete`：查询已经完成，返回结果为不完整结果，需要重复请求以获得完整结果。","type":"string","example":"Complete"},"count":{"title":"当前查询到的日志总数","description":"当前查询到的日志总数","type":"integer","format":"int64","example":"100"},"log":{"title":"策略治理审计日志内容","description":"策略治理审计日志内容","type":"object","properties":{"msg":{"title":"策略治理审计日志信息","description":"策略治理审计日志信息","type":"string","example":"d4hdhs*****"},"cluster_id":{"title":"目标集群ID","description":"目标集群ID","type":"string","example":"c8155823d057948c69a****"},"constraint_kind":{"title":"策略类型名称","description":"策略类型名称","type":"string","example":"ACKAllowedRepos"},"resource_name":{"title":"目标资源名称","description":"目标资源名称","type":"string","example":"nginx-deployment-basic2-84ccb74bfc-df22p"},"resource_kind":{"title":"目标资源类型","description":"目标资源类型","type":"string","example":"Pod"},"resource_namespace":{"title":"目标资源命名空间","description":"目标资源命名空间","type":"string","example":"default"}}}}},"totalViolations":{"title":"集群中当前被拦截和告警两种处理类型下不同治理等级的违规计数。","description":"集群中当前被拦截和告警两种处理类型下不同治理等级的违规计数。","type":"object","properties":{"deny":{"title":"被拦截的不同治理等级的违规计数统计","description":"被拦截的不同治理等级的违规计数统计","type":"object","properties":{"severity":{"title":"策略治理等级","description":"策略治理等级","type":"string","example":"high"},"violations":{"title":"被拦截的事件计数","description":"被拦截的事件计数","type":"integer","format":"int64","example":"0"}}},"warn":{"title":"告警模式下不同治理等级的违规计数统计","description":"告警模式下不同治理等级的违规计数统计","type":"object","properties":{"severity":{"title":"策略治理等级","description":"策略治理等级","type":"string","example":"low"},"violations":{"title":"告警的事件计数","description":"告警的事件计数","type":"integer","format":"int64","example":"5"}}}}},"violations":{"title":"集群中针对不同策略类型的拦截和告警的审计计数统计列表","description":"集群中针对不同策略类型的拦截和告警的审计计数统计列表","type":"object","properties":{"deny":{"title":"被拦截的不同策略类型的审计计数","description":"被拦截的不同策略类型的审计计数","type":"object","properties":{"policyName":{"title":"策略名称","description":"策略名称","type":"string","example":"policy-gatekeeper-ackallowedrepos"},"policyDescription":{"title":"策略描述","description":"策略描述","type":"string","example":"Requires container images to begin with a repo string from a specified list."},"violations":{"title":"对应规则的事件计数","description":"集群中对应规则类型下被拦截的违规计数统计","type":"integer","format":"int64","example":"11"},"severity":{"title":"策略治理等级","description":"策略治理等级","type":"string","example":"high"}}},"warn":{"title":"告警的不同策略类型审计计数","description":"告警模式下不同治理等级的违规计数统计","type":"object","properties":{"policyName":{"title":"策略名称","description":"策略名称","type":"string","example":"policy-gatekeeper-ackpspcapabilities"},"policyDescription":{"title":"策略描述","description":"策略描述","type":"string","example":"Controls Linux capabilities."},"violations":{"title":"对应规则的事件计数","description":"集群中对应规则类型下被告警的违规计数统计","type":"integer","format":"int64","example":"81"},"severity":{"title":"策略治理等级","description":"策略治理等级","type":"string","example":"high"}}}}}}}}},"responseDemo":"[{\"type\":\"json\",\"example\":\"{\\n  \\\"on_state\\\": [\\n    {\\n      \\\"enabled_count\\\": 3,\\n      \\\"total\\\": 8,\\n      \\\"severity\\\": \\\"high\\\"\\n    }\\n  ],\\n  \\\"admit_log\\\": {\\n    \\\"progress\\\": \\\"Complete\\\",\\n    \\\"count\\\": 100,\\n    \\\"log\\\": {\\n      \\\"msg\\\": \\\"d4hdhs*****\\\",\\n      \\\"cluster_id\\\": \\\"c8155823d057948c69a****\\\",\\n      \\\"constraint_kind\\\": \\\"ACKAllowedRepos\\\",\\n      \\\"resource_name\\\": \\\"nginx-deployment-basic2-84ccb74bfc-df22p\\\",\\n      \\\"resource_kind\\\": \\\"Pod\\\",\\n      \\\"resource_namespace\\\": \\\"default\\\"\\n    }\\n  },\\n  \\\"totalViolations\\\": {\\n    \\\"deny\\\": {\\n      \\\"severity\\\": \\\"high\\\",\\n      \\\"violations\\\": 0\\n    },\\n    \\\"warn\\\": {\\n      \\\"severity\\\": \\\"low\\\",\\n      \\\"violations\\\": 5\\n    }\\n  },\\n  \\\"violations\\\": {\\n    \\\"deny\\\": {\\n      \\\"policyName\\\": \\\"policy-gatekeeper-ackallowedrepos\\\",\\n      \\\"policyDescription\\\": \\\"Requires container images to begin with a repo string from a specified list.\\\",\\n      \\\"violations\\\": 11,\\n      \\\"severity\\\": \\\"high\\\"\\n    },\\n    \\\"warn\\\": {\\n      \\\"policyName\\\": \\\"policy-gatekeeper-ackpspcapabilities\\\",\\n      \\\"policyDescription\\\": \\\"Controls Linux capabilities.\\\",\\n      \\\"violations\\\": 81,\\n      \\\"severity\\\": \\\"high\\\"\\n    }\\n  }\\n}\",\"errorExample\":\"\"},{\"type\":\"xml\",\"example\":\"<DescribePolicyGovernanceInClusterResponse>\\n    <on_state>\\n        <enabled_count>0</enabled_count>\\n        <total>14</total>\\n        <severity>low</severity>\\n    </on_state>\\n    <on_state>\\n        <enabled_count>2</enabled_count>\\n        <total>13</total>\\n        <severity>high</severity>\\n    </on_state>\\n    <on_state>\\n        <enabled_count>1</enabled_count>\\n        <total>8</total>\\n        <severity>medium</severity>\\n    </on_state>\\n    <admit_log>\\n        <progress>Complete</progress>\\n        <count>75</count>\\n        <log>\\n            <__source__>192.168.0.188</__source__>\\n            <__tag__:__hostname__>iZwz98e621h0kvki3ja****</__tag__:__hostname__>\\n            <__tag__:__pack_id__>63DE8FD17599E86****</__tag__:__pack_id__>\\n            <__tag__:__path__>/policy_admit_logs/gatekeeper_admit.log</__tag__:__path__>\\n            <__tag__:__receive_time__>1631168040</__tag__:__receive_time__>\\n            <__tag__:__user_defined_id__>k8s-group-cb36d98a701ef4742b50603866809****</__tag__:__user_defined_id__>\\n            <__tag__:_container_ip_>10.102.0.89</__tag__:_container_ip_>\\n            <__tag__:_container_name_>manager</__tag__:_container_name_>\\n            <__tag__:_image_name_>registry-vpc.cn-shenzhen.aliyuncs.com/acs/gatekeeper:v3.6.0.60-g72c4896-aliyun</__tag__:_image_name_>\\n            <__tag__:_namespace_>kube-system</__tag__:_namespace_>\\n            <__tag__:_node_ip_>192.168.0.188</__tag__:_node_ip_>\\n            <__tag__:_node_name_>cn-shenzhen.192.168.XX.XX</__tag__:_node_name_>\\n            <__tag__:_pod_name_>gatekeeper-7648f64cc8-27nd4</__tag__:_pod_name_>\\n            <__tag__:_pod_uid_>11083b05-eecd-454c-8d22-81c83ce1****</__tag__:_pod_uid_>\\n            <__time__>1631168037</__time__>\\n            <__topic__/>\\n            <cluster_id>cb36d98a701ef4742b50603866809****</cluster_id>\\n            <constraint_action>deny</constraint_action>\\n            <constraint_api_version>v1beta1</constraint_api_version>\\n            <constraint_group>constraints.gatekeeper.sh</constraint_group>\\n            <constraint_kind>ACKAllowedRepos</constraint_kind>\\n            <constraint_name>allowed-repos-80970511-c93d-4c40-b692-be18c077****</constraint_name>\\n            <event_msg>Admission webhook \\\"validation.gatekeeper.sh\\\" denied request, Resource Namespace: default, Constraint: allowed-repos-80970511-c93d-4c40-b692-be18c0770382, Message: container &lt;nginx&gt; has an invalid image repo &lt;nginx:1.7.9&gt;, allowed repos are [\\\"registry.cn-shanghai.aliyuncs.com/acs/\\\", \\\"registry.cn-hangzhou.aliyuncs.com/acs/\\\"]</event_msg>\\n            <event_reason>GatekeeperFailedAdmission</event_reason>\\n            <event_type>violation</event_type>\\n            <level>info</level>\\n            <logger>ack_policy_admit_log_for_sls</logger>\\n            <msg>container &lt;nginx&gt; has an invalid image repo &lt;nginx:1.7.9&gt;, allowed repos are [\\\"registry.cn-shanghai.aliyuncs.com/acs/\\\", \\\"registry.cn-hangzhou.aliyuncs.com/acs/\\\"]</msg>\\n            <process>admission</process>\\n            <request_uid>9db8f008-c2e8-4723-a380-18ef358c2827</request_uid>\\n            <request_username>system:serviceaccount:kube-system:replicaset-controller</request_username>\\n            <resource_api_version>v1</resource_api_version>\\n            <resource_group/>\\n            <resource_kind>Pod</resource_kind>\\n            <resource_name>nginx-deployment-basic2-84ccb74bfc-df22p</resource_name>\\n            <resource_namespace>default</resource_namespace>\\n            <time>2021-09-09T06:13:57Z</time>\\n            <ts>1631168037.444757</ts>\\n        </log>\\n        <log>\\n            <__source__>192.168.XX.XX</__source__>\\n        </log>\\n    </admit_log>\\n    <Violation>\\n        <totalViolations>\\n            <deny>\\n                <severity>high</severity>\\n                <violations>75</violations>\\n            </deny>\\n            <deny>\\n                <severity>medium</severity>\\n                <violations>0</violations>\\n            </deny>\\n            <warn>\\n                <severity>high</severity>\\n                <violations>0</violations>\\n            </warn>\\n            <warn>\\n                <severity>medium</severity>\\n                <violations>0</violations>\\n            </warn>\\n        </totalViolations>\\n        <violations>\\n            <deny>\\n                <policyName>policy-gatekeeper-ackallowedrepos</policyName>\\n                <policyDescription>Requires container images to begin with a repo string from a specified list.</policyDescription>\\n                <severity>high</severity>\\n                <violations>11</violations>\\n            </deny>\\n            <deny>\\n                <policyName>policy-gatekeeper-ackpspcapabilities</policyName>\\n                <policyDescription>Controls Linux capabilities.</policyDescription>\\n                <severity>high</severity>\\n                <violations>81</violations>\\n            </deny>\\n        </violations>\\n    </Violation>\\n</DescribePolicyGovernanceInClusterResponse>\",\"errorExample\":\"\"}]","title":"获取集群策略治理详情"}